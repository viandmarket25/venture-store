"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[192],{192:(gl,$e,d)=>{d.r($e),d.d($e,{AddManualPaymentDialogComponent:()=>W,CancelOrderDialogComponent:()=>z,CouponCodeSelectorComponent:()=>Y,DraftOrderDetailComponent:()=>H,DraftOrderVariantSelectorComponent:()=>ie,FulfillOrderDialogComponent:()=>ae,FulfillmentCardComponent:()=>ce,FulfillmentDetailComponent:()=>G,FulfillmentStateLabelComponent:()=>le,GET_COUPON_CODE_SELECTOR_PROMOTION_LIST:()=>St,GET_CUSTOMER_ADDRESSES:()=>_l,GET_SELLER_ORDERS:()=>gt,LineFulfillmentComponent:()=>R,LineRefundsComponent:()=>Q,ModificationDetailComponent:()=>de,NODE_HEIGHT:()=>je,ORDER_DETAIL_QUERY:()=>ia,OrderCustomFieldsCardComponent:()=>oe,OrderDataTableComponent:()=>$,OrderDetailComponent:()=>ye,OrderEditResultType:()=>L,OrderEditorComponent:()=>Ze,OrderEditsPreviewDialogComponent:()=>Oe,OrderGuard:()=>w,OrderHistoryComponent:()=>Ce,OrderHistoryEntryHostComponent:()=>xe,OrderListComponent:()=>be,OrderModule:()=>Te,OrderPaymentCardComponent:()=>he,OrderProcessEdgeComponent:()=>se,OrderProcessGraphComponent:()=>pe,OrderProcessGraphDialogComponent:()=>ue,OrderProcessNodeComponent:()=>K,OrderResolver:()=>B,OrderStateSelectDialogComponent:()=>re,OrderTableComponent:()=>k,OrderTotalColumnComponent:()=>U,OrderTransitionService:()=>A,PaymentDetailComponent:()=>V,PaymentStateLabelComponent:()=>ge,RefundOrderDialogComponent:()=>_e,RefundStateLabelComponent:()=>fe,SelectAddressDialogComponent:()=>j,SelectCustomerDialogComponent:()=>te,SelectShippingMethodDialogComponent:()=>ne,SellerOrdersCardComponent:()=>ve,SettleRefundDialogComponent:()=>me,SimpleItemListComponent:()=>E,createRoutes:()=>Ct,modifyingOrderBreadcrumb:()=>yt,orderBreadcrumb:()=>vt});var l=d(6008),c=d(5209),Ae=d(7698),e=d(3162),M=d(7734),Me=d(4889),x=d(8434),Z=d(8356),y=d(8279),p=d(7347),m=d(2477),h=d(2491);function Ot(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.add-payment-to-order"))}function Zt(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"translate"),e.ALo(6,"localeCurrency"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.form.invalid||t.form.pristine),e.xp6(1),e.AsE(" ",e.lcZ(5,6,"order.add-payment")," (",e.xi3(6,8,t.outstandingAmount,t.currencyCode),") ")}}Ae.Ps`
    query GetAddManualPaymentMethodList($options: PaymentMethodListOptions!) {
        paymentMethods(options: $options) {
            items {
                id
                createdAt
                updatedAt
                name
                code
                description
                enabled
            }
            totalItems
        }
    }
`;class W{constructor(n){this.dataService=n,this.form=new l.nJ({method:new l.p4("",l.kI.required),transactionId:new l.p4("",l.kI.required)})}ngOnInit(){this.paymentMethods$=this.dataService.query(c.nv3,{options:{take:999}}).mapSingle(n=>n.paymentMethods.items)}submit(){const n=this.form.value;this.resolveWith({method:n.method,transactionId:n.transactionId})}cancel(){this.resolveWith()}}W.\u0275fac=function(n){return new(n||W)(e.Y36(c.DoR))},W.\u0275cmp=e.Xpm({type:W,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","appendTo","body","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Ot,2,3,"ng-template",0),e.TgZ(1,"form",1)(2,"vdr-form-field",2),e.ALo(3,"translate"),e._UZ(4,"ng-select",3),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"vdr-form-field",4),e.ALo(7,"translate"),e._UZ(8,"input",5),e.qZA()(),e.YNc(9,Zt,7,11,"ng-template",6)),2&n&&(e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("label",e.lcZ(3,5,"order.payment-method")),e.xp6(2),e.Q6J("items",e.lcZ(5,7,t.paymentMethods$))("addTag",!0),e.xp6(2),e.Q6J("label",e.lcZ(7,9,"order.transaction-id")))},dependencies:[l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,M.w9,Me.h,x.y,Z.n,y.q,p.Ov,m.X$,h.k],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0});var _=d(8511),u=d(296),X=d(2533);function bt(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.cancel-order"))}function Tt(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",19),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id]=i)})("input",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.checkIfAllSelected())}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("ngModel",o.lineQuantities[t.id])("disabled",o.cancelAll)("max",t.quantity)}}function At(r,n){if(1&r&&e._uU(0),2&r){const t=e.oxw().$implicit;e.Oqu(t.quantity)}}function It(r,n){if(1&r&&(e.TgZ(0,"tr",10)(1,"td",11),e._UZ(2,"img",12),e.ALo(3,"assetPreview"),e.qZA(),e.TgZ(4,"td",13),e._uU(5),e.qZA(),e.TgZ(6,"td",14),e._uU(7),e.qZA(),e.TgZ(8,"td",15),e._uU(9),e.qZA(),e.TgZ(10,"td",15),e._uU(11),e.ALo(12,"localeCurrency"),e.qZA(),e.TgZ(13,"td",16),e.YNc(14,Tt,1,3,"input",17),e.YNc(15,At,1,1,"ng-template",null,18,e.W1O),e.qZA()()),2&r){const t=n.$implicit,o=e.MAs(16),i=e.oxw();e.ekj("is-disabled",i.cancelAll)("is-cancelled",0===t.quantity),e.xp6(2),e.Q6J("src",e.xi3(3,11,t.featuredAsset,"tiny"),e.LSH),e.xp6(3),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.Oqu(t.quantity),e.xp6(2),e.hij(" ",e.xi3(12,14,t.unitPriceWithTax,i.order.currencyCode)," "),e.xp6(3),e.Q6J("ngIf",t.quantity>0&&!i.order.active)("ngIfElse",o)}}function Lt(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"clr-radio-wrapper")(2,"input",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.cancelAll=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.radioChanged())}),e.qZA(),e.TgZ(3,"label"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"clr-radio-wrapper")(7,"input",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.cancelAll=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.radioChanged())}),e.qZA(),e.TgZ(8,"label"),e._uU(9),e.ALo(10,"translate"),e.qZA()(),e.BQk()}if(2&r){const t=e.oxw();e.xp6(2),e.Q6J("value",!0)("ngModel",t.cancelAll),e.xp6(2),e.Oqu(e.lcZ(5,6,"order.cancel-entire-order")),e.xp6(3),e.Q6J("value",!1)("ngModel",t.cancelAll),e.xp6(2),e.Oqu(e.lcZ(10,8,"order.cancel-specified-items"))}}function wt(r,n){1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-selected-items")," "))}function Mt(r,n){1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-order")," "))}function Ft(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e.YNc(4,wt,3,3,"ng-container",6),e.YNc(5,Mt,3,3,"ng-container",6),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.reason||!t.order.active&&0===t.selectionCount),e.xp6(1),e.Q6J("ngIf",!t.order.active),e.xp6(1),e.Q6J("ngIf",t.order.active)}}class z{get selectionCount(){return Object.values(this.lineQuantities).reduce((n,t)=>n+t,0)}constructor(n){this.i18nService=n,this.cancelAll=!0,this.lineQuantities={},this.reasons=(0,c.hq7)().cancellationReasons??[(0,_.J)("order.cancel-reason-customer-request"),(0,_.J)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(t=>this.i18nService.translate(t))}ngOnInit(){this.lineQuantities=this.order.lines.reduce((n,t)=>({...n,[t.id]:t.quantity}),{})}radioChanged(){if(this.cancelAll)for(const n of this.order.lines)this.lineQuantities[n.id]=n.quantity;else for(const n of this.order.lines)this.lineQuantities[n.id]=0}checkIfAllSelected(){for(const[n,t]of Object.entries(this.lineQuantities)){const o=this.order.lines.find(i=>i.id===n)?.quantity;if(o&&t<o)return}this.cancelAll=!0}select(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason,cancelShipping:this.cancelAll})}cancel(){this.resolveWith()}getLineInputs(){if(!this.order.active)return Object.entries(this.lineQuantities).map(([n,t])=>({orderLineId:n,quantity:t})).filter(n=>0<n.quantity)}}z.\u0275fac=function(n){return new(n||z)(e.Y36(c.Dp7))},z.\u0275cmp=e.Xpm({type:z,selectors:[["vdr-cancel-order-dialog"]],decls:30,vars:23,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-disabled","is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[4,"ngIf"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input"],["type","radio","clrRadio","","name","options",3,"value","ngModel","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,bt,2,3,"ng-template",0),e.TgZ(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA()()(),e.YNc(22,It,17,17,"tr",4),e.qZA()(),e.TgZ(23,"div",5),e.YNc(24,Lt,11,10,"ng-container",6),e.TgZ(25,"label",7),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"ng-select",8),e.NdJ("ngModelChange",function(i){return t.reason=i}),e.qZA()()(),e.YNc(29,Ft,6,6,"ng-template",9)),2&n&&(e.xp6(8),e.Oqu(e.lcZ(9,11,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,13,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,15,"order.quantity")),e.xp6(3),e.Oqu(e.lcZ(18,17,"order.unit-price")),e.xp6(3),e.Oqu(e.lcZ(21,19,"order.cancel")),e.xp6(2),e.Q6J("ngForOf",t.order.lines),e.xp6(2),e.Q6J("ngIf",!0!==t.order.active),e.xp6(2),e.Oqu(e.lcZ(27,21,"order.cancellation-reason")),e.xp6(2),e.Q6J("items",t.reasons)("addTag",!0)("ngModel",t.reason))},dependencies:[u.MgK,u.asN,u.EeQ,p.sg,p.O5,l.Fj,l.wV,l._,l.JJ,l.qQ,l.Fd,l.On,M.w9,x.y,Z.n,y.q,m.X$,X.M,h.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});var ee=d(8077),He=d(196),Qe=d(4144),Ge=d(536),g=d(407),b=d(2303),Ke=d(6821),F=d(6489);function qt(r,n){if(1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.qZA(),e._uU(2)),2&r){const t=n.item;e.xp6(1),e.Oqu(t.code),e.xp6(1),e.hij(" ",t.promotionName," ")}}const St=Ae.Ps`
    query GetCouponCodeSelectorPromotionList($options: PromotionListOptions) {
        promotions(options: $options) {
            items {
                id
                name
                couponCode
            }
            totalItems
        }
    }
`;class Y{constructor(n){this.dataService=n,this.addCouponCode=new e.vpe,this.removeCouponCode=new e.vpe,this.couponCodeInput$=new ee.x}ngOnInit(){this.availableCouponCodes$=(0,He.z)(this.couponCodeInput$.pipe((0,Qe.b)(200),(0,Ge.x)(),(0,g.w)(n=>this.dataService.query(c.RZZ,{options:{take:10,skip:0,filter:{couponCode:{contains:n}}}}).single$),(0,b.U)(({promotions:n})=>n.items.map(t=>({code:t.couponCode,promotionName:t.name}))),(0,Ke.O)([]))),this.control||(this.control=new l.p4(this.couponCodes??[]))}}Y.\u0275fac=function(n){return new(n||Y)(e.Y36(c.DoR))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["vdr-coupon-code-selector"]],inputs:{couponCodes:"couponCodes",control:"control"},outputs:{addCouponCode:"addCouponCode",removeCouponCode:"removeCouponCode"},decls:3,vars:9,consts:[["appendTo","body","bindLabel","code","bindValue","code","typeToSearchText","",3,"items","addTag","multiple","hideSelected","minTermLength","typeahead","formControl","add","remove"],["ng-option-tmp",""]],template:function(n,t){1&n&&(e.TgZ(0,"ng-select",0),e.NdJ("add",function(i){return t.addCouponCode.emit(i.code)})("remove",function(i){return t.removeCouponCode.emit(null==i.value?null:i.value.code)}),e.ALo(1,"async"),e.YNc(2,qt,3,2,"ng-template",1),e.qZA()),2&n&&e.Q6J("items",e.lcZ(1,7,t.availableCouponCodes$))("addTag",!1)("multiple",!0)("hideSelected",!0)("minTermLength",2)("typeahead",t.couponCodeInput$)("formControl",t.control)},dependencies:[l.JJ,l.oH,M.w9,M.ir,F.Y,p.Ov],changeDetection:0});var Pt=d(7296),q=d(233),Jt=d(3312),v=d(2680),Ie=d(5244),Fe=d(463),Ve=d(3339),Be=d(5303),We=d(8812);function Dt(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.select-address"))}function Nt(r,n){if(1&r&&(e.TgZ(0,"vdr-radio-card",7),e._UZ(1,"vdr-formatted-address",8),e.qZA()),2&r){const t=n.$implicit;e.Q6J("item",t),e.xp6(1),e.Q6J("address",t)}}function Qt(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tab-content")(1,"vdr-radio-card-fieldset",5),e.NdJ("selectItem",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.selectedAddress=i)}),e.YNc(2,Nt,2,2,"vdr-radio-card",6),e.qZA()()}if(2&r){const t=e.oxw(2).ngIf,o=e.oxw();e.xp6(1),e.Q6J("idFn",o.addressIdFn)("selectedItemId",o.selectedAddress&&o.addressIdFn(o.selectedAddress)),e.xp6(1),e.Q6J("ngForOf",t)}}function Ut(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tab")(1,"button",3),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Qt,3,3,"ng-template",4),e.NdJ("clrIfActiveChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.useExisting=i)}),e.qZA()}if(2&r){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,"order.existing-address")),e.xp6(2),e.Q6J("clrIfActive",t.useExisting)}}function kt(r,n){if(1&r&&(e.TgZ(0,"clr-tab-content"),e._UZ(1,"vdr-address-form",9),e.ALo(2,"async"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.addressForm)("availableCountries",e.lcZ(2,2,t.availableCountries$))}}function Et(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tabs"),e.YNc(1,Ut,5,4,"clr-tab",1),e.TgZ(2,"clr-tab")(3,"button",3),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.YNc(6,kt,3,4,"ng-template",4),e.NdJ("clrIfActiveChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.createNew=i)}),e.qZA()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.customerId&&t.length),e.xp6(3),e.Oqu(e.lcZ(5,3,"customer.create-new-address")),e.xp6(2),e.Q6J("clrIfActive",o.createNew)}}function Yt(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.useExisting&&!t.selectedAddress||t.createNew&&t.addressForm.invalid),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.okay")," ")}}class j{constructor(n,t){this.dataService=n,this.formBuilder=t,this.useExisting=!0,this.createNew=!1}ngOnInit(){this.addressForm=this.formBuilder.group({fullName:[this.currentAddress?.fullName??""],company:[this.currentAddress?.company??""],streetLine1:[this.currentAddress?.streetLine1??"",l.kI.required],streetLine2:[this.currentAddress?.streetLine2??""],city:[this.currentAddress?.city??"",l.kI.required],province:[this.currentAddress?.province??""],postalCode:[this.currentAddress?.postalCode??"",l.kI.required],countryCode:[this.currentAddress?.countryCode??"",l.kI.required],phoneNumber:[this.currentAddress?.phoneNumber??""]}),this.useExisting=!!this.customerId,this.addresses$=this.customerId?this.dataService.query(c.lii,{customerId:this.customerId}).mapSingle(({customer:n})=>n?.addresses??[]).pipe((0,Ie.b)(n=>{this.currentAddress&&(this.selectedAddress=n.find(t=>t.streetLine1===this.currentAddress?.streetLine1&&t.postalCode===this.currentAddress?.postalCode)),0===n.length&&(this.createNew=!0,this.useExisting=!1)})):(0,v.of)([]),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(({countries:n})=>n.items)}trackByFn(n){return n.id}addressIdFn(n){return n.streetLine1+n.postalCode}cancel(){this.resolveWith()}select(){if(this.useExisting&&this.selectedAddress&&this.resolveWith({...(0,Jt.e)(this.selectedAddress,["fullName","company","streetLine1","streetLine2","city","province","phoneNumber","postalCode"]),countryCode:this.selectedAddress.country.code}),this.createNew&&this.addressForm.valid){const n=this.addressForm.value;this.resolveWith(n)}}}j.\u0275fac=function(n){return new(n||j)(e.Y36(c.DoR),e.Y36(l.QS))},j.\u0275cmp=e.Xpm({type:j,selectors:[["vdr-select-address-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[4,"ngIf"],["vdrDialogButtons",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],[1,"block","mt-4",3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"address"],[3,"formGroup","availableCountries"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Dt,2,3,"ng-template",0),e.YNc(1,Et,7,5,"clr-tabs",1),e.ALo(2,"async"),e.YNc(3,Yt,6,7,"ng-template",2)),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.addresses$)))},dependencies:[u.tam,u.UkA,u.S4y,u.gKI,u.Iq$,u.dl,u.Qs7,p.sg,p.O5,l.JL,l.sg,Z.n,y.q,Fe.b,Ve.C,Be.C,We.m,p.Ov,m.X$],changeDetection:0});var Xe=d(1196);function jt(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.set-customer-for-order"))}function Rt(r,n){if(1&r&&(e.TgZ(0,"span",8),e._UZ(1,"clr-icon",9),e.TgZ(2,"span",10),e._uU(3),e.qZA(),e.TgZ(4,"vdr-chip"),e._uU(5),e.qZA()()),2&r){const t=n.item;e.xp6(3),e.AsE("",t.firstName," ",t.lastName,""),e.xp6(2),e.Oqu(t.emailAddress)}}function $t(r,n){if(1&r&&(e.TgZ(0,"span",8),e._UZ(1,"clr-icon",9),e.TgZ(2,"span",10),e._uU(3),e.qZA(),e.TgZ(4,"vdr-chip"),e._uU(5),e.qZA()()),2&r){const t=n.item;e.xp6(3),e.AsE("",t.firstName," ",t.lastName,""),e.xp6(2),e.Oqu(t.emailAddress)}}function Ht(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-tab-content")(1,"div",4)(2,"ng-select",5),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.selectedCustomer=i)}),e.ALo(3,"async"),e.YNc(4,Rt,6,3,"ng-template",6),e.YNc(5,$t,6,3,"ng-template",7),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(2),e.Q6J("items",e.lcZ(3,9,t.customers$))("addTag",!1)("multiple",!0)("hideSelected",!0)("trackByFn",t.trackByFn)("minTermLength",2)("loading",t.isLoading)("typeahead",t.input$)("ngModel",t.selectedCustomer)}}function Gt(r,n){if(1&r&&(e.TgZ(0,"clr-tab-content")(1,"form",11)(2,"vdr-form-field",12),e.ALo(3,"translate"),e._UZ(4,"input",13),e.qZA(),e.TgZ(5,"vdr-form-field",14),e.ALo(6,"translate"),e._UZ(7,"input",15),e.qZA(),e.TgZ(8,"vdr-form-field",16),e.ALo(9,"translate"),e._UZ(10,"input",17),e.qZA(),e.TgZ(11,"vdr-form-field",18),e.ALo(12,"translate"),e._UZ(13,"input",19),e.qZA(),e.TgZ(14,"vdr-form-field",20),e.ALo(15,"translate"),e._UZ(16,"input",21),e.qZA()()()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.customerForm),e.xp6(1),e.Q6J("label",e.lcZ(3,6,"customer.title")),e.xp6(3),e.Q6J("label",e.lcZ(6,8,"customer.first-name")),e.xp6(3),e.Q6J("label",e.lcZ(9,10,"customer.last-name")),e.xp6(3),e.Q6J("label",e.lcZ(12,12,"customer.email-address")),e.xp6(3),e.Q6J("label",e.lcZ(15,14,"customer.phone-number"))}}function Kt(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.useExisting&&0===t.selectedCustomer.length||t.createNew&&t.customerForm.invalid),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.okay")," ")}}class te{constructor(n,t){this.dataService=n,this.formBuilder=t,this.isLoading=!1,this.input$=new ee.x,this.selectedCustomer=[],this.useExisting=!0,this.createNew=!1,this.customerForm=this.formBuilder.group({title:"",firstName:["",l.kI.required],lastName:["",l.kI.required],phoneNumber:"",emailAddress:["",[l.kI.required,l.kI.email]]})}ngOnInit(){this.customers$=(0,He.z)((0,v.of)([]),this.input$.pipe((0,Qe.b)(200),(0,Ge.x)(),(0,Ie.b)(()=>this.isLoading=!0),(0,g.w)(n=>this.dataService.customer.getCustomerList(10,0,n).mapStream(({customers:t})=>t.items).pipe((0,Xe.K)(()=>(0,v.of)([])),(0,Ie.b)(()=>this.isLoading=!1)))))}trackByFn(n){return n.id}cancel(){this.resolveWith()}select(){if(this.useExisting&&1===this.selectedCustomer.length&&this.resolveWith(this.selectedCustomer[0]),this.createNew&&this.customerForm.valid){const n=this.customerForm.value;this.resolveWith(n)}}}te.\u0275fac=function(n){return new(n||te)(e.Y36(c.DoR),e.Y36(l.QS))},te.\u0275cmp=e.Xpm({type:te,selectors:[["vdr-select-customer-dialog"]],decls:13,vars:8,consts:[["vdrDialogTitle",""],["clrTabLink",""],[3,"clrIfActive","clrIfActiveChange"],["vdrDialogButtons",""],[1,"mt-4"],["appendTo","body","bindLabel","name",3,"items","addTag","multiple","hideSelected","trackByFn","minTermLength","loading","typeahead","ngModel","ngModelChange"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"item-row"],["shape","user",1,"is-solid"],[1,"mx-1"],[3,"formGroup"],["for","title",3,"label"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,jt,2,3,"ng-template",0),e.TgZ(1,"clr-tabs")(2,"clr-tab")(3,"button",1),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.YNc(6,Ht,6,11,"ng-template",2),e.NdJ("clrIfActiveChange",function(i){return t.useExisting=i}),e.qZA(),e.TgZ(7,"clr-tab")(8,"button",1),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.YNc(11,Gt,17,16,"ng-template",2),e.NdJ("clrIfActiveChange",function(i){return t.createNew=i}),e.qZA()(),e.YNc(12,Kt,6,7,"ng-template",3)),2&n&&(e.xp6(4),e.Oqu(e.lcZ(5,4,"order.existing-customer")),e.xp6(2),e.Q6J("clrIfActive",t.useExisting),e.xp6(3),e.Oqu(e.lcZ(10,6,"customer.create-new-customer")),e.xp6(2),e.Q6J("clrIfActive",t.createNew))},dependencies:[u.qvL,u.tam,u.UkA,u.S4y,u.gKI,u.Iq$,u.dl,u.Qs7,l._Y,l.Fj,l.JJ,l.JL,l.On,l.sg,l.u,M.w9,M.ir,M.mR,F.Y,Me.h,x.y,Z.n,y.q,p.Ov,m.X$],styles:[".item-row[_ngcontent-%COMP%]{display:flex;align-items:center}"],changeDetection:0});var T=d(8258),qe=d(1434);function Vt(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.select-shipping-method"))}function Bt(r,n){if(1&r&&e._UZ(0,"vdr-object-tree",9),2&r){const t=e.oxw().$implicit;e.Q6J("value",t.metadata)}}function Wt(r,n){if(1&r&&(e.TgZ(0,"vdr-radio-card",4)(1,"div",5)(2,"vdr-labeled-data",6),e.ALo(3,"translate"),e._uU(4),e.qZA(),e.TgZ(5,"div",7)(6,"vdr-labeled-data",6),e.ALo(7,"translate"),e._uU(8),e.ALo(9,"localeCurrency"),e.qZA(),e.TgZ(10,"vdr-labeled-data",6),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA()(),e.YNc(14,Bt,1,1,"vdr-object-tree",8),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw();e.Q6J("item",t),e.xp6(2),e.Q6J("label",e.lcZ(3,8,"settings.shipping-method")),e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.Q6J("label",e.lcZ(7,10,"common.price")),e.xp6(2),e.hij(" ",e.xi3(9,12,t.price,o.currencyCode)," "),e.xp6(2),e.Q6J("label",e.lcZ(11,15,"common.price-with-tax")),e.xp6(2),e.hij(" ",e.xi3(13,17,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",t.metadata)}}function Xt(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.selectedMethod),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.okay")," ")}}class ne{ngOnInit(){this.currentSelectionId&&(this.selectedMethod=this.eligibleShippingMethods.find(n=>n.id===this.currentSelectionId))}methodIdFn(n){return n.id}cancel(){this.resolveWith()}select(){this.selectedMethod&&this.resolveWith(this.selectedMethod.id)}}ne.\u0275fac=function(n){return new(n||ne)},ne.\u0275cmp=e.Xpm({type:ne,selectors:[["vdr-select-shipping-method-dialog"]],decls:4,vars:3,consts:[["vdrDialogTitle",""],[3,"idFn","selectedItemId","selectItem"],[3,"item",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"item"],[1,"result-details"],[3,"label"],[1,"price-row"],[3,"value",4,"ngIf"],[3,"value"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Vt,2,3,"ng-template",0),e.TgZ(1,"vdr-radio-card-fieldset",1),e.NdJ("selectItem",function(i){return t.selectedMethod=i}),e.YNc(2,Wt,15,20,"vdr-radio-card",2),e.qZA(),e.YNc(3,Xt,6,7,"ng-template",3)),2&n&&(e.xp6(1),e.Q6J("idFn",t.methodIdFn)("selectedItemId",null==t.selectedMethod?null:t.selectedMethod.id),e.xp6(1),e.Q6J("ngForOf",t.eligibleShippingMethods))},dependencies:[p.sg,p.O5,Z.n,y.q,T.W,qe._,Be.C,We.m,m.X$,h.k],changeDetection:0});var S=d(3618),zt=d(3346),en=d(9931),ze=d(2493);var nn=d(904),P=d(3756);function rn(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.select-state"))}function on(r,n){if(1&r&&(e.TgZ(0,"option",4),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"stateI18nToken"),e.qZA()),2&r){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",e.lcZ(2,2,e.lcZ(3,4,t))," ")}}function an(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"common.cancel")," "))}const ln=function(r){return{state:r}};function cn(r,n){if(1&r){const t=e.EpF();e.YNc(0,an,3,3,"button",5),e.TgZ(1,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()}if(2&r){const t=e.oxw();e.Q6J("ngIf",t.cancellable),e.xp6(1),e.Q6J("disabled",!t.selectedState),e.xp6(1),e.hij(" ",e.xi3(3,3,"order.transition-to-state",e.VKq(10,ln,e.lcZ(4,6,e.lcZ(5,8,t.selectedState))))," ")}}class re{constructor(){this.nextStates=[],this.message="",this.selectedState=""}select(){this.selectedState&&this.resolveWith(this.selectedState)}cancel(){this.resolveWith()}}re.\u0275fac=function(n){return new(n||re)},re.\u0275cmp=e.Xpm({type:re,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(n,t){1&n&&(e.YNc(0,rn,2,3,"ng-template",0),e.TgZ(1,"p"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-form-field")(5,"select",1),e.NdJ("ngModelChange",function(i){return t.selectedState=i}),e.YNc(6,on,4,6,"option",2),e.qZA()(),e.YNc(7,cn,6,12,"ng-template",3)),2&n&&(e.xp6(2),e.Oqu(e.lcZ(3,3,t.message)),e.xp6(3),e.Q6J("ngModel",t.selectedState),e.xp6(1),e.Q6J("ngForOf",t.nextStates))},dependencies:[p.sg,p.O5,l.YN,l.Kr,l.EJ,l.JJ,l.On,Me.h,x.y,Z.n,y.q,m.X$,P.N],changeDetection:0});class A{constructor(n,t,o,i){this.dataService=n,this.modalService=t,this.notificationService=o,this.i18nService=i}transitionToPreModifyingState(n,t){return this.getPreModifyingState(n).pipe((0,g.w)(o=>{const i={orderId:n,nextStates:t,message:this.i18nService.translate((0,_.J)("order.unable-to-transition-to-state-try-another"),{state:o}),cancellable:!1,retry:10};return o?this.transitionToStateOrThrow(n,o).pipe((0,Xe.K)(a=>this.manuallyTransitionToState(i))):this.manuallyTransitionToState(i)}))}manuallyTransitionToState(n){return this.modalService.fromComponent(re,{locals:{nextStates:n.nextStates,cancellable:n.cancellable,message:n.message},closable:!1,size:"md"}).pipe((0,g.w)(t=>{if(t)return this.transitionToStateOrThrow(n.orderId,t);if(n.cancellable)return S.E;throw new Error("An order state must be selected")}),function tn(r){return(0,en.e)((n,t)=>{let o,a,i=!1;const s=()=>{o=n.subscribe((0,ze.x)(t,void 0,void 0,f=>{a||(a=new ee.x,(0,zt.Xf)(r(a)).subscribe((0,ze.x)(t,()=>o?s():i=!0))),a&&a.next(f)})),i&&(o.unsubscribe(),o=null,i=!1,s())};s()})}(t=>t.pipe((0,nn.g)(2e3),(0,q.q)(n.retry))))}getPreModifyingState(n){return this.dataService.order.getOrderHistory(n,{filter:{type:{eq:c.iYD.ORDER_STATE_TRANSITION}},sort:{createdAt:c.Asd.DESC}}).mapSingle(t=>t.order).pipe((0,b.U)(t=>{const o=t?.history.items.find(i=>"Modifying"===i.data.to);if(o)return o.data.from}))}transitionToStateOrThrow(n,t){return this.dataService.order.transitionToState(n,t).pipe((0,b.U)(({transitionOrderToState:o})=>{switch(o?.__typename){case"Order":return o?.state;case"OrderStateTransitionError":throw this.notificationService.error(o?.transitionError),new Error(o?.transitionError)}}))}}A.\u0275fac=function(n){return new(n||A)(e.LFG(c.DoR),e.LFG(c.Z7U),e.LFG(c.gqp),e.LFG(c.Dp7))},A.\u0275prov=e.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"});var O=d(8763),Ue=d(9705),J=d(9014),D=d(433),N=d(8308),Le=d(9182),we=d(2814),Se=d(3827),et=d(7362),tt=d(3332),nt=d(3661),Pe=d(7790),ke=d(7536);function dn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.editable=!0)}),e._UZ(1,"clr-icon",10),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&r&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"common.edit")," "))}function sn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onUpdateClick())}),e._UZ(1,"clr-icon",12),e._uU(2),e.ALo(3,"translate"),e.qZA()}if(2&r){const t=e.oxw(2);e.Q6J("disabled",t.customFieldForm.pristine||t.customFieldForm.invalid),e.xp6(2),e.hij(" ",e.lcZ(3,2,"common.update")," ")}}function pn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.onCancelClick())}),e._UZ(1,"clr-icon",13),e._uU(2),e.ALo(3,"translate"),e.qZA()}2&r&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"common.cancel")," "))}function un(r,n){if(1&r&&(e.TgZ(0,"div",1)(1,"div",2),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4),e._UZ(6,"vdr-tabbed-custom-fields",5),e.qZA()(),e.TgZ(7,"div",6),e.YNc(8,dn,4,3,"button",7),e.YNc(9,sn,4,4,"button",8),e.YNc(10,pn,4,3,"button",7),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,10,"common.custom-fields")," "),e.xp6(3),e.ekj("editable",t.editable),e.xp6(1),e.Q6J("customFields",t.customFieldsConfig)("customFieldsFormGroup",t.customFieldForm)("readonly",!t.editable)("compact",!0),e.xp6(2),e.Q6J("ngIf",!t.editable),e.xp6(1),e.Q6J("ngIf",t.editable),e.xp6(1),e.Q6J("ngIf",t.editable)}}class oe{constructor(n,t){this.formBuilder=n,this.modalService=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new e.vpe,this.editable=!1}ngOnInit(){this.customFieldForm=this.formBuilder.group({});for(const n of this.customFieldsConfig)this.customFieldForm.addControl(n.name,this.formBuilder.control(this.customFieldValues[n.name]))}onUpdateClick(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}onCancelClick(){this.customFieldForm.dirty?this.modalService.dialog({title:(0,_.J)("catalog.confirm-cancel"),buttons:[{type:"secondary",label:(0,_.J)("common.keep-editing")},{type:"danger",label:(0,_.J)("common.discard-changes"),returnValue:!0}]}).subscribe(n=>{n&&(this.customFieldForm.reset(),this.customFieldForm.markAsPristine(),this.editable=!1)}):this.editable=!1}}oe.\u0275fac=function(n){return new(n||oe)(e.Y36(l.QS),e.Y36(c.Z7U))},oe.\u0275cmp=e.Xpm({type:oe,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly","compact"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"],["shape","times"]],template:function(n,t){1&n&&e.YNc(0,un,11,12,"div",0),2&n&&e.Q6J("ngIf",t.customFieldsConfig.length)},dependencies:[u.qvL,p.O5,ke.y,m.X$],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0});var C=d(3576),rt=d(7869),ot=d(9002),I=d(5387),Je=d(2050);function _n(r,n){1&r&&e._UZ(0,"clr-icon",9)}function mn(r,n){1&r&&e._UZ(0,"clr-icon",10)}function gn(r,n){1&r&&e._UZ(0,"clr-icon",11)}function fn(r,n){1&r&&(e.TgZ(0,"label",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.line-fulfillment-all")," "))}const hn=function(r,n){return{total:r,count:n}};function xn(r,n){if(1&r&&(e.TgZ(0,"label",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.line-fulfillment-partial",e.WLB(4,hn,t.line.quantity,t.fulfilledCount))," ")}}function Cn(r,n){1&r&&(e.TgZ(0,"label",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.line-fulfillment-none")," "))}function vn(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",15),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.tracking-code")),e.xp6(2),e.hij(" ",t.fulfillment.trackingCode," ")}}const yn=function(r){return{count:r}};function On(r,n){if(1&r&&(e.TgZ(0,"div",13)(1,"div",14),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-labeled-data",15),e.ALo(6,"translate"),e._uU(7),e.ALo(8,"localeDate"),e.qZA(),e.TgZ(9,"vdr-labeled-data",15),e.ALo(10,"translate"),e._uU(11),e.qZA(),e.YNc(12,vn,3,4,"vdr-labeled-data",16),e.qZA()),2&r){const t=n.$implicit;e.xp6(2),e.lnq(" ",e.lcZ(3,8,"order.fulfillment")," #",t.fulfillment.id," (",e.xi3(4,10,"order.item-count",e.VKq(20,yn,t.count)),") "),e.xp6(3),e.Q6J("label",e.lcZ(6,13,"common.created-at")),e.xp6(2),e.hij(" ",e.xi3(8,15,t.fulfillment.createdAt,"medium")," "),e.xp6(2),e.Q6J("label",e.lcZ(10,18,"order.fulfillment-method")),e.xp6(2),e.hij(" ",t.fulfillment.method," "),e.xp6(1),e.Q6J("ngIf",t.fulfillment.trackingCode)}}function Zn(r,n){if(1&r&&(e.TgZ(0,"vdr-dropdown",1)(1,"button",2),e.YNc(2,_n,1,0,"clr-icon",3),e.YNc(3,mn,1,0,"clr-icon",4),e.YNc(4,gn,1,0,"clr-icon",5),e.qZA(),e.TgZ(5,"vdr-dropdown-menu",6),e.YNc(6,fn,3,3,"label",7),e.YNc(7,xn,3,7,"label",7),e.YNc(8,Cn,3,3,"label",7),e.YNc(9,On,13,22,"div",8),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.Q6J("ngIf","full"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","partial"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","none"===t.fulfillmentStatus),e.xp6(2),e.Q6J("ngIf","full"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","partial"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngIf","none"===t.fulfillmentStatus),e.xp6(1),e.Q6J("ngForOf",t.fulfillments)}}class R{constructor(){this.fulfilledCount=0,this.fulfillments=[]}ngOnChanges(n){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.quantity),this.fulfillments=this.getFulfillments(this.line))}getDeliveredCount(n){return n.fulfillmentLines?.reduce((t,o)=>t+o.quantity,0)??0}getFulfillmentStatus(n,t){return n===t?"full":0<n&&n<t?"partial":"none"}getFulfillments(n){return n.fulfillmentLines?.map(t=>{const o=this.allOrderFulfillments?.find(i=>i.id===t.fulfillmentId);if(o)return{count:t.quantity,fulfillment:o}}).filter(I.notNullOrUndefined)??[]}}R.\u0275fac=function(n){return new(n||R)},R.\u0275cmp=e.Xpm({type:R,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",allOrderFulfillments:"allOrderFulfillments",orderState:"orderState"},features:[e.TTD],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(n,t){1&n&&e.YNc(0,Zn,10,7,"vdr-dropdown",0),2&n&&e.Q6J("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},dependencies:[u.qvL,u.MgK,p.sg,p.O5,J.J,D.N,N.U,T.W,m.X$,Je.H],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-700)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-700)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-700)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0});var it=d(9225);const bn=function(r){return{count:r}};function Tn(r,n){if(1&r&&(e.TgZ(0,"span",1),e.ALo(1,"translate"),e._UZ(2,"clr-icon",2),e.qZA()),2&r){const t=e.oxw();e.Q6J("title",e.xi3(1,1,"order.refunded-count",e.VKq(4,bn,t.getRefundedCount())))}}class Q{getRefundedCount(){return(this.payments?.reduce((t,o)=>[...t,...o.refunds],[]).filter(t=>"Failed"!==t.state).reduce((t,o)=>[...t,...o.lines],[])??[]).filter(t=>t.orderLineId===this.line.id).reduce((t,o)=>t+o.quantity,0)}}Q.\u0275fac=function(n){return new(n||Q)},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(n,t){1&n&&e.YNc(0,Tn,3,6,"span",0),2&n&&e.Q6J("ngIf",t.getRefundedCount())},dependencies:[u.qvL,p.O5,it.Lv,m.X$],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0});class U extends c.Up6{constructor(){super(...arguments),this.orderable=!1}}U.\u0275fac=function(){let r;return function(t){return(r||(r=e.n5z(U)))(t||U)}}(),U.\u0275cmp=e.Xpm({type:U,selectors:[["vdr-order-total-column"]],exportAs:["row"],features:[e.qOj],decls:0,vars:0,template:function(n,t){},encapsulation:2});var An=d(4973),In=d(6933),Ln=d(9911),wn=d(6542);function Mn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"th",18)(1,"input",19),e.NdJ("change",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onToggleAllClick())}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(1),e.Q6J("checked",null==t.selectionManager?null:t.selectionManager.areAllCurrentItemsSelected())}}function Fn(r,n){1&r&&e._UZ(0,"clr-icon",28)}function qn(r,n){1&r&&e._UZ(0,"clr-icon",29)}function Sn(r,n){1&r&&e._UZ(0,"clr-icon",30)}function Pn(r,n){if(1&r&&(e.TgZ(0,"div",31),e._uU(1),e.qZA()),2&r){const t=e.oxw().ngIf;e.xp6(1),e.Oqu(t.sortOrder)}}function Jn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",22)(1,"button",23),e.NdJ("click",function(){const a=e.CHM(t).ngIf;return e.KtG(a.toggleSortOrder())}),e.YNc(2,Fn,1,0,"clr-icon",24),e.YNc(3,qn,1,0,"clr-icon",25),e.YNc(4,Sn,1,0,"clr-icon",26),e.qZA(),e.YNc(5,Pn,2,1,"div",27),e.qZA()}if(2&r){const t=n.ngIf;e.xp6(1),e.ekj("active",t.sortOrder),e.xp6(1),e.Q6J("ngIf",!t.sortOrder),e.xp6(1),e.Q6J("ngIf","ASC"===t.sortOrder),e.xp6(1),e.Q6J("ngIf","DESC"===t.sortOrder),e.xp6(1),e.Q6J("ngIf",t.sortOrder)}}function Dn(r,n){if(1&r&&(e.TgZ(0,"th")(1,"div",20)(2,"span"),e._uU(3),e.qZA(),e.YNc(4,Jn,6,6,"div",21),e.qZA()()),2&r){const t=n.$implicit;e.ekj("expand",t.expand),e.xp6(1),e.Q6J("ngClass",t.align),e.xp6(2),e.Oqu(t.heading),e.xp6(1),e.Q6J("ngIf",t.sort)}}function Nn(r,n){1&r&&e.GkF(0)}function Qn(r,n){1&r&&e.GkF(0)}function Un(r,n){if(1&r&&e._UZ(0,"vdr-data-table-filters",40),2&r){const t=n.$implicit,o=e.oxw(3);e.Q6J("filterWithValue",t)("filters",o.filters)}}function kn(r,n){if(1&r&&e._UZ(0,"vdr-data-table-filters",41),2&r){const t=e.oxw(3);e.Q6J("filters",t.filters)}}function En(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",37),e.YNc(2,Un,1,2,"vdr-data-table-filters",38),e.YNc(3,kn,1,1,"vdr-data-table-filters",39),e.qZA(),e.BQk()),2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.filters.activeFilters),e.xp6(1),e.Q6J("ngIf",t.filters.length)}}function Yn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr")(1,"th",32)(2,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleSearchFilterRow())}),e.ALo(3,"translate"),e._UZ(4,"clr-icon",34),e.qZA(),e.TgZ(5,"div",35),e.YNc(6,Nn,1,0,"ng-container",36),e.YNc(7,Qn,1,0,"ng-container",36),e.YNc(8,En,4,2,"ng-container",8),e.qZA()()()}if(2&r){const t=e.oxw();e.xp6(1),e.ekj("active",t.showSearchFilterRow),e.uIk("colspan",t.visibleSortedColumns.length+(t.selectionManager?2:1)),e.xp6(1),e.ekj("active",t.showSearchFilterRow),e.Q6J("title",e.lcZ(3,11,"common.search-and-filter-list")),e.xp6(3),e.ekj("hidden",!t.showSearchFilterRow),e.xp6(1),e.Q6J("ngTemplateOutlet",null==t.searchComponent?null:t.searchComponent.template),e.xp6(1),e.Q6J("ngTemplateOutlet",t.customSearchTemplate),e.xp6(1),e.Q6J("ngIf",t.filters)}}function jn(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"td",18)(1,"input",44),e.NdJ("click",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.onRowClick(a,i))}),e.qZA()()}if(2&r){const t=e.oxw(),o=t.index,i=t.$implicit,a=e.oxw();e.ekj("active",a.activeIndex===o),e.xp6(1),e.Q6J("checked",null==a.selectionManager?null:a.selectionManager.isSelected(i))}}function Rn(r,n){1&r&&e.GkF(0)}const $n=function(r,n){return{item:r,index:n}};function Hn(r,n){if(1&r&&(e.TgZ(0,"td")(1,"div",20),e.YNc(2,Rn,1,0,"ng-container",45),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw(),i=o.index,a=o.$implicit,s=e.oxw();e.ekj("active",s.activeIndex===i),e.xp6(1),e.Q6J("ngClass",t.align),e.xp6(1),e.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",e.WLB(5,$n,a,i))}}function Gn(r,n){if(1&r&&(e.TgZ(0,"tr"),e.YNc(1,jn,2,3,"td",42),e.YNc(2,Hn,3,8,"td",43),e._UZ(3,"td"),e.qZA()),2&r){const t=n.index,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.selectionManager),e.xp6(1),e.Q6J("ngForOf",o.visibleSortedColumns),e.xp6(1),e.ekj("active",o.activeIndex===t)}}function Kn(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"vdr-empty-placeholder",46),e.ALo(3,"translate"),e.qZA()()),2&r){const t=e.oxw();e.xp6(1),e.uIk("colspan",t.visibleSortedColumns.length+(t.selectionManager?2:1)),e.xp6(1),e.Q6J("emptyStateLabel",e.lcZ(3,2,"order.order-is-empty"))}}function Vn(r,n){if(1&r&&(e.TgZ(0,"tr",47)(1,"td",48),e._uU(2),e.qZA(),e.TgZ(3,"td",49),e._uU(4),e.qZA(),e._UZ(5,"td",50),e.TgZ(6,"td",51),e._uU(7),e.ALo(8,"localeCurrency"),e.TgZ(9,"div",14),e.ALo(10,"translate"),e._uU(11),e.ALo(12,"localeCurrency"),e.qZA()(),e._UZ(13,"td"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(t.sku),e.xp6(1),e.uIk("colspan",o.visibleSortedColumns.length-4),e.xp6(2),e.hij(" ",e.xi3(8,6,t.priceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(10,9,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(12,11,t.price,o.order.currencyCode)," ")}}function Bn(r,n){if(1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.qZA()),2&r){const t=n.ngIf;e.xp6(1),e.Oqu(t)}}function Wn(r,n){if(1&r&&(e.TgZ(0,"tr",53)(1,"td",2)(2,"a",54),e._uU(3),e.qZA(),e.YNc(4,Bn,2,1,"vdr-chip",8),e.qZA(),e.TgZ(5,"td",2),e._uU(6),e.ALo(7,"localeCurrency"),e.TgZ(8,"div",14),e.ALo(9,"translate"),e._uU(10),e.ALo(11,"localeCurrency"),e.qZA()(),e._UZ(12,"td"),e.qZA()),2&r){const t=e.oxw().$implicit,o=e.oxw();e.xp6(1),e.uIk("colspan",o.visibleSortedColumns.length-1),e.xp6(1),e.Q6J("routerLink",o.getPromotionLink(t)),e.xp6(1),e.Oqu(t.description),e.xp6(1),e.Q6J("ngIf",o.getCouponCodeForAdjustment(o.order,t)),e.xp6(2),e.hij(" ",e.xi3(7,7,t.amountWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(9,10,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(11,12,t.amount,o.order.currencyCode)," ")}}function Xn(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Wn,13,15,"tr",52),e.BQk()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf","OTHER"!==t.type)}}function zn(r,n){if(1&r&&(e.TgZ(0,"vdr-chip",55),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.hij(" ",t.shippingMethod.name," ")}}const er=[[["vdr-bulk-action-menu"]]],tr=function(r,n,t,o){return{id:r,itemsPerPage:n,currentPage:t,totalItems:o}};class $ extends c.eJ5{get allColumns(){return[...this.columns??[],...this.customFieldColumns??[],...this.totalColumns??[]]}get sortedColumns(){const n=this.allColumns,t=this.getDataTableConfig();for(const[o,i]of Object.entries(t[this.id].order)){const a=n.find(f=>f.id===o),s=n.findIndex(f=>f.id===o);-1!==s&&a&&(n.splice(s,1),n.splice(i,0,a))}return n}getPromotionLink(n){return["/marketing","promotions",n.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(n,t){const o=t.adjustmentSource.split(":")[1],i=n.promotions.find(a=>a.id===o);if(i)return i.couponCode||void 0}getShippingNames(n){return n.shippingLines.length?n.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}function rr(r,n){if(1&r&&(e._UZ(0,"img",7),e.ALo(1,"assetPreview")),2&r){const t=n.ngIf;e.Q6J("src",e.xi3(1,1,t,"tiny"),e.LSH)}}function or(r,n){1&r&&(e.TgZ(0,"div",8),e._UZ(1,"clr-icon",9),e.qZA())}function ir(r,n){if(1&r&&(e.TgZ(0,"div",4),e.YNc(1,rr,2,4,"img",5),e.YNc(2,or,2,0,"ng-template",null,6,e.W1O),e.qZA()),2&r){const t=n.item,o=e.MAs(3);e.xp6(1),e.Q6J("ngIf",t.featuredAsset)("ngIfElse",o)}}function ar(r,n){if(1&r&&e._uU(0),2&r){const t=n.item;e.hij(" ",t.productVariant.name," ")}}function lr(r,n){if(1&r&&e._uU(0),2&r){const t=n.item;e.hij(" ",t.productVariant.sku," ")}}function cr(r,n){if(1&r&&(e.TgZ(0,"div",10),e._uU(1),e.ALo(2,"localeCurrency"),e.TgZ(3,"div",11),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA()()),2&r){const t=n.item,o=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,3,t.unitPriceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(4,6,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(6,8,t.unitPrice,o.order.currencyCode)," ")}}function dr(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.BQk()),2&r){const t=e.oxw().item;e.xp6(1),e.hij(" ",t.quantity," ")}}function sr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",16)(1,"input",17,18),e.NdJ("blur",function(){e.CHM(t);const i=e.MAs(2),a=e.oxw().item,s=e.oxw();return e.KtG(s.draftInputBlur(a,i.valueAsNumber))}),e.qZA(),e.TgZ(3,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().item,a=e.oxw();return e.KtG(a.remove.emit({lineId:i.id}))}),e._UZ(4,"clr-icon",20),e.qZA()()}if(2&r){const t=e.oxw().item;e.xp6(1),e.Q6J("value",t.quantity)}}function pr(r,n){if(1&r&&(e.YNc(0,dr,2,1,"ng-container",12),e.YNc(1,sr,5,1,"ng-template",null,13,e.W1O),e._UZ(3,"vdr-line-refunds",14)(4,"vdr-line-fulfillment",15)),2&r){const t=n.item,o=e.MAs(2),i=e.oxw();e.Q6J("ngIf",!i.isDraft)("ngIfElse",o),e.xp6(3),e.Q6J("line",t)("payments",i.order.payments),e.xp6(1),e.Q6J("line",t)("orderState",i.order.state)("allOrderFulfillments",i.order.fulfillments)}}function ur(r,n){if(1&r&&e._UZ(0,"vdr-dt2-custom-field-column",21),2&r){const t=n.$implicit;e.Q6J("customField",t)}}function _r(r,n){if(1&r&&(e.TgZ(0,"div",25)(1,"a",26),e._uU(2),e.qZA(),e.TgZ(3,"div",27),e._uU(4),e.ALo(5,"localeCurrency"),e.TgZ(6,"div",11),e.ALo(7,"translate"),e._uU(8),e.ALo(9,"localeCurrency"),e.qZA()()()),2&r){const t=n.$implicit,o=e.oxw(4);e.xp6(1),e.Q6J("routerLink",o.getPromotionLink(t)),e.xp6(1),e.Oqu(t.description),e.xp6(2),e.hij(" ",e.xi3(5,5,t.amountWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(7,8,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(9,10,t.amount,o.order.currencyCode)," ")}}function mr(r,n){if(1&r&&(e.TgZ(0,"vdr-dropdown")(1,"div",23),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-dropdown-menu"),e.YNc(5,_r,10,13,"div",24),e.qZA()()),2&r){const t=e.oxw().ngIf;e.xp6(2),e.hij(" ",e.lcZ(3,2,"order.promotions-applied")," "),e.xp6(3),e.Q6J("ngForOf",t)}}function gr(r,n){if(1&r&&(e.ynx(0),e.YNc(1,mr,6,4,"vdr-dropdown",22),e.BQk()),2&r){const t=n.ngIf;e.xp6(1),e.Q6J("ngIf",t.length)}}function fr(r,n){if(1&r&&(e.TgZ(0,"div",10),e._uU(1),e.ALo(2,"localeCurrency"),e.TgZ(3,"div",11),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA()(),e.YNc(7,gr,2,1,"ng-container",22)),2&r){const t=n.item,o=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,4,t.linePriceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(4,7,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(6,9,t.linePrice,o.order.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",o.getLineDiscounts(t))}}$.\u0275fac=function(){let r;return function(t){return(r||(r=e.n5z($)))(t||$)}}(),$.\u0275cmp=e.Xpm({type:$,selectors:[["vdr-order-data-table"]],contentQueries:function(n,t,o){if(1&n&&e.Suo(o,U,4),2&n){let i;e.iGM(i=e.CRH())&&(t.totalColumns=i)}},inputs:{order:"order"},features:[e.qOj],ngContentSelectors:["vdr-bulk-action-menu"],decls:60,vars:72,consts:[[1,"bulk-actions"],[1,"table-wrapper"],[1,""],[1,"heading-row"],["class","selection-col",4,"ngIf"],[3,"expand",4,"ngFor","ngForOf"],[1,"column-picker"],[3,"uiLanguage","columns","reorder","resetColumns"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"sub-total"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["class","shipping-method-name",4,"ngFor","ngForOf"],[1,"total"],[1,"selection-col"],["type","checkbox","clrCheckbox","",3,"checked","change"],[1,"cell-content",3,"ngClass"],["class","sort-toggle",4,"ngIf"],[1,"sort-toggle"],[3,"click"],["shape","two-way-arrows left",4,"ngIf"],["shape","arrow up",4,"ngIf"],["shape","arrow down",4,"ngIf"],["class","sort-label",4,"ngIf"],["shape","two-way-arrows left"],["shape","arrow up"],["shape","arrow down"],[1,"sort-label"],[1,"filter-row"],[1,"button-ghost","toggle-search-filter-row",3,"title","click"],["shape","search"],[1,"filter-row-wrapper"],[4,"ngTemplateOutlet"],[1,"filters"],["class","mt-1",3,"filterWithValue","filters",4,"ngFor","ngForOf"],["class","mt-1",3,"filters",4,"ngIf"],[1,"mt-1",3,"filterWithValue","filters"],[1,"mt-1",3,"filters"],["class","selection-col",3,"active",4,"ngIf"],[3,"active",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"checked","click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"emptyStateLabel"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle","sku"],[1,"align-middle"],[1,"align-middle","total"],["class","order-adjustment",4,"ngIf"],[1,"order-adjustment"],[3,"routerLink"],[1,"shipping-method-name"]],template:function(n,t){1&n&&(e.F$t(er),e.TgZ(0,"div",0),e.Hsn(1),e.qZA(),e.TgZ(2,"div",1)(3,"table",2)(4,"thead")(5,"tr",3),e.YNc(6,Mn,2,1,"th",4),e.YNc(7,Dn,5,5,"th",5),e.TgZ(8,"th")(9,"div",6)(10,"vdr-data-table-colum-picker",7),e.NdJ("reorder",function(i){return t.onColumnReorder(i)})("resetColumns",function(){return t.onColumnsReset()}),e.ALo(11,"async"),e.qZA()()()(),e.YNc(12,Yn,9,13,"tr",8),e.qZA(),e.TgZ(13,"tbody"),e.YNc(14,Gn,4,4,"tr",9),e.ALo(15,"paginate"),e.ynx(16),e.YNc(17,Kn,4,4,"tr",8),e.BQk(),e.YNc(18,Vn,14,14,"tr",10),e.YNc(19,Xn,2,1,"ng-container",11),e.TgZ(20,"tr",12)(21,"td",2),e._uU(22),e.ALo(23,"translate"),e.qZA(),e._UZ(24,"td"),e.TgZ(25,"td",13),e._uU(26),e.ALo(27,"localeCurrency"),e.TgZ(28,"div",14),e.ALo(29,"translate"),e._uU(30),e.ALo(31,"localeCurrency"),e.qZA()(),e._UZ(32,"td"),e.qZA(),e.TgZ(33,"tr",15)(34,"td",2),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"td"),e.YNc(38,zn,2,1,"vdr-chip",16),e.qZA(),e.TgZ(39,"td",13),e._uU(40),e.ALo(41,"localeCurrency"),e.TgZ(42,"div",14),e.ALo(43,"translate"),e._uU(44),e.ALo(45,"localeCurrency"),e.qZA()(),e._UZ(46,"td"),e.qZA(),e.TgZ(47,"tr",17)(48,"td",2),e._uU(49),e.ALo(50,"translate"),e.qZA(),e._UZ(51,"td"),e.TgZ(52,"td",13),e._uU(53),e.ALo(54,"localeCurrency"),e.TgZ(55,"div",14),e.ALo(56,"translate"),e._uU(57),e.ALo(58,"localeCurrency"),e.qZA()(),e._UZ(59,"td"),e.qZA()()()()),2&n&&(e.xp6(3),e.Udp("table-layout",null!=t.items&&t.items.length?"inherit":"fixed"),e.ekj("no-select",t.disableSelect),e.xp6(1),e.ekj("items-selected",null==t.selectionManager?null:t.selectionManager.selection.length),e.xp6(2),e.Q6J("ngIf",t.selectionManager),e.xp6(1),e.Q6J("ngForOf",t.visibleSortedColumns),e.xp6(3),e.Q6J("uiLanguage",e.lcZ(11,32,t.uiLanguage$))("columns",t.sortedColumns),e.xp6(2),e.Q6J("ngIf",t.searchComponent||t.customSearchTemplate||(null==t.filters?null:t.filters.length)),e.xp6(2),e.Q6J("ngForOf",e.xi3(15,34,t.items,e.l5B(67,tr,t.id,t.itemsPerPage,t.currentPage,t.totalItems)))("ngForTrackBy",t.trackByFn),e.xp6(3),e.Q6J("ngIf",!(null!=t.items&&t.items.length)),e.xp6(1),e.Q6J("ngForOf",t.order.surcharges),e.xp6(1),e.Q6J("ngForOf",t.order.discounts),e.xp6(3),e.Oqu(e.lcZ(23,37,"order.sub-total")),e.xp6(2),e.uIk("colspan",t.visibleSortedColumns.length-2),e.xp6(2),e.hij(" ",e.xi3(27,39,t.order.subTotalWithTax,t.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(29,42,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(31,44,t.order.subTotal,t.order.currencyCode)," "),e.xp6(5),e.Oqu(e.lcZ(36,47,"order.shipping")),e.xp6(2),e.uIk("colspan",t.visibleSortedColumns.length-2),e.xp6(1),e.Q6J("ngForOf",t.order.shippingLines),e.xp6(2),e.hij(" ",e.xi3(41,49,t.order.shippingWithTax,t.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(43,52,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(45,54,t.order.shipping,t.order.currencyCode)," "),e.xp6(5),e.Oqu(e.lcZ(50,57,"order.total")),e.xp6(2),e.uIk("colspan",t.visibleSortedColumns.length-2),e.xp6(2),e.hij(" ",e.xi3(54,59,t.order.totalWithTax,t.order.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(56,62,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(58,64,t.order.total,t.order.currencyCode)," "))},dependencies:[u.q0d,u.qvL,u.KKC,p.mk,p.sg,p.O5,p.tP,C.rH,F.Y,x.y,An.j,In.I,Ln.L,p.Ov,wn._s,m.X$,h.k],styles:["[_nghost-%COMP%]{display:block;max-width:100%;position:relative;margin-bottom:calc(var(--space-unit) * 4);container-type:inline-size}th[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-weight-200);font-size:var(--font-size-xs);font-weight:600;text-transform:uppercase;position:relative;white-space:nowrap}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 1.5) calc(var(--space-unit) * 1)}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{text-align:center}@media screen and (min-width: 992px){tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{padding-left:var(--surface-margin-left);text-align:left}}th[_ngcontent-%COMP%]:last-of-type, td[_ngcontent-%COMP%]:last-of-type{border-right:1px solid var(--color-weight-200)}tr[_ngcontent-%COMP%]:first-of-type   th[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(0deg,var(--color-weight-200),transparent) 1}tr[_ngcontent-%COMP%]:last-of-type   td[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(180deg,var(--color-weight-200),transparent) 1}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-row-separator)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--color-table-row-hover-bg)}.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 5);background-color:var(--color-surface-bg);z-index:10;display:flex;position:absolute;top:5px;height:40px}@media screen and (min-width: 992px){.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 8.5)}}@media screen and (min-width: 1280px){.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 10.5)}}.table-wrapper[_ngcontent-%COMP%]{display:block;overflow-y:hidden;overflow-x:auto;width:100%;max-width:var(--surface-width)}table[_ngcontent-%COMP%]{width:100%}table.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.column-picker[_ngcontent-%COMP%]{width:24px}.sort-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:calc(var(--space-unit) * .5)}.sort-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:0;border-radius:var(--border-radius-lg);color:var(--color-weight-500);padding:0 2px;cursor:pointer;background-color:transparent}.sort-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--color-primary-700)}.sort-toggle[_ngcontent-%COMP%]   .sort-label[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * .5);font-size:10px;color:var(--color-primary-600);font-weight:400}.toggle-search-filter-row[_ngcontent-%COMP%]{position:absolute;top:-12px;left:4px}@media screen and (min-width: 1280px){.toggle-search-filter-row[_ngcontent-%COMP%]{left:8px}}.toggle-search-filter-row.active[_ngcontent-%COMP%]{background-color:var(--color-primary-700);color:var(--color-primary-100);border-color:var(--color-primary-700)}th.filter-row[_ngcontent-%COMP%]{position:relative;font-size:var(--font-size-base);font-weight:400;background-color:var(--color-weight-100);box-shadow:var(--data-table-filter-box-shadow);border-left-width:0;border-right-width:0;text-align:initial;padding:0}th.filter-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}th.filter-row.active[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-weight-200)}th.filter-row[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 1);display:flex;flex-wrap:wrap;gap:calc(var(--space-unit) * .5)}.filter-row-wrapper[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 4);padding-left:0;max-height:150px;transition:max-height .2s,padding .2s,opacity .2s}.filter-row-wrapper.hidden[_ngcontent-%COMP%]{max-height:0px;padding-top:0;padding-bottom:0;overflow:hidden;opacity:0}.cell-link[_ngcontent-%COMP%]{display:block;width:100%;height:100%}td.active[_ngcontent-%COMP%]{background-color:var(--color-table-row-active-bg)}.cell-content[_ngcontent-%COMP%]{display:flex;align-items:center;line-height:var(--font-size-sm);color:var(--color-weight-700)}.cell-content.left[_ngcontent-%COMP%]{justify-content:flex-start}.cell-content.center[_ngcontent-%COMP%]{justify-content:center}.cell-content.right[_ngcontent-%COMP%]{justify-content:flex-end}.selection-col[_ngcontent-%COMP%]{width:calc(var(--space-unit) * 8)}vdr-empty-placeholder[_ngcontent-%COMP%]{width:100%}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:var(--space-unit);margin-left:var(--surface-margin-left);margin-right:var(--space-unit)}.total-items-count[_ngcontent-%COMP%]{font-size:var(--font-size-xs)}@container (max-width: 500px){.total-items-count[_ngcontent-%COMP%]{display:none}}","[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-right:2px}"],changeDetection:0});class k{constructor(){this.isDraft=!1,this.adjust=new e.vpe,this.remove=new e.vpe,this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}get visibleOrderLineCustomFields(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}get showElided(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}ngOnInit(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}draftInputBlur(n,t){n.quantity!==t&&this.adjust.emit({lineId:n.id,quantity:t})}toggleOrderLineCustomFields(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}getLineDiscounts(n){return n.discounts.filter(t=>t.type===c.S2X.PROMOTION)}getLineCustomFields(){for(const n of this.order.lines){const t=new l.nJ({}),o=this.orderLineCustomFields.map(i=>{const a=n.customFields[i.name];return t.addControl(i.name,new l.p4(a)),{config:i,formGroup:t,value:a}}).filter(i=>!!this.orderLineCustomFieldsVisible||null!=i.value);this.customFieldsForLine[n.id]=o}}getPromotionLink(n){return["/marketing","promotions",n.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(n,t){const o=t.adjustmentSource.split(":")[1],i=n.promotions.find(a=>a.id===o);if(i)return i.couponCode||void 0}getShippingNames(n){return n.shippingLines.length?n.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}k.\u0275fac=function(n){return new(n||k)},k.\u0275cmp=e.Xpm({type:k,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields",isDraft:"isDraft"},outputs:{adjust:"adjust",remove:"remove"},decls:20,vars:24,consts:[["id","order-detail-",3,"items","order"],[3,"heading"],[3,"heading","optional"],[3,"customField",4,"ngFor","ngForOf"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"unit-price"],[1,"net-price",3,"title"],[4,"ngIf","ngIfElse"],["draft",""],[3,"line","payments"],[3,"line","orderState","allOrderFulfillments"],[1,"flex"],["type","number","min","0",1,"draft-qty",3,"value","blur"],["qtyInput",""],[1,"icon-button",3,"click"],["shape","trash"],[3,"customField"],[4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-order-data-table",0)(1,"vdr-dt2-column",1),e.ALo(2,"translate"),e.YNc(3,ir,4,2,"ng-template"),e.qZA(),e.TgZ(4,"vdr-dt2-column",1),e.ALo(5,"translate"),e.YNc(6,ar,1,1,"ng-template"),e.qZA(),e.TgZ(7,"vdr-dt2-column",2),e.ALo(8,"translate"),e.YNc(9,lr,1,1,"ng-template"),e.qZA(),e.TgZ(10,"vdr-dt2-column",1),e.ALo(11,"translate"),e.YNc(12,cr,7,11,"ng-template"),e.qZA(),e.TgZ(13,"vdr-dt2-column",2),e.ALo(14,"translate"),e.YNc(15,pr,5,7,"ng-template"),e.qZA(),e.YNc(16,ur,1,1,"vdr-dt2-custom-field-column",3),e.TgZ(17,"vdr-order-total-column",2),e.ALo(18,"translate"),e.YNc(19,fr,8,12,"ng-template"),e.qZA()()),2&n&&(e.Q6J("items",t.order.lines)("order",t.order),e.xp6(1),e.Q6J("heading",e.lcZ(2,12,"common.image")),e.xp6(3),e.Q6J("heading",e.lcZ(5,14,"order.product-name")),e.xp6(3),e.Q6J("heading",e.lcZ(8,16,"order.product-sku"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(11,18,"order.unit-price")),e.xp6(3),e.Q6J("heading",e.lcZ(14,20,"order.quantity"))("optional",!1),e.xp6(3),e.Q6J("ngForOf",t.orderLineCustomFields),e.xp6(1),e.Q6J("heading",e.lcZ(18,22,"order.total"))("optional",!1))},dependencies:[u.qvL,p.sg,p.O5,C.rH,x.y,J.J,D.N,N.U,rt.U,ot.j,R,Q,$,U,m.X$,X.M,h.k],styles:["[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-right:2px}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var Ee=d(123),at=d(3651);function hr(r,n){if(1&r&&(e.TgZ(0,"div",16),e._UZ(1,"vdr-custom-field-control",17),e.qZA()),2&r){const t=n.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("compact",!0)("readonly",!1)("customField",t)("customFieldsFormGroup",o.customFieldsFormGroup)}}function xr(r,n){if(1&r&&(e.ynx(0),e.YNc(1,hr,2,4,"div",15),e.BQk()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.orderLineCustomFields)}}function Cr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",5),e._UZ(2,"img",6),e.ALo(3,"assetPreview"),e.TgZ(4,"div",7)(5,"div"),e._uU(6),e.qZA(),e.TgZ(7,"div",8),e._uU(8),e.qZA()(),e.TgZ(9,"div",9)(10,"div",8),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"div",8),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e._UZ(16,"div",10),e.TgZ(17,"div",7)(18,"div"),e._uU(19),e.ALo(20,"localeCurrency"),e.qZA(),e.TgZ(21,"div",11),e.ALo(22,"translate"),e._uU(23),e.ALo(24,"localeCurrency"),e.qZA()(),e.TgZ(25,"div")(26,"input",12),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.quantity=i)}),e.qZA()(),e.TgZ(27,"button",13),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.addItemClick(a))}),e._uU(28),e.ALo(29,"translate"),e.qZA()(),e.YNc(30,xr,2,1,"ng-container",14),e.qZA()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(2),e.Q6J("src",e.xi3(3,15,t.featuredAsset||t.product.featuredAsset,32),e.LSH),e.xp6(4),e.Oqu(null==t?null:t.name),e.xp6(2),e.Oqu(null==t?null:t.sku),e.xp6(3),e.AsE(" ",e.lcZ(12,18,"catalog.stock-on-hand"),": ",t.stockOnHand," "),e.xp6(3),e.AsE(" ",e.lcZ(15,20,"catalog.stock-allocated"),": ",t.stockAllocated," "),e.xp6(5),e.Oqu(e.xi3(20,22,null==t?null:t.priceWithTax,o.currencyCode)),e.xp6(2),e.Q6J("title",e.lcZ(22,25,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(24,27,null==t?null:t.price,o.currencyCode)," "),e.xp6(3),e.Q6J("disabled",!t)("ngModel",o.quantity),e.xp6(1),e.Q6J("disabled",!t),e.xp6(1),e.hij(" ",e.lcZ(29,30,"order.add-item-to-order")," "),e.xp6(2),e.Q6J("ngIf",o.orderLineCustomFields.length)}}class ie{constructor(n){this.dataService=n,this.addItem=new e.vpe,this.customFieldsFormGroup=new l.nJ({}),this.selectedVariantId$=new ee.x,this.quantity=1}ngOnInit(){this.selectedVariant$=this.selectedVariantId$.pipe((0,g.w)(n=>n?this.dataService.product.getProductVariant(n).mapSingle(({productVariant:t})=>t):[void 0]));for(const n of this.orderLineCustomFields)this.customFieldsFormGroup.addControl(n.name,new l.p4(""))}addItemClick(n){n&&(this.addItem.emit({productVariantId:n.id,quantity:this.quantity,customFields:this.orderLineCustomFields.length?this.customFieldsFormGroup.value:void 0}),this.selectedVariantId$.next(void 0),this.customFieldsFormGroup.reset())}}function vr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-action-bar")(1,"vdr-ab-left")(2,"div",1),e._UZ(3,"vdr-order-state-label",2),e.qZA()(),e.TgZ(4,"vdr-ab-right")(5,"button",3),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.completeOrder())}),e._UZ(6,"clr-icon",4),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"vdr-dropdown")(10,"button",5),e._UZ(11,"clr-icon",6),e.qZA(),e.TgZ(12,"vdr-dropdown-menu",7)(13,"button",8),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteOrder())}),e._UZ(14,"clr-icon",9),e._uU(15),e.ALo(16,"translate"),e.qZA()()()()()}if(2&r){const t=n.ngIf;e.xp6(3),e.Q6J("state",t.state),e.xp6(2),e.Q6J("disabled",!t.customer||!t.lines.length||!t.shippingLines.length),e.xp6(2),e.hij(" ",e.lcZ(8,4,"order.complete-draft-order")," "),e.xp6(8),e.hij(" ",e.lcZ(16,6,"order.delete-draft-order")," ")}}function yr(r,n){1&r&&e._UZ(0,"clr-icon",24)}function Or(r,n){1&r&&e._UZ(0,"clr-icon",25)}function Zr(r,n){if(1&r&&(e.YNc(0,yr,1,0,"clr-icon",22),e.YNc(1,Or,1,0,"clr-icon",23)),2&r){const t=e.oxw().ngIf;e.Q6J("ngIf",!t.customer),e.xp6(1),e.Q6J("ngIf",t.customer)}}function br(r,n){if(1&r&&e._UZ(0,"vdr-customer-label",26),2&r){const t=e.oxw().ngIf;e.Q6J("customer",t.customer)}}function Tr(r,n){1&r&&e._UZ(0,"clr-icon",24)}function Ar(r,n){1&r&&e._UZ(0,"clr-icon",25)}function Ir(r,n){if(1&r&&(e.YNc(0,Tr,1,0,"clr-icon",22),e.YNc(1,Ar,1,0,"clr-icon",23)),2&r){const t=e.oxw().ngIf;e.Q6J("ngIf",!t.billingAddress.streetLine1),e.xp6(1),e.Q6J("ngIf",t.billingAddress.streetLine1)}}function Lr(r,n){if(1&r&&e._UZ(0,"vdr-formatted-address",27),2&r){const t=e.oxw().ngIf;e.Q6J("address",t.billingAddress)}}function wr(r,n){1&r&&e._UZ(0,"clr-icon",24)}function Mr(r,n){1&r&&e._UZ(0,"clr-icon",25)}function Fr(r,n){if(1&r&&(e.YNc(0,wr,1,0,"clr-icon",22),e.YNc(1,Mr,1,0,"clr-icon",23)),2&r){const t=e.oxw().ngIf;e.Q6J("ngIf",!t.shippingAddress.streetLine1||!t.shippingLines.length),e.xp6(1),e.Q6J("ngIf",t.shippingAddress.streetLine1&&t.shippingLines.length)}}function qr(r,n){if(1&r&&e._UZ(0,"vdr-formatted-address",27),2&r){const t=e.oxw().ngIf;e.Q6J("address",t.shippingAddress)}}function Sr(r,n){if(1&r&&(e.TgZ(0,"div"),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.xp6(1),e.hij(" ",t.shippingMethod.name," ")}}function Pr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.displayCouponCodeInput=!i.displayCouponCodeInput)}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.set-coupon-codes")," "))}function Jr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"label"),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"vdr-coupon-code-selector",28),e.NdJ("addCouponCode",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.applyCouponCode(i))})("removeCouponCode",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.removeCouponCode(i))}),e.qZA()()}if(2&r){const t=e.oxw().ngIf;e.xp6(2),e.Oqu(e.lcZ(3,2,"order.set-coupon-codes")),e.xp6(2),e.Q6J("couponCodes",t.couponCodes)}}function Dr(r,n){if(1&r&&e._UZ(0,"vdr-page-entity-info",29),2&r){const t=n.ngIf;e.Q6J("entity",t)}}function Nr(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"percent"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"localeCurrency"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"localeCurrency"),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw(2).ngIf;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(e.lcZ(5,4,t.taxRate/100)),e.xp6(3),e.Oqu(e.xi3(8,6,t.taxBase,o.currencyCode)),e.xp6(3),e.Oqu(e.xi3(11,9,t.taxTotal,o.currencyCode))}}function Qr(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"table",30)(2,"thead")(3,"tr")(4,"th"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA()()(),e.TgZ(16,"tbody"),e.YNc(17,Nr,12,12,"tr",16),e.qZA()(),e.BQk()),2&r){const t=e.oxw().ngIf;e.xp6(5),e.Oqu(e.lcZ(6,5,"common.description")),e.xp6(3),e.Oqu(e.lcZ(9,7,"order.tax-rate")),e.xp6(3),e.Oqu(e.lcZ(12,9,"order.tax-base")),e.xp6(3),e.Oqu(e.lcZ(15,11,"order.tax-total")),e.xp6(3),e.Q6J("ngForOf",t.taxSummary)}}function Ur(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card",10),e.ALo(3,"translate"),e.YNc(4,Zr,2,2,"ng-template",11),e.YNc(5,br,1,1,"vdr-customer-label",12),e.TgZ(6,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setCustomer())}),e._uU(7),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"vdr-card",10),e.ALo(10,"translate"),e.YNc(11,Ir,2,2,"ng-template",11),e.YNc(12,Lr,1,1,"vdr-formatted-address",14),e.TgZ(13,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setBillingAddress())}),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"vdr-card",10),e.ALo(17,"translate"),e.YNc(18,Fr,2,2,"ng-template",11),e.YNc(19,qr,1,1,"vdr-formatted-address",14),e.TgZ(20,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setShippingAddress())}),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.YNc(23,Sr,2,1,"div",16),e.TgZ(24,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.setShippingMethod())}),e._uU(25),e.ALo(26,"translate"),e.qZA()(),e.TgZ(27,"vdr-card"),e.YNc(28,Pr,3,3,"button",17),e.YNc(29,Jr,5,4,"div",0),e.qZA(),e.TgZ(30,"vdr-card"),e.YNc(31,Dr,1,1,"vdr-page-entity-info",18),e.ALo(32,"async"),e.qZA()(),e.TgZ(33,"vdr-page-block")(34,"vdr-card")(35,"vdr-draft-order-variant-selector",19),e.NdJ("addItem",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.addItemToOrder(i))}),e.qZA(),e.TgZ(36,"vdr-order-table",20),e.NdJ("adjust",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.adjustOrderLine(i))})("remove",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.removeOrderLine(i))}),e.qZA()(),e.TgZ(37,"vdr-card",10),e.ALo(38,"translate"),e.YNc(39,Qr,18,13,"ng-container",0),e.qZA(),e.TgZ(40,"vdr-order-custom-fields-card",21),e.NdJ("updateClick",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.updateCustomFields(i))}),e.qZA()()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(2),e.Q6J("title",e.lcZ(3,23,"order.customer")),e.xp6(3),e.Q6J("ngIf",t.customer),e.xp6(2),e.hij(" ",e.lcZ(8,25,"order.set-customer-for-order")," "),e.xp6(2),e.Q6J("title",e.lcZ(10,27,"order.billing-address")),e.xp6(3),e.Q6J("ngIf",t.billingAddress),e.xp6(2),e.hij(" ",e.lcZ(15,29,"order.set-billing-address")," "),e.xp6(2),e.Q6J("title",e.lcZ(17,31,"order.shipping")),e.xp6(3),e.Q6J("ngIf",t.shippingAddress),e.xp6(2),e.hij(" ",e.lcZ(22,33,"order.set-shipping-address")," "),e.xp6(2),e.Q6J("ngForOf",t.shippingLines),e.xp6(2),e.hij(" ",e.lcZ(26,35,"order.set-shipping-method")," "),e.xp6(3),e.Q6J("ngIf",0===t.couponCodes.length&&!o.displayCouponCodeInput),e.xp6(1),e.Q6J("ngIf",t.couponCodes.length||o.displayCouponCodeInput),e.xp6(2),e.Q6J("ngIf",e.lcZ(32,37,o.entity$)),e.xp6(4),e.Q6J("orderLineCustomFields",o.orderLineCustomFields)("currencyCode",t.currencyCode),e.xp6(1),e.Q6J("order",t)("orderLineCustomFields",o.orderLineCustomFields)("isDraft",!0),e.xp6(1),e.Q6J("title",e.lcZ(38,39,"order.tax-summary")),e.xp6(2),e.Q6J("ngIf",t.taxSummary.length),e.xp6(1),e.Q6J("customFieldsConfig",o.customFields)("customFieldValues",t.customFields)}}ie.\u0275fac=function(n){return new(n||ie)(e.Y36(c.DoR))},ie.\u0275cmp=e.Xpm({type:ie,selectors:[["vdr-draft-order-variant-selector"]],inputs:{currencyCode:"currencyCode",orderLineCustomFields:"orderLineCustomFields"},outputs:{addItem:"addItem"},decls:8,vars:6,consts:[[1,"card"],[1,"card-block"],[1,"card-title"],[3,"productSelected"],["class","card-block",4,"ngIf"],[1,"variant-details"],[1,"mr-2",3,"src"],[1,"details"],[1,"small"],[1,"details","ml-4"],[1,"flex-spacer"],[1,"small",3,"title"],["type","number","min","0",3,"disabled","ngModel","ngModelChange"],[1,"btn","btn-small","btn-primary",3,"disabled","click"],[4,"ngIf"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"vdr-product-variant-selector",3),e.NdJ("productSelected",function(i){return t.selectedVariantId$.next(i.productVariantId)}),e.qZA()(),e.YNc(6,Cr,31,32,"div",4),e.ALo(7,"async"),e.qZA()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,2,"order.add-item-to-order")),e.xp6(3),e.Q6J("ngIf",e.lcZ(7,4,t.selectedVariant$)))},dependencies:[p.sg,p.O5,l.Fj,l.wV,l.JJ,l.qQ,l.On,Ee.M,x.y,at.e,p.Ov,m.X$,X.M,h.k],styles:[".variant-details[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img);width:32px;height:32px}.variant-details[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{font-size:.65rem;line-height:.7rem}.variant-details[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:48px;margin:0 6px}.variant-details[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});class H extends c.VE7{constructor(n,t,o,i,a){super(),this.changeDetector=n,this.dataService=t,this.notificationService=o,this.modalService=i,this.orderTransitionService=a,this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.detailForm=new l.nJ({}),this.fetchHistory=new ee.x,this.displayCouponCodeInput=!1}ngOnInit(){this.init(),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.eligibleShippingMethods$=this.entity$.pipe((0,g.w)(n=>this.dataService.order.getDraftOrderEligibleShippingMethods(n.id).mapSingle(({eligibleShippingMethodsForDraftOrder:t})=>t)))}ngOnDestroy(){this.destroy()}addItemToOrder(n){this.dataService.order.addItemToDraftOrder(this.id,n).subscribe(t=>{"Order"!==t.addItemToDraftOrder.__typename&&this.notificationService.error(t.addItemToDraftOrder.message)})}adjustOrderLine(n){this.dataService.order.adjustDraftOrderLine(this.id,{orderLineId:n.lineId,quantity:n.quantity}).subscribe(t=>{"Order"!==t.adjustDraftOrderLine.__typename&&this.notificationService.error(t.adjustDraftOrderLine.message)})}removeOrderLine(n){this.dataService.order.removeDraftOrderLine(this.id,n.lineId).subscribe(t=>{"Order"!==t.removeDraftOrderLine.__typename&&this.notificationService.error(t.removeDraftOrderLine.message)})}getOrderAddressLines(n){return n?Object.values(n).filter(t=>"OrderAddress"!==t).filter(t=>!!t):[]}setCustomer(){this.modalService.fromComponent(te).subscribe(n=>{this.hasId(n)?this.dataService.order.setCustomerForDraftOrder(this.id,{customerId:n.id}).subscribe():n&&this.dataService.order.setCustomerForDraftOrder(this.id,{input:n}).subscribe()})}setShippingAddress(){this.entity$.pipe((0,q.q)(1),(0,g.w)(n=>this.modalService.fromComponent(j,{locals:{customerId:n.customer?.id,currentAddress:n.shippingAddress??void 0}}))).subscribe(n=>{n&&this.dataService.order.setDraftOrderShippingAddress(this.id,n).subscribe()})}setBillingAddress(){this.entity$.pipe((0,q.q)(1),(0,g.w)(n=>this.modalService.fromComponent(j,{locals:{customerId:n.customer?.id,currentAddress:n.billingAddress??void 0}}))).subscribe(n=>{n&&this.dataService.order.setDraftOrderBillingAddress(this.id,n).subscribe()})}applyCouponCode(n){this.dataService.order.applyCouponCodeToDraftOrder(this.id,n).subscribe()}removeCouponCode(n){this.dataService.order.removeCouponCodeFromDraftOrder(this.id,n).subscribe()}setShippingMethod(){(0,Pt.a)(this.entity$,this.eligibleShippingMethods$).pipe((0,q.q)(1),(0,g.w)(([n,t])=>this.modalService.fromComponent(ne,{locals:{eligibleShippingMethods:t,currencyCode:n.currencyCode,currentSelectionId:n.shippingLines?.[0]?.shippingMethod.id}}))).subscribe(n=>{n&&this.dataService.order.setDraftOrderShippingMethod(this.id,n).subscribe()})}updateCustomFields(n){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:n}).subscribe()}deleteOrder(){this.dataService.order.deleteDraftOrder(this.id).subscribe(({deleteDraftOrder:n})=>{n.result===c.PcR.DELETED?(this.notificationService.success((0,_.J)("common.notify-delete-success"),{entity:"Order"}),this.router.navigate(["/orders"])):n.message&&this.notificationService.error(n.message)})}completeOrder(){this.dataService.order.transitionToState(this.id,"ArrangingPayment").subscribe(({transitionOrderToState:n})=>{"Order"===n?.__typename?this.router.navigate(["/orders",this.id]):"OrderStateTransitionError"===n?.__typename&&this.notificationService.error(n.transitionError)})}hasId(n){return"object"==typeof n&&!!n.id}setFormValues(n){}}H.\u0275fac=function(n){return new(n||H)(e.Y36(e.sBO),e.Y36(c.DoR),e.Y36(c.gqp),e.Y36(c.Z7U),e.Y36(A))},H.\u0275cmp=e.Xpm({type:H,selectors:[["vdr-draft-order-detail"]],features:[e.qOj],decls:5,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"state"],[1,"btn","btn-primary",3,"disabled","click"],["shape","check"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["shape","trash",1,"is-danger"],[3,"title"],["vdrCardControls",""],["class","block mb-2",3,"customer",4,"ngIf"],[1,"button-small",3,"click"],["class","block mb-2",3,"address",4,"ngIf"],[1,"button-small","mr-2",3,"click"],[4,"ngFor","ngForOf"],["class","button-small",3,"click",4,"ngIf"],[3,"entity",4,"ngIf"],[3,"orderLineCustomFields","currencyCode","addItem"],[3,"order","orderLineCustomFields","isDraft","adjust","remove"],[3,"customFieldsConfig","customFieldValues","updateClick"],["shape","unknown-status","class","is-warning",4,"ngIf"],["shape","check","class","is-success",4,"ngIf"],["shape","unknown-status",1,"is-warning"],["shape","check",1,"is-success"],[1,"block","mb-2",3,"customer"],[1,"block","mb-2",3,"address"],[3,"couponCodes","addCouponCode","removeCouponCode"],[3,"entity"],[1,"table"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block"),e.YNc(1,vr,17,8,"vdr-action-bar",0),e.ALo(2,"async"),e.qZA(),e.YNc(3,Ur,41,41,"vdr-page-detail-layout",0),e.ALo(4,"async")),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.entity$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.entity$)))},dependencies:[u.qvL,u.MgK,p.sg,p.O5,O.Kk,O.BN,O.mz,Ue.d,J.J,D.N,N.U,Le.H,we.G,Fe.b,Se.z,et.D,tt.T,nt.W,Pe.A,Pe.D,oe,k,ie,Y,p.Ov,p.Zx,m.X$,h.k],changeDetection:0});var kr=d(7747);function Er(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.fulfill-order"))}function Yr(r,n){if(1&r&&(e._UZ(0,"img",17),e.ALo(1,"assetPreview")),2&r){const t=e.oxw().$implicit;e.Q6J("src",e.xi3(1,1,t.featuredAsset,"tiny"),e.LSH)}}function jr(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",18),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.fulfillmentQuantities[a.id].fulfillCount=i)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("disabled",0===o.getUnfulfilledCount(t))("ngModel",o.fulfillmentQuantities[t.id].fulfillCount)("max",o.fulfillmentQuantities[t.id].max)}}function Rr(r,n){if(1&r&&(e.TgZ(0,"tr",9)(1,"td",10),e.YNc(2,Yr,2,4,"img",11),e.qZA(),e.TgZ(3,"td",12),e._uU(4),e.qZA(),e.TgZ(5,"td",13),e._uU(6),e.qZA(),e.TgZ(7,"td",14),e._uU(8),e.qZA(),e.TgZ(9,"td",14),e._uU(10),e.qZA(),e.TgZ(11,"td",15),e.YNc(12,jr,1,3,"input",16),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw();e.ekj("ignore",0===o.getUnfulfilledCount(t)),e.xp6(2),e.Q6J("ngIf",t.featuredAsset),e.xp6(2),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.Oqu(o.getUnfulfilledCount(t)),e.xp6(2),e.Oqu(t.productVariant.stockOnHand),e.xp6(2),e.Q6J("ngIf",o.fulfillmentQuantities[t.id])}}function $r(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.canSubmit()),e.xp6(1),e.hij(" ",e.lcZ(5,5,"order.create-fulfillment")," ")}}class ae{constructor(n,t){this.dataService=n,this.changeDetector=t,this.fulfillmentHandlerControl=new l.p4,this.fulfillmentQuantities={}}ngOnInit(){this.dataService.settings.getGlobalSettings().single$.subscribe(({globalSettings:n})=>{this.fulfillmentQuantities=this.order.lines.reduce((t,o)=>{const i=this.getFulfillableCount(o,n.trackInventory);return{...t,[o.id]:{fulfillCount:i,max:i}}},{}),this.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(n=>n.fulfillmentHandlers).subscribe(n=>{this.fulfillmentHandlerDef=n.find(t=>t.code===this.order.shippingLines[0]?.shippingMethod?.fulfillmentHandlerCode)||n[0],this.fulfillmentHandler=(0,c.miO)(this.fulfillmentHandlerDef),this.fulfillmentHandlerControl.patchValue(this.fulfillmentHandler),this.changeDetector.markForCheck()})}getFulfillableCount(n,t){const{trackInventory:o,stockOnHand:i}=n.productVariant,a=o===c.TvZ.INHERIT?t:o===c.TvZ.TRUE,s=this.getUnfulfilledCount(n);return a?Math.min(s,i):s}getUnfulfilledCount(n){const t=this.order.fulfillments?.map(o=>o.lines).flat().filter(o=>o.orderLineId===n.id).reduce((o,i)=>o+i.quantity,0)??0;return n.quantity-t}canSubmit(){const n=Object.values(this.fulfillmentQuantities).reduce((o,{fulfillCount:i})=>o+i,0);return(0,c.dOS)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<n}select(){const n=Object.entries(this.fulfillmentQuantities).map(([t,{fulfillCount:o}])=>({orderLineId:t,quantity:o}));this.resolveWith({lines:n,handler:(0,c.RnJ)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}cancel(){this.resolveWith()}}function Hr(r,n){if(1&r&&(e.TgZ(0,"li",2)(1,"div",3),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",4),e._uU(4),e.qZA()),2&r){const t=n.$implicit;e.Q6J("title",t.name),e.xp6(2),e.Oqu(t.quantity),e.xp6(2),e.hij(" ",t.name," ")}}ae.\u0275fac=function(n){return new(n||ae)(e.Y36(c.DoR),e.Y36(e.sBO))},ae.\u0275cmp=e.Xpm({type:ae,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Er,2,3,"ng-template",0),e.TgZ(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA()()(),e.YNc(22,Rr,13,8,"tr",4),e.qZA()(),e.TgZ(23,"div",5),e._UZ(24,"vdr-formatted-address",6),e.TgZ(25,"h6"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e._uU(28),e.TgZ(29,"strong"),e._uU(30),e.ALo(31,"localeCurrency"),e.qZA(),e._UZ(32,"vdr-configurable-input",7),e.qZA()(),e.YNc(33,$r,6,7,"ng-template",8)),2&n&&(e.xp6(8),e.Oqu(e.lcZ(9,14,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,16,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,18,"order.unfulfilled")),e.xp6(3),e.Oqu(e.lcZ(18,20,"catalog.stock-on-hand")),e.xp6(3),e.Oqu(e.lcZ(21,22,"order.fulfill")),e.xp6(2),e.Q6J("ngForOf",t.order.lines),e.xp6(2),e.Q6J("address",t.order.shippingAddress),e.xp6(2),e.Oqu(e.lcZ(27,24,"order.shipping-method")),e.xp6(2),e.hij(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),e.xp6(2),e.Oqu(e.xi3(31,26,t.order.shipping,t.order.currencyCode)),e.xp6(2),e.Q6J("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},dependencies:[p.sg,p.O5,l.Fj,l.wV,l.JJ,l.qQ,l.Fd,l.On,l.oH,kr.q,x.y,Z.n,y.q,Fe.b,m.X$,X.M,h.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-right:2px}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0});class E{}function Gr(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.tracking-code")),e.xp6(2),e.hij(" ",null==t.fulfillment?null:t.fulfillment.trackingCode,"\n")}}function Kr(r,n){if(1&r&&e._UZ(0,"vdr-custom-field-control",5),2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("readonly",!0)("compact",!0)("customField",t)("customFieldsFormGroup",o.customFieldFormGroup)}}function Vr(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Kr,1,4,"vdr-custom-field-control",4),e.BQk()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.customFieldFormGroup.get(t.name))}}E.\u0275fac=function(n){return new(n||E)},E.\u0275cmp=e.Xpm({type:E,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"ul"),e.YNc(2,Hr,5,3,"li",1),e.qZA()()),2&n&&(e.xp6(2),e.Q6J("ngForOf",t.items))},dependencies:[u.qvL,p.sg],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0});class G{constructor(n){this.serverConfigService=n,this.customFieldConfig=[],this.customFieldFormGroup=new l.nJ({})}ngOnInit(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}ngOnChanges(n){this.buildCustomFieldsFormGroup()}get fulfillment(){return this.order.fulfillments&&this.order.fulfillments.find(n=>n.id===this.fulfillmentId)}get items(){return this.fulfillment?.lines.map(n=>({name:this.order.lines.find(t=>t.id===n.orderLineId)?.productVariant.name??"",quantity:n.quantity}))??[]}buildCustomFieldsFormGroup(){const n=this.fulfillment.customFields;for(const t of this.serverConfigService.getCustomFieldsFor("Fulfillment"))this.customFieldFormGroup.addControl(t.name,new l.p4(n[t.name]))}customFieldIsObject(n){return Array.isArray(n)||(0,I.isObject)(n)}}function Br(r,n){1&r&&e._UZ(0,"clr-icon",2)}G.\u0275fac=function(n){return new(n||G)(e.Y36(c.iHG))},G.\u0275cmp=e.Xpm({type:G,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[e.TTD],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"localeDate"),e.qZA(),e.TgZ(4,"vdr-labeled-data",0),e.ALo(5,"translate"),e._uU(6),e.qZA(),e.YNc(7,Gr,3,4,"vdr-labeled-data",1),e.TgZ(8,"vdr-labeled-data",0),e.ALo(9,"translate"),e._UZ(10,"vdr-simple-item-list",2),e.qZA(),e.YNc(11,Vr,2,1,"ng-container",3)),2&n&&(e.Q6J("label",e.lcZ(1,8,"common.created-at")),e.xp6(2),e.hij(" ",e.xi3(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),e.xp6(2),e.Q6J("label",e.lcZ(5,13,"order.fulfillment-method")),e.xp6(2),e.hij(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),e.xp6(1),e.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),e.xp6(1),e.Q6J("label",e.lcZ(9,15,"order.contents")),e.xp6(2),e.Q6J("items",t.items),e.xp6(1),e.Q6J("ngForOf",t.customFieldConfig))},dependencies:[p.sg,p.O5,Ee.M,T.W,E,m.X$,Je.H],changeDetection:0});class le{get chipColorType(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}function Wr(r,n){if(1&r&&e._UZ(0,"vdr-fulfillment-detail",7),2&r){const t=e.oxw();e.Q6J("fulfillmentId",null==t.fulfillment?null:t.fulfillment.id)("order",t.order)}}le.\u0275fac=function(n){return new(n||le)},le.\u0275cmp=e.Xpm({type:le,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-chip",0),e.ALo(1,"translate"),e.YNc(2,Br,1,0,"clr-icon",1),e._uU(3),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()),2&n&&(e.Q6J("title",e.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),e.xp6(2),e.Q6J("ngIf","Delivered"===t.state),e.xp6(1),e.hij(" ",e.lcZ(4,6,e.lcZ(5,8,t.state)),"\n"))},dependencies:[u.qvL,p.O5,F.Y,m.X$,P.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});const lt=function(r){return{state:r}};function Xr(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",14),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw(2);return e.KtG(s.transitionState.emit(a))}),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA(),e.BQk()}if(2&r){const t=n.ngIf;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.set-fulfillment-state",e.VKq(8,lt,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function zr(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"clr-icon",18),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.BQk()),2&r){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.transition-to-state",e.VKq(8,lt,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function eo(r,n){1&r&&(e._UZ(0,"clr-icon",19),e._uU(1),e.ALo(2,"translate")),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-fulfillment")," "))}function to(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",15),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.transitionState.emit(a))}),e.YNc(2,zr,6,10,"ng-container",16),e.YNc(3,eo,3,3,"ng-template",null,17,e.W1O),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,o=e.MAs(4);e.xp6(2),e.Q6J("ngIf","Cancelled"!==t)("ngIfElse",o)}}function no(r,n){if(1&r&&(e.TgZ(0,"div",8),e.YNc(1,Xr,6,10,"ng-container",9),e.TgZ(2,"vdr-dropdown")(3,"button",10),e._UZ(4,"clr-icon",11),e.qZA(),e.TgZ(5,"vdr-dropdown-menu",12),e.YNc(6,to,5,2,"ng-container",13),e.qZA()()()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.nextSuggestedState()),e.xp6(5),e.Q6J("ngForOf",t.nextOtherStates())}}class ce{constructor(){this.transitionState=new e.vpe}nextSuggestedState(){if(!this.fulfillment)return;const{nextStates:n}=this.fulfillment,t=o=>n.includes(o)?o:n[0];switch(this.fulfillment?.state){case"Pending":return t("Shipped");case"Shipped":return t("Delivered");default:return n.find(o=>"Cancelled"!==o)}}nextOtherStates(){if(!this.fulfillment)return[];const n=this.nextSuggestedState();return this.fulfillment.nextStates.filter(t=>t!==n)}}function ro(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.note")),e.xp6(2),e.Oqu(t.modification.note)}}function oo(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"localeCurrency"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();let i;e.Q6J("label",e.lcZ(1,3,"order.surcharges")),e.xp6(2),e.AsE(" ",null==(i=o.getSurcharge(t.id))?null:i.description," ",e.xi3(3,5,null==(i=o.getSurcharge(t.id))?null:i.priceWithTax,o.order.currencyCode),"")}}function io(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._UZ(2,"vdr-simple-item-list",3),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.added-items")),e.xp6(2),e.Q6J("items",t.getAddedItems())}}function ao(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._UZ(2,"vdr-simple-item-list",3),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.removed-items")),e.xp6(2),e.Q6J("items",t.getRemovedItems())}}ce.\u0275fac=function(n){return new(n||ce)},ce.\u0275cmp=e.Xpm({type:ce,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div",2),e._UZ(6,"vdr-fulfillment-state-label",3),e.qZA()(),e.TgZ(7,"div",4),e.YNc(8,Wr,1,2,"vdr-fulfillment-detail",5),e.qZA(),e.YNc(9,no,7,2,"div",6),e.qZA()),2&n&&(e.xp6(3),e.Oqu(e.lcZ(4,4,"order.fulfillment")),e.xp6(3),e.Q6J("state",null==t.fulfillment?null:t.fulfillment.state),e.xp6(2),e.Q6J("ngIf",!!t.fulfillment),e.xp6(1),e.Q6J("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},dependencies:[u.qvL,p.sg,p.O5,J.J,D.N,N.U,Le.H,G,le,m.X$,P.N],styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});class de{constructor(){this.addedItems=new Map,this.removedItems=new Map}ngOnChanges(){const{added:n,removed:t}=this.getModifiedLines();this.addedItems=n,this.removedItems=t}getSurcharge(n){return this.order.surcharges.find(t=>t.id===n)}getAddedItems(){return[...this.addedItems.entries()].map(([n,t])=>({name:n.productVariant.name,quantity:t}))}getRemovedItems(){return[...this.removedItems.entries()].map(([n,t])=>({name:n.productVariant.name,quantity:t}))}getModifiedLines(){const n=new Map,t=new Map;for(const o of this.modification.lines||[]){const i=this.order.lines.find(a=>a.id===o.orderLineId);i&&(o.quantity<0?t.set(i,-o.quantity):n.set(i,o.quantity))}return{added:n,removed:t}}}de.\u0275fac=function(n){return new(n||de)},de.\u0275cmp=e.Xpm({type:de,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[e.TTD],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA(),e.YNc(3,ro,3,4,"vdr-labeled-data",1),e.YNc(4,oo,4,8,"vdr-labeled-data",2),e.YNc(5,io,3,4,"vdr-labeled-data",1),e.YNc(6,ao,3,4,"vdr-labeled-data",1)),2&n&&(e.Q6J("label",e.lcZ(1,6,"common.ID")),e.xp6(2),e.Oqu(t.modification.id),e.xp6(1),e.Q6J("ngIf",t.modification.note),e.xp6(1),e.Q6J("ngForOf",t.modification.surcharges),e.xp6(1),e.Q6J("ngIf",t.getAddedItems().length),e.xp6(1),e.Q6J("ngIf",t.getRemovedItems().length))},dependencies:[p.sg,p.O5,T.W,E,m.X$,h.k],changeDetection:0});var ct=d(7284),Ye=d(4400);const je=72;function lo(r,n){if(1&r&&(e.TgZ(0,"div",3),e._UZ(1,"div",4)(2,"clr-icon",5),e.TgZ(3,"div",6),e._uU(4),e.ALo(5,"translate"),e.ALo(6,"stateI18nToken"),e.qZA()()),2&r){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,e.lcZ(6,3,t.cancelledState))," ")}}class K{constructor(n){this.elementRef=n,this.active$=new Ye.X(!1),this.activeTarget$=new Ye.X(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}ngOnChanges(n){this.isCancellable=!!this.node.to.find(t=>"Cancelled"===t.name),n.active&&this.active$.next(this.active)}getPos(n="top"){this.elementRef.nativeElement.getBoundingClientRect();const o=this.elementRef.nativeElement.querySelector(".node")?.getBoundingClientRect().height??0;return{x:10,y:this.index*je+("bottom"===n?o:0)}}getStyle(){const n=this.getPos();return{"top.px":n.y,"left.px":n.x}}}K.\u0275fac=function(n){return new(n||K)(e.Y36(e.SBq))},K.\u0275cmp=e.Xpm({type:K,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[e.TTD],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e.TgZ(2,"div",1),e.ALo(3,"async"),e._uU(4),e.ALo(5,"translate"),e.ALo(6,"stateI18nToken"),e.qZA(),e.YNc(7,lo,7,5,"div",2),e.qZA()),2&n&&(e.ekj("active",e.lcZ(1,7,t.active$)),e.Q6J("ngStyle",t.getStyle()),e.xp6(2),e.ekj("active-target",e.lcZ(3,9,t.activeTarget$)),e.xp6(2),e.hij(" ",e.lcZ(5,11,e.lcZ(6,13,t.node.name))," "),e.xp6(3),e.Q6J("ngIf",t.isCancellable))},dependencies:[u.qvL,p.O5,p.PC,p.Ov,m.X$,P.N],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0});class se{ngOnInit(){this.active$=this.from.active$.asObservable().pipe((0,Ie.b)(n=>this.to.activeTarget$.next(n)))}getStyle(){const n=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===n?"bottom":"top"),o=this.to.getPos("down"===n?"top":"bottom"),i=Math.abs(t.x-o.x),a=Math.abs(t.y-o.y),s=Math.sqrt(i**2+a**2);return{"top.px":t.y,"left.px":t.x+("down"===n?10:40)+12*this.index,"height.px":s,"width.px":1,..."up"===n?{transform:"rotateZ(180deg)","transform-origin":"top"}:{}}}}function co(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"vdr-order-process-node",1),e.NdJ("mouseenter",function(){const a=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.onMouseOver(a.name))})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onMouseOut())}),e.ALo(2,"async"),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,o=n.index,i=e.oxw();e.xp6(1),e.Q6J("node",t)("index",o)("active",e.lcZ(2,3,i.activeState$)===t.name)}}function so(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"vdr-order-process-edge",2),e.BQk()),2&r){const t=n.$implicit;e.xp6(1),e.Q6J("from",t.from)("to",t.to)("index",t.index)}}se.\u0275fac=function(n){return new(n||se)},se.\u0275cmp=e.Xpm({type:se,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.ALo(1,"async"),e._UZ(2,"clr-icon",1),e.qZA()),2&n&&(e.ekj("active",e.lcZ(1,5,t.active$)),e.Q6J("ngStyle",t.getStyle()),e.uIk("data-from",t.from.node.name)("data-to",t.to.node.name))},dependencies:[u.qvL,p.PC,p.Ov],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0});class pe{constructor(n){this.changeDetector=n,this.setActiveState$=new Ye.X(void 0),this.nodes=[],this.edges=[]}get outerHeight(){return this.nodes.length*je}ngOnInit(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe((0,Qe.b)(150))}ngOnChanges(n){this.populateNodes()}ngAfterViewInit(){setTimeout(()=>this.populateEdges())}onMouseOver(n){this.setActiveState$.next(n)}onMouseOut(){this.setActiveState$.next(this.initialState)}getNodeFor(n){if(this.nodeComponents)return this.nodeComponents.find(t=>t.node.name===n)}populateNodes(){const n=new Map;for(const t of this.states)n.set(t.name,{name:t.name,to:[]});for(const[t,o]of n.entries()){const i=this.states.find(a=>a.name===t)?.to??[];for(const a of i){const s=n.get(a);s&&o.to.push(s)}}this.nodes=[...n.values()].filter(t=>"Cancelled"!==t.name)}populateEdges(){for(const n of this.nodes){const t=this.getNodeFor(n.name);let o=0;for(const i of n.to){const a=this.getNodeFor(i.name);t&&a&&t!==a&&(this.edges.push({to:a,from:t,index:o}),o++)}}this.edges=[...this.edges],this.changeDetector.markForCheck()}}function po(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.order-state-diagram"))}pe.\u0275fac=function(n){return new(n||pe)(e.Y36(e.sBO))},pe.\u0275cmp=e.Xpm({type:pe,selectors:[["vdr-order-process-graph"]],viewQuery:function(n,t){if(1&n&&e.Gf(K,5),2&n){let o;e.iGM(o=e.CRH())&&(t.nodeComponents=o)}},hostVars:2,hostBindings:function(n,t){2&n&&e.Udp("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[e.TTD],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(n,t){1&n&&(e.YNc(0,co,3,5,"ng-container",0),e.YNc(1,so,2,3,"ng-container",0)),2&n&&(e.Q6J("ngForOf",t.nodes),e.xp6(1),e.Q6J("ngForOf",t.edges))},dependencies:[p.sg,K,se,p.Ov],styles:["[_nghost-%COMP%]{display:block;border:1px hotpink;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0});class ue{constructor(n){this.serverConfigService=n,this.states=[]}ngOnInit(){this.states=this.serverConfigService.getOrderProcessStates()}}ue.\u0275fac=function(n){return new(n||ue)(e.Y36(c.iHG))},ue.\u0275cmp=e.Xpm({type:ue,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(n,t){1&n&&(e.YNc(0,po,2,3,"ng-template",0),e._UZ(1,"vdr-order-process-graph",1)),2&n&&(e.xp6(1),e.Q6J("states",t.states)("initialState",t.activeState))},dependencies:[y.q,pe,m.X$],changeDetection:0});var dt=d(7619);function uo(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.refund-and-cancel-order"))}function _o(r,n){if(1&r&&(e.TgZ(0,"div",36),e._uU(1),e.TgZ(2,"div",37),e._uU(3),e.ALo(4,"currency"),e.ALo(5,"number"),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw(3).$implicit,i=e.oxw();e.xp6(1),e.hij(" ",t.description," "),e.xp6(2),e.hij(" ",e.xi3(4,2,e.xi3(5,5,t.amount/100/o.quantity,"1.0-2"),i.order.currencyCode)," ")}}function mo(r,n){if(1&r&&(e.TgZ(0,"vdr-dropdown")(1,"div",32)(2,"button",33),e._UZ(3,"clr-icon",34),e.qZA()(),e.TgZ(4,"vdr-dropdown-menu"),e.YNc(5,_o,6,8,"div",35),e.qZA()()),2&r){const t=e.oxw().ngIf;e.xp6(5),e.Q6J("ngForOf",t)}}function go(r,n){if(1&r&&(e.ynx(0),e.YNc(1,mo,6,1,"vdr-dropdown",26),e.BQk()),2&r){const t=n.ngIf;e.xp6(1),e.Q6J("ngIf",t.length)}}function fo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",38),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id].quantity=i)})("input",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.handleZeroQuantity(a.lineQuantities[i.id]))}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("ngModel",o.lineQuantities[t.id].quantity)("max",t.quantity)}}function ho(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",39),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id].refund=i)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("disabled",0===o.lineQuantities[t.id].quantity)("ngModel",o.lineQuantities[t.id].refund)}}function xo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"input",39),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw().$implicit,s=e.oxw();return e.KtG(s.lineQuantities[a.id].cancel=i)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("disabled",0===o.lineQuantities[t.id].quantity)("ngModel",o.lineQuantities[t.id].cancel)}}function Co(r,n){if(1&r&&(e.TgZ(0,"tr",18)(1,"td",19),e._UZ(2,"img",20),e.ALo(3,"assetPreview"),e.qZA(),e.TgZ(4,"td",21),e._uU(5),e.qZA(),e.TgZ(6,"td",22),e._uU(7),e.qZA(),e.TgZ(8,"td",23),e._uU(9),e._UZ(10,"vdr-line-refunds",24),e.qZA(),e.TgZ(11,"td",23),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA(),e.TgZ(14,"td",23)(15,"div",25),e._uU(16),e.ALo(17,"localeCurrency"),e.YNc(18,go,2,1,"ng-container",26),e.qZA()(),e.TgZ(19,"td",27),e.YNc(20,fo,1,2,"input",28),e.qZA(),e.TgZ(21,"td",29)(22,"div",30),e.YNc(23,ho,1,2,"input",31),e.qZA()(),e.TgZ(24,"td",29)(25,"div",30),e.YNc(26,xo,1,2,"input",31),e.qZA()()()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(2),e.Q6J("src",e.xi3(3,12,t.featuredAsset,"tiny"),e.LSH),e.xp6(3),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.hij(" ",t.quantity," "),e.xp6(1),e.Q6J("line",t)("payments",o.order.payments),e.xp6(2),e.hij(" ",e.xi3(13,15,t.unitPriceWithTax,o.order.currencyCode)," "),e.xp6(4),e.hij(" ",e.xi3(17,18,t.proratedUnitPriceWithTax,o.order.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",t.discounts),e.xp6(2),e.Q6J("ngIf",o.lineCanBeRefundedOrCancelled(t)),e.xp6(3),e.Q6J("ngIf",o.lineCanBeRefundedOrCancelled(t)),e.xp6(3),e.Q6J("ngIf",o.lineCanBeRefundedOrCancelled(t))}}function vo(r,n){if(1&r&&(e.TgZ(0,"option",40),e._uU(1),e.ALo(2,"localeCurrency"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();e.Q6J("ngValue",t)("disabled","Settled"!==t.state),e.xp6(1),e.lnq(" #",t.id," ",t.method,": ",e.xi3(2,5,t.amount,o.order.currencyCode)," ")}}const yo=function(r,n){return{min:r,max:n}};function Oo(r,n){if(1&r&&(e.TgZ(0,"div",41),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"currency"),e.ALo(4,"localeCurrency"),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,"order.refund-total-error",e.WLB(10,yo,e.xi3(3,4,0,t.order.currencyCode),e.xi3(4,7,t.settledPaymentsTotal,t.order.currencyCode)))," ")}}function Zo(r,n){1&r&&(e.TgZ(0,"div",42),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.refund-total-warning")," "))}const bo=function(r){return{amount:r}};function To(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"localeCurrency"),e.BQk()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.refund-with-amount",e.VKq(7,bo,e.xi3(3,4,t.refundTotal,t.order.currencyCode)))," ")}}function Ao(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.hij(" ",e.lcZ(1,1,"order.cancel-selected-items")," ")}function Io(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",44),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.select())}),e.YNc(4,To,4,9,"ng-container",45),e.YNc(5,Ao,2,3,"ng-template",null,46,e.W1O),e.qZA()}if(2&r){const t=e.MAs(6),o=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,4,"common.cancel")),e.xp6(2),e.Q6J("disabled",!o.canSubmit()),e.xp6(1),e.Q6J("ngIf",o.isRefunding())("ngIfElse",t)}}class _e{constructor(n){this.i18nService=n,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=(0,c.hq7)().cancellationReasons??[(0,_.J)("order.refund-reason-customer-request"),(0,_.J)("order.refund-reason-not-available")],this.reasons=this.reasons.map(t=>this.i18nService.translate(t))}get refundTotal(){return this.order.lines.reduce((t,o)=>{const i=this.lineQuantities[o.id],a=i.refund&&i.quantity||0;return t+o.proratedUnitPriceWithTax*a},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}get settledPaymentsTotal(){return this.settledPayments.map(n=>n.amount-(0,I.summate)(n.refunds.filter(i=>"Failed"!==i.state),"total")).reduce((n,t)=>n+t,0)}lineCanBeRefundedOrCancelled(n){return(this.order.payments?.reduce((o,i)=>[...o,...i.refunds],[]).filter(o=>"Failed"!==o.state).reduce((o,i)=>[...o,...i.lines],[]).filter(o=>o.orderLineId===n.id).reduce((o,i)=>o+i.quantity,0)??0)<n.quantity}ngOnInit(){this.lineQuantities=this.order.lines.reduce((n,t)=>({...n,[t.id]:{quantity:0,refund:!1,cancel:!1}}),{}),this.settledPayments=(this.order.payments||[]).filter(n=>"Settled"===n.state),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}handleZeroQuantity(n){0===n?.quantity&&(n.cancel=!1,n.refund=!1)}isRefunding(){return Object.values(this.lineQuantities).reduce((t,o)=>t||0<o.quantity&&o.refund,!1)}isCancelling(){return Object.values(this.lineQuantities).reduce((t,o)=>t||0<o.quantity&&o.cancel,!1)}canSubmit(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}select(){const n=this.selectedPayment;if(n){const t=this.getOrderLineInput(i=>i.refund),o=this.getOrderLineInput(i=>i.cancel);this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shippingWithTax:0,adjustment:this.adjustment,paymentId:n.id},cancel:{lines:o,orderId:this.order.id,reason:this.reason,cancelShipping:this.refundShipping}})}}cancel(){this.resolveWith()}getOrderLineInput(n){return Object.entries(this.lineQuantities).filter(([t,o])=>0<o.quantity&&n(o)).map(([t,o])=>({orderLineId:t,quantity:o.quantity}))}}function Lo(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.settle-refund"))}function wo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",!t.transactionId),e.xp6(1),e.hij(" ",e.lcZ(5,5,"order.settle-refund")," ")}}_e.\u0275fac=function(n){return new(n||_e)(e.Y36(c.Dp7))},_e.\u0275cmp=e.Xpm({type:_e,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:76,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt-4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","quantity-col"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(n,t){1&n&&(e.YNc(0,uo,2,3,"ng-template",0),e.TgZ(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.TgZ(19,"th"),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"th"),e._uU(23),e.ALo(24,"translate"),e.qZA(),e.TgZ(25,"th"),e._uU(26),e.ALo(27,"translate"),e.qZA(),e.TgZ(28,"th"),e._uU(29),e.ALo(30,"translate"),e.qZA()()(),e.YNc(31,Co,27,21,"tr",4),e.qZA()(),e.TgZ(32,"div",5)(33,"div")(34,"label",6),e._uU(35),e.ALo(36,"translate"),e.qZA(),e.TgZ(37,"ng-select",7),e.NdJ("ngModelChange",function(i){return t.reason=i}),e.ALo(38,"translate"),e.qZA()(),e.TgZ(39,"div")(40,"clr-select-container")(41,"label"),e._uU(42),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"select",8),e.NdJ("ngModelChange",function(i){return t.selectedPayment=i}),e.YNc(45,vo,3,8,"option",9),e.qZA()(),e.TgZ(46,"clr-checkbox-wrapper")(47,"input",10),e.NdJ("ngModelChange",function(i){return t.refundShipping=i}),e.qZA(),e.TgZ(48,"label"),e._uU(49),e.ALo(50,"translate"),e.ALo(51,"localeCurrency"),e.qZA()(),e.TgZ(52,"clr-input-container")(53,"label"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.TgZ(56,"vdr-currency-input",11),e.NdJ("ngModelChange",function(i){return t.adjustment=i}),e.qZA()(),e.TgZ(57,"div",12)(58,"div",13),e._uU(59),e.ALo(60,"translate"),e.ALo(61,"localeCurrency"),e.qZA(),e.TgZ(62,"div",14),e._uU(63),e.ALo(64,"translate"),e.ALo(65,"localeCurrency"),e.qZA(),e.YNc(66,Oo,5,13,"div",15),e.YNc(67,Zo,3,3,"div",16),e.qZA()()()(),e.YNc(68,Io,7,6,"ng-template",17)),2&n&&(e.xp6(8),e.Oqu(e.lcZ(9,37,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,39,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,41,"order.quantity")),e.xp6(3),e.Oqu(e.lcZ(18,43,"order.unit-price")),e.xp6(3),e.Oqu(e.lcZ(21,45,"order.prorated-unit-price")),e.xp6(3),e.Oqu(e.lcZ(24,47,"order.quantity")),e.xp6(3),e.Oqu(e.lcZ(27,49,"order.refund")),e.xp6(3),e.Oqu(e.lcZ(30,51,"order.cancel")),e.xp6(2),e.Q6J("ngForOf",t.order.lines),e.xp6(1),e.ekj("faded",!t.isRefunding()&&!t.isCancelling()),e.xp6(3),e.Oqu(e.lcZ(36,53,"order.refund-cancellation-reason")),e.xp6(2),e.Q6J("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",e.lcZ(38,55,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),e.xp6(5),e.Oqu(e.lcZ(43,57,"order.payment-to-refund")),e.xp6(2),e.Q6J("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),e.xp6(1),e.Q6J("ngForOf",t.settledPayments),e.xp6(2),e.Q6J("ngModel",t.refundShipping)("disabled",!t.isRefunding()),e.xp6(2),e.AsE(" ",e.lcZ(50,59,"order.refund-shipping")," (",e.xi3(51,61,t.order.shippingWithTax,t.order.currencyCode),") "),e.xp6(5),e.Oqu(e.lcZ(55,64,"order.refund-adjustment")),e.xp6(2),e.Q6J("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),e.xp6(1),e.ekj("disabled",!t.isRefunding()),e.xp6(2),e.AsE(" ",e.lcZ(60,66,"order.payment-amount"),": ",e.xi3(61,68,t.selectedPayment.amount,t.order.currencyCode)," "),e.xp6(4),e.AsE(" ",e.lcZ(64,71,"order.refund-total"),": ",e.xi3(65,73,t.refundTotal,t.order.currencyCode)," "),e.xp6(3),e.Q6J("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),e.xp6(1),e.Q6J("ngIf",t.selectedPayment.amount<t.refundTotal))},dependencies:[u.qvL,u.MgK,u.KKC,u.PEh,u.xRP,u.G55,u.otW,u.dTv,p.sg,p.O5,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.EJ,l.JJ,l.qQ,l.Fd,l.On,M.w9,dt.K,x.y,Z.n,y.q,J.J,D.N,N.U,Q,p.JJ,p.H9,m.X$,X.M,h.k],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.quantity-col[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.refund-details.faded[_ngcontent-%COMP%]{opacity:.5}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0});const Mo=function(r){return{method:r}};class me{constructor(){this.transactionId=""}submit(){this.resolveWith(this.transactionId)}cancel(){this.resolveWith()}}me.\u0275fac=function(n){return new(n||me)},me.\u0275cmp=e.Xpm({type:me,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,Lo,2,3,"ng-template",0),e.TgZ(1,"p",1),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"clr-input-container")(5,"label"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"input",2),e.NdJ("ngModelChange",function(i){return t.transactionId=i}),e.qZA()(),e.YNc(9,wo,6,7,"ng-template",3)),2&n&&(e.xp6(2),e.hij(" ",e.xi3(3,3,"order.settle-refund-manual-instructions",e.VKq(8,Mo,t.refund.method)),"\n"),e.xp6(4),e.Oqu(e.lcZ(7,6,"order.transaction-id")),e.xp6(2),e.Q6J("ngModel",t.transactionId))},dependencies:[u.MgK,u.xRP,u.G55,l.Fj,l.JJ,l.On,x.y,Z.n,y.q,m.X$],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});var st=d(4753),Fo=d(9617);function qo(r,n){1&r&&e._UZ(0,"clr-icon",2)}class ge{get chipColorType(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}function So(r,n){1&r&&e._UZ(0,"clr-icon",2)}ge.\u0275fac=function(n){return new(n||ge)},ge.\u0275cmp=e.Xpm({type:ge,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-chip",0),e.ALo(1,"translate"),e.YNc(2,qo,1,0,"clr-icon",1),e._uU(3),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()),2&n&&(e.Q6J("title",e.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),e.xp6(2),e.Q6J("ngIf","Settled"===t.state),e.xp6(1),e.hij(" ",e.lcZ(4,6,e.lcZ(5,8,t.state)),"\n"))},dependencies:[u.qvL,p.O5,F.Y,m.X$,P.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});class fe{get chipColorType(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}function Po(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.error-message")),e.xp6(2),e.hij(" ",t.payment.errorMessage,"\n")}}function Jo(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw();e.Q6J("label",e.lcZ(1,2,"order.transaction-id")),e.xp6(2),e.hij(" ",t.payment.transactionId,"\n")}}fe.\u0275fac=function(n){return new(n||fe)},fe.\u0275cmp=e.Xpm({type:fe,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-chip",0),e.ALo(1,"translate"),e.YNc(2,So,1,0,"clr-icon",1),e._uU(3),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()),2&n&&(e.Q6J("title",e.lcZ(1,4,"order.payment-state"))("colorType",t.chipColorType),e.xp6(2),e.Q6J("ngIf","Settled"===t.state),e.xp6(1),e.hij(" ",e.lcZ(4,6,e.lcZ(5,8,t.state)),"\n"))},dependencies:[u.qvL,p.O5,F.Y,m.X$,P.N],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});class V{}function Do(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.BQk()),2&r){const t=e.oxw();e.xp6(1),e.hij("#",t.payment.transactionId,"")}}function No(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",11),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.transaction-id")),e.xp6(2),e.hij(" ",t.transactionId," ")}}function Qo(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",11),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.refund-reason")),e.xp6(2),e.hij(" ",t.reason," ")}}function Uo(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",11),e.ALo(1,"translate"),e._UZ(2,"vdr-object-tree",13),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.refund-metadata")),e.xp6(2),e.Q6J("value",t.metadata)}}function ko(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",14)(1,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw();return e.KtG(a.settleRefund.emit(i))}),e._uU(2),e.ALo(3,"translate"),e.qZA()()}2&r&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"order.settle-refund")," "))}function Eo(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",1),e._UZ(2,"clr-icon",9),e._uU(3),e.ALo(4,"translate"),e._UZ(5,"div",10)(6,"vdr-refund-state-label",4),e.qZA(),e.TgZ(7,"div",5)(8,"vdr-labeled-data",11),e.ALo(9,"translate"),e._uU(10),e.ALo(11,"localeDate"),e.qZA(),e.TgZ(12,"vdr-labeled-data",11),e.ALo(13,"translate"),e._uU(14),e.ALo(15,"localeCurrency"),e.qZA(),e.YNc(16,No,3,4,"vdr-labeled-data",12),e.YNc(17,Qo,3,4,"vdr-labeled-data",12),e.YNc(18,Uo,3,4,"vdr-labeled-data",12),e.qZA(),e.YNc(19,ko,4,3,"div",8),e.BQk()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(3),e.AsE(" ",e.lcZ(4,11,"order.refund")," #",t.id," "),e.xp6(3),e.Q6J("state",t.state),e.xp6(2),e.Q6J("label",e.lcZ(9,13,"common.created-at")),e.xp6(2),e.hij(" ",e.xi3(11,15,t.createdAt,"medium")," "),e.xp6(2),e.Q6J("label",e.lcZ(13,18,"order.refund-total")),e.xp6(2),e.hij(" ",e.xi3(15,20,t.total,o.currencyCode)," "),e.xp6(2),e.Q6J("ngIf",t.transactionId),e.xp6(1),e.Q6J("ngIf",t.reason),e.xp6(1),e.Q6J("ngIf",o.refundHasMetadata(t)),e.xp6(1),e.Q6J("ngIf","Pending"===t.state)}}function Yo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.settlePayment.emit(i.payment))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.settle-payment")," "))}V.\u0275fac=function(n){return new(n||V)},V.\u0275cmp=e.Xpm({type:V,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-labeled-data",0),e.ALo(1,"translate"),e._uU(2),e.qZA(),e.TgZ(3,"vdr-labeled-data",0),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA(),e.YNc(7,Po,3,4,"vdr-labeled-data",1),e.YNc(8,Jo,3,4,"vdr-labeled-data",1),e.TgZ(9,"vdr-labeled-data",0),e.ALo(10,"translate"),e._UZ(11,"vdr-object-tree",2),e.qZA()),2&n&&(e.Q6J("label",e.lcZ(1,8,"order.payment-method")),e.xp6(2),e.hij(" ",t.payment.method,"\n"),e.xp6(1),e.Q6J("label",e.lcZ(4,10,"order.amount")),e.xp6(2),e.hij(" ",e.xi3(6,12,t.payment.amount,t.currencyCode),"\n"),e.xp6(2),e.Q6J("ngIf",t.payment.errorMessage),e.xp6(1),e.Q6J("ngIf",t.payment.transactionId),e.xp6(1),e.Q6J("label",e.lcZ(10,15,"order.payment-metadata")),e.xp6(2),e.Q6J("value",t.payment.metadata))},dependencies:[p.O5,T.W,qe._,m.X$,h.k],changeDetection:0});const jo=function(r){return{state:r}};function Ro(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"clr-icon",23),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.BQk()),2&r){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.transition-to-state",e.VKq(8,jo,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function $o(r,n){1&r&&(e._UZ(0,"clr-icon",24),e._uU(1),e.ALo(2,"translate")),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.cancel-payment")," "))}function Ho(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",20),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.transitionPaymentState.emit({payment:s.payment,state:a}))}),e.YNc(2,Ro,6,10,"ng-container",21),e.YNc(3,$o,3,3,"ng-template",null,22,e.W1O),e.qZA(),e.BQk()}if(2&r){const t=n.$implicit,o=e.MAs(4);e.xp6(2),e.Q6J("ngIf","Cancelled"!==t)("ngIfElse",o)}}function Go(r,n){if(1&r&&(e.TgZ(0,"div",14),e.YNc(1,Yo,3,3,"button",16),e.TgZ(2,"vdr-dropdown")(3,"button",17),e._UZ(4,"clr-icon",18),e.qZA(),e.TgZ(5,"vdr-dropdown-menu",19),e.YNc(6,Ho,5,2,"ng-container",7),e.qZA()()()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.payment.nextStates.includes("Settled")),e.xp6(5),e.Q6J("ngForOf",t.nextOtherStates())}}class he{constructor(){this.settlePayment=new e.vpe,this.transitionPaymentState=new e.vpe,this.settleRefund=new e.vpe}refundHasMetadata(n){return!!n&&Object.keys(n.metadata).length>0}nextOtherStates(){return this.payment?this.payment.nextStates.filter(n=>"Settled"!==n&&"Error"!==n):[]}}he.\u0275fac=function(n){return new(n||he)},he.\u0275cmp=e.Xpm({type:he,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div"),e._uU(3),e.ALo(4,"translate"),e.YNc(5,Do,2,1,"ng-container",2),e.qZA(),e.TgZ(6,"div",3),e._UZ(7,"vdr-payment-state-label",4),e.qZA()(),e.TgZ(8,"div",5),e._UZ(9,"vdr-payment-detail",6),e.qZA(),e.YNc(10,Eo,20,23,"ng-container",7),e.YNc(11,Go,7,2,"div",8),e.qZA()),2&n&&(e.xp6(3),e.hij(" ",e.lcZ(4,7,"order.payment")," "),e.xp6(2),e.Q6J("ngIf",t.payment.transactionId),e.xp6(2),e.Q6J("state",t.payment.state),e.xp6(2),e.Q6J("payment",t.payment)("currencyCode",t.currencyCode),e.xp6(1),e.Q6J("ngForOf",t.payment.refunds),e.xp6(1),e.Q6J("ngIf",t.payment.nextStates.length))},dependencies:[u.qvL,p.sg,p.O5,it.Lv,J.J,D.N,N.U,Le.H,T.W,qe._,ge,fe,V,m.X$,P.N,Je.H,h.k],styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var pt=d(2125),Ko=d(9114);const Vo=["portal"];class xe{constructor(n,t){this.componentFactoryResolver=n,this.historyEntryComponentService=t,this.expandClick=new e.vpe}ngOnInit(){const n=this.historyEntryComponentService.getComponent(this.entry.type),t=this.componentFactoryResolver.resolveComponentFactory(n),o=this.portalRef.createComponent(t);o.instance.entry=this.entry,o.instance.order=this.order,this.instance=o.instance,this.componentRef=o}ngOnDestroy(){this.componentRef?.destroy()}}xe.\u0275fac=function(n){return new(n||xe)(e.Y36(e._Vd),e.Y36(c.GwB))},xe.\u0275cmp=e.Xpm({type:xe,selectors:[["vdr-order-history-entry-host"]],viewQuery:function(n,t){if(1&n&&e.Gf(Vo,7,e.s_b),2&n){let o;e.iGM(o=e.CRH())&&(t.portalRef=o.first)}},inputs:{entry:"entry",order:"order",expanded:"expanded"},outputs:{expandClick:"expandClick"},exportAs:["historyEntry"],decls:3,vars:6,consts:[[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],["portal",""]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-timeline-entry",0),e.NdJ("expandClick",function(){return t.expandClick.emit()}),e._UZ(1,"div",null,1),e.qZA()),2&n&&e.Q6J("displayType",t.instance.getDisplayType(t.entry))("iconShape",t.instance.getIconShape&&t.instance.getIconShape(t.entry))("createdAt",t.entry.createdAt)("name",t.instance.getName&&t.instance.getName(t.entry))("featured",t.instance.isFeatured(t.entry))("collapsed",!t.expanded&&!t.instance.isFeatured(t.entry))},dependencies:[pt._],encapsulation:2});var ut=d(8064);function Bo(r,n){1&r&&(e.TgZ(0,"span",12),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.note-only-visible-to-administrators")," "))}function Wo(r,n){1&r&&(e.TgZ(0,"span",13),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.note-visible-to-customer")," "))}function Xo(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-order-history-entry-host",16),e.NdJ("expandClick",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.expanded=!i.expanded)}),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("order",o.order)("entry",t)("expanded",o.expanded)}}function zo(r,n){1&r&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.history-order-fulfilled")," "))}function ei(r,n){1&r&&(e.TgZ(0,"div",11),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.history-order-cancelled")," "))}const _t=function(r,n){return{from:r,to:n}};function ti(r,n){if(1&r&&(e._uU(0),e.ALo(1,"translate")),2&r){const t=e.oxw(3).$implicit;e.hij(" ",e.xi3(1,1,"order.history-order-transition",e.WLB(4,_t,t.data.from,t.data.to))," ")}}function ni(r,n){if(1&r&&(e.ynx(0),e.YNc(1,zo,3,3,"div",21),e.YNc(2,ei,3,3,"div",21),e.YNc(3,ti,2,7,"ng-template",22),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf","Delivered"===t.data.to),e.xp6(1),e.Q6J("ngIf","Cancelled"===t.data.to),e.xp6(1),e.Q6J("ngIf","Cancelled"!==t.data.to&&"Delivered"!==t.data.to)}}function ri(r,n){1&r&&(e.TgZ(0,"vdr-chip",27),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.modification-settled")))}function oi(r,n){1&r&&(e.TgZ(0,"vdr-chip",28),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.modification-not-settled")))}function ii(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"strong"),e._uU(4),e.ALo(5,"localeCurrency"),e.qZA(),e.YNc(6,ri,3,3,"vdr-chip",24),e.YNc(7,oi,3,3,"vdr-chip",25),e.TgZ(8,"vdr-history-entry-detail"),e._UZ(9,"vdr-modification-detail",26),e.qZA(),e.BQk()),2&r){const t=n.ngIf,o=e.oxw(4);e.xp6(1),e.hij(" ",e.lcZ(2,6,"order.modify-order-price-difference"),": "),e.xp6(3),e.Oqu(e.xi3(5,8,t.priceChange,o.order.currencyCode)),e.xp6(2),e.Q6J("ngIf",t.isSettled),e.xp6(1),e.Q6J("ngIf",!t.isSettled),e.xp6(2),e.Q6J("order",o.order)("modification",t)}}function ai(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,ii,10,11,"ng-container",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,2,"order.history-order-modified")," "),e.xp6(2),e.Q6J("ngIf",o.getModification(t.data.modificationId))}}function li(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-payment-detail",31),e.qZA()),2&r){const t=n.ngIf,o=e.oxw(5);e.xp6(1),e.Q6J("payment",t)("currencyCode",o.order.currencyCode)}}function ci(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._uU(4),e.ALo(5,"translate"),e.YNc(6,li,2,2,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.xp6(2),e.hij(" ",e.lcZ(3,4,"order.history-payment-settled")," "),e.xp6(2),e.AsE(" ",e.lcZ(5,6,"order.transaction-id"),": ",null==(i=o.getPayment(t))?null:i.transactionId," "),e.xp6(2),e.Q6J("ngIf",o.getPayment(t))}}const mt=function(r,n,t){return{from:r,to:n,id:t}};function di(r,n){if(1&r&&(e._uU(0),e.ALo(1,"translate")),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.hij(" ",e.xi3(1,1,"order.history-payment-transition",e.kEZ(4,mt,t.data.from,t.data.to,null==(i=o.getPayment(t))?null:i.transactionId))," ")}}function si(r,n){if(1&r&&(e.ynx(0),e.YNc(1,ci,7,8,"ng-container",29),e.YNc(2,di,2,8,"ng-template",null,30,e.W1O),e.BQk()),2&r){const t=e.MAs(3),o=e.oxw(2).$implicit;e.xp6(1),e.Q6J("ngIf","Settled"===o.data.to)("ngIfElse",t)}}function pi(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"order.history-refund-transition",e.kEZ(4,mt,t.data.from,t.data.to,t.data.refundId))," ")}}function ui(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail")(1,"vdr-labeled-data",32),e.ALo(2,"translate"),e._uU(3),e.qZA(),e.TgZ(4,"vdr-labeled-data",32),e.ALo(5,"translate"),e._UZ(6,"vdr-simple-item-list",33),e.qZA(),e.TgZ(7,"vdr-labeled-data",32),e.ALo(8,"translate"),e._uU(9),e.qZA()()),2&r){const t=n.ngIf,o=e.oxw(3).$implicit;e.xp6(1),e.Q6J("label",e.lcZ(2,6,"order.cancellation-reason")),e.xp6(2),e.hij(" ",o.data.reason," "),e.xp6(1),e.Q6J("label",e.lcZ(5,8,"order.contents")),e.xp6(2),e.Q6J("items",t),e.xp6(1),e.Q6J("label",e.lcZ(8,10,"order.shipping-cancelled")),e.xp6(2),e.hij(" ",o.data.shippingCancelled," ")}}const _i=function(r){return{count:r}};function mi(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.YNc(3,ui,10,12,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,2,"order.history-items-cancelled",e.VKq(5,_i,o.getCancelledQuantity(t)))," "),e.xp6(2),e.Q6J("ngIf",o.getCancelledItems(t))}}function gi(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-fulfillment-detail",34),e.qZA()),2&r){const t=n.ngIf,o=e.oxw(4);e.xp6(1),e.Q6J("fulfillmentId",t.id)("order",o.order)}}function fi(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.YNc(3,gi,2,2,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,2,"order.history-fulfillment-created")," "),e.xp6(2),e.Q6J("ngIf",o.getFulfillment(t))}}function hi(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._uU(4),e.ALo(5,"translate"),e.BQk()),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.xp6(2),e.hij(" ",e.lcZ(3,3,"order.history-fulfillment-delivered")," "),e.xp6(2),e.AsE(" ",e.lcZ(5,5,"order.tracking-code"),": ",null==(i=o.getFulfillment(t))?null:i.trackingCode," ")}}function xi(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._uU(4),e.ALo(5,"translate"),e.BQk()),2&r){const t=e.oxw(3).$implicit,o=e.oxw();let i;e.xp6(2),e.hij(" ",e.lcZ(3,3,"order.history-fulfillment-shipped")," "),e.xp6(2),e.AsE(" ",e.lcZ(5,5,"order.tracking-code"),": ",null==(i=o.getFulfillment(t))?null:i.trackingCode," ")}}function Ci(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r){const t=e.oxw(3).$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,"order.history-fulfillment-transition",e.WLB(4,_t,t.data.from,t.data.to))," ")}}function vi(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-fulfillment-detail",34),e.qZA()),2&r){const t=n.ngIf,o=e.oxw(4);e.xp6(1),e.Q6J("fulfillmentId",t.id)("order",o.order)}}function yi(r,n){if(1&r&&(e.ynx(0),e.YNc(1,hi,6,7,"ng-container",23),e.YNc(2,xi,6,7,"ng-container",23),e.YNc(3,Ci,3,7,"ng-container",23),e.YNc(4,vi,2,2,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit,o=e.oxw();e.xp6(1),e.Q6J("ngIf","Delivered"===t.data.to),e.xp6(1),e.Q6J("ngIf","Shipped"===t.data.to),e.xp6(1),e.Q6J("ngIf","Delivered"!==t.data.to&&"Shipped"!==t.data.to),e.xp6(1),e.Q6J("ngIf",o.getFulfillment(t))}}function Oi(r,n){1&r&&(e.TgZ(0,"span",47),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"common.public")))}function Zi(r,n){1&r&&(e.TgZ(0,"span",48),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"common.private")))}function bi(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",35)(2,"div",36),e.YNc(3,Oi,3,3,"span",37),e.YNc(4,Zi,3,3,"span",38),e._uU(5),e.qZA(),e._UZ(6,"div",39),e.TgZ(7,"vdr-dropdown")(8,"button",40),e._UZ(9,"clr-icon",41),e.qZA(),e.TgZ(10,"vdr-dropdown-menu",42)(11,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.updateNote.emit(i))}),e.ALo(12,"hasPermission"),e._UZ(13,"clr-icon",44),e._uU(14),e.ALo(15,"translate"),e.qZA(),e._UZ(16,"div",45),e.TgZ(17,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,a=e.oxw();return e.KtG(a.deleteNote.emit(i))}),e.ALo(18,"hasPermission"),e._UZ(19,"clr-icon",46),e._uU(20),e.ALo(21,"translate"),e.qZA()()()(),e.BQk()}if(2&r){const t=e.oxw(2).$implicit;e.xp6(3),e.Q6J("ngIf",t.isPublic),e.xp6(1),e.Q6J("ngIf",!t.isPublic),e.xp6(1),e.hij(" ",t.data.note," "),e.xp6(6),e.Q6J("disabled",!e.lcZ(12,7,"UpdateOrder")),e.xp6(3),e.hij(" ",e.lcZ(15,9,"common.edit")," "),e.xp6(3),e.Q6J("disabled",!e.lcZ(18,11,"UpdateOrder")),e.xp6(3),e.hij(" ",e.lcZ(21,13,"common.delete")," ")}}const Ti=function(r){return["/marketing","promotions",r]};function Ai(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"vdr-chip")(4,"a",49),e._uU(5),e.qZA()(),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,3,"order.history-coupon-code-applied"),": "),e.xp6(3),e.Q6J("routerLink",e.VKq(5,Ti,t.data.promotionId)),e.xp6(1),e.Oqu(t.data.couponCode)}}function Ii(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"vdr-chip")(4,"span",50),e._uU(5),e.qZA()(),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,2,"order.history-coupon-code-removed"),": "),e.xp6(4),e.Oqu(t.data.couponCode)}}function Li(r,n){if(1&r&&(e.TgZ(0,"vdr-history-entry-detail"),e._UZ(1,"vdr-object-tree",51),e.qZA()),2&r){const t=e.oxw(3).$implicit;e.xp6(1),e.Q6J("value",t.data)}}function wi(r,n){if(1&r&&(e.ynx(0),e.TgZ(1,"div",11),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Li,2,1,"vdr-history-entry-detail",23),e.BQk()),2&r){const t=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,2,t.type)," "),e.xp6(2),e.Q6J("ngIf",t.data)}}function Mi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-timeline-entry",17),e.NdJ("expandClick",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.expanded=!i.expanded)}),e.ynx(1,18),e.YNc(2,ni,4,3,"ng-container",19),e.YNc(3,ai,5,4,"ng-container",19),e.YNc(4,si,4,2,"ng-container",19),e.YNc(5,pi,3,8,"ng-container",19),e.YNc(6,mi,4,7,"ng-container",19),e.YNc(7,fi,4,4,"ng-container",19),e.YNc(8,yi,5,4,"ng-container",19),e.YNc(9,bi,22,15,"ng-container",19),e.YNc(10,Ai,6,7,"ng-container",19),e.YNc(11,Ii,6,4,"ng-container",19),e.YNc(12,wi,5,4,"ng-container",20),e.BQk(),e.qZA()}if(2&r){const t=e.oxw().$implicit,o=e.oxw();e.Q6J("displayType",o.getDisplayType(t))("iconShape",o.getTimelineIcon(t))("createdAt",t.createdAt)("name",o.getName(t))("featured",o.isFeatured(t))("collapsed",!o.expanded&&!o.isFeatured(t)),e.xp6(1),e.Q6J("ngSwitch",t.type),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_STATE_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_MODIFIED),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_PAYMENT_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_REFUND_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_CANCELLATION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_FULFILLMENT),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_FULFILLMENT_TRANSITION),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_NOTE),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_COUPON_APPLIED),e.xp6(1),e.Q6J("ngSwitchCase",o.type.ORDER_COUPON_REMOVED)}}function Fi(r,n){if(1&r&&(e.ynx(0),e.YNc(1,Xo,1,3,"vdr-order-history-entry-host",14),e.YNc(2,Mi,13,17,"ng-template",null,15,e.W1O),e.BQk()),2&r){const t=n.$implicit,o=e.MAs(3),i=e.oxw();e.xp6(1),e.Q6J("ngIf",i.hasCustomComponent(t.type))("ngIfElse",o)}}class Ce{constructor(n){this.historyEntryComponentService=n,this.addNote=new e.vpe,this.updateNote=new e.vpe,this.deleteNote=new e.vpe,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=c.iYD}hasCustomComponent(n){return!!this.historyEntryComponentService.getComponent(n)}getDisplayType(n){if(n.type===c.iYD.ORDER_STATE_TRANSITION){if("Delivered"===n.data.to)return"success";if("Cancelled"===n.data.to)return"error"}return n.type===c.iYD.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===n.data.to?"success":n.type===c.iYD.ORDER_PAYMENT_TRANSITION&&("Declined"===n.data.to||"Cancelled"===n.data.to)||n.type===c.iYD.ORDER_CANCELLATION?"error":n.type===c.iYD.ORDER_REFUND_TRANSITION?"warning":"default"}getTimelineIcon(n){if(n.type===c.iYD.ORDER_STATE_TRANSITION){if("Delivered"===n.data.to)return["success-standard","is-solid"];if("Cancelled"===n.data.to)return"ban"}return n.type===c.iYD.ORDER_PAYMENT_TRANSITION&&"Settled"===n.data.to?"credit-card":n.type===c.iYD.ORDER_NOTE?"note":n.type===c.iYD.ORDER_MODIFIED?"pencil":n.type!==c.iYD.ORDER_FULFILLMENT_TRANSITION||"Shipped"!==n.data.to&&"Delivered"!==n.data.to?void 0:"truck"}isFeatured(n){switch(n.type){case c.iYD.ORDER_STATE_TRANSITION:return"Delivered"===n.data.to||"Cancelled"===n.data.to||"Settled"===n.data.to;case c.iYD.ORDER_PAYMENT_TRANSITION:return"Settled"===n.data.to||"Cancelled"===n.data.to;case c.iYD.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===n.data.to||"Shipped"===n.data.to;case c.iYD.ORDER_NOTE:case c.iYD.ORDER_MODIFIED:return!0;default:return!1}}getFulfillment(n){if((n.type===c.iYD.ORDER_FULFILLMENT||n.type===c.iYD.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(t=>t.id===n.data.fulfillmentId)}getPayment(n){if(n.type===c.iYD.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(t=>t.id===n.data.paymentId)}getCancelledQuantity(n){return n.data.lines.reduce((t,o)=>t+o.quantity,0)}getCancelledItems(n){const t=new Map,o=n.data.lines;for(const i of this.order.lines){const a=o.find(s=>s.orderLineId===i.id);if(a){t.get(i.productVariant.name);t.set(i.productVariant.name,a.quantity)}}return Array.from(t.entries()).map(([i,a])=>({name:i,quantity:a}))}getModification(n){return this.order.modifications.find(t=>t.id===n)}getName(n){const{administrator:t}=n;if(t)return`${t.firstName} ${t.lastName}`;{const o=this.order.customer;if(o)return`${o.firstName} ${o.lastName}`}return""}addNoteToOrder(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}Ce.\u0275fac=function(n){return new(n||Ce)(e.Y36(c.GwB))},Ce.\u0275cmp=e.Xpm({type:Ce,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:20,vars:21,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"order","entry","expanded","expandClick",4,"ngIf","ngIfElse"],["defaultComponents",""],[3,"order","entry","expanded","expandClick"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"],[3,"value"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"vdr-timeline-entry",1)(2,"div",2)(3,"textarea",3),e.NdJ("ngModelChange",function(i){return t.note=i}),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){return t.addNoteToOrder()}),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"div",5)(8,"clr-checkbox-wrapper")(9,"input",6),e.NdJ("ngModelChange",function(i){return t.noteIsPrivate=i}),e.qZA(),e.TgZ(10,"label"),e._uU(11),e.ALo(12,"translate"),e.qZA()(),e.YNc(13,Bo,3,3,"span",7),e.YNc(14,Wo,3,3,"span",8),e.qZA()(),e.YNc(15,Fi,4,2,"ng-container",9),e.TgZ(16,"vdr-timeline-entry",10)(17,"div",11),e._uU(18),e.ALo(19,"translate"),e.qZA()()()),2&n&&(e.ekj("expanded",t.expanded),e.xp6(1),e.Q6J("featured",!0),e.xp6(2),e.Q6J("ngModel",t.note),e.xp6(1),e.Q6J("disabled",!t.note),e.xp6(1),e.hij(" ",e.lcZ(6,15,"common.add-note")," "),e.xp6(4),e.Q6J("ngModel",t.noteIsPrivate),e.xp6(2),e.Oqu(e.lcZ(12,17,"order.note-is-private")),e.xp6(2),e.Q6J("ngIf",t.noteIsPrivate),e.xp6(1),e.Q6J("ngIf",!t.noteIsPrivate),e.xp6(1),e.Q6J("ngForOf",t.history),e.xp6(1),e.Q6J("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),e.xp6(2),e.hij(" ",e.lcZ(19,19,"order.history-order-created")," "))},dependencies:[u.qvL,u.MgK,u.KKC,u.PEh,p.sg,p.O5,p.RF,p.n9,p.ED,l.Fj,l.Wl,l.JJ,l.On,C.rH,F.Y,x.y,J.J,D.N,N.U,Le.H,T.W,qe._,pt._,Ko.C,G,V,E,de,xe,m.X$,ut.j,h.k],styles:["[_nghost-%COMP%]{display:block}.entry-list[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 2)}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-700)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-700)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-700)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-700)}"],changeDetection:0});var qi=d(6884);const gt=Ae.Ps`
    query GetSellerOrders($orderId: ID!) {
        order(id: $orderId) {
            id
            sellerOrders {
                id
                code
                state
                orderPlacedAt
                currencyCode
                totalWithTax
                channels {
                    id
                    code
                    seller {
                        id
                        name
                    }
                }
            }
        }
    }
`;function Si(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",5),e.ALo(1,"translate"),e._uU(2),e.qZA()),2&r){const t=n.ngIf;e.Q6J("label",e.lcZ(1,2,"common.seller")),e.xp6(2),e.hij(" ",t.name," ")}}function Pi(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",5),e.ALo(1,"translate"),e._uU(2),e.ALo(3,"localeCurrency"),e.qZA()),2&r){const t=e.oxw().$implicit;e.Q6J("label",e.lcZ(1,2,"order.total")),e.xp6(2),e.hij(" ",e.xi3(3,4,t.totalWithTax,t.currencyCode)," ")}}const Ji=function(r){return["seller-orders",r]};function Di(r,n){if(1&r&&(e.TgZ(0,"div")(1,"a",3),e._uU(2),e._UZ(3,"clr-icon",4),e.qZA(),e.TgZ(4,"vdr-labeled-data",5),e.ALo(5,"translate"),e._UZ(6,"vdr-order-state-label",6),e.qZA(),e.YNc(7,Si,3,4,"vdr-labeled-data",7),e.YNc(8,Pi,4,7,"vdr-labeled-data",7),e.qZA()),2&r){const t=n.$implicit,o=e.oxw();e.xp6(1),e.Q6J("routerLink",e.VKq(8,Ji,t.id)),e.xp6(1),e.hij("",t.code," "),e.xp6(2),e.Q6J("label",e.lcZ(5,6,"order.state")),e.xp6(2),e.Q6J("state",t.state),e.xp6(1),e.Q6J("ngIf",o.getSeller(t)),e.xp6(1),e.Q6J("ngIf",o.getSeller(t))}}class ve{constructor(n,t,o){this.router=n,this.dataService=t,this.channelService=o}ngOnInit(){this.sellerOrders$=this.dataService.query(gt,{orderId:this.orderId}).mapSingle(({order:n})=>n?.sellerOrders??[])}getSeller(n){return n.channels.find(o=>o.code!==qi.z$)?.seller}navigateToSellerOrder(n){this.router.navigate(["/orders",n.id])}}function Ni(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().ngIf,a=e.oxw();return e.KtG(a.addManualPayment(i))}),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"localeCurrency"),e.qZA()}if(2&r){const t=e.oxw().ngIf,o=e.oxw();e.xp6(1),e.AsE(" ",e.lcZ(2,2,"order.add-payment-to-order")," (",e.xi3(3,4,o.outstandingPaymentAmount(t),t.currencyCode),") ")}}function Qi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.transitionToState("ArrangingAdditionalPayment"))}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.arrange-additional-payment")," "))}function Ui(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.fulfillOrder())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&r){const t=e.oxw().ngIf,o=e.oxw();e.Q6J("disabled",!o.canAddFulfillment(t)),e.xp6(1),e.hij(" ",e.lcZ(2,2,"order.fulfill-order")," ")}}function ki(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.transitionToModifying())}),e._UZ(2,"clr-icon",13),e._uU(3),e.ALo(4,"translate"),e.qZA(),e._UZ(5,"div",8),e.BQk()}2&r&&(e.xp6(3),e.hij(" ",e.lcZ(4,1,"order.modify-order")," "))}function Ei(r,n){1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"translate"),e.BQk()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.refund-and-cancel-order")," "))}function Yi(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.hij(" ",e.lcZ(1,1,"order.cancel-order")," ")}function ji(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().ngIf,a=e.oxw();return e.KtG(a.cancelOrRefund(i))}),e._UZ(1,"clr-icon",14),e.YNc(2,Ei,3,3,"ng-container",15),e.YNc(3,Yi,2,3,"ng-template",null,16,e.W1O),e.qZA()}if(2&r){const t=e.MAs(4),o=e.oxw().ngIf,i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.orderHasSettledPayments(o))("ngIfElse",t)}}ve.\u0275fac=function(n){return new(n||ve)(e.Y36(C.F0),e.Y36(c.DoR),e.Y36(c.Tjy))},ve.\u0275cmp=e.Xpm({type:ve,selectors:[["vdr-seller-orders-card"]],inputs:{orderId:"orderId"},decls:5,vars:6,consts:[[3,"title"],[1,"form-grid"],[4,"ngFor","ngForOf"],[1,"button-ghost","mb-1",3,"routerLink"],["shape","arrow right"],[3,"label"],[3,"state"],[3,"label",4,"ngIf"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-card",0),e.ALo(1,"translate"),e.TgZ(2,"div",1),e.YNc(3,Di,9,10,"div",2),e.ALo(4,"async"),e.qZA()()),2&n&&(e.Q6J("title",e.lcZ(1,2,"order.seller-orders")),e.xp6(3),e.Q6J("ngForOf",e.lcZ(4,4,t.sellerOrders$)))},dependencies:[u.qvL,p.sg,p.O5,C.rH,we.G,T.W,Pe.A,p.Ov,m.X$,h.k],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0});const Ri=function(r){return{state:r}};function $i(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){const a=e.CHM(t).$implicit,s=e.oxw(3);return e.KtG(s.transitionToState(a))}),e._UZ(1,"clr-icon",18),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"translate"),e.ALo(5,"stateI18nToken"),e.qZA()}if(2&r){const t=n.$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,"order.transition-to-state",e.VKq(8,Ri,e.lcZ(4,4,e.lcZ(5,6,t))))," ")}}function Hi(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"div",8),e.YNc(2,$i,6,10,"button",17),e.ALo(3,"async"),e.BQk()),2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.nextStates$))}}function Gi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-action-bar"),e._UZ(1,"vdr-ab-left"),e.TgZ(2,"vdr-ab-right"),e._UZ(3,"vdr-action-bar-items",1),e.YNc(4,Ni,4,7,"button",2),e.YNc(5,Qi,3,3,"button",2),e.YNc(6,Ui,3,4,"button",3),e.TgZ(7,"vdr-dropdown")(8,"button",4),e._UZ(9,"clr-icon",5),e.qZA(),e.TgZ(10,"vdr-dropdown-menu",6),e.YNc(11,ki,6,3,"ng-container",0),e.YNc(12,ji,5,2,"button",7),e.YNc(13,Hi,4,3,"ng-container",0),e.ALo(14,"async"),e._UZ(15,"div",8),e.TgZ(16,"button",9),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.manuallyTransitionToState(a))}),e._UZ(17,"clr-icon",10),e._uU(18),e.ALo(19,"translate"),e.qZA()()()()()}if(2&r){const t=n.ngIf,o=e.oxw();let i;e.xp6(4),e.Q6J("ngIf","Aggregate"!==t.type&&("ArrangingPayment"===t.state||"ArrangingAdditionalPayment"===t.state)&&(o.hasUnsettledModifications(t)||0<o.outstandingPaymentAmount(t))),e.xp6(1),e.Q6J("ngIf","Aggregate"!==t.type&&!1===t.active&&"ArrangingAdditionalPayment"!==t.state&&"ArrangingPayment"!==t.state&&0<o.outstandingPaymentAmount(t)),e.xp6(1),e.Q6J("ngIf","Aggregate"!==t.type),e.xp6(5),e.Q6J("ngIf","Aggregate"!==t.type&&t.nextStates.includes("Modifying")),e.xp6(1),e.Q6J("ngIf","Aggregate"!==t.type&&t.nextStates.includes("Cancelled")),e.xp6(1),e.Q6J("ngIf",null==(i=e.lcZ(14,7,o.nextStates$))?null:i.length),e.xp6(5),e.hij(" ",e.lcZ(19,9,"order.manually-transition-to-state")," ")}}function Ki(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",36),e.ALo(1,"translate"),e._UZ(2,"vdr-formatted-address",37),e.qZA()),2&r){const t=e.oxw().ngIf;e.Q6J("label",e.lcZ(1,2,"order.shipping-address")),e.xp6(2),e.Q6J("address",t.shippingAddress)}}function Vi(r,n){if(1&r&&(e.TgZ(0,"vdr-labeled-data",38),e.ALo(1,"translate"),e._UZ(2,"vdr-formatted-address",37),e.qZA()),2&r){const t=e.oxw().ngIf;e.Q6J("label",e.lcZ(1,2,"order.billing-address")),e.xp6(2),e.Q6J("address",t.billingAddress)}}function Bi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-order-payment-card",40),e.NdJ("settlePayment",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.settlePayment(i))})("transitionPaymentState",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.transitionPaymentState(i))})("settleRefund",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.settleRefund(i))}),e.qZA()}if(2&r){const t=n.$implicit,o=e.oxw(2).ngIf;e.Q6J("currencyCode",o.currencyCode)("payment",t)}}function Wi(r,n){if(1&r&&(e.TgZ(0,"vdr-card",22),e.ALo(1,"translate"),e.YNc(2,Bi,1,2,"vdr-order-payment-card",39),e.qZA()),2&r){const t=e.oxw().ngIf;e.Q6J("title",e.lcZ(1,2,"order.payments")),e.xp6(2),e.Q6J("ngForOf",t.payments)}}function Xi(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-fulfillment-card",42),e.NdJ("transitionState",function(i){const s=e.CHM(t).$implicit,f=e.oxw(3);return e.KtG(f.transitionFulfillment(s.id,i))}),e.qZA()}if(2&r){const t=n.$implicit,o=e.oxw(2).ngIf;e.Q6J("fulfillment",t)("order",o)}}function zi(r,n){if(1&r&&(e.TgZ(0,"vdr-card"),e.YNc(1,Xi,1,2,"vdr-fulfillment-card",41),e.qZA()),2&r){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.fulfillments)}}function ea(r,n){if(1&r&&e._UZ(0,"vdr-page-entity-info",43),2&r){const t=n.ngIf;e.Q6J("entity",t)}}function ta(r,n){if(1&r&&e._UZ(0,"vdr-seller-orders-card",44),2&r){const t=e.oxw().ngIf;e.Q6J("orderId",t.id)}}function na(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"percent"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"localeCurrency"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"localeCurrency"),e.qZA()()),2&r){const t=n.$implicit,o=e.oxw().ngIf;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(e.lcZ(5,4,t.taxRate/100)),e.xp6(3),e.Oqu(e.xi3(8,6,t.taxBase,o.currencyCode)),e.xp6(3),e.Oqu(e.xi3(11,9,t.taxTotal,o.currencyCode))}}function ra(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-card",22),e.ALo(1,"translate"),e._UZ(2,"vdr-tabbed-custom-fields",45),e.ALo(3,"hasPermission"),e.TgZ(4,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.updateCustomFields())}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&r){const t=e.oxw(2);let o;e.Q6J("title",e.lcZ(1,6,"common.custom-fields")),e.xp6(2),e.Q6J("customFields",t.customFields)("customFieldsFormGroup",t.detailForm.get("customFields"))("readonly",!e.lcZ(3,8,"UpdateOrder")),e.xp6(2),e.Q6J("disabled",(null==(o=t.detailForm.get("customFields"))?null:o.pristine)||(null==(o=t.detailForm.get("customFields"))?null:o.invalid)),e.xp6(1),e.hij(" ",e.lcZ(6,10,"common.update")," ")}}function oa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card")(3,"vdr-order-state-label",19)(4,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openStateDiagram())}),e.ALo(5,"translate"),e._UZ(6,"clr-icon",21),e.qZA()()(),e.TgZ(7,"vdr-card",22),e.ALo(8,"translate"),e._UZ(9,"vdr-customer-label",23),e.YNc(10,Ki,3,4,"vdr-labeled-data",24),e.YNc(11,Vi,3,4,"vdr-labeled-data",25),e.qZA(),e.YNc(12,Wi,3,4,"vdr-card",26),e.YNc(13,zi,2,1,"vdr-card",0),e.TgZ(14,"vdr-card"),e.YNc(15,ea,1,1,"vdr-page-entity-info",27),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"vdr-page-block"),e.YNc(18,ta,1,1,"vdr-seller-orders-card",28),e.TgZ(19,"vdr-card",29),e._UZ(20,"vdr-order-table",30),e.qZA(),e.TgZ(21,"vdr-card",31),e.ALo(22,"translate"),e.TgZ(23,"table",32)(24,"thead")(25,"tr")(26,"th"),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"th"),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"th"),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"th"),e._uU(36),e.ALo(37,"translate"),e.qZA()()(),e.TgZ(38,"tbody"),e.YNc(39,na,12,12,"tr",33),e.qZA()()(),e.YNc(40,ra,7,12,"vdr-card",26),e._UZ(41,"vdr-custom-detail-component-host",34),e.TgZ(42,"vdr-card",22),e.ALo(43,"translate"),e.TgZ(44,"vdr-order-history",35),e.NdJ("addNote",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.addNote(i))})("updateNote",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.updateNote(i))})("deleteNote",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.deleteNote(i))}),e.ALo(45,"async"),e.qZA()()()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(3),e.Q6J("state",t.state),e.xp6(1),e.Q6J("title",e.lcZ(5,26,"order.order-state-diagram")),e.xp6(3),e.Q6J("title",e.lcZ(8,28,"order.customer")),e.xp6(2),e.Q6J("customer",t.customer),e.xp6(1),e.Q6J("ngIf",o.getOrderAddressLines(t.shippingAddress).length),e.xp6(1),e.Q6J("ngIf",o.getOrderAddressLines(t.billingAddress).length),e.xp6(1),e.Q6J("ngIf",null==t.payments?null:t.payments.length),e.xp6(1),e.Q6J("ngIf",null==t.fulfillments?null:t.fulfillments.length),e.xp6(2),e.Q6J("ngIf",e.lcZ(16,30,o.entity$)),e.xp6(3),e.Q6J("ngIf",t.sellerOrders.length),e.xp6(1),e.Q6J("paddingX",!1),e.xp6(1),e.Q6J("order",t)("orderLineCustomFields",o.orderLineCustomFields),e.xp6(1),e.Q6J("title",e.lcZ(22,32,"order.tax-summary"))("paddingX",!1),e.xp6(6),e.Oqu(e.lcZ(28,34,"common.description")),e.xp6(3),e.Oqu(e.lcZ(31,36,"order.tax-rate")),e.xp6(3),e.Oqu(e.lcZ(34,38,"order.tax-base")),e.xp6(3),e.Oqu(e.lcZ(37,40,"order.tax-total")),e.xp6(3),e.Q6J("ngForOf",t.taxSummary),e.xp6(1),e.Q6J("ngIf",o.customFields.length),e.xp6(1),e.Q6J("entity$",o.entity$)("detailForm",o.detailForm),e.xp6(1),e.Q6J("title",e.lcZ(43,42,"order.order-history")),e.xp6(2),e.Q6J("order",t)("history",e.lcZ(45,44,o.history$))}}const ia=Ae.Ps`
    query OrderDetailQuery($id: ID!) {
        order(id: $id) {
            ...OrderDetail
        }
    }
    ${c.gfD}
`;class ye extends c.VE7{constructor(n,t,o,i,a,s){super(),this.changeDetector=n,this.dataService=t,this.notificationService=o,this.modalService=i,this.orderTransitionService=a,this.formBuilder=s,this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.detailForm=new l.cw({customFields:this.formBuilder.group(this.customFields.reduce((f,Ne)=>({...f,[Ne.name]:""}),{}))}),this.fetchHistory=new ee.x,this.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"]}ngOnInit(){this.init(),this.entity$.pipe((0,q.q)(1)).subscribe(n=>{"Modifying"===n.state&&this.router.navigate(["./","modify"],{relativeTo:this.route})}),this.history$=this.fetchHistory.pipe((0,Ke.O)(null),(0,g.w)(()=>this.dataService.order.getOrderHistory(this.id,{sort:{createdAt:c.Asd.DESC}}).mapStream(n=>n.order?.history.items))),this.nextStates$=this.entity$.pipe((0,b.U)(n=>this.defaultStates.includes(n.state)?n.nextStates.filter(o=>!this.defaultStates.includes(o)):n.nextStates))}ngOnDestroy(){this.destroy()}openStateDiagram(){this.entity$.pipe((0,q.q)(1),(0,g.w)(n=>this.modalService.fromComponent(ue,{closable:!0,locals:{activeState:n.state}}))).subscribe()}transitionToState(n){this.dataService.order.transitionToState(this.id,n).subscribe(({transitionOrderToState:t})=>{switch(t?.__typename){case"Order":this.notificationService.success((0,_.J)("order.transitioned-to-state-success"),{state:n}),this.fetchHistory.next();break;case"OrderStateTransitionError":this.notificationService.error(t.transitionError)}})}manuallyTransitionToState(n){this.orderTransitionService.manuallyTransitionToState({orderId:n.id,nextStates:n.nextStates,cancellable:!0,message:(0,_.J)("order.manually-transition-to-state-message"),retry:0}).subscribe()}transitionToModifying(){this.dataService.order.transitionToState(this.id,"Modifying").subscribe(({transitionOrderToState:n})=>{switch(n?.__typename){case"Order":this.router.navigate(["./modify"],{relativeTo:this.route});break;case"OrderStateTransitionError":this.notificationService.error(n.transitionError)}})}updateCustomFields(){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success((0,_.J)("common.notify-update-success"),{entity:"Order"})})}getOrderAddressLines(n){return n?Object.values(n).filter(t=>"OrderAddress"!==t).filter(t=>!!t):[]}settlePayment(n){this.dataService.order.settlePayment(n.id).subscribe(({settlePayment:t})=>{switch(t.__typename){case"Payment":"Settled"===t.state?this.notificationService.success((0,_.J)("order.settle-payment-success")):this.notificationService.error((0,_.J)("order.settle-payment-error")),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":this.notificationService.error(t.message)}})}transitionPaymentState({payment:n,state:t}){"Cancelled"===t?this.dataService.order.cancelPayment(n.id).subscribe(({cancelPayment:o})=>{switch(o.__typename){case"Payment":this.notificationService.success((0,_.J)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(o.transitionError);break;case"CancelPaymentError":this.notificationService.error(o.paymentErrorMessage)}}):this.dataService.order.transitionPaymentToState(n.id,t).subscribe(({transitionPaymentToState:o})=>{switch(o.__typename){case"Payment":this.notificationService.success((0,_.J)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(o.message)}})}canAddFulfillment(n){const t=(n.fulfillments??[]).reduce((i,a)=>[...i,...a.lines],[]);let o=!0;for(const i of n.lines)t.filter(s=>s.orderLineId===i.id).reduce((s,f)=>s+f.quantity,0)<i.quantity&&(o=!1);return!o&&!this.hasUnsettledModifications(n)&&0===this.outstandingPaymentAmount(n)&&(n.nextStates.includes("Shipped")||n.nextStates.includes("PartiallyShipped")||n.nextStates.includes("Delivered"))}hasUnsettledModifications(n){return 0<n.modifications.filter(t=>!t.isSettled).length}getOutstandingModificationAmount(n){return(0,I.summate)(n.modifications.filter(t=>!t.isSettled),"priceChange")}outstandingPaymentAmount(n){const t=i=>"Cancelled"!==i.state&&"Declined"!==i.state&&"Error"!==i.state;let o=0;for(const i of n.payments?.filter(t)??[]){const a=i.refunds.filter(f=>"Failed"!==f.state)??[],s=(0,I.summate)(a,"total");o+=i.amount-s}return n.totalWithTax-o}addManualPayment(n){const t=n.state;this.modalService.fromComponent(W,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(n),currencyCode:n.currencyCode}}).pipe((0,g.w)(o=>o?this.dataService.order.addManualPaymentToOrder({orderId:this.id,transactionId:o.transactionId,method:o.method,metadata:o.metadata||{}}):S.E),(0,g.w)(({addManualPaymentToOrder:o})=>{switch(o.__typename){case"Order":return this.notificationService.success((0,_.J)("order.add-payment-to-order-success")),"ArrangingAdditionalPayment"===t?this.orderTransitionService.transitionToPreModifyingState(n.id,n.nextStates):(0,v.of)("PaymentSettled");case"ManualPaymentStateError":return this.notificationService.error(o.message),S.E;default:return S.E}})).subscribe(o=>{o&&this.refetchOrder({result:o})})}fulfillOrder(){this.entity$.pipe((0,q.q)(1),(0,g.w)(n=>this.modalService.fromComponent(ae,{size:"xl",locals:{order:n}})),(0,g.w)(n=>n?this.dataService.order.createFulfillment(n):(0,v.of)(void 0)),(0,g.w)(n=>this.refetchOrder(n).pipe((0,ct.h)(n)))).subscribe(n=>{if(n){const{addFulfillmentToOrder:t}=n;switch(t.__typename){case"Fulfillment":this.notificationService.success((0,_.J)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":this.notificationService.error(t.message);break;case"FulfillmentStateTransitionError":this.notificationService.error(t.transitionError);break;case"CreateFulfillmentError":this.notificationService.error(t.fulfillmentHandlerError);break;case void 0:this.notificationService.error(JSON.stringify(t));break;default:(0,I.assertNever)(t)}}})}transitionFulfillment(n,t){this.dataService.order.transitionFulfillmentToState(n,t).pipe((0,g.w)(o=>this.refetchOrder(o))).subscribe(()=>{this.notificationService.success((0,_.J)("order.successfully-updated-fulfillment"))})}cancelOrRefund(n){const t=this.orderHasSettledPayments(n);"PaymentAuthorized"!==n.state&&!0!==n.active&&t?this.refundOrder(n):this.cancelOrder(n)}settleRefund(n){this.modalService.fromComponent(me,{size:"md",locals:{refund:n}}).pipe((0,g.w)(t=>t?this.dataService.order.settleRefund({transactionId:t,id:n.id},this.id):(0,v.of)(void 0))).subscribe(t=>{t&&this.notificationService.success((0,_.J)("order.settle-refund-success"))})}addNote(n){const{note:t,isPublic:o}=n;this.dataService.order.addNoteToOrder({id:this.id,note:t,isPublic:o}).pipe((0,g.w)(i=>this.refetchOrder(i))).subscribe(i=>{this.notificationService.success((0,_.J)("common.notify-create-success"),{entity:"Note"})})}updateNote(n){this.modalService.fromComponent(c.UlA,{closable:!0,locals:{displayPrivacyControls:!0,note:n.data.note,noteIsPrivate:!n.isPublic}}).pipe((0,g.w)(t=>t?this.dataService.order.updateOrderNote({noteId:n.id,isPublic:!t.isPrivate,note:t.note}):S.E)).subscribe(t=>{this.fetchHistory.next(),this.notificationService.success((0,_.J)("common.notify-update-success"),{entity:"Note"})})}deleteNote(n){return this.modalService.dialog({title:(0,_.J)("common.confirm-delete-note"),body:n.data.note,buttons:[{type:"secondary",label:(0,_.J)("common.cancel")},{type:"danger",label:(0,_.J)("common.delete"),returnValue:!0}]}).pipe((0,g.w)(t=>t?this.dataService.order.deleteOrderNote(n.id):S.E)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success((0,_.J)("common.notify-delete-success"),{entity:"Note"})})}orderHasSettledPayments(n){return!!n.payments?.find(t=>"Settled"===t.state)}cancelOrder(n){this.modalService.fromComponent(z,{size:"xl",locals:{order:n}}).pipe((0,g.w)(t=>t?this.dataService.order.cancelOrder(t):(0,v.of)(void 0)),(0,g.w)(t=>this.refetchOrder(t))).subscribe(t=>{t&&this.notificationService.success((0,_.J)("order.cancelled-order-success"))})}refundOrder(n){this.modalService.fromComponent(_e,{size:"xl",locals:{order:n}}).pipe((0,g.w)(t=>t?t.cancel.lines?.length?this.dataService.order.cancelOrder(t.cancel).pipe((0,b.U)(o=>{const i=o.cancelOrder;switch(i.__typename){case"Order":return this.refetchOrder(i).subscribe(),this.notificationService.success((0,_.J)("order.cancelled-order-success")),t;case"CancelActiveOrderError":case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"EmptyOrderLineSelectionError":return void this.notificationService.error(i.message)}})):[t]:(0,v.of)(void 0)),(0,g.w)(t=>t?t.refund.lines.length?this.dataService.order.refundOrder(t.refund).pipe((0,b.U)(o=>o.refundOrder)):[void 0]:(0,v.of)(void 0))).subscribe(t=>{if(t)switch(t.__typename){case"Refund":this.refetchOrder(t).subscribe(),"Failed"===t.state?this.notificationService.error((0,_.J)("order.refund-order-failed")):this.notificationService.success((0,_.J)("order.refund-order-success"));break;case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":this.notificationService.error(t.message)}})}refetchOrder(n){return this.fetchHistory.next(),n?this.dataService.order.getOrder(this.id).single$:(0,v.of)(void 0)}setFormValues(n){this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),n)}}ye.\u0275fac=function(n){return new(n||ye)(e.Y36(e.sBO),e.Y36(c.DoR),e.Y36(c.gqp),e.Y36(c.Z7U),e.Y36(A),e.Y36(l.qu))},ye.\u0275cmp=e.Xpm({type:ye,selectors:[["vdr-order-detail"]],features:[e.qOj],decls:5,vars:6,consts:[[4,"ngIf"],["locationId","order-detail"],["class","button primary mr-1",3,"click",4,"ngIf"],["class","button primary mr-1",3,"disabled","click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"button","primary","mr-1",3,"click"],[1,"button","primary","mr-1",3,"disabled","click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],[3,"title"],[3,"customer"],["class","mt-2",3,"label",4,"ngIf"],[3,"label",4,"ngIf"],[3,"title",4,"ngIf"],[3,"entity",4,"ngIf"],["class","mb-2",3,"orderId",4,"ngIf"],[3,"paddingX"],[3,"order","orderLineCustomFields"],[3,"title","paddingX"],[1,"table"],[4,"ngFor","ngForOf"],["locationId","order-detail",3,"entity$","detailForm"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"mt-2",3,"label"],[1,"mt-1",3,"address"],[3,"label"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState",4,"ngFor","ngForOf"],[3,"fulfillment","order","transitionState"],[3,"entity"],[1,"mb-2",3,"orderId"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly"],[1,"button","primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block"),e.YNc(1,Gi,20,11,"vdr-action-bar",0),e.ALo(2,"async"),e.qZA(),e.YNc(3,oa,46,46,"vdr-page-detail-layout",0),e.ALo(4,"async")),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.entity$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.entity$)))},dependencies:[u.qvL,p.sg,p.O5,O.Kk,O.BN,O.mz,Ue.d,J.J,D.N,N.U,Le.H,we.G,Fe.b,T.W,st.W,ke.y,Fo.C,Se.z,et.D,tt.T,nt.W,Pe.A,he,Ce,ce,k,ve,p.Ov,p.Zx,m.X$,ut.j,P.N,h.k],styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0});var L,r,aa=d(2670),De=d(4467),ft=d(5822);function la(r,n){1&r&&(e._uU(0),e.ALo(1,"translate")),2&r&&e.Oqu(e.lcZ(1,1,"order.confirm-modifications"))}function ca(r,n){if(1&r&&(e.TgZ(0,"option",9),e._uU(1),e.ALo(2,"localeCurrency"),e.qZA()),2&r){const t=n.$implicit,o=e.oxw(2);e.Q6J("ngValue",t),e.xp6(1),e.lnq(" #",t.id," ",t.method,": ",e.xi3(2,4,t.amount,o.order.currencyCode)," ")}}function da(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"clr-select-container")(2,"label"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"select",5),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.selectedPayment=i)}),e.YNc(6,ca,3,7,"option",6),e.qZA()(),e.TgZ(7,"label",7),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"textarea",8),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.refundNote=i)}),e.qZA()()}if(2&r){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,5,"order.payment-to-refund")),e.xp6(2),e.Q6J("ngModel",t.selectedPayment),e.xp6(1),e.Q6J("ngForOf",t.order.payments),e.xp6(2),e.Oqu(e.lcZ(9,7,"order.refund-cancellation-reason")),e.xp6(2),e.Q6J("ngModel",t.refundNote)}}function sa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.cancel())}),e._uU(1),e.ALo(2,"translate"),e.qZA(),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e._uU(4),e.ALo(5,"translate"),e.qZA()}if(2&r){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,3,"common.cancel")),e.xp6(2),e.Q6J("disabled",t.priceDifference<0&&!t.selectedPayment),e.xp6(1),e.hij(" ",e.lcZ(5,5,"common.confirm")," ")}}(r=L||(L={}))[r.Refund=0]="Refund",r[r.Payment=1]="Payment",r[r.PriceUnchanged=2]="PriceUnchanged",r[r.Cancel=3]="Cancel";class Oe{get priceDifference(){return this.order.totalWithTax-this.originalTotalWithTax}ngOnInit(){this.refundNote=this.modifyOrderInput.note||""}cancel(){this.resolveWith({result:L.Cancel})}submit(){0<this.priceDifference?this.resolveWith({result:L.Payment}):this.priceDifference<0?this.resolveWith({result:L.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:L.PriceUnchanged})}}Oe.\u0275fac=function(n){return new(n||Oe)},Oe.\u0275cmp=e.Xpm({type:Oe,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,t){1&n&&(e.YNc(0,la,2,3,"ng-template",0),e._UZ(1,"vdr-order-table",1),e.TgZ(2,"h4",2),e._uU(3),e.ALo(4,"translate"),e.TgZ(5,"strong"),e._uU(6),e.ALo(7,"localeCurrency"),e.qZA()(),e.YNc(8,da,11,9,"div",3),e.YNc(9,sa,6,7,"ng-template",4)),2&n&&(e.xp6(1),e.Q6J("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),e.xp6(2),e.hij(" ",e.lcZ(4,5,"order.modify-order-price-difference"),": "),e.xp6(3),e.Oqu(e.xi3(7,7,t.priceDifference,t.order.currencyCode)),e.xp6(2),e.Q6J("ngIf",t.priceDifference<0))},dependencies:[u.MgK,u.otW,u.dTv,u.XE5,p.sg,p.O5,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.Q7,l.On,x.y,Z.n,y.q,k,m.X$,h.k],changeDetection:0});var pa=d(4712);function ua(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"vdr-action-bar")(1,"vdr-ab-left")(2,"div",1),e._UZ(3,"vdr-order-state-label",2),e.qZA()(),e.TgZ(4,"vdr-ab-right")(5,"button",3),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.transitionToPriorState(a))}),e._uU(6),e.ALo(7,"translate"),e.qZA()()()}if(2&r){const t=n.ngIf;e.xp6(3),e.Q6J("state",t.state),e.xp6(3),e.hij(" ",e.lcZ(7,2,"order.cancel-modification")," ")}}function _a(r,n){1&r&&(e.TgZ(0,"th"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"common.custom-fields")," "))}function ma(r,n){if(1&r&&(e._UZ(0,"img",40),e.ALo(1,"assetPreview")),2&r){const t=e.oxw().$implicit;e.Q6J("src",e.xi3(1,1,t.featuredAsset,"tiny"),e.LSH)}}const ht=function(r){return[r]};function ga(r,n){if(1&r&&(e.TgZ(0,"td",41),e._UZ(1,"vdr-tabbed-custom-fields",42),e.qZA()),2&r){const t=e.oxw().index,o=e.oxw(2);e.xp6(1),e.Q6J("customFields",o.orderLineCustomFields)("customFieldsFormGroup",o.orderLineCustomFieldsFormArray.get(e.VKq(3,ht,t)))("compact",!0)}}function fa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",28)(1,"td",29),e.YNc(2,ma,2,4,"img",30),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e.TgZ(7,"td",33),e._uU(8),e.ALo(9,"localeCurrency"),e.TgZ(10,"div",15),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA()(),e.TgZ(14,"td",34)(15,"input",35),e.NdJ("input",function(i){const s=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.updateLineQuantity(s,i.target.value))}),e.qZA(),e._UZ(16,"vdr-line-refunds",36)(17,"vdr-line-fulfillment",37),e.qZA(),e.YNc(18,ga,2,5,"td",38),e.TgZ(19,"td",39),e._uU(20),e.ALo(21,"localeCurrency"),e.TgZ(22,"div",15),e.ALo(23,"translate"),e._uU(24),e.ALo(25,"localeCurrency"),e.qZA()()()}if(2&r){const t=n.$implicit,o=e.oxw().ngIf,i=e.oxw();e.ekj("is-cancelled",0===t.quantity)("modified",i.isLineModified(t)),e.xp6(2),e.Q6J("ngIf",t.featuredAsset),e.xp6(2),e.Oqu(t.productVariant.name),e.xp6(2),e.Oqu(t.productVariant.sku),e.xp6(2),e.hij(" ",e.xi3(9,20,t.unitPriceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(11,23,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(13,25,t.unitPrice,o.currencyCode)," "),e.xp6(3),e.Q6J("value",t.quantity),e.xp6(1),e.Q6J("line",t)("payments",o.payments),e.xp6(1),e.Q6J("line",t)("allOrderFulfillments",o.fulfillments)("orderState",o.state),e.xp6(1),e.Q6J("ngIf",i.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(21,28,t.linePriceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(23,31,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(25,33,t.linePrice,o.currencyCode)," ")}}function ha(r,n){if(1&r&&(e._UZ(0,"img",40),e.ALo(1,"assetPreview")),2&r){const t=e.oxw().$implicit;e.Q6J("src",e.xi3(1,1,t.productAsset,"tiny"),e.LSH)}}function xa(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"vdr-custom-field-control",47),e.BQk()),2&r){const t=n.$implicit,o=e.oxw(2).index,i=e.oxw(2);e.xp6(1),e.Q6J("customField",t)("customFieldsFormGroup",i.addItemCustomFieldsFormArray.get(e.VKq(3,ht,o)))("compact",!0)}}function Ca(r,n){if(1&r&&(e.TgZ(0,"td",41),e.YNc(1,xa,2,5,"ng-container",46),e.qZA()),2&r){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.orderLineCustomFields)}}function va(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",43)(1,"td",29),e.YNc(2,ha,2,4,"img",30),e.qZA(),e.TgZ(3,"td",31),e._uU(4),e.qZA(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e.TgZ(7,"td",33),e._uU(8),e.ALo(9,"localeCurrency"),e.TgZ(10,"div",15),e.ALo(11,"translate"),e._uU(12),e.ALo(13,"localeCurrency"),e.qZA()(),e.TgZ(14,"td",34)(15,"input",35),e.NdJ("input",function(i){const s=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.updateAddedItemQuantity(s,i.target.value))}),e.qZA(),e.TgZ(16,"button",44),e.NdJ("click",function(){const a=e.CHM(t).index,s=e.oxw(2);return e.KtG(s.removeAddedItem(a))}),e._UZ(17,"clr-icon",45),e.qZA()(),e.YNc(18,Ca,2,1,"td",38),e.TgZ(19,"td",39),e._uU(20),e.ALo(21,"currency"),e.TgZ(22,"div",15),e.ALo(23,"translate"),e._uU(24),e.ALo(25,"currency"),e.qZA()()()}if(2&r){const t=n.$implicit,o=e.oxw().ngIf,i=e.oxw();e.xp6(2),e.Q6J("ngIf",t.productAsset),e.xp6(2),e.Oqu(t.productVariantName),e.xp6(2),e.Oqu(t.sku),e.xp6(2),e.hij(" ",e.xi3(9,11,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(11,14,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(13,16,t.price,o.currencyCode)," "),e.xp6(3),e.Q6J("value",t.quantity),e.xp6(3),e.Q6J("ngIf",i.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(21,19,t.priceWithTax*t.quantity/100,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(23,22,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(25,24,t.price*t.quantity/100,o.currencyCode)," ")}}function ya(r,n){1&r&&e._UZ(0,"td")}function Oa(r,n){if(1&r&&(e.TgZ(0,"tr",48)(1,"td",49),e._uU(2),e.qZA(),e.TgZ(3,"td",32),e._uU(4),e.qZA(),e._UZ(5,"td",50)(6,"td"),e.YNc(7,ya,1,0,"td",0),e.TgZ(8,"td",39),e._uU(9),e.ALo(10,"localeCurrency"),e.TgZ(11,"div",15),e.ALo(12,"translate"),e._uU(13),e.ALo(14,"localeCurrency"),e.qZA()()()),2&r){const t=n.$implicit,o=e.oxw().ngIf,i=e.oxw();e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Oqu(t.sku),e.xp6(3),e.Q6J("ngIf",i.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(10,6,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(12,9,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(14,11,t.price,o.currencyCode)," ")}}function Za(r,n){1&r&&e._UZ(0,"td")}function ba(r,n){if(1&r&&(e.ynx(0),e._uU(1),e.ALo(2,"localeCurrency"),e.TgZ(3,"div",15),e.ALo(4,"translate"),e._uU(5),e.ALo(6,"localeCurrency"),e.qZA(),e.BQk()),2&r){const t=n.ngIf,o=e.oxw(2).ngIf;e.xp6(1),e.hij(" ",e.xi3(2,3,t.priceWithTax,o.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(4,6,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(6,8,t.price,o.currencyCode)," ")}}function Ta(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr",51)(1,"td",49),e._uU(2),e.TgZ(3,"button",44),e.NdJ("click",function(){const a=e.CHM(t).index,s=e.oxw(2);return e.KtG(s.removeSurcharge(a))}),e._UZ(4,"clr-icon",45),e.qZA()(),e.TgZ(5,"td",32),e._uU(6),e.qZA(),e._UZ(7,"td",50)(8,"td"),e.YNc(9,Za,1,0,"td",0),e.TgZ(10,"td",39),e.YNc(11,ba,7,11,"ng-container",0),e.qZA()()}if(2&r){const t=n.$implicit,o=e.oxw(2);e.xp6(2),e.hij(" ",t.description," "),e.xp6(4),e.Oqu(t.sku),e.xp6(3),e.Q6J("ngIf",o.orderLineCustomFields.length),e.xp6(2),e.Q6J("ngIf",o.getSurchargePrices(t))}}function Aa(r,n){1&r&&e._UZ(0,"td")}function Ia(r,n){if(1&r&&(e._UZ(0,"img",58),e.ALo(1,"assetPreview")),2&r){const t=n.ngIf;e.Q6J("src",e.xi3(1,1,t,"tiny"),e.LSH)}}function La(r,n){if(1&r&&(e.TgZ(0,"div",55),e.YNc(1,Ia,2,4,"img",56),e.TgZ(2,"div")(3,"strong",57),e._uU(4),e.qZA(),e.TgZ(5,"small"),e._uU(6),e.qZA(),e.TgZ(7,"div"),e._uU(8),e.ALo(9,"localeCurrency"),e.qZA()()()),2&r){const t=e.oxw(2).ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.addItemSelectedVariant.productAsset),e.xp6(3),e.Oqu(o.addItemSelectedVariant.productVariantName),e.xp6(2),e.Oqu(o.addItemSelectedVariant.sku),e.xp6(2),e.hij(" ",e.xi3(9,4,o.getSelectedItemPrice(o.addItemSelectedVariant),t.currencyCode)," ")}}function wa(r,n){if(1&r&&(e.ynx(0),e._UZ(1,"vdr-custom-field-control",59),e.BQk()),2&r){const t=n.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("readonly",!o.addItemSelectedVariant)("customField",t)("customFieldsFormGroup",o.addItemCustomFieldsForm)("compact",!0)}}function Ma(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-accordion-content")(1,"vdr-product-variant-selector",52),e.NdJ("productSelected",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.addItemSelectedVariant=i)}),e.qZA(),e.YNc(2,La,10,7,"div",53),e.YNc(3,wa,2,4,"ng-container",46),e.TgZ(4,"button",54),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.addItemToOrder(i.addItemSelectedVariant))}),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&r){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.addItemSelectedVariant),e.xp6(1),e.Q6J("ngForOf",t.orderLineCustomFields),e.xp6(1),e.Q6J("disabled",!t.addItemSelectedVariant||t.addItemCustomFieldsForm.invalid),e.xp6(1),e.hij(" ",e.lcZ(6,4,"order.add-item-to-order")," ")}}function Fa(r,n){if(1&r&&(e.TgZ(0,"clr-accordion-content"),e._UZ(1,"vdr-coupon-code-selector",60),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("control",t.couponCodesControl)}}const qa=function(r){return{rate:r}};function Sa(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"clr-accordion-content")(1,"form",61),e.NdJ("submit",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.addSurcharge(i.surchargeForm.value))}),e.TgZ(2,"vdr-form-field",62),e.ALo(3,"translate"),e._UZ(4,"input",63),e.qZA(),e.TgZ(5,"vdr-form-field",64),e.ALo(6,"translate"),e._UZ(7,"input",65),e.qZA(),e.TgZ(8,"vdr-form-field",66),e.ALo(9,"translate"),e._UZ(10,"vdr-currency-input",67),e.qZA(),e.TgZ(11,"vdr-form-field",68),e.ALo(12,"translate"),e._UZ(13,"input",69),e.qZA(),e.TgZ(14,"vdr-form-field",70),e.ALo(15,"translate"),e.TgZ(16,"vdr-affixed-input",71),e._UZ(17,"input",72),e.qZA()(),e.TgZ(18,"vdr-form-field",73),e.ALo(19,"translate"),e._UZ(20,"input",74),e.qZA(),e.TgZ(21,"button",75),e._uU(22),e.ALo(23,"translate"),e.qZA()()()}if(2&r){const t=e.oxw().ngIf,o=e.oxw();let i,a;e.xp6(1),e.Q6J("formGroup",o.surchargeForm),e.xp6(1),e.Q6J("label",e.lcZ(3,10,"common.description")),e.xp6(3),e.Q6J("label",e.lcZ(6,12,"order.product-sku")),e.xp6(3),e.Q6J("label",e.lcZ(9,14,"common.price")),e.xp6(2),e.Q6J("currencyCode",t.currencyCode),e.xp6(1),e.Q6J("label",e.xi3(12,16,"catalog.price-includes-tax-at",e.VKq(25,qa,null==(i=o.surchargeForm.get("taxRate"))?null:i.value))),e.xp6(3),e.Q6J("label",e.lcZ(15,19,"order.tax-rate")),e.xp6(4),e.Q6J("label",e.lcZ(19,21,"order.tax-description")),e.xp6(3),e.Q6J("disabled",o.surchargeForm.invalid||o.surchargeForm.pristine||0===(null==(a=o.surchargeForm.get("price"))?null:a.value)),e.xp6(1),e.hij(" ",e.lcZ(23,23,"order.add-surcharge")," ")}}function Pa(r,n){if(1&r&&(e.TgZ(0,"clr-accordion-content"),e._UZ(1,"vdr-address-form",76),e.ALo(2,"async"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.shippingAddressForm)("availableCountries",e.lcZ(2,3,t.availableCountries$))("customFields",t.addressCustomFields)}}function Ja(r,n){if(1&r&&(e.TgZ(0,"clr-accordion-content"),e._UZ(1,"vdr-address-form",76),e.ALo(2,"async"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.billingAddressForm)("availableCountries",e.lcZ(2,3,t.availableCountries$))("customFields",t.addressCustomFields)}}const Re=function(r){return{count:r}};function Da(r,n){if(1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.modification-adding-items",e.VKq(4,Re,null==t.modifyOrderInput.addItems?null:t.modifyOrderInput.addItems.length))," ")}}function Na(r,n){if(1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.modification-adjusting-lines",e.VKq(4,Re,null==t.modifyOrderInput.adjustOrderLines?null:t.modifyOrderInput.adjustOrderLines.length))," ")}}function Qa(r,n){if(1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r){const t=e.oxw(2);e.xp6(1),e.hij(" ",e.xi3(2,1,"order.modification-adding-surcharges",e.VKq(4,Re,null==t.modifyOrderInput.surcharges?null:t.modifyOrderInput.surcharges.length))," ")}}function Ua(r,n){1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.modification-updating-shipping-address")," "))}function ka(r,n){1&r&&(e.TgZ(0,"li"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"order.modification-updating-billing-address")," "))}function Ea(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div")(1,"div",4)(2,"div",5)(3,"table",6)(4,"thead")(5,"tr"),e._UZ(6,"th"),e.TgZ(7,"th"),e._uU(8),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"th"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"th"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"th"),e._uU(17),e.ALo(18,"translate"),e.qZA(),e.YNc(19,_a,3,3,"th",0),e.TgZ(20,"th"),e._uU(21),e.ALo(22,"translate"),e.qZA()()(),e.TgZ(23,"tbody"),e.YNc(24,fa,26,36,"tr",7),e.YNc(25,va,26,27,"tr",8),e.YNc(26,Oa,15,14,"tr",9),e.YNc(27,Ta,12,4,"tr",10),e.TgZ(28,"tr",11)(29,"td",12),e._uU(30),e.ALo(31,"translate"),e.qZA(),e.TgZ(32,"td",13),e._uU(33),e.qZA(),e._UZ(34,"td",14),e.YNc(35,Aa,1,0,"td",0),e.TgZ(36,"td",13),e._uU(37),e.ALo(38,"localeCurrency"),e.TgZ(39,"div",15),e.ALo(40,"translate"),e._uU(41),e.ALo(42,"localeCurrency"),e.qZA()()()()(),e.TgZ(43,"h4",16),e._uU(44),e.ALo(45,"translate"),e.qZA(),e.TgZ(46,"clr-accordion")(47,"clr-accordion-panel")(48,"clr-accordion-title"),e._uU(49),e.ALo(50,"translate"),e.qZA(),e.YNc(51,Ma,7,6,"clr-accordion-content",17),e.qZA(),e.TgZ(52,"clr-accordion-panel")(53,"clr-accordion-title"),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.YNc(56,Fa,2,1,"clr-accordion-content",17),e.qZA(),e.TgZ(57,"clr-accordion-panel")(58,"clr-accordion-title"),e._uU(59),e.ALo(60,"translate"),e.qZA(),e.YNc(61,Sa,24,27,"clr-accordion-content",17),e.qZA(),e.TgZ(62,"clr-accordion-panel")(63,"clr-accordion-title"),e._uU(64),e.ALo(65,"translate"),e.qZA(),e.YNc(66,Pa,3,5,"clr-accordion-content",17),e.qZA(),e.TgZ(67,"clr-accordion-panel")(68,"clr-accordion-title"),e._uU(69),e.ALo(70,"translate"),e.qZA(),e.YNc(71,Ja,3,5,"clr-accordion-content",17),e.qZA()()(),e.TgZ(72,"div",18)(73,"div",19)(74,"div",20),e._uU(75),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"div",21)(78,"ul"),e.YNc(79,Da,3,6,"li",0),e.YNc(80,Na,3,6,"li",0),e.YNc(81,Qa,3,6,"li",0),e.YNc(82,Ua,3,3,"li",0),e.YNc(83,ka,3,3,"li",0),e.qZA()(),e.TgZ(84,"div",21)(85,"label",22),e._uU(86),e.ALo(87,"translate"),e.qZA(),e.TgZ(88,"textarea",23),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.note=i)}),e.qZA(),e.TgZ(89,"clr-checkbox-wrapper",24)(90,"input",25),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.recalculateShipping=i)}),e.qZA(),e.TgZ(91,"label"),e._uU(92),e.ALo(93,"translate"),e.qZA()()(),e.TgZ(94,"div",26)(95,"button",27),e.NdJ("click",function(){const a=e.CHM(t).ngIf,s=e.oxw();return e.KtG(s.previewAndModify(a))}),e._uU(96),e.ALo(97,"translate"),e.qZA()()()()()()}if(2&r){const t=n.ngIf,o=e.oxw();e.xp6(8),e.Oqu(e.lcZ(9,35,"order.product-name")),e.xp6(3),e.Oqu(e.lcZ(12,37,"order.product-sku")),e.xp6(3),e.Oqu(e.lcZ(15,39,"order.unit-price")),e.xp6(3),e.Oqu(e.lcZ(18,41,"order.quantity")),e.xp6(2),e.Q6J("ngIf",o.orderLineCustomFields.length),e.xp6(2),e.Oqu(e.lcZ(22,43,"order.total")),e.xp6(3),e.Q6J("ngForOf",t.lines),e.xp6(1),e.Q6J("ngForOf",o.addedLines)("ngForTrackBy",o.trackByProductVariantId),e.xp6(1),e.Q6J("ngForOf",t.surcharges),e.xp6(1),e.Q6J("ngForOf",o.modifyOrderInput.surcharges),e.xp6(3),e.Oqu(e.lcZ(31,45,"order.shipping")),e.xp6(3),e.hij(" ",null==t.shippingLines[0]||null==t.shippingLines[0].shippingMethod?null:t.shippingLines[0].shippingMethod.name," "),e.xp6(2),e.Q6J("ngIf",o.orderLineCustomFields.length),e.xp6(2),e.hij(" ",e.xi3(38,47,t.shippingWithTax,t.currencyCode)," "),e.xp6(2),e.Q6J("title",e.lcZ(40,50,"order.net-price")),e.xp6(2),e.hij(" ",e.xi3(42,52,t.shipping,t.currencyCode)," "),e.xp6(3),e.Oqu(e.lcZ(45,55,"order.modifications")),e.xp6(5),e.Oqu(e.lcZ(50,57,"order.add-item-to-order")),e.xp6(5),e.Oqu(e.lcZ(55,59,"order.set-coupon-codes")),e.xp6(5),e.Oqu(e.lcZ(60,61,"order.add-surcharge")),e.xp6(5),e.Oqu(e.lcZ(65,63,"order.edit-shipping-address")),e.xp6(5),e.Oqu(e.lcZ(70,65,"order.edit-billing-address")),e.xp6(6),e.hij(" ",e.lcZ(76,67,"order.modification-summary")," "),e.xp6(4),e.Q6J("ngIf",null==o.modifyOrderInput.addItems?null:o.modifyOrderInput.addItems.length),e.xp6(1),e.Q6J("ngIf",null==o.modifyOrderInput.adjustOrderLines?null:o.modifyOrderInput.adjustOrderLines.length),e.xp6(1),e.Q6J("ngIf",null==o.modifyOrderInput.surcharges?null:o.modifyOrderInput.surcharges.length),e.xp6(1),e.Q6J("ngIf",o.shippingAddressForm.dirty),e.xp6(1),e.Q6J("ngIf",o.billingAddressForm.dirty),e.xp6(3),e.Oqu(e.lcZ(87,69,"order.note")),e.xp6(2),e.Q6J("ngModel",o.note),e.xp6(2),e.Q6J("ngModel",o.recalculateShipping),e.xp6(2),e.Oqu(e.lcZ(93,71,"order.modification-recalculate-shipping")),e.xp6(3),e.Q6J("disabled",!o.canPreviewChanges()),e.xp6(1),e.hij(" ",e.lcZ(97,73,"order.preview-changes")," ")}}class Ze extends c.UT_{constructor(n,t,o,i,a,s,f,Ne){super(t,n,o,a),this.changeDetector=i,this.dataService=a,this.notificationService=s,this.modalService=f,this.orderTransitionService=Ne,this.detailForm=new l.nJ({}),this.couponCodesControl=new l.p4,this.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},this.note="",this.recalculateShipping=!0,this.addedVariants=new Map}get addedLines(){const n=t=>"SinglePrice"===t.__typename?t.value:0;return(this.modifyOrderInput.addItems||[]).map(t=>{const o=this.addedVariants.get(t.productVariantId);if(o)return{...o,price:n(o.price),priceWithTax:n(o.priceWithTax),quantity:t.quantity}}).filter(I.notNullOrUndefined)}ngOnInit(){this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe((0,De.R)(this.destroy$)).subscribe(n=>{n.couponCodes.length&&this.couponCodesControl.setValue(n.couponCodes),this.surchargeForm=new l.nJ({description:new l.p4("",l.kI.required),sku:new l.p4(""),price:new l.p4(0,l.kI.required),priceIncludesTax:new l.p4(!0),taxRate:new l.p4(0),taxDescription:new l.p4("")}),this.shippingAddressForm||(this.shippingAddressForm=new l.nJ({fullName:new l.p4(n.shippingAddress?.fullName),company:new l.p4(n.shippingAddress?.company),streetLine1:new l.p4(n.shippingAddress?.streetLine1),streetLine2:new l.p4(n.shippingAddress?.streetLine2),city:new l.p4(n.shippingAddress?.city),province:new l.p4(n.shippingAddress?.province),postalCode:new l.p4(n.shippingAddress?.postalCode),countryCode:new l.p4(n.shippingAddress?.countryCode),phoneNumber:new l.p4(n.shippingAddress?.phoneNumber)}),this.addAddressCustomFieldsFormGroup(this.shippingAddressForm,n.shippingAddress)),this.billingAddressForm||(this.billingAddressForm=new l.nJ({fullName:new l.p4(n.billingAddress?.fullName),company:new l.p4(n.billingAddress?.company),streetLine1:new l.p4(n.billingAddress?.streetLine1),streetLine2:new l.p4(n.billingAddress?.streetLine2),city:new l.p4(n.billingAddress?.city),province:new l.p4(n.billingAddress?.province),postalCode:new l.p4(n.billingAddress?.postalCode),countryCode:new l.p4(n.billingAddress?.countryCode),phoneNumber:new l.p4(n.billingAddress?.phoneNumber)}),this.addAddressCustomFieldsFormGroup(this.billingAddressForm,n.billingAddress)),this.orderLineCustomFieldsFormArray=new l.vC([]);for(const t of n.lines){const o=new l.nJ({});for(const{name:i}of this.orderLineCustomFields)o.addControl(i,new l.p4(t.customFields[i]));o.valueChanges.pipe((0,De.R)(this.destroy$)).subscribe(i=>{let a=this.modifyOrderInput.adjustOrderLines.find(s=>s.orderLineId===t.id);a||(a={orderLineId:t.id,quantity:t.quantity},this.modifyOrderInput.adjustOrderLines.push(a)),this.orderLineCustomFields.length&&(a.customFields=i)}),this.orderLineCustomFieldsFormArray.push(o)}}),this.addItemCustomFieldsFormArray=new l.vC([]),this.addItemCustomFieldsForm=new l.nJ({});for(const n of this.orderLineCustomFields)this.addItemCustomFieldsForm.addControl(n.name,new l.p4);this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(n=>n.countries.items).pipe((0,ft.d)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:c.Asd.DESC},filter:{type:{eq:c.iYD.ORDER_STATE_TRANSITION}}}).single$.subscribe(({order:n})=>{this.previousState=n?.history.items[0].data.from})}ngOnDestroy(){this.destroy()}transitionToPriorState(n){this.orderTransitionService.transitionToPreModifyingState(n.id,n.nextStates).subscribe(t=>{this.router.navigate([".."],{relativeTo:this.route})})}canPreviewChanges(){const{addItems:n,adjustOrderLines:t,surcharges:o}=this.modifyOrderInput;return!!n?.length||!!o?.length||!!t?.length||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid||this.couponCodesControl.dirty}isLineModified(n){return!!this.modifyOrderInput.adjustOrderLines?.find(t=>t.orderLineId===n.id&&t.quantity!==n.quantity)}updateLineQuantity(n,t){const{adjustOrderLines:o}=this.modifyOrderInput;let i=o?.find(a=>a.orderLineId===n.id);i&&+t===n.quantity&&o?.splice(o?.indexOf(i),1),i||(i={orderLineId:n.id,quantity:+t},o?.push(i)),i.quantity=+t}updateAddedItemQuantity(n,t){const o=this.modifyOrderInput.addItems?.find(i=>i.productVariantId===n.productVariantId);o&&(o.quantity=+t)}trackByProductVariantId(n,t){return t.productVariantId}getSelectedItemPrice(n){return"SinglePrice"===n?.priceWithTax.__typename?n.priceWithTax.value:0}addItemToOrder(n){if(!n)return;const t=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0;let o=this.modifyOrderInput.addItems?.find(i=>this.isMatchingAddItemRow(i,n,t));if(o?o.quantity++:(o={productVariantId:n.productVariantId,quantity:1},t&&(o.customFields=t),this.modifyOrderInput.addItems?.push(o)),t){const i=new l.nJ({});for(const[a,s]of Object.entries(t))i.addControl(a,new l.p4(s));this.addItemCustomFieldsFormArray.push(i),i.valueChanges.pipe((0,De.R)(this.destroy$)).subscribe(a=>{o&&(o.customFields=a)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(n.productVariantId,n)}isMatchingAddItemRow(n,t,o){return n.productVariantId===t.productVariantId&&JSON.stringify(n.customFields)===JSON.stringify(o)}removeAddedItem(n){this.modifyOrderInput.addItems.splice(n,1),-1<n&&this.addItemCustomFieldsFormArray.removeAt(n)}getSurchargePrices(n){const t=n.priceIncludesTax?n.price:Math.round(n.price*((100+(n.taxRate||0))/100));return{price:n.priceIncludesTax?Math.round(n.price/((100+(n.taxRate||0))/100)):n.price,priceWithTax:t}}addSurcharge(n){this.modifyOrderInput.surcharges?.push(n),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}removeSurcharge(n){this.modifyOrderInput.surcharges?.splice(n,1)}previewAndModify(n){const o={...{...this.modifyOrderInput,adjustOrderLines:this.modifyOrderInput.adjustOrderLines.map(a=>(0,c.EJQ)((0,aa.I)(a),this.orderLineCustomFields))},...this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{},...this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{},dryRun:!0,couponCodes:this.couponCodesControl.dirty?this.couponCodesControl.value:void 0,note:this.note??"",options:{recalculateShipping:this.recalculateShipping}},i=n.totalWithTax;this.dataService.order.modifyOrder(o).pipe((0,g.w)(({modifyOrder:a})=>{switch(a.__typename){case"Order":return this.modalService.fromComponent(Oe,{size:"xl",closable:!1,locals:{originalTotalWithTax:i,order:a,orderLineCustomFields:this.orderLineCustomFields,modifyOrderInput:o}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":case"CouponCodeLimitError":case"CouponCodeExpiredError":case"CouponCodeInvalidError":return this.notificationService.error(a.message),(0,v.of)(!1);case null:case void 0:return(0,v.of)(!1);default:(0,I.assertNever)(a)}}),(0,g.w)(a=>{if(!a||a.result===L.Cancel)return this.dataService.order.getOrder(this.id).mapSingle(()=>!1);{const s={...o,dryRun:!1};return a.result===L.Refund&&(s.refund={paymentId:a.refundPaymentId,reason:a.refundNote}),this.dataService.order.modifyOrder(s).pipe((0,g.w)(({modifyOrder:f})=>{if("Order"===f.__typename){const ml=0<f.totalWithTax-i?"ArrangingAdditionalPayment":this.previousState;return this.dataService.order.transitionToState(n.id,ml).pipe((0,ct.h)(!0))}return this.notificationService.error(f.message),S.E}))}})).subscribe(a=>{a&&this.router.navigate(["../"],{relativeTo:this.route})})}addAddressCustomFieldsFormGroup(n,t){if(t&&this.addressCustomFields.length){const o=new l.nJ({});for(const i of this.addressCustomFields){const a=i.name,s=t.customFields?.[a];o.addControl(a,new l.p4(s))}n.addControl("customFields",o)}}setFormValues(n,t){}}Ze.\u0275fac=function(n){return new(n||Ze)(e.Y36(C.F0),e.Y36(C.gz),e.Y36(c.iHG),e.Y36(e.sBO),e.Y36(c.DoR),e.Y36(c.gqp),e.Y36(c.Z7U),e.Y36(A))},Ze.\u0275cmp=e.Xpm({type:Ze,selectors:[["vdr-order-editor"]],features:[e.qOj],decls:7,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb-2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","allOrderFulfillments","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],["entityName","OrderLine",3,"customFields","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb-4",3,"productSelected"],["class","flex mb-4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb-4"],["class","mr-4 add-item-thumb",3,"src",4,"ngIf"],[1,"mr-4"],[1,"mr-4","add-item-thumb",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"control"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block"),e.YNc(1,ua,8,4,"vdr-action-bar",0),e.ALo(2,"async"),e.qZA(),e.TgZ(3,"vdr-page-block"),e.YNc(4,Ea,98,75,"div",0),e.ALo(5,"async"),e._UZ(6,"vdr-page-block"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.entity$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,4,t.entity$)))},dependencies:[u.q0d,u.Nz$,u.qvL,u.DbV,u.MgK,u.KKC,u.PEh,u.XE5,u.bZL,u.GmI,u.UJ5,u.r6y,u.dxz,u.twP,p.sg,p.O5,l._Y,l.Fj,l.wV,l.Wl,l.JJ,l.JL,l.Q7,l.qQ,l.Fd,l.On,l.sg,l.u,O.Kk,O.BN,O.mz,pa.K,dt.K,Ee.M,Me.h,x.y,we.G,at.e,Ve.C,ke.y,Se.z,R,Q,Y,p.Ov,p.H9,m.X$,X.M,h.k],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}.order-table[_ngcontent-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-right:2px}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{text-align:start}.add-item-thumb[_ngcontent-%COMP%]{max-width:50px}"],changeDetection:0});var Ya=d(3736),ja=d(5757),Ra=d(8862),$a=d(4246),Ha=d(5881);const Ga=function(){return["./draft/create"]};function Ka(r,n){1&r&&(e.TgZ(0,"a",12),e._UZ(1,"clr-icon",13),e._uU(2),e.ALo(3,"translate"),e.qZA()),2&r&&(e.Q6J("routerLink",e.DdM(4,Ga)),e.xp6(2),e.hij(" ",e.lcZ(3,2,"catalog.create-draft-order")," "))}const Va=function(){return["CreateOrder"]};function Ba(r,n){1&r&&(e.ynx(0),e.YNc(1,Ka,4,5,"a",11),e.BQk()),2&r&&(e.xp6(1),e.Q6J("vdrIfPermissions",e.DdM(1,Va)))}function Wa(r,n){if(1&r&&e._uU(0),2&r){const t=n.item;e.hij(" ",t.id," ")}}function Xa(r,n){if(1&r&&(e._uU(0),e.ALo(1,"localeDate")),2&r){const t=n.item;e.hij(" ",e.xi3(1,1,t.createdAt,"short")," ")}}const za=function(r){return["./draft",r]},el=function(r){return["./",r]};function tl(r,n){if(1&r&&(e.TgZ(0,"a",14)(1,"span"),e._uU(2),e.qZA(),e._UZ(3,"clr-icon",15),e.qZA()),2&r){const t=n.item;e.Q6J("routerLink","Draft"===t.state?e.VKq(2,za,t.id):e.VKq(4,el,t.id)),e.xp6(2),e.Oqu(t.code)}}function nl(r,n){if(1&r&&(e.TgZ(0,"vdr-customer-label",16),e.NdJ("click",function(o){return o.stopPropagation()}),e.qZA()),2&r){const t=n.item;e.Q6J("customer",t.customer)}}function rl(r,n){1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.order-type-regular")))}function ol(r,n){1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.order-type-aggregate")))}function il(r,n){1&r&&(e.TgZ(0,"vdr-chip"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&r&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"order.order-type-seller")))}function al(r,n){if(1&r&&(e.YNc(0,rl,3,3,"vdr-chip",1),e.YNc(1,ol,3,3,"vdr-chip",1),e.YNc(2,il,3,3,"vdr-chip",1)),2&r){const t=n.item,o=e.oxw();e.Q6J("ngIf",t.type===o.OrderType.Regular),e.xp6(1),e.Q6J("ngIf",t.type===o.OrderType.Aggregate),e.xp6(1),e.Q6J("ngIf",t.type===o.OrderType.Seller)}}function ll(r,n){if(1&r&&e._UZ(0,"vdr-order-state-label",17),2&r){const t=n.item;e.Q6J("state",t.state)}}function cl(r,n){if(1&r&&(e._uU(0),e.ALo(1,"localeCurrency")),2&r){const t=n.item;e.hij(" ",e.xi3(1,1,t.totalWithTax,t.currencyCode)," ")}}function dl(r,n){if(1&r&&(e._uU(0),e.ALo(1,"timeAgo")),2&r){const t=n.item;e.hij(" ",e.lcZ(1,1,t.updatedAt)," ")}}function sl(r,n){if(1&r&&(e._uU(0),e.ALo(1,"localeDate")),2&r){const t=n.item;e.hij(" ",e.xi3(1,1,t.orderPlacedAt,"short")," ")}}function pl(r,n){if(1&r&&e._uU(0),2&r){const t=n.item,o=e.oxw();e.hij(" ",o.getShippingNames(t)," ")}}function ul(r,n){if(1&r&&e._UZ(0,"vdr-dt2-custom-field-column",18),2&r){const t=n.$implicit,o=e.oxw();e.Q6J("customField",t)("sorts",o.sorts)}}class be extends c.$ms{constructor(n,t){super(),this.serverConfigService=n,this.channelService=t,this.orderStates=this.serverConfigService.getOrderProcessStates().map(o=>o.name),this.OrderType=c.mrS,this.customFields=this.getCustomFieldConfig("Order"),this.filters=this.createFilterCollection().addDateFilters().addFilter({name:"active",type:{kind:"boolean"},label:(0,_.J)("order.filter-is-active"),filterField:"active"}).addFilter({name:"totalWithTax",type:{kind:"number",inputType:"currency",currencyCode:"USD"},label:(0,_.J)("order.total"),filterField:"totalWithTax"}).addFilter({name:"state",type:{kind:"select",options:this.orderStates.map(o=>({value:o,label:(0,c.yr0)(o)}))},label:(0,_.J)("order.state"),filterField:"state"}).addFilter({name:"type",type:{kind:"select",options:[{value:c.mrS.Regular,label:(0,_.J)("order.order-type-regular")},{value:c.mrS.Aggregate,label:(0,_.J)("order.order-type-aggregate")},{value:c.mrS.Seller,label:(0,_.J)("order.order-type-seller")}]},label:(0,_.J)("order.order-type"),filterField:"type"}).addFilter({name:"orderPlacedAt",type:{kind:"dateRange"},label:(0,_.J)("order.placed-at"),filterField:"orderPlacedAt"}).addFilter({name:"customerLastName",type:{kind:"text"},label:(0,_.J)("customer.last-name"),filterField:"customerLastName"}).addFilter({name:"transactionId",type:{kind:"text"},label:(0,_.J)("order.transaction-id"),filterField:"transactionId"}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("updatedAt","DESC").addSort({name:"id"}).addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"orderPlacedAt"}).addSort({name:"customerLastName"}).addSort({name:"state"}).addSort({name:"totalWithTax"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.canCreateDraftOrder=!1,this.activeChannelIsDefaultChannel=!1,super.configure({document:c.a4G,getItems:o=>o.orders,setVariables:(o,i)=>this.createQueryOptions(o,i,this.searchTermControl.value),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]}),this.canCreateDraftOrder=!!this.serverConfigService.getOrderProcessStates().find(o=>"Created"===o.name)?.to.includes("Draft")}ngOnInit(){super.ngOnInit();const n=this.channelService.defaultChannelIsActive$.pipe((0,Ie.b)(t=>this.activeChannelIsDefaultChannel=t));super.refreshListOnChanges(this.filters.valueChanges,this.sorts.valueChanges,n)}createQueryOptions(n,t,o){let i=this.filters.createFilterInput();return this.activeChannelIsDefaultChannel&&(i={...i??{}}),o&&(i={code:{contains:o},customerLastName:{contains:o},transactionId:{contains:o}}),{options:{skip:n,take:t,filter:{...i??{}},filterOperator:o?c.FnJ.OR:c.FnJ.AND,sort:this.sorts.createSortInput()}}}getShippingNames(n){return n.shippingLines.length?n.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}be.\u0275fac=function(n){return new(n||be)(e.Y36(c.iHG),e.Y36(c.Tjy))},be.\u0275cmp=e.Xpm({type:be,selectors:[["vdr-order-list"]],features:[e.qOj],decls:44,vars:60,consts:[["locationId","order-list"],[4,"ngIf"],["id","order-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","order-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault","sort"],[3,"heading","hiddenByDefault"],[3,"heading","optional"],[3,"heading","sort"],[3,"heading"],[3,"customField","sorts",4,"ngFor","ngForOf"],["class","btn",3,"routerLink",4,"vdrIfPermissions"],[1,"btn",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"customer","click"],[3,"state"],[3,"customField","sorts"]],template:function(n,t){1&n&&(e.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-right"),e._UZ(3,"vdr-action-bar-items",0),e.YNc(4,Ba,2,2,"ng-container",1),e.qZA()()(),e.TgZ(5,"vdr-data-table-2",2),e.NdJ("pageChange",function(i){return t.setPageNumber(i)})("itemsPerPageChange",function(i){return t.setItemsPerPage(i)}),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e._UZ(10,"vdr-bulk-action-menu",3)(11,"vdr-dt2-search",4),e.ALo(12,"translate"),e.TgZ(13,"vdr-dt2-column",5),e.ALo(14,"translate"),e.YNc(15,Wa,1,1,"ng-template"),e.qZA(),e.TgZ(16,"vdr-dt2-column",6),e.ALo(17,"translate"),e.YNc(18,Xa,2,4,"ng-template"),e.qZA(),e.TgZ(19,"vdr-dt2-column",7),e.ALo(20,"translate"),e.YNc(21,tl,4,6,"ng-template"),e.qZA(),e.TgZ(22,"vdr-dt2-column",8),e.ALo(23,"translate"),e.YNc(24,nl,1,1,"ng-template"),e.qZA(),e.TgZ(25,"vdr-dt2-column",6),e.ALo(26,"translate"),e.YNc(27,al,3,3,"ng-template"),e.qZA(),e.TgZ(28,"vdr-dt2-column",8),e.ALo(29,"translate"),e.YNc(30,ll,1,1,"ng-template"),e.qZA(),e.TgZ(31,"vdr-dt2-column",8),e.ALo(32,"translate"),e.YNc(33,cl,2,4,"ng-template"),e.qZA(),e.TgZ(34,"vdr-dt2-column",9),e.ALo(35,"translate"),e.YNc(36,dl,2,3,"ng-template"),e.qZA(),e.TgZ(37,"vdr-dt2-column",8),e.ALo(38,"translate"),e.YNc(39,sl,2,4,"ng-template"),e.qZA(),e.TgZ(40,"vdr-dt2-column",9),e.ALo(41,"translate"),e.YNc(42,pl,1,1,"ng-template"),e.qZA(),e.YNc(43,ul,1,2,"vdr-dt2-custom-field-column",10),e.qZA()),2&n&&(e.xp6(4),e.Q6J("ngIf",t.canCreateDraftOrder),e.xp6(1),e.Q6J("items",e.lcZ(6,30,t.items$))("itemsPerPage",e.lcZ(7,32,t.itemsPerPage$))("totalItems",e.lcZ(8,34,t.totalItems$))("currentPage",e.lcZ(9,36,t.currentPage$))("filters",t.filters),e.xp6(5),e.Q6J("hostComponent",t)("selectionManager",t.selectionManager),e.xp6(1),e.Q6J("searchTermControl",t.searchTermControl)("searchTermPlaceholder",e.lcZ(12,38,"order.search-by-order-filters")),e.xp6(2),e.Q6J("heading",e.lcZ(14,40,"common.id"))("hiddenByDefault",!0)("sort",t.sorts.get("id")),e.xp6(3),e.Q6J("heading",e.lcZ(17,42,"common.created-at"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(20,44,"common.code"))("optional",!1),e.xp6(3),e.Q6J("heading",e.lcZ(23,46,"order.customer"))("sort",t.sorts.get("customerLastName")),e.xp6(3),e.Q6J("heading",e.lcZ(26,48,"order.order-type"))("hiddenByDefault",!0),e.xp6(3),e.Q6J("heading",e.lcZ(29,50,"order.state"))("sort",t.sorts.get("state")),e.xp6(3),e.Q6J("heading",e.lcZ(32,52,"order.total"))("sort",t.sorts.get("totalWithTax")),e.xp6(3),e.Q6J("heading",e.lcZ(35,54,"common.updated-at")),e.xp6(3),e.Q6J("heading",e.lcZ(38,56,"order.placed-at"))("sort",t.sorts.get("orderPlacedAt")),e.xp6(3),e.Q6J("heading",e.lcZ(41,58,"order.shipping")),e.xp6(3),e.Q6J("ngForOf",t.customFields))},dependencies:[u.qvL,p.sg,p.O5,C.rH,O.Kk,O.mz,F.Y,Ue.d,we.G,Ya.H,st.W,ja.c,Ra.e,rt.U,$a.J,ot.j,Se.z,p.Ov,m.X$,Ha.e,Je.H,h.k],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;max-width:100vw;margin-bottom:6px}.filter-presets[_ngcontent-%COMP%]{max-width:90vw;overflow-x:auto}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:initial}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px;height:36px}ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0});const _l=Ae.Ps`
    query GetCustomerAddresses($customerId: ID!) {
        customer(id: $customerId) {
            id
            addresses {
                ...Address
            }
        }
    }
    ${c.UYy}
`;var xt=d(5038);class B{constructor(n,t){this.router=n,this.dataService=t}resolve(n,t){const o=n.paramMap.get("id"),i=this.router.events.pipe((0,xt.h)(s=>s instanceof C.wM)),a=this.dataService.order.getOrder(o).mapStream(s=>s.order).pipe((0,g.w)(s=>"Draft"===s?.state&&n.component!==H?(this.router.navigate(["/orders/draft",o]),S.E):[s]),(0,De.R)(i),(0,xt.h)(I.notNullOrUndefined),(0,ft.d)(1));return a.pipe((0,q.q)(1),(0,b.U)(()=>a))}}B.\u0275fac=function(n){return new(n||B)(e.LFG(C.F0),e.LFG(c.DoR))},B.\u0275prov=e.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"});class w{constructor(n,t){this.dataService=n,this.router=t}canActivate(n,t){const o=t.url.includes("orders/draft"),i=n.paramMap.get("id");return!o||"create"!==i||this.dataService.order.createDraftOrder().pipe((0,b.U)(({createDraftOrder:a})=>this.router.parseUrl(`/orders/draft/${a.id}`)))}}w.\u0275fac=function(n){return new(n||w)(e.LFG(c.DoR),e.LFG(C.F0))},w.\u0275prov=e.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"});const Ct=r=>[{path:"",component:c.IIO,pathMatch:"full",data:{locationId:"order-list",breadcrumb:(0,_.J)("breadcrumb.orders")},children:r.getPageTabRoutes("order-list")},{path:"draft/:id",component:c.IIO,canActivate:[w],data:{locationId:"draft-order-detail",breadcrumb:{label:(0,_.J)("breadcrumb.orders"),link:["../"]}},children:r.getPageTabRoutes("draft-order-detail")},{path:":id",component:c.IIO,canActivate:[w],data:{locationId:"order-detail",breadcrumb:{label:(0,_.J)("breadcrumb.orders"),link:["../"]}},children:r.getPageTabRoutes("order-detail")},{path:":aggregateOrderId/seller-orders/:id",component:c.IIO,canActivate:[w],data:{locationId:"order-detail",breadcrumb:{label:(0,_.J)("breadcrumb.orders"),link:["../"]}},children:r.getPageTabRoutes("order-detail")},{path:":id/modify",component:Ze,resolve:{entity:B},data:{breadcrumb:yt}}];function vt(r,n){return r.entity.pipe((0,b.U)(t=>t.aggregateOrder?[{label:"breadcrumb.orders",link:["../"]},{label:t.aggregateOrder.code,link:["../",t.aggregateOrder.id]},{label:(0,_.J)("breadcrumb.seller-orders"),link:["../",t.aggregateOrder.id]},{label:t.code,link:[t.id]}]:[{label:"breadcrumb.orders",link:["../"]},{label:t.code,link:[t.id]}]))}function yt(r,n){return vt(r).pipe((0,b.U)(t=>{const o=t.slice();return o[1].link=["../",t[1].link[0]],o.concat({label:(0,_.J)("breadcrumb.modifying"),link:[""]})}))}class Te{constructor(n){this.pageService=n,n.registerPageTab({priority:0,location:"order-list",tab:(0,_.J)("order.orders"),route:"",component:be}),n.registerPageTab({priority:0,location:"order-detail",tab:(0,_.J)("order.order"),route:"",component:(0,c.IX9)({component:ye,query:c.jCp,entityKey:"order",getBreadcrumbs:t=>t?.type===c.mrS.Seller&&t?.aggregateOrder?[{label:`${t?.aggregateOrder?.code}`,link:["/orders/",t?.aggregateOrder?.id]},{label:(0,_.J)("breadcrumb.seller-orders"),link:["/orders/",t?.aggregateOrder?.id]},{label:`${t?.code}`,link:[t?.id]}]:[{label:`${t?.code}`,link:[t?.id]}]})}),n.registerPageTab({priority:0,location:"draft-order-detail",tab:(0,_.J)("order.order"),route:"",component:(0,c.IX9)({component:H,query:c.jCp,entityKey:"order",getBreadcrumbs:t=>[{label:(0,_.J)("order.draft-order"),link:[t?.id]}]})})}}Te.\u0275fac=function(n){return new(n||Te)(e.LFG(c.PhL))},Te.\u0275mod=e.oAB({type:Te}),Te.\u0275inj=e.cJS({providers:[{provide:C.Z6,useFactory:r=>Ct(r),multi:!0,deps:[c.PhL]}],imports:[c.m81,C.Bz.forChild([])]})}}]);
//# sourceMappingURL=192.3cf1eb19bc8e8d82.js.map