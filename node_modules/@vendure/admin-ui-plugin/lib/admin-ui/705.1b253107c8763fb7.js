"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[705],{6705:(_t,C,a)=>{a.r(C),a.d(C,{HealthCheckComponent:()=>p,JobListComponent:()=>u,JobStateLabelComponent:()=>g,SystemModule:()=>h,systemRoutes:()=>U});var t=a(3162),s=a(5209),i=a(296),r=a(7347),m=a(8763),v=a(6489),y=a(4753),T=a(6959),A=a(2649),x=a(8066),L=a(3827),J=a(2477),N=a(2050);function I(e,o){1&e&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"system.health-all-systems-up")," "))}function Q(e,o){1&e&&(t._uU(0),t.ALo(1,"translate")),2&e&&t.hij(" ",t.lcZ(1,1,"system.health-error")," ")}const S=function(e,o){return{"is-success":e,"is-danger":o}};function Y(e,o){if(1&e&&(t.TgZ(0,"div",7)(1,"div",8),t._UZ(2,"clr-icon",9),t.qZA(),t.TgZ(3,"div",10),t.YNc(4,I,3,3,"ng-container",11),t.YNc(5,Q,2,3,"ng-template",null,12,t.W1O),t.TgZ(7,"div",13),t._uU(8),t.ALo(9,"translate"),t.ALo(10,"localeDate"),t.ALo(11,"async"),t.qZA()()()),2&e){const n=o.ngIf,l=t.MAs(6),c=t.oxw();t.xp6(2),t.Q6J("ngClass",t.WLB(13,S,"ok"===n,"ok"!==n)),t.uIk("shape","ok"===n?"check-circle":"exclamation-circle"),t.xp6(2),t.Q6J("ngIf","ok"===n)("ngIfElse",l),t.xp6(4),t.AsE(" ",t.lcZ(9,6,"system.health-last-checked"),": ",t.xi3(10,8,t.lcZ(11,11,c.healthCheckService.lastCheck$),"mediumTime")," ")}}function P(e,o){1&e&&(t.ynx(0),t._UZ(1,"clr-icon",17),t._uU(2),t.ALo(3,"translate"),t.BQk()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"system.health-status-up")," "))}function q(e,o){1&e&&(t._UZ(0,"clr-icon",18),t._uU(1),t.ALo(2,"translate")),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"system.health-status-down")," "))}function k(e,o){if(1&e&&(t.TgZ(0,"tr")(1,"td",14),t._uU(2),t.qZA(),t.TgZ(3,"td",14)(4,"vdr-chip",15),t.YNc(5,P,4,3,"ng-container",11),t.YNc(6,q,3,3,"ng-template",null,16,t.W1O),t.qZA()(),t.TgZ(8,"td",14),t._uU(9),t.qZA()()),2&e){const n=o.$implicit,l=t.MAs(7);t.xp6(2),t.Oqu(n.key),t.xp6(2),t.Q6J("colorType","up"===n.result.status?"success":"error"),t.xp6(1),t.Q6J("ngIf","up"===n.result.status)("ngIfElse",l),t.xp6(4),t.Oqu(n.result.message)}}class p{constructor(o){this.healthCheckService=o}}p.\u0275fac=function(o){return new(o||p)(t.Y36(s.Gpz))},p.\u0275cmp=t.Xpm({type:p,selectors:[["vdr-health-check"]],decls:30,vars:18,consts:[["class","system-status-header",4,"ngIf"],["locationId","system-status"],[1,"btn","btn-secondary",3,"click"],["shape","refresh"],[1,"table"],[1,"left"],[4,"ngFor","ngForOf"],[1,"system-status-header"],[1,"status-icon"],["size","48",3,"ngClass"],[1,"status-detail"],[4,"ngIf","ngIfElse"],["error",""],[1,"last-checked"],[1,"align-middle","left"],[3,"colorType"],["down",""],["shape","check-circle"],["shape","exclamation-circle"]],template:function(o,n){1&o&&(t.TgZ(0,"vdr-page-header"),t._UZ(1,"vdr-page-title"),t.qZA(),t.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left"),t.YNc(6,Y,12,16,"div",0),t.ALo(7,"async"),t.qZA(),t.TgZ(8,"vdr-ab-right"),t._UZ(9,"vdr-action-bar-items",1),t.TgZ(10,"button",2),t.NdJ("click",function(){return n.healthCheckService.refresh()}),t._UZ(11,"clr-icon",3),t._uU(12),t.ALo(13,"translate"),t.qZA()()()(),t.TgZ(14,"vdr-page-block")(15,"table",4)(16,"thead")(17,"tr")(18,"th",5),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"th",5),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"th",5),t._uU(25),t.ALo(26,"translate"),t.qZA()()(),t.TgZ(27,"tbody"),t.YNc(28,k,10,5,"tr",6),t.ALo(29,"async"),t.qZA()()()()),2&o&&(t.xp6(6),t.Q6J("ngIf",t.lcZ(7,6,n.healthCheckService.status$)),t.xp6(6),t.hij(" ",t.lcZ(13,8,"system.health-refresh")," "),t.xp6(7),t.hij(" ",t.lcZ(20,10,"common.name")," "),t.xp6(3),t.hij(" ",t.lcZ(23,12,"system.health-status")," "),t.xp6(3),t.hij(" ",t.lcZ(26,14,"system.health-message")," "),t.xp6(3),t.Q6J("ngForOf",t.lcZ(29,16,n.healthCheckService.details$)))},dependencies:[i.qvL,r.mk,r.sg,r.O5,m.Kk,m.BN,m.mz,v.Y,y.W,T.q,A.T,x.H,L.z,r.Ov,J.X$,N.H],styles:[".system-status-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header[_ngcontent-%COMP%]   .status-detail[_ngcontent-%COMP%]{font-weight:700;margin-right:6px}.system-status-header[_ngcontent-%COMP%]   .last-checked[_ngcontent-%COMP%]{font-weight:400;color:var(--color-grey-500)}"],changeDetection:0});var d=a(6008),O=a(1414),E=a(4467),w=a(5038),F=a(2303),f=a(3576),b=a(7734),D=a(8434),M=a(9014),H=a(433),R=a(8308),$=a(9182),G=a(1434),z=a(8862),B=a(7869);function W(e,o){if(1&e&&(t.TgZ(0,"span",3),t._uU(1),t.ALo(2,"percent"),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,n.job.progress/100)," ")}}class g{get iconShape(){switch(this.job.state){case s.Zyh.COMPLETED:return"check-circle";case s.Zyh.FAILED:return"exclamation-circle";case s.Zyh.CANCELLED:return"ban";case s.Zyh.PENDING:case s.Zyh.RETRYING:return"hourglass";case s.Zyh.RUNNING:return"sync"}}get colorType(){switch(this.job.state){case s.Zyh.COMPLETED:return"success";case s.Zyh.FAILED:case s.Zyh.CANCELLED:return"error";case s.Zyh.PENDING:case s.Zyh.RETRYING:return"";case s.Zyh.RUNNING:return"warning"}}}g.\u0275fac=function(o){return new(o||g)},g.\u0275cmp=t.Xpm({type:g,selectors:[["vdr-job-state-label"]],inputs:{job:"job"},decls:5,vars:6,consts:[[3,"colorType"],[1,"mr1"],["class","progress",4,"ngIf"],[1,"progress"]],template:function(o,n){1&o&&(t.TgZ(0,"vdr-chip",0),t._UZ(1,"clr-icon",1),t._uU(2),t.ALo(3,"titlecase"),t.YNc(4,W,3,3,"span",2),t.qZA()),2&o&&(t.Q6J("colorType",n.colorType),t.xp6(1),t.uIk("shape",n.iconShape),t.xp6(1),t.hij(" ",t.lcZ(3,4,n.job.state)," "),t.xp6(2),t.Q6J("ngIf","RUNNING"===n.job.state))},dependencies:[i.qvL,r.O5,v.Y,r.Zx,r.rS],styles:[".progress[_ngcontent-%COMP%]{margin-left:3px}clr-icon[_ngcontent-%COMP%]{min-width:12px}"],changeDetection:0});var K=a(8064),X=a(5881),V=a(3169);function tt(e,o){1&e&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"system.all-job-queues")," "))}function et(e,o){if(1&e&&(t.TgZ(0,"vdr-chip",11),t._uU(1),t.qZA()),2&e){const n=t.oxw().item;t.Q6J("colorFrom",n.name),t.xp6(1),t.Oqu(n.name)}}function nt(e,o){if(1&e&&(t.YNc(0,tt,3,3,"ng-container",9),t.YNc(1,et,2,2,"ng-template",null,10,t.W1O)),2&e){const n=o.item,l=t.MAs(2);t.Q6J("ngIf","all"===n.name)("ngIfElse",l)}}function ot(e,o){if(1&e&&t._uU(0),2&e){const n=o.item;t.hij(" ",n.id," ")}}function at(e,o){if(1&e&&(t._uU(0),t.ALo(1,"timeAgo")),2&e){const n=o.item;t.hij(" ",t.lcZ(1,1,n.createdAt)," ")}}function st(e,o){if(1&e&&(t.TgZ(0,"vdr-chip",11),t._uU(1),t.qZA()),2&e){const n=o.item;t.Q6J("colorFrom",n.queueName),t.xp6(1),t.Oqu(n.queueName)}}function lt(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",13),t.ALo(2,"translate"),t._UZ(3,"clr-icon",14),t.qZA(),t.TgZ(4,"vdr-dropdown-menu")(5,"div",15),t._UZ(6,"vdr-object-tree",16),t.qZA()()()),2&e){const n=t.oxw().item;t.xp6(1),t.Q6J("title",t.lcZ(2,2,"system.job-data")),t.xp6(5),t.Q6J("value",n.data)}}function rt(e,o){if(1&e&&t.YNc(0,lt,7,4,"vdr-dropdown",12),2&e){const n=o.item;t.Q6J("ngIf",n.data)}}function ct(e,o){if(1&e&&(t.TgZ(0,"div",19),t._uU(1),t.qZA()),2&e){const n=t.oxw().item;t.xp6(1),t.hij("after ",n.attempts," attempts")}}function it(e,o){if(1&e&&(t.TgZ(0,"div",19),t._uU(1),t.qZA()),2&e){const n=t.oxw().item;t.xp6(1),t.AsE(" attempting ",n.attempts+1," of ",n.retries," ")}}function mt(e,o){if(1&e&&(t._UZ(0,"vdr-job-state-label",17),t.YNc(1,ct,2,1,"div",18),t.YNc(2,it,2,2,"div",18)),2&e){const n=o.item;t.Q6J("job",n),t.xp6(1),t.Q6J("ngIf","FAILED"===n.state),t.xp6(1),t.Q6J("ngIf","RUNNING"===n.state||"RETRYING"===n.state)}}function pt(e,o){if(1&e&&(t._uU(0),t.ALo(1,"duration")),2&e){const n=o.item;t.hij(" ",t.lcZ(1,1,n.duration)," ")}}function dt(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",20),t._UZ(2,"clr-icon",14),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu")(6,"div",15),t._UZ(7,"vdr-object-tree",16),t.qZA()()()),2&e){const n=t.oxw().item;t.xp6(3),t.hij(" ",t.lcZ(4,2,"system.job-result")," "),t.xp6(4),t.Q6J("value",n.result)}}function gt(e,o){if(1&e&&(t.TgZ(0,"vdr-dropdown")(1,"button",20),t._UZ(2,"clr-icon",21),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"vdr-dropdown-menu")(6,"div",15),t._uU(7),t.qZA()()()),2&e){const n=t.oxw().item;t.xp6(3),t.hij(" ",t.lcZ(4,2,"system.job-error")," "),t.xp6(4),t.hij(" ",n.error," ")}}const ut=function(){return["DeleteSettings","DeleteSystem"]};function ht(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"vdr-dropdown")(1,"button",22),t._UZ(2,"clr-icon",23),t.qZA(),t.TgZ(3,"vdr-dropdown-menu",24)(4,"button",25),t.NdJ("click",function(){t.CHM(n);const c=t.oxw().item,_=t.oxw();return t.KtG(_.cancelJob(c.id))}),t.ALo(5,"hasPermission"),t._UZ(6,"clr-icon",26),t._uU(7),t.ALo(8,"translate"),t.qZA()()()}2&e&&(t.xp6(4),t.Q6J("disabled",!t.lcZ(5,2,t.DdM(6,ut))),t.xp6(3),t.hij(" ",t.lcZ(8,4,"common.cancel")," "))}function Zt(e,o){if(1&e&&(t.YNc(0,dt,8,4,"vdr-dropdown",12),t.YNc(1,gt,8,4,"vdr-dropdown",12),t.YNc(2,ht,9,7,"vdr-dropdown",12)),2&e){const n=o.item,l=t.oxw();t.Q6J("ngIf",l.hasResult(n)),t.xp6(1),t.Q6J("ngIf",n.error),t.xp6(1),t.Q6J("ngIf",!n.isSettled&&"FAILED"!==n.state)}}class u extends s.t7C{constructor(o,n,l,c,_){super(c,_),this.dataService=o,this.modalService=n,this.notificationService=l,this.liveUpdate=new d.p4(!0),this.hideSettled=new d.p4(!0),this.queueFilter=new d.p4("all"),super.setQueryFn((...Z)=>this.dataService.settings.getAllJobs(...Z),Z=>Z.jobs,(Z,vt)=>({options:{skip:Z,take:vt,filter:{..."all"===this.queueFilter.value?null:{queueName:{eq:this.queueFilter.value}},...this.hideSettled.value?{isSettled:{eq:!1}}:{}},sort:{createdAt:s.Asd.DESC}}}))}ngOnInit(){super.ngOnInit(),(0,O.H)(5e3,2e3).pipe((0,E.R)(this.destroy$),(0,w.h)(()=>this.liveUpdate.value)).subscribe(()=>{this.refresh()}),this.queues$=this.dataService.settings.getJobQueues().mapStream(o=>o.jobQueues).pipe((0,F.U)(o=>[{name:"all",running:!0},...o]))}hasResult(o){const n=o.result;return null!=n&&("object"!=typeof n||Object.keys(n).length>0)}cancelJob(o){this.dataService.settings.cancelJob(o).subscribe(()=>this.refresh())}}u.\u0275fac=function(o){return new(o||u)(t.Y36(s.DoR),t.Y36(s.Z7U),t.Y36(s.gqp),t.Y36(f.F0),t.Y36(f.gz))},u.\u0275cmp=t.Xpm({type:u,selectors:[["vdr-job-list"]],features:[t.qOj],decls:47,vars:53,consts:[[1,"mr-2"],["type","checkbox","clrCheckbox","","name","live-update",3,"formControl"],["type","checkbox","clrCheckbox","","name","hide-settled",3,"formControl","change"],["locationId","job-list"],["bindValue","name",3,"addTag","items","hideSelected","multiple","markFirst","clearable","searchable","formControl","change"],["ng-label-tmp","","ng-option-tmp",""],["id","job-list",3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"heading"],[3,"heading","optional"],[4,"ngIf","ngIfElse"],["others",""],[3,"colorFrom"],[4,"ngIf"],["vdrDropdownTrigger","",1,"btn","btn-link","btn-icon",3,"title"],["shape","details"],[1,"result-detail"],[3,"value"],[3,"job"],["class","retry-info",4,"ngIf"],[1,"retry-info"],["vdrDropdownTrigger","",1,"btn","btn-link","btn-sm","details-button"],["shape","exclamation-circle"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","ban",1,"is-danger"]],template:function(o,n){1&o&&(t.TgZ(0,"vdr-page-header"),t._UZ(1,"vdr-page-title"),t.qZA(),t.TgZ(2,"vdr-page-body")(3,"vdr-page-block")(4,"vdr-action-bar")(5,"vdr-ab-left")(6,"clr-checkbox-wrapper",0),t._UZ(7,"input",1),t.TgZ(8,"label"),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"clr-checkbox-wrapper")(12,"input",2),t.NdJ("change",function(){return n.refresh()}),t.qZA(),t.TgZ(13,"label"),t._uU(14),t.ALo(15,"translate"),t.qZA()()(),t.TgZ(16,"vdr-ab-right"),t._UZ(17,"vdr-action-bar-items",3),t.TgZ(18,"ng-select",4),t.NdJ("change",function(){return n.refresh()}),t.ALo(19,"async"),t.YNc(20,nt,3,2,"ng-template",5),t.qZA()()()(),t.TgZ(21,"vdr-data-table-2",6),t.NdJ("pageChange",function(c){return n.setPageNumber(c)})("itemsPerPageChange",function(c){return n.setItemsPerPage(c)}),t.ALo(22,"async"),t.ALo(23,"async"),t.ALo(24,"async"),t.ALo(25,"async"),t.TgZ(26,"vdr-dt2-column",7),t.ALo(27,"translate"),t.YNc(28,ot,1,1,"ng-template"),t.qZA(),t.TgZ(29,"vdr-dt2-column",7),t.ALo(30,"translate"),t.YNc(31,at,2,3,"ng-template"),t.qZA(),t.TgZ(32,"vdr-dt2-column",8),t.ALo(33,"translate"),t.YNc(34,st,2,2,"ng-template"),t.qZA(),t.TgZ(35,"vdr-dt2-column",8),t.ALo(36,"translate"),t.YNc(37,rt,1,1,"ng-template"),t.qZA(),t.TgZ(38,"vdr-dt2-column",7),t.ALo(39,"translate"),t.YNc(40,mt,3,3,"ng-template"),t.qZA(),t.TgZ(41,"vdr-dt2-column",7),t.ALo(42,"translate"),t.YNc(43,pt,2,3,"ng-template"),t.qZA(),t.TgZ(44,"vdr-dt2-column",7),t.ALo(45,"translate"),t.YNc(46,Zt,3,3,"ng-template"),t.qZA()()()),2&o&&(t.xp6(7),t.Q6J("formControl",n.liveUpdate),t.xp6(2),t.Oqu(t.lcZ(10,25,"common.live-update")),t.xp6(3),t.Q6J("formControl",n.hideSettled),t.xp6(2),t.Oqu(t.lcZ(15,27,"system.hide-settled-jobs")),t.xp6(4),t.Q6J("addTag",!1)("items",t.lcZ(19,29,n.queues$))("hideSelected",!0)("multiple",!1)("markFirst",!1)("clearable",!1)("searchable",!1)("formControl",n.queueFilter),t.xp6(3),t.Q6J("items",t.lcZ(22,31,n.items$))("itemsPerPage",t.lcZ(23,33,n.itemsPerPage$))("totalItems",t.lcZ(24,35,n.totalItems$))("currentPage",t.lcZ(25,37,n.currentPage$)),t.xp6(5),t.Q6J("heading",t.lcZ(27,39,"common.id")),t.xp6(3),t.Q6J("heading",t.lcZ(30,41,"common.created-at")),t.xp6(3),t.Q6J("heading",t.lcZ(33,43,"system.job-queue-name"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(36,45,"system.job-data"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(39,47,"system.job-state")),t.xp6(3),t.Q6J("heading",t.lcZ(42,49,"system.job-duration")),t.xp6(3),t.Q6J("heading",t.lcZ(45,51,"system.job-result")))},dependencies:[i.qvL,i.MgK,i.KKC,i.PEh,r.O5,d.Wl,d.JJ,d.oH,b.w9,b.ir,b.mR,m.Kk,m.BN,m.mz,v.Y,D.y,M.J,H.N,R.U,$.H,G._,y.W,z.e,B.U,T.q,A.T,x.H,L.z,g,r.Ov,J.X$,K.j,X.e,V.u],styles:[".result-detail[_ngcontent-%COMP%]{margin:0 12px}.retry-info[_ngcontent-%COMP%]{margin-left:6px;color:var(--color-grey-400)}"],changeDetection:0});var j=a(8511);const U=[{path:"jobs",component:u,data:{breadcrumb:(0,j.J)("breadcrumb.job-queue")}},{path:"system-status",component:p,data:{breadcrumb:(0,j.J)("breadcrumb.system-status")}}];class h{}h.\u0275fac=function(o){return new(o||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[s.m81,f.Bz.forChild(U)]})}}]);
//# sourceMappingURL=705.1b253107c8763fb7.js.map