"use strict";(self.webpackChunkvendure_admin=self.webpackChunkvendure_admin||[]).push([[938],{9938:($l,be,m)=>{m.r(be),m.d(be,{ASSET_DETAIL_QUERY:()=>eo,ApplyFacetDialogComponent:()=>at,AssetDetailComponent:()=>bt,AssetListComponent:()=>Tt,AssetsComponent:()=>X,AssignProductsToChannelDialogComponent:()=>E,BulkAddFacetValuesDialogComponent:()=>Zt,COLLECTION_DETAIL_QUERY:()=>na,CREATE_STOCK_LOCATION:()=>vl,CatalogModule:()=>Rt,CollectionBreadcrumbPipe:()=>st,CollectionContentsComponent:()=>rt,CollectionDataTableComponent:()=>ct,CollectionDetailComponent:()=>At,CollectionListComponent:()=>yt,CollectionTreeComponent:()=>Yt,CollectionTreeNodeComponent:()=>et,CollectionTreeService:()=>tt,ConfirmVariantDeletionDialogComponent:()=>Gt,CreateProductOptionGroupDialogComponent:()=>ht,CreateProductVariantDialogComponent:()=>vt,FACET_DETAIL_QUERY:()=>Or,FACET_LIST_QUERY:()=>zr,FacetDetailComponent:()=>Ft,FacetListComponent:()=>Lt,GET_PRODUCTS_WITH_FACET_VALUES_BY_IDS:()=>Je,GET_PRODUCT_DETAIL:()=>is,GET_STOCK_LOCATION_DETAIL:()=>hl,GET_STOCK_LOCATION_LIST:()=>kl,GET_VARIANTS_WITH_FACET_VALUES_BY_IDS:()=>De,GenerateProductVariantsComponent:()=>It,GeneratedVariant:()=>Hn,MoveCollectionsDialogComponent:()=>Pt,OPTION_VALUE_INPUT_VALUE_ACCESSOR:()=>Te,OptionValueInputComponent:()=>W,PRODUCT_LIST_QUERY:()=>Vl,PRODUCT_VARIANT_DETAIL_QUERY:()=>Ul,PRODUCT_VARIANT_DETAIL_QUERY_PRODUCT_VARIANT_FRAGMENT:()=>Ce,PRODUCT_VARIANT_LIST_QUERY:()=>ql,PRODUCT_VARIANT_UPDATE_MUTATION:()=>Ml,ProductDetailComponent:()=>dt,ProductDetailService:()=>S,ProductListComponent:()=>kt,ProductOptionsEditorComponent:()=>_t,ProductVariantDetailComponent:()=>Dt,ProductVariantListComponent:()=>lt,ProductVariantQuickJumpComponent:()=>Jt,ProductVariantsEditorComponent:()=>Ct,ProductVariantsResolver:()=>xt,ProductVariantsTableComponent:()=>Et,StockLocationDetailComponent:()=>Bt,StockLocationListComponent:()=>wt,UPDATE_PRODUCTS_BULK:()=>we,UPDATE_STOCK_LOCATION:()=>Cl,UPDATE_VARIANTS_BULK:()=>Ne,UpdateProductOptionDialogComponent:()=>jt,VariantPriceDetailComponent:()=>Ot,arrayToTree:()=>Ye,assignCollectionsToChannelBulkAction:()=>Qe,assignFacetValuesToProductsBulkAction:()=>en,assignFacetsToChannelBulkAction:()=>Ee,assignProductVariantsToChannelBulkAction:()=>nn,assignProductsToChannelBulkAction:()=>Xe,assignStockLocationsToChannelBulkAction:()=>cn,createRoutes:()=>Ze,deleteCollectionsBulkAction:()=>Ue,deleteFacetsBulkAction:()=>Ge,deleteProductVariantsBulkAction:()=>an,deleteProductsBulkAction:()=>We,deleteStockLocationsBulkAction:()=>rn,moveCollectionsBulkAction:()=>Me,productOptionsEditorBreadcrumb:()=>Ae,removeCollectionsFromChannelBulkAction:()=>qe,removeFacetsFromChannelBulkAction:()=>Be,removeFacetsFromChannelBulkAction2:()=>Jr,removeProductVariantsFromChannelBulkAction:()=>on,removeProductsFromChannelBulkAction:()=>tn,removeStockLocationsFromChannelBulkAction:()=>sn,replaceLast:()=>le});var Z=m(3576),p=m(8511),c=m(5209),t=m(3162),h=m(2303),d=m(6008),y=m(7296),Nt=m(1376),B=m(5244),$=m(233),w=m(8227),j=m(4707),ne=m(5387),N=m(2680),ln=m(9139),Ht=m(5822),C=m(407);function le(o,n,e){if(!o)return"";const i=o.lastIndexOf(n);if(-1===i)return o;return o.substr(0,i)+o.substr(i).replace(n,e)}class S{constructor(n){this.dataService=n}getTaxCategories(){return this.dataService.settings.getTaxCategories().mapSingle(n=>n.taxCategories.items).pipe((0,Ht.d)(1))}createProductWithVariants(n,e,i){const a=this.dataService.product.createProduct(n),r=e.groups.filter(l=>0<l.values.length),s=this.createProductOptionGroups(r,i);return(0,Nt.D)(a,s).pipe((0,w.z)(([{createProduct:l},u])=>(u.length?(0,Nt.D)(u.map(v=>this.dataService.product.addOptionGroupToProduct({productId:l.id,optionGroupId:v.id}))):(0,N.of)([])).pipe((0,h.U)(()=>({createProduct:l,optionGroups:u})))),(0,w.z)(({createProduct:l,optionGroups:u})=>{const g=e.variants.map(T=>{const P=u.length?T.optionValues.map((I,q)=>{const D=u[q].options.find(pt=>pt.name===I);if(!D)throw new Error(`Could not find a matching ProductOption "${I}" when creating variant`);return D.id}):[];return{...T,optionIds:P}}),v=u.map(T=>T.options).reduce((T,P)=>[...T,...P],[]);return this.createProductVariants(l,g,v,i,e.stockLocationId)}))}createProductOptionGroups(n,e){return n.length?(0,Nt.D)(n.map(i=>this.dataService.product.createProductOptionGroups({code:(0,j.U)(i.name,"-"),translations:[{languageCode:e,name:i.name}],options:i.values.map(a=>({code:(0,j.U)(a,"-"),translations:[{languageCode:e,name:a}]}))}).pipe((0,h.U)(a=>a.createProductOptionGroup)))):(0,N.of)([])}createProductVariants(n,e,i,a,r){const s=e.map(l=>{const u=i.length?`${n.name} ${l.optionIds.map(g=>i.find(v=>v.id===g)).filter(ne.notNullOrUndefined).map(g=>g.name).join(" ")}`:n.name;return{productId:n.id,price:l.price,sku:l.sku,translations:[{languageCode:a,name:u}],stockLevels:[{stockLocationId:r,stockOnHand:l.stock}],optionIds:l.optionIds}});return this.dataService.product.createProductVariants(s).pipe((0,h.U)(({createProductVariants:l})=>({createProductVariants:l,productId:n.id})))}updateProduct(n){const{product:e,languageCode:i,autoUpdate:a,productInput:r,variantsInput:s}=n,l=[],u=s||[];return(a?this.dataService.product.getProductVariantsForProduct({},e.id).mapSingle(({productVariants:v})=>v.items):(0,N.of)([])).pipe((0,w.z)(v=>{if(r){l.push(this.dataService.product.updateProduct(r));const T=(0,c.ZIM)(e,i)?.name??"",P=(0,c.ZIM)(r,i)?.name;if(P&&T!==P&&a)for(const I of v){const q=(0,c.ZIM)(I,i)?.name||"";let D;const pt=u.find(xe=>xe.id===I.id);pt?D=pt:(D={id:I.id,translations:[{languageCode:i,name:q}]},u.push(D));const ee=(0,c.ZIM)(D,i);ee&&(ee.name?ee.name=le(ee.name,T,P):ee.name=[P,...I.options.map(xe=>xe.name)].join(" "))}}return u.length&&l.push(this.dataService.product.updateProductVariants(u)),(0,Nt.D)(l)}))}updateProductOption(n,e,i){return(n.autoUpdate?this.dataService.product.getProductVariantsForProduct({},e.id).mapSingle(({productVariants:r})=>r.items):(0,N.of)([])).pipe((0,w.z)(r=>{let s=(0,N.of)([]);if(n.autoUpdate){let l;const u=(0,c.ZIM)(n,i)?.name;u||(s=(0,N.of)([]));const g=[];for(const v of r)if(v.options.map(T=>T.id).includes(n.id)){l||(l=(0,c.ZIM)(v.options.find(P=>P.id===n.id),i)?.name);const T=(0,c.ZIM)(v,i)?.name||"";l&&u&&T.includes(l)&&g.push({id:v.id,translations:[{languageCode:i,name:le(T,l,u)}]})}g.length&&(s=this.dataService.product.updateProductVariants(g))}return this.dataService.product.updateProductOption(n).pipe((0,w.z)(()=>s))}))}deleteProductVariant(n,e){return this.dataService.product.deleteProductVariant(n).pipe((0,C.w)(i=>i.deleteProductVariant.result===c.PcR.DELETED?this.dataService.product.getProduct(e).single$:(0,ln._)(i.deleteProductVariant.message)))}}S.\u0275fac=function(n){return new(n||S)(t.LFG(c.DoR))},S.\u0275prov=t.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"});var f=m(296),_=m(7347),x=m(8763),M=m(4889),F=m(8434),R=m(2039),J=m(3736),ut=m(7536),mt=m(8862),H=m(7869),dn=m(6959),pn=m(2649),un=m(2429),mn=m(8066),O=m(3827),Vt=m(7362),gt=m(7790),b=m(2477),Y=m(8064),nt=m(2050);function gn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",6),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.detailForm.pristine||e.detailForm.invalid),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function _n(o,n){if(1&o&&(t.ynx(0,19),t._UZ(1,"vdr-tabbed-custom-fields",20),t.ALo(2,"hasPermission"),t.BQk()),2&o){const e=t.oxw().$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("customFields",i.optionGroupCustomFields)("customFieldsFormGroup",e.get("customFields"))("readonly",!t.lcZ(2,3,i.updatePermission))}}function fn(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.value.id," ")}}function hn(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.value.createdAt,"short")," ")}}function vn(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.value.updatedAt,"short")," ")}}function Cn(o,n){if(1&o&&(t._UZ(0,"input",24),t.ALo(1,"hasPermission")),2&o){const e=n.item,i=t.oxw(4);t.Q6J("formControl",e.get("name"))("readonly",!t.lcZ(1,2,i.updatePermission))}}function xn(o,n){if(1&o&&t._UZ(0,"input",25),2&o){const e=n.item;t.Q6J("formControl",e.get("code"))}}function bn(o,n){if(1&o&&(t._UZ(0,"vdr-tabbed-custom-fields",26),t.ALo(1,"hasPermission")),2&o){const e=n.item,i=t.oxw(4);t.Q6J("customFields",i.optionCustomFields)("compact",!0)("customFieldsFormGroup",e.get("customFields"))("readonly",!t.lcZ(1,4,i.updatePermission))}}function Tn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-data-table-2",21),t.NdJ("pageChange",function(a){t.CHM(e);const r=t.oxw().$implicit,s=t.oxw(2);return t.KtG(s.paginationSettings[r.value.id].currentPage=a)}),t.TgZ(1,"vdr-dt2-column",22),t.ALo(2,"translate"),t.YNc(3,fn,1,1,"ng-template"),t.qZA(),t.TgZ(4,"vdr-dt2-column",22),t.ALo(5,"translate"),t.YNc(6,hn,2,4,"ng-template"),t.qZA(),t.TgZ(7,"vdr-dt2-column",22),t.ALo(8,"translate"),t.YNc(9,vn,2,4,"ng-template"),t.qZA(),t.TgZ(10,"vdr-dt2-column",23),t.ALo(11,"translate"),t.YNc(12,Cn,2,4,"ng-template"),t.qZA(),t.TgZ(13,"vdr-dt2-column",23),t.ALo(14,"translate"),t.YNc(15,xn,1,1,"ng-template"),t.qZA(),t.TgZ(16,"vdr-dt2-column",22),t.ALo(17,"translate"),t.YNc(18,bn,2,6,"ng-template"),t.qZA()()}if(2&o){const e=n.ngIf,i=t.oxw().$implicit,a=t.oxw(2);t.Q6J("items",e)("itemsPerPage",null==a.paginationSettings[i.value.id]?null:a.paginationSettings[i.value.id].itemsPerPage)("currentPage",null==a.paginationSettings[i.value.id]?null:a.paginationSettings[i.value.id].currentPage)("totalItems",e.length),t.xp6(1),t.Q6J("heading",t.lcZ(2,16,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(5,18,"common.created-at"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(8,20,"common.updated-at"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(11,22,"common.name"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(14,24,"common.code"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(17,26,"common.custom-fields"))("hiddenByDefault",0===a.optionCustomFields.length)}}function Zn(o,n){if(1&o&&(t.TgZ(0,"vdr-card",10),t._UZ(1,"vdr-page-entity-info",11),t.TgZ(2,"div",12)(3,"vdr-form-field",13),t.ALo(4,"translate"),t._UZ(5,"input",14),t.ALo(6,"hasPermission"),t.qZA(),t.TgZ(7,"vdr-form-field",15),t.ALo(8,"translate"),t._UZ(9,"input",16),t.ALo(10,"hasPermission"),t.qZA()(),t.YNc(11,_n,3,5,"ng-container",17),t.YNc(12,Tn,19,28,"vdr-data-table-2",18),t.qZA()),2&o){const e=n.$implicit,i=n.index,a=t.oxw(2);t.Q6J("formArrayName",i)("title",e.value.code),t.xp6(1),t.Q6J("entity",e.value),t.xp6(2),t.Q6J("label",t.lcZ(4,11,"common.name")),t.xp6(2),t.Q6J("id","name-"+i)("readonly",!t.lcZ(6,13,a.updatePermission)),t.xp6(2),t.Q6J("label",t.lcZ(8,15,"common.code")),t.xp6(2),t.Q6J("id","code-"+i)("readonly",!t.lcZ(10,17,a.updatePermission)),t.xp6(2),t.Q6J("ngIf",a.optionGroupCustomFields.length),t.xp6(1),t.Q6J("ngIf",a.getOptions(e))}}function An(o,n){if(1&o&&(t.TgZ(0,"form",7)(1,"div",8),t.YNc(2,Zn,13,19,"vdr-card",9),t.qZA()()),2&o){const e=t.oxw();t.Q6J("formGroup",e.detailForm),t.xp6(2),t.Q6J("ngForOf",e.getOptionGroups())}}class _t extends c.UT_{constructor(n,e,i,a,r,s,l,u){super(n,e,i,a),this.route=n,this.router=e,this.serverConfigService=i,this.dataService=a,this.productDetailService=r,this.formBuilder=s,this.changeDetector=l,this.notificationService=u,this.autoUpdateVariantNames=!0,this.paginationSettings={},this.updatePermission=[c.y3$.UpdateCatalog,c.y3$.UpdateProduct],this.optionGroupCustomFields=this.getCustomFieldConfig("ProductOptionGroup"),this.optionCustomFields=this.getCustomFieldConfig("ProductOption")}ngOnInit(){this.optionGroups$=this.route.snapshot.data.entity.pipe((0,h.U)(n=>n.optionGroups),(0,B.b)(n=>{for(const e of n)this.paginationSettings[e.id]={currentPage:1,itemsPerPage:10}})),this.detailForm=new d.nJ({optionGroups:new d.vC([])}),super.init()}getOptionGroups(){return this.detailForm.get("optionGroups").controls}getOptions(n){return n.get("options").controls}save(){if(this.detailForm.invalid||this.detailForm.pristine)return;const n=this.dataService.product.getProduct(this.id).mapSingle(e=>e.product);(0,y.a)(this.entity$,this.languageCode$,n).pipe((0,$.q)(1),(0,w.z)(([{optionGroups:e},i,a])=>{const r=[];for(const s of this.getOptionGroups()){if(s.dirty){const l=e.find(u=>u.id===s.value.id);if(l){const u=this.getUpdatedOptionGroup(l,s,i);r.push(this.dataService.product.updateProductOptionGroup(u))}}for(const l of this.getOptions(s))if(l.dirty){const u=e.find(g=>g.id===s.value.id)?.options.find(g=>g.id===l.value.id);if(u){const g=this.getUpdatedOption(u,l,i);r.push(this.productDetailService.updateProductOption({...g,autoUpdate:this.autoUpdateVariantNames},a,i))}}}return(0,Nt.D)(r)})).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"ProductOptionGroup"})},e=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"ProductOptionGroup"})})}getUpdatedOptionGroup(n,e,i){return(0,c.iSy)({translatable:n,updatedFields:e.value,customFieldConfig:this.optionGroupCustomFields,languageCode:i,defaultTranslation:{languageCode:i,name:n.name||""}})}getUpdatedOption(n,e,i){return(0,c.iSy)({translatable:n,updatedFields:e.value,customFieldConfig:this.optionCustomFields,languageCode:i,defaultTranslation:{languageCode:i,name:n.name||""}})}setFormValues(n,e){const i=this.detailForm.get("optionGroups");for(const a of n.optionGroups){const r=(0,c.ZIM)(a,e),s=this.setOptionGroupForm(a,i,r);this.setCustomFieldsForm(this.optionGroupCustomFields,s,a,r);let l=s.get("options");l||(l=this.formBuilder.array([]),s.addControl("options",l));for(const u of a.options){const g=(0,c.ZIM)(u,e),v=this.setOptionForm(u,l,g);this.setCustomFieldsForm(this.optionCustomFields,v,u,g)}}}setCustomFieldsForm(n,e,i,a){if(n.length){let r=e.get(["customFields"]);r||(r=this.formBuilder.group(n.reduce((s,l)=>({...s,[l.name]:""}),{})),e.addControl("customFields",r)),this.setCustomFieldFormValues(n,r,i,a)}}setOptionGroupForm(n,e,i){const a={id:n.id,createdAt:n.createdAt,updatedAt:n.updatedAt,code:n.code,name:i?.name??""};let r=e.controls.find(s=>s.value.id===n.id);return r?(r.get("id")?.setValue(a.id),r.get("code")?.setValue(a.code),r.get("name")?.setValue(a.name),r.get("createdAt")?.setValue(a.createdAt),r.get("updatedAt")?.setValue(a.updatedAt)):(r=this.formBuilder.group(a),e.push(r)),r}setOptionForm(n,e,i){const a={id:n.id,createdAt:n.createdAt,updatedAt:n.updatedAt,code:n.code,name:i?.name??""};let r=e.controls.find(s=>s.value.id===n.id);return r?(r.get("id")?.setValue(a.id),r.get("code")?.setValue(a.code),r.get("name")?.setValue(a.name),r.get("createdAt")?.setValue(a.createdAt),r.get("updatedAt")?.setValue(a.updatedAt)):(r=this.formBuilder.group(a),e.push(r)),r}}_t.\u0275fac=function(n){return new(n||_t)(t.Y36(Z.gz),t.Y36(Z.F0),t.Y36(c.iHG),t.Y36(c.DoR),t.Y36(S),t.Y36(d.QS),t.Y36(t.sBO),t.Y36(c.gqp))},_t.\u0275cmp=t.Xpm({type:_t,selectors:[["vdr-product-options-editor"]],features:[t.qOj],decls:24,vars:17,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"flex","center"],[1,"mr-2"],["clrCheckbox","","type","checkbox","id","auto-update",3,"ngModel","ngModelChange"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup"],["formGroupName","optionGroups"],[3,"formArrayName","title",4,"ngFor","ngForOf"],[3,"formArrayName","title"],[3,"entity"],[1,"form-grid"],["for","name",3,"label"],["type","text","formControlName","name",3,"id","readonly"],["for","code",3,"label"],["type","text","formControlName","code",3,"id","readonly"],["formGroupName","customFields",4,"ngIf"],["id","edit-options-list",3,"items","itemsPerPage","currentPage","totalItems","pageChange",4,"ngIf"],["formGroupName","customFields"],["entityName","ProductOptionGroup",3,"customFields","customFieldsFormGroup","readonly"],["id","edit-options-list",3,"items","itemsPerPage","currentPage","totalItems","pageChange"],[3,"heading","hiddenByDefault"],[3,"heading","optional"],["type","text",3,"formControl","readonly"],["type","text",3,"formControl"],["entityName","ProductOption",3,"customFields","compact","customFieldsFormGroup","readonly"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-header"),t._UZ(1,"vdr-page-title"),t.TgZ(2,"vdr-page-header-description"),t._uU(3),t.ALo(4,"translate"),t.qZA()(),t.TgZ(5,"vdr-page-body")(6,"vdr-page-block")(7,"vdr-action-bar")(8,"vdr-ab-left")(9,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(10,"async"),t.ALo(11,"async"),t.qZA()(),t.TgZ(12,"vdr-ab-right")(13,"div",1)(14,"div",2)(15,"clr-checkbox-wrapper")(16,"input",3),t.NdJ("ngModelChange",function(a){return e.autoUpdateVariantNames=a}),t.qZA(),t.TgZ(17,"label"),t._uU(18),t.ALo(19,"translate"),t.qZA()()(),t.YNc(20,gn,3,4,"button",4),t.qZA()()()(),t.TgZ(21,"vdr-page-block"),t.YNc(22,An,3,2,"form",5),t.ALo(23,"async"),t.qZA()()),2&n&&(t.xp6(3),t.Oqu(t.lcZ(4,7,"catalog.page-description-options-editor")),t.xp6(6),t.Q6J("availableLanguageCodes",t.lcZ(10,9,e.availableLanguages$))("currentLanguageCode",t.lcZ(11,11,e.languageCode$)),t.xp6(7),t.Q6J("ngModel",e.autoUpdateVariantNames),t.xp6(2),t.Oqu(t.lcZ(19,13,"catalog.auto-update-product-variant-name")),t.xp6(2),t.Q6J("vdrIfPermissions",e.updatePermission),t.xp6(2),t.Q6J("ngIf",t.lcZ(23,15,e.optionGroups$)))},dependencies:[f.MgK,f.KKC,f.PEh,_.sg,_.O5,d._Y,d.Fj,d.Wl,d.JJ,d.JL,d.On,d.oH,d.sg,d.u,d.x0,d.CE,x.Kk,x.BN,x.mz,M.h,F.y,R.S,J.H,ut.y,mt.e,H.U,dn.q,pn.T,un._,mn.H,O.z,Vt.D,gt.A,_.Ov,b.X$,Y.j,nt.H],styles:[".option-group-header[_ngcontent-%COMP%]{display:flex;align-items:baseline}"],changeDetection:0});var Ut=m(8077),L=m(3618),K=m(6821),ft=m(8356),ot=m(8279);function Pn(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.create-product-option-group"),"\n")}function yn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",8),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.confirm())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,3,"common.cancel")),t.xp6(2),t.Q6J("disabled",e.form.invalid),t.xp6(1),t.hij(" ",t.lcZ(5,5,"common.confirm")," ")}}class ht{constructor(n){this.formBuilder=n,this.form=this.formBuilder.group({name:["",d.kI.required],code:["",d.kI.required]})}updateCode(){const n=this.form.get("name"),e=this.form.get("code");n&&e&&e.pristine&&e.setValue((0,j.U)(`${n.value}`,"-"))}confirm(){const{name:n,code:e}=this.form.value;!n||!e||this.resolveWith({code:e,options:[],translations:[{languageCode:this.languageCode,name:n}]})}cancel(){this.resolveWith()}}ht.\u0275fac=function(n){return new(n||ht)(t.Y36(d.qu))},ht.\u0275cmp=t.Xpm({type:ht,selectors:[["vdr-create-product-option-group-dialog"]],decls:9,vars:7,consts:[["vdrDialogTitle",""],[1,"form-grid",3,"formGroup"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"input"],["for","code",3,"label"],["id","code","type","text","formControlName","code"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){1&n&&(t.YNc(0,Pn,2,3,"ng-template",0),t.TgZ(1,"div",1)(2,"vdr-form-field",2),t.ALo(3,"translate"),t.TgZ(4,"input",3),t.NdJ("input",function(){return e.updateCode()}),t.qZA()(),t.TgZ(5,"vdr-form-field",4),t.ALo(6,"translate"),t._UZ(7,"input",5),t.qZA()(),t.YNc(8,yn,6,7,"ng-template",6)),2&n&&(t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("label",t.lcZ(3,3,"common.name")),t.xp6(3),t.Q6J("label",t.lcZ(6,5,"common.code")))},dependencies:[d.Fj,d.JJ,d.JL,d.sg,d.u,M.h,F.y,ft.n,ot.q,b.X$],changeDetection:0});var oe=m(7734);function Fn(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.create-product-variant"),"\n")}function Ln(o,n){if(1&o&&(t.TgZ(0,"vdr-form-field",7),t._UZ(1,"ng-select",11),t.qZA()),2&o){const e=n.$implicit;t.Q6J("label",e.name),t.xp6(1),t.Q6J("items",e.options)("formControlName",e.code)}}function In(o,n){1&o&&(t.TgZ(0,"clr-alert",12)(1,"clr-alert-item")(2,"span",13),t._uU(3),t.ALo(4,"translate"),t.qZA()()()),2&o&&(t.Q6J("clrAlertClosable",!1),t.xp6(3),t.hij(" ",t.lcZ(4,2,"catalog.cannot-create-variants-without-options")," "))}function kn(o,n){if(1&o&&(t.TgZ(0,"div",14)(1,"clr-alert",15)(2,"clr-alert-item")(3,"span",13),t._uU(4),t.ALo(5,"translate"),t.qZA()()()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("clrAlertClosable",!1),t.xp6(3),t.lnq(" ",t.lcZ(5,4,"catalog.product-variant-exists"),": ",e.existingVariant.name," (",e.existingVariant.sku,") ")}}function On(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",17),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.confirm())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,3,"common.cancel")),t.xp6(2),t.Q6J("disabled",e.form.invalid||e.existingVariant||0===e.product.optionGroups.length),t.xp6(1),t.hij(" ",t.lcZ(5,5,"common.confirm")," ")}}class vt{constructor(n){this.formBuilder=n,this.form=this.formBuilder.group({name:["",d.kI.required],sku:["",d.kI.required],options:this.formBuilder.record({})})}ngOnInit(){for(const e of this.product.optionGroups)this.form.get("options").addControl(e.code,new d.NI("",d.kI.required));this.form.get("options").valueChanges.subscribe(e=>{const i=this.form.get("name");if(!Object.values(e).every(s=>null==s)&&e&&i&&!i.dirty){const s=Object.entries(e).map(([l,u])=>this.product.optionGroups.find(g=>g.code===l)?.options.find(g=>g.id===u)?.name).join(" ");i.setValue(`${this.product.name} ${s}`)}Object.values(e).every(s=>null!=s)&&(this.existingVariant=this.product.variants.find(s=>Object.entries(e).every(([l,u])=>s.options.find(g=>g.groupId===this.getGroupIdFromCode(l))?.id===u)))})}confirm(){const{name:n,sku:e,options:i}=this.form.value;if(!n||!e||!i)return;const a=Object.values(i).filter(ne.notNullOrUndefined);this.resolveWith({productId:this.product.id,sku:e,optionIds:a,translations:[{languageCode:this.product.languageCode,name:n}]})}cancel(){this.resolveWith()}getGroupCodeFromId(n){return this.product.optionGroups.find(e=>e.id===n)?.code??""}getGroupIdFromCode(n){return this.product.optionGroups.find(e=>e.code===n)?.id??""}}vt.\u0275fac=function(n){return new(n||vt)(t.Y36(d.qu))},vt.\u0275cmp=t.Xpm({type:vt,selectors:[["vdr-create-product-variant-dialog"]],decls:14,vars:10,consts:[["vdrDialogTitle",""],[3,"formGroup"],["formGroupName","options",1,"form-grid"],[3,"label",4,"ngFor","ngForOf"],["clrAlertType","warning","class","form-grid-span",3,"clrAlertClosable",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"form-grid","mt-2"],[3,"label"],["type","text","formControlName","name"],["type","text","formControlName","sku"],["vdrDialogButtons",""],["bindLabel","name","bindValue","id","appendTo","body",3,"items","formControlName"],["clrAlertType","warning",1,"form-grid-span",3,"clrAlertClosable"],[1,"alert-text"],[1,"mt-2"],["clrAlertType","warning",1,"",3,"clrAlertClosable"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){1&n&&(t.YNc(0,Fn,2,3,"ng-template",0),t.TgZ(1,"form",1)(2,"div",2),t.YNc(3,Ln,2,3,"vdr-form-field",3),t.YNc(4,In,5,4,"clr-alert",4),t.qZA(),t.YNc(5,kn,6,6,"div",5),t.TgZ(6,"div",6)(7,"vdr-form-field",7),t.ALo(8,"translate"),t._UZ(9,"input",8),t.qZA(),t.TgZ(10,"vdr-form-field",7),t.ALo(11,"translate"),t._UZ(12,"input",9),t.qZA()()(),t.YNc(13,On,6,7,"ng-template",10)),2&n&&(t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(2),t.Q6J("ngForOf",e.product.optionGroups),t.xp6(1),t.Q6J("ngIf",0===e.product.optionGroups.length),t.xp6(1),t.Q6J("ngIf",e.existingVariant),t.xp6(2),t.Q6J("label",t.lcZ(8,6,"common.name")),t.xp6(3),t.Q6J("label",t.lcZ(11,8,"catalog.sku")))},dependencies:[f.TIm,f.CyW,f.I9z,_.sg,_.O5,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,d.x0,oe.w9,M.h,F.y,ft.n,ot.q,b.X$],changeDetection:0});var z=m(6489),it=m(4246),V=m(1044);const Jn=["textArea"],Dn=["editNameInput"];function wn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-chip",6),t.NdJ("iconClick",function(){const r=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.removeOption(r))}),t.TgZ(1,"span",7)(2,"input",8,9),t.NdJ("blur",function(a){const s=t.CHM(e).index,l=t.oxw(2);return t.KtG(l.updateOption(s,a))})("click",function(a){return a.cancelBubble=!0}),t.qZA()(),t.TgZ(4,"span",10),t.NdJ("click",function(a){const s=t.CHM(e).index,l=t.oxw(2);return t.KtG(l.editName(s,a))}),t._uU(5),t.qZA()()}if(2&o){const e=n.$implicit,i=n.last,a=n.index,r=t.oxw(2);t.ekj("selected",i&&r.lastSelected)("locked",e.locked),t.Q6J("icon",e.locked?"lock":"times")("colorFrom",r.groupName),t.xp6(1),t.Q6J("hidden",r.editingIndex!==a),t.xp6(1),t.Q6J("ngModel",e.name),t.xp6(2),t.ekj("editable",!e.locked&&!e.id),t.Q6J("hidden",r.editingIndex===a),t.xp6(1),t.Oqu(e.name)}}function Nn(o,n){if(1&o&&(t.TgZ(0,"div",4),t.YNc(1,wn,6,12,"vdr-chip",5),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.optionValues)}}const Te={provide:d.JU,useExisting:(0,t.Gpc)(()=>W),multi:!0};class W{get optionValues(){return this.formValue??this.options??[]}constructor(n){this.changeDetector=n,this.groupName="",this.add=new t.vpe,this.remove=new t.vpe,this.edit=new t.vpe,this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1,this.editingIndex=-1}registerOnChange(n){this.onChangeFn=n}registerOnTouched(n){this.onTouchFn=n}setDisabledState(n){this.disabled=n,this.changeDetector.markForCheck()}writeValue(n){this.formValue=n||[]}focus(){this.textArea.nativeElement.focus()}editName(n,e){const i=this.optionValues[n];if(!i.locked&&!i.id){e.cancelBubble=!0,this.editingIndex=n;const a=this.nameInputs.get(n)?.nativeElement;setTimeout(()=>a?.focus())}}updateOption(n,e){const i=this.optionValues[n],a=e.target.value;i&&(a&&(i.name=a,this.edit.emit({index:n,option:i})),this.editingIndex=-1)}removeOption(n){n.locked||(this.formValue?(this.formValue=this.formValue?.filter(e=>e.name!==n.name),this.onChangeFn(this.formValue)):this.remove.emit(n))}handleKey(n){switch(n.key){case",":case"Enter":this.addOptionValue(),n.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}handleBlur(){this.isFocussed=!1,this.addOptionValue()}addOptionValue(){const n=this.parseInputIntoOptions(this.input).filter(e=>!(this.options??this.formValue)?.find(a=>a?.name===e.name));if(!this.formValue&&this.options)for(const e of n)this.add.emit(e);else this.formValue=(0,V.T)([...this.formValue,...n]),this.onChangeFn(this.formValue);this.input=""}parseInputIntoOptions(n){return n.split(/[,\n]/).map(e=>e.trim()).filter(e=>""!==e).map(e=>({name:e,locked:!1}))}removeLastOption(){if(this.optionValues.length){const n=this.optionValues[this.optionValues.length-1];this.removeOption(n)}}}W.\u0275fac=function(n){return new(n||W)(t.Y36(t.sBO))},W.\u0275cmp=t.Xpm({type:W,selectors:[["vdr-option-value-input"]],viewQuery:function(n,e){if(1&n&&(t.Gf(Jn,7),t.Gf(Dn,5,t.SBq)),2&n){let i;t.iGM(i=t.CRH())&&(e.textArea=i.first),t.iGM(i=t.CRH())&&(e.nameInputs=i)}},inputs:{groupName:"groupName",options:"options",disabled:"disabled"},outputs:{add:"add",remove:"remove",edit:"edit"},features:[t._Bn([Te])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"],[3,"hidden"],["type","text",3,"ngModel","blur","click"],["editNameInput",""],[1,"option-name",3,"hidden","click"]],template:function(n,e){if(1&n){const i=t.EpF();t.TgZ(0,"div",0),t.NdJ("click",function(){t.CHM(i);const r=t.MAs(3);return t.KtG(r.focus())}),t.YNc(1,Nn,2,1,"div",1),t.TgZ(2,"textarea",2,3),t.NdJ("keyup",function(r){return e.handleKey(r)})("focus",function(){return e.isFocussed=!0})("blur",function(){return e.handleBlur()})("ngModelChange",function(r){return e.input=r}),t.qZA()()}2&n&&(t.ekj("focus",e.isFocussed),t.xp6(1),t.Q6J("ngIf",0<e.optionValues.length),t.xp6(1),t.Q6J("ngModel",e.input)("disabled",e.disabled))},dependencies:[_.sg,_.O5,d.Fj,d.JJ,d.On,z.Y,F.y],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:var(--color-form-input-bg);border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}vdr-chip[_ngcontent-%COMP%]   .option-name.editable[_ngcontent-%COMP%]:hover{outline:1px solid var(--color-component-bg-300);outline-offset:1px;border-radius:1px}vdr-chip[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:0!important;margin-top:-2px;margin-bottom:-2px}"]});var ie=m(2491);function Vn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",11)(1,"vdr-form-field",12),t.ALo(2,"translate"),t.TgZ(3,"input",13),t.NdJ("ngModelChange",function(a){const s=t.CHM(e).$implicit;return t.KtG(s.name=a)}),t.qZA()(),t.TgZ(4,"vdr-form-field",14),t.ALo(5,"translate"),t.TgZ(6,"vdr-option-value-input",15,16),t.NdJ("add",function(a){const s=t.CHM(e).index,l=t.oxw();return t.KtG(l.addOption(s,a.name))})("remove",function(a){const s=t.CHM(e).index,l=t.oxw();return t.KtG(l.removeOption(s,a))}),t.qZA()(),t.TgZ(8,"div")(9,"button",17),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.removeOptionGroup(r))}),t._UZ(10,"clr-icon",18),t.qZA()()()}if(2&o){const e=n.$implicit;t.xp6(1),t.Q6J("label",t.lcZ(2,7,"catalog.option")),t.xp6(2),t.Q6J("ngModel",e.name)("readonly",!e.isNew),t.xp6(1),t.Q6J("label",t.lcZ(5,9,"catalog.option-values")),t.xp6(2),t.Q6J("options",e.values)("groupName",e.name)("disabled",""===e.name)}}function Un(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function Mn(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function Qn(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}function qn(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.name," ")}}function $n(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.sku," ")}}function Sn(o,n){if(1&o&&(t.TgZ(0,"vdr-chip",22),t._uU(1),t.qZA()),2&o){const e=n.ngIf,i=t.oxw(2).$implicit;t.Q6J("colorFrom",i.code),t.xp6(1),t.Oqu(e.name)}}function Yn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",23)(1,"ng-select",24),t.NdJ("change",function(a){t.CHM(e);const r=t.oxw().item,s=t.oxw().$implicit,l=t.oxw();return t.KtG(l.setOptionToAddToVariant(r.id,s.id,null==a?null:a.id))}),t.qZA(),t.TgZ(2,"button",25),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().item,r=t.oxw(2);return t.KtG(r.addOptionToVariant(a))}),t._UZ(3,"clr-icon",26),t.qZA()()}if(2&o){const e=t.oxw().item,i=t.oxw().$implicit,a=t.oxw();t.xp6(1),t.Q6J("items",i.options),t.xp6(1),t.ekj("primary",!(null==a.optionsToAddToVariant[e.id]||!a.optionsToAddToVariant[e.id][i.id])),t.Q6J("disabled",!(null!=a.optionsToAddToVariant[e.id]&&a.optionsToAddToVariant[e.id][i.id]))}}function Gn(o,n){if(1&o&&(t.YNc(0,Sn,2,2,"vdr-chip",20),t.YNc(1,Yn,4,4,"ng-template",null,21,t.W1O)),2&o){const e=n.item,i=t.MAs(2),a=t.oxw().$implicit,r=t.oxw();t.Q6J("ngIf",r.getOption(e,a.id))("ngIfElse",i)}}function En(o,n){if(1&o&&(t.TgZ(0,"vdr-dt2-column",19),t.YNc(1,Gn,3,2,"ng-template"),t.qZA()),2&o){const e=n.$implicit;t.Q6J("heading",e.name)}}function Bn(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeCurrency")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.price,e.currencyCode)," ")}}function jn(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeCurrency")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.priceWithTax,e.currencyCode)," ")}}function Rn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){const r=t.CHM(e).item,s=t.oxw();return t.KtG(s.deleteVariant(r))}),t._UZ(1,"clr-icon",28),t.qZA()}}class Hn{constructor(n){for(const e of Object.keys(n))this[e]=n[e]}}class Ct{constructor(n,e,i,a,r,s){this.route=n,this.dataService=e,this.productDetailService=i,this.notificationService=a,this.modalService=r,this.changeDetector=s,this.formValueChanged=!1,this.optionsChanged=!1,this.itemsPerPage=100,this.currentPage=1,this.searchTermControl=new d.NI(""),this.selectionManager=new c.ZE0({multiSelect:!0,itemsAreEqual:(l,u)=>l.id===u.id,additiveMode:!0}),this.optionsToAddToVariant={},this.refresh$=new Ut.x}ngOnInit(){this.languageCode=this.route.snapshot.paramMap.get("lang")||(0,c.kAh)(),this.dataService.settings.getActiveChannel().single$.subscribe(e=>{this.currencyCode=e.activeChannel.defaultCurrencyCode});const n=this.refresh$.pipe((0,C.w)(()=>this.dataService.product.getProductVariantsOptions(this.route.parent?.snapshot.paramMap.get("id")).mapSingle(e=>e.product)),(0,K.O)(this.route.snapshot.data.product));this.variants$=n.pipe((0,C.w)(e=>this.searchTermControl.valueChanges.pipe((0,K.O)(""),(0,h.U)(i=>i?e.variants.filter(a=>a.name.toLowerCase().includes(i.toLowerCase())):e.variants)))),this.optionGroups$=n.pipe((0,h.U)(e=>e.optionGroups)),this.totalItems$=this.variants$.pipe((0,h.U)(e=>e.length)),n.subscribe(e=>{this.product=e;const i=e.variants.map(r=>r.options.map(s=>s.id)).flat(),a=e.variants.map(r=>r.options.map(s=>s.groupId)).flat();this.optionGroups=e.optionGroups.map(r=>({id:r.id,isNew:!1,name:r.name,locked:a.includes(r.id),values:r.options.map(s=>({id:s.id,name:s.name,locked:i.includes(s.id)}))}))})}setItemsPerPage(n){this.itemsPerPage=n,this.currentPage=1}setPageNumber(n){this.currentPage=n}onFormChanged(n){this.formValueChanged=!0,n.enabled=!0}canDeactivate(){return!this.formValueChanged}addOptionGroup(){this.modalService.fromComponent(ht,{locals:{languageCode:this.languageCode}}).pipe((0,C.w)(n=>n?this.dataService.product.createProductOptionGroups(n).pipe((0,C.w)(({createProductOptionGroup:e})=>this.dataService.product.addOptionGroupToProduct({optionGroupId:e.id,productId:this.product.id}))):L.E)).subscribe(n=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"ProductOptionGroup"}),this.refresh$.next(),this.changeDetector.markForCheck()})}removeOptionGroup(n){const e=n.id,i=this.product.variants.filter(a=>a.options.map(r=>r.groupId).includes(e)).length;this.modalService.dialog({title:(0,p.J)("catalog.confirm-delete-product-option-group"),body:i?(0,p.J)("catalog.confirm-delete-product-option-group-body"):"",translationVars:{name:n.name,count:i},buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(a=>a?this.dataService.product.removeOptionGroupFromProduct({optionGroupId:e,productId:this.product.id,force:!0}):L.E)).subscribe(({removeOptionGroupFromProduct:a})=>{"Product"===a.__typename?(this.notificationService.success((0,p.J)("common.notify-delete-success"),{entity:"ProductOptionGroup"}),this.refresh$.next()):"ProductOptionInUseError"===a.__typename&&this.notificationService.error(a.message??"")})}addOption(n,e){const i=this.optionGroups[n];i&&i.id&&this.dataService.product.addOptionToGroup({productOptionGroupId:i.id,code:(0,j.U)(e,"-"),translations:[{name:e,languageCode:this.languageCode}]}).subscribe(({createProductOption:a})=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"ProductOption"}),this.refresh$.next()})}removeOption(n,{id:e,name:i}){const a=this.optionGroups[n];a&&this.modalService.dialog({title:(0,p.J)("catalog.confirm-delete-product-option"),translationVars:{name:i},buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(r=>r?this.dataService.product.deleteProductOption(e):L.E)).subscribe(({deleteProductOption:r})=>{r.result===c.PcR.DELETED?(this.notificationService.success((0,p.J)("common.notify-delete-success"),{entity:"ProductOption"}),a.values=a.values.filter(s=>s.id!==e),this.refresh$.next()):this.notificationService.error(r.message??"")})}setOptionToAddToVariant(n,e,i){this.optionsToAddToVariant[n]||(this.optionsToAddToVariant[n]={}),i?this.optionsToAddToVariant[n][e]=i:delete this.optionsToAddToVariant[n][e]}addOptionToVariant(n){this.dataService.product.updateProductVariants([{id:n.id,optionIds:[...n.options.map(e=>e.id),...Object.values(this.optionsToAddToVariant[n.id])]}]).subscribe(({updateProductVariants:e})=>{this.refresh$.next()})}deleteVariant(n){this.modalService.dialog({title:(0,p.J)("catalog.confirm-delete-product-variant"),translationVars:{name:n.name},buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(e=>e?this.productDetailService.deleteProductVariant(n.id,this.product.id):L.E)).subscribe(()=>{this.notificationService.success((0,p.J)("common.notify-delete-success"),{entity:"ProductVariant"}),this.refresh$.next()},e=>{this.notificationService.error((0,p.J)("common.notify-delete-error"),{entity:"ProductVariant"})})}createNewVariant(){this.modalService.fromComponent(vt,{locals:{product:this.product}}).pipe((0,C.w)(n=>n?this.dataService.product.createProductVariants([n]):L.E)).subscribe(n=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"ProductVariant"}),this.refresh$.next()})}getOption(n,e){return n.options.find(i=>i.groupId===e)}}Ct.\u0275fac=function(n){return new(n||Ct)(t.Y36(Z.gz),t.Y36(c.DoR),t.Y36(S),t.Y36(c.gqp),t.Y36(c.Z7U),t.Y36(t.sBO))},Ct.\u0275cmp=t.Xpm({type:Ct,selectors:[["vdr-product-variants-editor"]],decls:44,vars:55,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"button","mt-1",3,"click"],["shape","plus"],[3,"paddingX"],[1,"mx-3"],[1,"button",3,"click"],["id","manage-product-variant-list",3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault"],[3,"heading","optional"],[3,"heading",4,"ngFor","ngForOf"],[1,"option-groups"],[3,"label"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"flex-spacer",3,"label"],[3,"options","groupName","disabled","add","remove"],["optionValueInputComponent",""],[1,"button-small","mt-4",3,"click"],["shape","trash"],[3,"heading"],[3,"colorFrom",4,"ngIf","ngIfElse"],["selectOption",""],[3,"colorFrom"],[1,"flex","center"],["bindLabel","name","bindValue","id","appendTo","body",3,"items","change"],[1,"button-small","ml-1",3,"disabled","click"],["shape","floppy"],[1,"button-small",3,"click"],["shape","trash is-danger"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-card"),t.YNc(2,Vn,11,11,"div",0),t.TgZ(3,"button",1),t.NdJ("click",function(){return e.addOptionGroup()}),t._UZ(4,"clr-icon",2),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"vdr-card",3)(8,"div",4)(9,"button",5),t.NdJ("click",function(){return e.createNewVariant()}),t._UZ(10,"clr-icon",2),t._uU(11),t.ALo(12,"translate"),t.qZA()(),t.TgZ(13,"vdr-data-table-2",6),t.NdJ("pageChange",function(a){return e.setPageNumber(a)})("itemsPerPageChange",function(a){return e.setItemsPerPage(a)}),t.ALo(14,"async"),t.ALo(15,"async"),t._UZ(16,"vdr-dt2-search",7),t.ALo(17,"translate"),t.TgZ(18,"vdr-dt2-column",8),t.ALo(19,"translate"),t.YNc(20,Un,1,1,"ng-template"),t.qZA(),t.TgZ(21,"vdr-dt2-column",8),t.ALo(22,"translate"),t.YNc(23,Mn,2,4,"ng-template"),t.qZA(),t.TgZ(24,"vdr-dt2-column",8),t.ALo(25,"translate"),t.YNc(26,Qn,2,4,"ng-template"),t.qZA(),t.TgZ(27,"vdr-dt2-column",9),t.ALo(28,"translate"),t.YNc(29,qn,1,1,"ng-template"),t.qZA(),t.TgZ(30,"vdr-dt2-column",9),t.ALo(31,"translate"),t.YNc(32,$n,1,1,"ng-template"),t.qZA(),t.YNc(33,En,2,1,"vdr-dt2-column",10),t.ALo(34,"async"),t.TgZ(35,"vdr-dt2-column",8),t.ALo(36,"translate"),t.YNc(37,Bn,2,4,"ng-template"),t.qZA(),t.TgZ(38,"vdr-dt2-column",8),t.ALo(39,"translate"),t.YNc(40,jn,2,4,"ng-template"),t.qZA(),t.TgZ(41,"vdr-dt2-column",9),t.ALo(42,"translate"),t.YNc(43,Rn,2,0,"ng-template"),t.qZA()()()()),2&n&&(t.xp6(2),t.Q6J("ngForOf",e.optionGroups),t.xp6(3),t.hij(" ",t.lcZ(6,27,"catalog.create-product-option-group")," "),t.xp6(2),t.Q6J("paddingX",!1),t.xp6(4),t.hij(" ",t.lcZ(12,29,"catalog.create-product-variant")," "),t.xp6(2),t.Q6J("items",t.lcZ(14,31,e.variants$))("itemsPerPage",e.itemsPerPage)("totalItems",t.lcZ(15,33,e.totalItems$))("currentPage",e.currentPage),t.xp6(3),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(17,35,"catalog.filter-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(19,37,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(22,39,"common.created-at"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(25,41,"common.updated-at"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(28,43,"catalog.name"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(31,45,"catalog.sku"))("optional",!1),t.xp6(3),t.Q6J("ngForOf",t.lcZ(34,47,e.optionGroups$)),t.xp6(2),t.Q6J("heading",t.lcZ(36,49,"common.price"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(39,51,"common.price-with-tax"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(42,53,"common.delete"))("optional",!1))},dependencies:[f.qvL,f.xRP,_.sg,_.O5,d.Fj,d.JJ,d.On,oe.w9,z.Y,M.h,F.y,mt.e,H.U,it.J,O.z,gt.A,W,_.Ov,b.X$,nt.H,ie.k],styles:[".option-groups[_ngcontent-%COMP%]{display:flex;width:100%;gap:var(--space-unit)}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});class xt extends c.p_9{constructor(n,e){super(n,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",languageCode:"",optionGroups:[],variants:[]},i=>e.product.getProductVariantsOptions(i).mapStream(a=>a.product))}}xt.\u0275fac=function(n){return new(n||xt)(t.LFG(Z.F0),t.LFG(c.DoR))},xt.\u0275prov=t.Yz7({token:xt,factory:xt.\u0275fac,providedIn:"root"});const Ze=o=>[{path:"inventory",component:c.IIO,data:{locationId:"product-list",breadcrumb:(0,p.J)("breadcrumb.inventory")},children:o.getPageTabRoutes("product-list")},{path:"inventory/:id",component:c.IIO,data:{locationId:"product-detail",breadcrumb:{label:(0,p.J)("breadcrumb.inventory"),link:["../","inventory"]}},children:[{path:"manage-variants",component:Ct,canDeactivate:[c.TSp],data:{breadcrumb:({product:n})=>[{label:`${n.name}`,link:["../"]},{label:(0,p.J)("breadcrumb.manage-variants"),link:["manage-variants"]}]},resolve:{product:n=>(0,t.f3M)(c.DoR).product.getProductVariantsOptions(n.parent?.params.id).mapSingle(e=>e.product)}},...o.getPageTabRoutes("product-detail")]},{path:"inventory/:productId/variants/:id",component:c.IIO,data:{locationId:"product-variant-detail",breadcrumb:{label:(0,p.J)("breadcrumb.inventory"),link:["../","inventory"]}},children:o.getPageTabRoutes("product-variant-detail")},{path:"inventory/:id/options",component:_t,resolve:(0,c.Po4)(xt),canDeactivate:[c.TSp],data:{breadcrumb:Ae}},{path:"inventory/stock-locations/:id",component:c.IIO,data:{locationId:"stock-location-detail",breadcrumb:[{label:(0,p.J)("breadcrumb.inventory"),link:["../","inventory"]},{label:(0,p.J)("breadcrumb.stock-locations"),link:["../","inventory","stock-locations"]}]},children:o.getPageTabRoutes("stock-location-detail")},{path:"facets",component:c.IIO,data:{locationId:"facet-list",breadcrumb:(0,p.J)("breadcrumb.facets")},children:o.getPageTabRoutes("facet-list")},{path:"facets/:id",component:c.IIO,data:{locationId:"facet-detail",breadcrumb:{label:(0,p.J)("breadcrumb.facets"),link:["../","facets"]}},children:o.getPageTabRoutes("facet-detail")},{path:"collections",component:c.IIO,data:{locationId:"collection-list",breadcrumb:(0,p.J)("breadcrumb.collections")},children:o.getPageTabRoutes("collection-list")},{path:"collections/:id",component:c.IIO,data:{locationId:"collection-detail",breadcrumb:{label:(0,p.J)("breadcrumb.collections"),link:["../","collections"]}},children:o.getPageTabRoutes("collection-detail")},{path:"assets",component:c.IIO,data:{locationId:"asset-list",breadcrumb:(0,p.J)("breadcrumb.assets")},children:o.getPageTabRoutes("asset-list")},{path:"assets/:id",component:c.IIO,data:{locationId:"asset-detail",breadcrumb:{label:(0,p.J)("breadcrumb.assets"),link:["../","assets"]}},children:o.getPageTabRoutes("asset-detail")}];function Ae(o,n){return o.entity.pipe((0,h.U)(e=>[{label:(0,p.J)("breadcrumb.inventory"),link:["../","inventory"]},{label:`${e.name}`,link:["../","inventory",n.id]},{label:(0,p.J)("breadcrumb.product-options"),link:["options"]}]))}var Pe=m(5314);function Kn(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.Oqu(t.lcZ(1,1,"catalog.add-facets"))}function zn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",4),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectValues())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,3,"common.cancel")),t.xp6(2),t.Q6J("disabled",0===e.selectedValues.length),t.xp6(1),t.hij(" ",t.lcZ(5,5,"catalog.add-facets")," ")}}class at{constructor(n){this.changeDetector=n,this.selectedValues=[]}ngAfterViewInit(){setTimeout(()=>this.selector.focus(),0)}selectValues(){this.resolveWith(this.selectedValues)}cancel(){this.resolveWith()}}at.\u0275fac=function(n){return new(n||at)(t.Y36(t.sBO))},at.\u0275cmp=t.Xpm({type:at,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(n,e){if(1&n&&t.Gf(c.$MF,5),2&n){let i;t.iGM(i=t.CRH())&&(e.selector=i.first)}},decls:3,vars:0,consts:[["vdrDialogTitle",""],[3,"selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){1&n&&(t.YNc(0,Kn,2,3,"ng-template",0),t.TgZ(1,"vdr-facet-value-selector",1),t.NdJ("selectedValuesChange",function(a){return e.selectedValues=a}),t.qZA(),t.YNc(2,zn,6,7,"ng-template",2))},dependencies:[Pe.$,ft.n,ot.q,b.X$],changeDetection:0});var A=m(7698),Wn=m(4844),G=m(4753);function Xn(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}const to=function(){return["UpdateCatalog","UpdateAsset"]},eo=A.Ps`
    query AssetDetailQuery($id: ID!) {
        asset(id: $id) {
            ...Asset
            tags {
                ...Tag
            }
        }
    }
    ${c.fed}
    ${c.i4$}
`;class bt extends c.VE7{constructor(n,e,i){super(),this.notificationService=n,this.dataService=e,this.formBuilder=i,this.customFields=this.getCustomFieldConfig("Asset"),this.detailForm=new d.cw({name:new d.NI(""),tags:new d.NI([]),customFields:this.formBuilder.group(this.customFields.reduce((a,r)=>({...a,[r.name]:""}),{}))})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}onAssetChange(n){this.detailForm.get("name")?.setValue(n.name),this.detailForm.get("tags")?.setValue(n.tags),this.detailForm.markAsDirty()}save(){this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"Asset"})},n=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"Asset"})})}setFormValues(n,e){this.detailForm.get("name")?.setValue(n.name),this.detailForm.get("tags")?.setValue(n.tags.map(i=>i.id)),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),n)}}bt.\u0275fac=function(n){return new(n||bt)(t.Y36(c.gqp),t.Y36(c.DoR),t.Y36(d.QS))},bt.\u0275cmp=t.Xpm({type:bt,selectors:[["vdr-asset-detail"]],features:[t.qOj],decls:9,vars:8,consts:[["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),t._UZ(2,"vdr-ab-left"),t.TgZ(3,"vdr-ab-right"),t._UZ(4,"vdr-action-bar-items",0),t.YNc(5,Xn,3,4,"button",1),t.qZA()()(),t.TgZ(6,"vdr-page-block")(7,"vdr-asset-preview",2),t.NdJ("assetChange",function(a){return e.onAssetChange(a)}),t.ALo(8,"async"),t.qZA()()),2&n&&(t.xp6(5),t.Q6J("vdrIfPermissions",t.DdM(7,to)),t.xp6(2),t.Q6J("asset",t.lcZ(8,5,e.entity$))("editable",!0)("customFields",e.customFields)("customFieldsForm",e.detailForm.get("customFields")))},dependencies:[x.Kk,x.BN,x.mz,Wn.A,J.H,G.W,O.z,_.Ov,b.X$],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0});var Q=m(4400),Mt=m(4144),ae=m(4467),ye=m(333),no=m(2013),Fe=m(1479),Le=m(8573),oo=m(7559),io=m(8030),de=m(6542);const ao=function(){return{}},ro=function(){return["DeleteCatalog","DeleteAsset"]};class Tt extends c.t7C{constructor(n,e,i,a,r){super(a,r),this.notificationService=n,this.modalService=e,this.dataService=i,this.searchTerm$=new Q.X(void 0),this.filterByTags$=new Q.X(void 0),this.uploading=!1,super.setQueryFn((...s)=>this.dataService.product.getAssetList(...s).refetchOnChannelChange(),s=>s.assets,(s,l)=>{const u=this.searchTerm$.value,g=this.filterByTags$.value?.map(v=>v.value);return{options:{skip:s,take:l,...u?{filter:{name:{contains:u}}}:{},sort:{createdAt:c.Asd.DESC},tags:g,tagsOperator:c.FnJ.AND}}},{take:25,skip:0})}ngOnInit(){super.ngOnInit(),this.paginationConfig$=(0,y.a)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe((0,h.U)(([n,e,i])=>({itemsPerPage:n,currentPage:e,totalItems:i}))),this.searchTerm$.pipe((0,Mt.b)(250),(0,ae.R)(this.destroy$)).subscribe(()=>this.refresh()),this.filterByTags$.pipe((0,ae.R)(this.destroy$)).subscribe(()=>this.refresh()),this.allTags$=this.dataService.product.getTagList().mapStream(n=>n.tags.items)}filesSelected(n){n.length&&(this.uploading=!0,this.dataService.product.createAssets(n).pipe((0,ye.x)(()=>this.uploading=!1)).subscribe(({createAssets:e})=>{let i=0;for(const a of e)switch(a.__typename){case"Asset":i++;break;case"MimeTypeError":this.notificationService.error(a.message)}0<i&&(super.refresh(),this.notificationService.success((0,p.J)("asset.notify-create-assets-success"),{count:i}))}))}deleteAssets(n){this.showModalAndDelete(n.map(e=>e.id)).pipe((0,C.w)(e=>e.result===c.PcR.DELETED?[!0]:this.showModalAndDelete(n.map(i=>i.id),e.message||"").pipe((0,h.U)(i=>i.result===c.PcR.DELETED)))).subscribe(()=>{this.notificationService.success((0,p.J)("common.notify-delete-success"),{entity:"Assets"}),this.refresh()},e=>{this.notificationService.error((0,p.J)("common.notify-delete-error"),{entity:"Assets"})})}showModalAndDelete(n,e){return this.modalService.dialog({title:(0,p.J)("catalog.confirm-delete-assets"),translationVars:{count:n.length},body:e,buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(i=>i?this.dataService.product.deleteAssets(n,!!e):L.E),(0,h.U)(i=>i.deleteAssets))}}Tt.\u0275fac=function(n){return new(n||Tt)(t.Y36(c.gqp),t.Y36(c.Z7U),t.Y36(c.DoR),t.Y36(Z.F0),t.Y36(Z.gz))},Tt.\u0275cmp=t.Xpm({type:Tt,selectors:[["vdr-asset-list"]],features:[t.qOj],decls:17,vars:30,consts:[[1,"my-2"],[3,"tags","searchTermChange","tagsChange"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"div",0)(2,"vdr-asset-search-input",1),t.NdJ("searchTermChange",function(a){return e.searchTerm$.next(a)})("tagsChange",function(a){return e.filterByTags$.next(a)}),t.ALo(3,"async"),t.TgZ(4,"vdr-asset-file-input",2),t.NdJ("selectFiles",function(a){return e.filesSelected(a)}),t.qZA()()(),t.TgZ(5,"vdr-asset-gallery",3),t.NdJ("deleteAssets",function(a){return e.deleteAssets(a)}),t.ALo(6,"paginate"),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"hasPermission"),t.qZA(),t.TgZ(10,"div",4)(11,"vdr-items-per-page-controls",5),t.NdJ("itemsPerPageChange",function(a){return e.setItemsPerPage(a)}),t.ALo(12,"async"),t.qZA(),t.TgZ(13,"vdr-pagination-controls",6),t.NdJ("pageChange",function(a){return e.setPageNumber(a)}),t.ALo(14,"async"),t.ALo(15,"async"),t.ALo(16,"async"),t.qZA()()()),2&n&&(t.xp6(2),t.Q6J("tags",t.lcZ(3,9,e.allTags$)),t.xp6(2),t.Q6J("uploading",e.uploading),t.xp6(1),t.Q6J("assets",t.xi3(6,11,t.lcZ(7,14,e.items$),t.lcZ(8,16,e.paginationConfig$)||t.DdM(28,ao)))("multiSelect",!0)("canDelete",t.lcZ(9,18,t.DdM(29,ro))),t.xp6(6),t.Q6J("itemsPerPage",t.lcZ(12,20,e.itemsPerPage$)),t.xp6(2),t.Q6J("currentPage",t.lcZ(14,22,e.currentPage$))("itemsPerPage",t.lcZ(15,24,e.itemsPerPage$))("totalItems",t.lcZ(16,26,e.totalItems$)))},dependencies:[no.V,Fe.w,Le.L,oo.e,io.K,O.z,_.Ov,de._s,Y.j],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});var k=m(9119),Qt=m(9014),qt=m(433),$t=m(8308),St=m(9182),re=m(2533);function co(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"img",10),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.previewAsset(a.featuredAsset))}),t.ALo(1,"assetPreview"),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("src",t.xi3(1,1,e.featuredAsset,"small"),t.LSH)}}function so(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",11),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectAssets())}),t._UZ(1,"clr-icon",12),t.TgZ(2,"div"),t._uU(3),t.ALo(4,"translate"),t.qZA()()}2&o&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"catalog.no-featured-asset")))}function lo(o,n){1&o&&t.GkF(0)}function po(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"button",13),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectAssets())}),t._UZ(2,"clr-icon",14),t._uU(3),t.ALo(4,"translate"),t.qZA()()}2&o&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"asset.add-asset")," "))}function uo(o,n){if(1&o&&(t.TgZ(0,"div",3)(1,"div",4),t.YNc(2,co,2,4,"img",5),t.YNc(3,so,5,3,"div",6),t.qZA(),t.TgZ(4,"div",7),t.YNc(5,lo,1,0,"ng-container",8),t.YNc(6,po,5,3,"div",9),t.qZA()()),2&o){const e=t.oxw(),i=t.MAs(4);t.xp6(2),t.Q6J("ngIf",e.featuredAsset),t.xp6(1),t.Q6J("ngIf",!e.featuredAsset),t.xp6(2),t.Q6J("ngTemplateOutlet",i),t.xp6(1),t.Q6J("vdrIfPermissions",e.updatePermissions)}}function mo(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"img",10),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.previewAsset(a.featuredAsset))}),t.ALo(1,"assetPreview"),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("src",t.xi3(1,1,e.featuredAsset,"thumb"),t.LSH)}}function go(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",11),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectAssets())}),t._UZ(1,"clr-icon",17),t.qZA()}}function _o(o,n){1&o&&t.GkF(0)}function fo(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectAssets())}),t.ALo(1,"translate"),t._UZ(2,"clr-icon",14),t._uU(3),t.ALo(4,"translate"),t.qZA()}2&o&&(t.Q6J("title",t.lcZ(1,2,"asset.add-asset")),t.xp6(3),t.hij(" ",t.lcZ(4,4,"asset.add-asset")," "))}function ho(o,n){if(1&o&&(t.TgZ(0,"div",15),t.YNc(1,mo,2,4,"img",5),t.YNc(2,go,2,0,"div",6),t.qZA(),t.YNc(3,_o,1,0,"ng-container",8),t.YNc(4,fo,5,6,"button",16)),2&o){const e=t.oxw(),i=t.MAs(4);t.xp6(1),t.Q6J("ngIf",e.featuredAsset),t.xp6(1),t.Q6J("ngIf",!e.featuredAsset),t.xp6(1),t.Q6J("ngTemplateOutlet",i),t.xp6(1),t.Q6J("vdrIfPermissions",e.updatePermissions)}}function vo(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",21),t.NdJ("cdkDropListDropped",function(a){t.CHM(e);const r=t.oxw(2);return t.KtG(r.dropListDropped(a))}),t.ALo(1,"hasPermission"),t.TgZ(2,"vdr-dropdown",22)(3,"div",23),t._UZ(4,"img",24),t.ALo(5,"assetPreview"),t.qZA(),t.TgZ(6,"vdr-dropdown-menu",25)(7,"button",26),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.previewAsset(r))}),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"button",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.setAsFeatured(r))}),t.ALo(11,"hasPermission"),t._uU(12),t.ALo(13,"translate"),t.qZA(),t._UZ(14,"div",28),t.TgZ(15,"button",29),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.removeAsset(r))}),t.ALo(16,"hasPermission"),t._uU(17),t.ALo(18,"translate"),t.qZA()()()()}if(2&o){const e=n.$implicit,i=n.index,a=t.oxw(2);t.Q6J("cdkDropListData",i)("cdkDropListDisabled",!t.lcZ(1,10,a.updatePermissions)),t.xp6(3),t.ekj("featured",a.isFeatured(e)),t.xp6(1),t.Q6J("src",t.xi3(5,12,e,"tiny"),t.LSH),t.xp6(4),t.hij(" ",t.lcZ(9,15,"asset.preview")," "),t.xp6(2),t.Q6J("disabled",a.isFeatured(e)||!t.lcZ(11,17,a.updatePermissions)),t.xp6(2),t.hij(" ",t.lcZ(13,19,"asset.set-as-featured-asset")," "),t.xp6(3),t.Q6J("disabled",!t.lcZ(16,21,a.updatePermissions)),t.xp6(2),t.hij(" ",t.lcZ(18,23,"asset.remove-asset")," ")}}function Co(o,n){if(1&o&&(t.TgZ(0,"div",19),t.YNc(1,vo,19,25,"div",20),t.qZA()),2&o){const e=t.oxw();t.ekj("compact",e.compact),t.xp6(1),t.Q6J("ngForOf",e.assets)}}class X{set assetsSetter(n){this.assets=(n||[]).slice()}constructor(n,e){this.modalService=n,this.changeDetector=e,this.compact=!1,this.change=new t.vpe,this.assets=[]}selectAssets(){this.modalService.fromComponent(c.V61,{size:"xl"}).subscribe(n=>{n&&n.length&&(this.assets=(0,V.T)(this.assets.concat(n),"id"),this.featuredAsset||(this.featuredAsset=n[0]),this.emitChangeEvent(this.assets,this.featuredAsset),this.changeDetector.markForCheck())})}setAsFeatured(n){this.featuredAsset=n,this.emitChangeEvent(this.assets,n)}isFeatured(n){return!!this.featuredAsset&&this.featuredAsset.id===n.id}previewAsset(n){this.modalService.fromComponent(c.IW,{size:"xl",closable:!0,locals:{asset:n}}).subscribe()}removeAsset(n){this.assets=this.assets.filter(e=>e.id!==n.id),this.featuredAsset&&this.featuredAsset.id===n.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}emitChangeEvent(n,e){this.change.emit({assets:n,featuredAsset:e})}dropListDropped(n){(0,k.bA)(this.assets,n.previousContainer.data,n.container.data),this.emitChangeEvent(this.assets,this.featuredAsset)}}X.\u0275fac=function(n){return new(n||X)(t.Y36(c.Z7U),t.Y36(t.sBO))},X.\u0275cmp=t.Xpm({type:X,selectors:[["vdr-assets"]],hostVars:2,hostBindings:function(n,e){2&n&&t.ekj("compact",e.compact)},inputs:{assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset",compact:"compact",updatePermissions:"updatePermissions"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","standard-view-container",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"standard-view-container"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"all-assets-container"],[4,"ngTemplateOutlet"],[4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["class","drop-list","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"drop-list",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["cdkDrag",""],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(n,e){if(1&n&&(t.YNc(0,uo,7,4,"div",0),t.YNc(1,ho,5,4,"ng-template",null,1,t.W1O),t.YNc(3,Co,2,3,"ng-template",null,2,t.W1O)),2&n){const i=t.MAs(2);t.Q6J("ngIf",!e.compact)("ngIfElse",i)}},dependencies:[f.qvL,_.sg,_.O5,_.tP,k.Wj,k.Fd,k.Zt,Qt.J,qt.N,$t.U,St.H,J.H,b.X$,Y.j,re.M],styles:["[_nghost-%COMP%]{display:block;container-type:inline-size}.compact[_nghost-%COMP%]{width:162px}.standard-view-container[_ngcontent-%COMP%]{display:flex;gap:calc(var(--space-unit) * 2)}.all-assets-container[_ngcontent-%COMP%]{display:flex;max-width:50%;flex-direction:column;justify-content:space-between}@container (max-width: 500px){.standard-view-container[_ngcontent-%COMP%]{flex-direction:column}.all-assets-container[_ngcontent-%COMP%]{max-width:100%}}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer;border-radius:var(--border-radius-img)}.featured-asset[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img);max-height:400px;max-width:100%;object-fit:contain}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:60px}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);border-radius:var(--border-radius-img);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:var(--border-radius-img)}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500);border-radius:calc(var(--border-radius-img) + 2px)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:54px}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%], .all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){display:none}"],changeDetection:0});var xo=m(5368),pe=m(2645),Ie=m(2257),bo=m(3027),ke=m(5734);function To(o,n){1&o&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"catalog.assign-variants-to-channel")))}function Zo(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.Oqu(t.lcZ(1,1,"catalog.assign-products-to-channel"))}function Ao(o,n){if(1&o&&(t.YNc(0,To,3,3,"ng-container",12),t.YNc(1,Zo,2,3,"ng-template",null,13,t.W1O)),2&o){const e=t.MAs(2),i=t.oxw();t.Q6J("ngIf",i.isProductVariantMode)("ngIfElse",e)}}const Oe=function(o){return{channel:o}};function Po(o,n){if(1&o&&(t._uU(0),t.ALo(1,"translate")),2&o){const e=t.oxw();t.hij(" ",t.xi3(1,1,"catalog.price-in-channel",t.VKq(4,Oe,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function yo(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.no-channel-selected")," ")}function Fo(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeCurrency")),2&o){const e=t.oxw().$implicit,i=t.oxw();t.hij(" ",t.xi3(1,1,e.pricePreview,null==i.selectedChannel?null:i.selectedChannel.defaultCurrencyCode)," ")}}function Lo(o,n){1&o&&t._uU(0," - ")}function Io(o,n){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"localeCurrency"),t.qZA(),t.TgZ(6,"td"),t.YNc(7,Fo,2,4,"ng-template",8),t.YNc(8,Lo,1,0,"ng-template",null,14,t.W1O),t.qZA()()),2&o){const e=n.$implicit,i=t.MAs(9),a=t.oxw();t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(t.xi3(5,4,e.price,null==a.currentChannel?null:a.currentChannel.defaultCurrencyCode)),t.xp6(3),t.Q6J("ngIf",a.selectedChannel)("ngIfElse",i)}}const ko=function(o){return{channelCode:o}};function Oo(o,n){if(1&o&&(t._uU(0),t.ALo(1,"translate")),2&o){const e=t.oxw(2);t.hij(" ",t.xi3(1,1,"catalog.assign-to-named-channel",t.VKq(4,ko,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function Jo(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.no-channel-selected")," ")}function Do(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",16),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.assign())}),t.YNc(4,Oo,2,6,"ng-template",8),t.YNc(5,Jo,2,3,"ng-template",null,9,t.W1O),t.qZA()}if(2&o){const e=t.MAs(6),i=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,4,"common.cancel")),t.xp6(2),t.Q6J("disabled",!i.selectedChannel),t.xp6(1),t.Q6J("ngIf",i.selectedChannel)("ngIfElse",e)}}class E{get isProductVariantMode(){return null!=this.productVariantIds}constructor(n,e){this.dataService=n,this.notificationService=e,this.priceFactorControl=new d.p4(1),this.selectedChannelIdControl=new d.p4}ngOnInit(){const n=this.dataService.client.userStatus().mapSingle(({userStatus:i})=>i.activeChannelId),e=this.dataService.settings.getChannels().mapSingle(i=>i.channels);(0,y.a)(n,e).subscribe(([i,a])=>{this.currentChannel=a.items.find(r=>r.id===i),this.availableChannels=a.items}),this.selectedChannelIdControl.valueChanges.subscribe(i=>{this.selectChannel(i)}),this.variantsPreview$=(0,y.a)((0,pe.D)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe((0,K.O)(1))).pipe((0,h.U)(([i,a])=>i.map(r=>({id:r.id,name:r.name,price:r.price,pricePreview:r.price*+a}))))}selectChannel(n){this.selectedChannel=this.availableChannels.find(e=>e.id===n[0])}assign(){const n=this.selectedChannel;n&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:n.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success((0,p.J)("catalog.assign-variant-to-channel-success"),{channel:n.code,count:this.productVariantIds.length}),this.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:n.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success((0,p.J)("catalog.assign-product-to-channel-success"),{channel:n.code,count:this.productIds.length}),this.resolveWith(!0)}))}cancel(){this.resolveWith()}getTopVariants(n){var e=this;return(0,xo.Z)(function*(){return(yield(0,Ie.n)(e.dataService.product.getProductVariants({filterOperator:c.FnJ.OR,filter:{productId:{in:e.productIds},id:{in:e.productVariantIds}},take:n}).single$)).productVariants.items})()}}E.\u0275fac=function(n){return new(n||E)(t.Y36(c.DoR),t.Y36(c.gqp))},E.\u0275cmp=t.Xpm({type:E,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){if(1&n&&(t.YNc(0,Ao,3,2,"ng-template",0),t.TgZ(1,"div",1)(2,"clr-input-container")(3,"label"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"vdr-channel-assignment-control",2),t.qZA(),t._UZ(7,"div",3),t.TgZ(8,"clr-input-container")(9,"label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t._UZ(12,"input",4),t.qZA()(),t.TgZ(13,"div",5)(14,"label",6),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"table",7)(18,"thead")(19,"tr")(20,"th"),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.TgZ(23,"th"),t._uU(24),t.ALo(25,"translate"),t.ALo(26,"translate"),t.ALo(27,"channelCodeToLabel"),t.qZA(),t.TgZ(28,"th"),t.YNc(29,Po,2,6,"ng-template",8),t.YNc(30,yo,2,3,"ng-template",null,9,t.W1O),t.qZA()()(),t.TgZ(32,"tbody"),t.YNc(33,Io,10,7,"tr",10),t.ALo(34,"async"),t.qZA()()(),t.YNc(35,Do,7,6,"ng-template",11)),2&n){const i=t.MAs(31);t.xp6(4),t.Oqu(t.lcZ(5,13,"common.channel")),t.xp6(2),t.Q6J("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",e.currentChannelIds)("formControl",e.selectedChannelIdControl),t.xp6(4),t.Oqu(t.lcZ(11,15,"catalog.price-conversion-factor")),t.xp6(2),t.Q6J("formControl",e.priceFactorControl),t.xp6(3),t.Oqu(t.lcZ(16,17,"catalog.channel-price-preview")),t.xp6(6),t.Oqu(t.lcZ(22,19,"common.name")),t.xp6(3),t.hij(" ",t.xi3(25,21,"catalog.price-in-channel",t.VKq(30,Oe,t.lcZ(26,24,t.lcZ(27,26,null==e.currentChannel?null:e.currentChannel.code))))," "),t.xp6(5),t.Q6J("ngIf",e.selectedChannel)("ngIfElse",i),t.xp6(4),t.Q6J("ngForOf",t.lcZ(34,28,e.variantsPreview$))}},dependencies:[f.MgK,f.xRP,f.G55,_.sg,_.O5,d.Fj,d.wV,d.JJ,d.qQ,d.Fd,d.oH,F.y,ft.n,ot.q,bo.S,_.Ov,b.X$,ke.E,ie.k],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0});const Je=A.Ps`
    query GetProductsWithFacetValuesByIds($ids: [String!]!) {
        products(options: { filter: { id: { in: $ids } } }) {
            items {
                id
                name
                facetValues {
                    id
                    name
                    code
                    facet {
                        id
                        name
                        code
                    }
                }
            }
        }
    }
`,De=A.Ps`
    query GetVariantsWithFacetValuesByIds($ids: [String!]!) {
        productVariants(options: { filter: { id: { in: $ids } } }) {
            items {
                id
                name
                sku
                facetValues {
                    id
                    name
                    code
                    facet {
                        id
                        name
                        code
                    }
                }
            }
        }
    }
`,we=A.Ps`
    mutation UpdateProductsBulk($input: [UpdateProductInput!]!) {
        updateProducts(input: $input) {
            id
            name
            facetValues {
                id
                name
                code
            }
        }
    }
`,Ne=A.Ps`
    mutation UpdateVariantsBulk($input: [UpdateProductVariantInput!]!) {
        updateProductVariants(input: $input) {
            id
            name
            facetValues {
                id
                name
                code
            }
        }
    }
`;var ce=m(1107);function wo(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.edit-facet-values"),"\n")}function No(o,n){if(1&o&&(t.TgZ(0,"div",14),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.sku)}}function Vo(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-facet-value-chip",15),t.NdJ("remove",function(){const r=t.CHM(e).$implicit,s=t.oxw().$implicit,l=t.oxw(2);return t.KtG(l.removeFacetValue(s,r.id))}),t.qZA()}if(2&o){const e=n.$implicit;t.Q6J("facetValue",e)}}function Uo(o,n){if(1&o&&(t.TgZ(0,"tr")(1,"td",10)(2,"div"),t._uU(3),t.qZA(),t.YNc(4,No,2,1,"div",11),t.qZA(),t.TgZ(5,"td",12),t.YNc(6,Vo,1,1,"vdr-facet-value-chip",13),t.qZA()()),2&o){const e=n.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(1),t.Q6J("ngIf",e.sku),t.xp6(2),t.Q6J("ngForOf",e.facetValues)}}function Mo(o,n){if(1&o&&(t.TgZ(0,"table",8)(1,"tbody"),t.YNc(2,Uo,7,3,"tr",9),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.items)}}function Qo(o,n){1&o&&(t.TgZ(0,"div",16),t._UZ(1,"clr-spinner"),t.qZA())}function qo(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",18),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.addFacetValues())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,3,"common.cancel")),t.xp6(2),t.Q6J("disabled",0===e.selectedValues.length&&!1===e.facetValuesRemoved),t.xp6(1),t.hij(" ",t.lcZ(5,5,"common.update")," ")}}class Zt{constructor(n,e){this.dataService=n,this.changeDetectorRef=e,this.mode="product",this.state="loading",this.selectedValues=[],this.items=[],this.facetValuesRemoved=!1}ngOnInit(){const n="product"===this.mode?this.dataService.query(Je,{ids:this.ids??[]}).mapSingle(({products:e})=>e.items.map(i=>({...i,facetValues:[...i.facetValues]}))):this.dataService.query(De,{ids:this.ids??[]}).mapSingle(({productVariants:e})=>e.items.map(i=>({...i,facetValues:[...i.facetValues]})));this.subscription=n.subscribe({next:e=>{this.items=e,this.state="ready",this.changeDetectorRef.markForCheck()}})}ngOnDestroy(){this.subscription?.unsubscribe()}cancel(){this.resolveWith()}removeFacetValue(n,e){n.facetValues=n.facetValues.filter(i=>i.id!==e),this.facetValuesRemoved=!0}addFacetValues(){const n=this.selectedValues.map(i=>i.id);return this.state="saving",("product"===this.mode?this.dataService.mutate(we,{input:this.items?.map(i=>({id:i.id,facetValueIds:(0,V.T)([...i.facetValues.map(a=>a.id),...n])}))}):this.dataService.mutate(Ne,{input:this.items?.map(i=>({id:i.id,facetValueIds:(0,V.T)([...i.facetValues.map(a=>a.id),...n])}))})).subscribe(i=>{this.resolveWith(this.selectedValues)})}}Zt.\u0275fac=function(n){return new(n||Zt)(t.Y36(c.DoR),t.Y36(t.sBO))},Zt.\u0275cmp=t.Xpm({type:Zt,selectors:[["vdr-bulk-add-facet-values-dialog"]],decls:11,vars:5,consts:[["vdrDialogTitle",""],[1,"flex"],[1,"flex","center"],[1,"mr2"],[3,"selectedValuesChange"],["class","table",4,"ngIf","ngIfElse"],["placeholder",""],["vdrDialogButtons",""],[1,"table"],[4,"ngFor","ngForOf"],[1,"left","align-middle"],["class","sku",4,"ngIf"],[1,"left"],[3,"facetValue","remove",4,"ngFor","ngForOf"],[1,"sku"],[3,"facetValue","remove"],[1,"loading"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){if(1&n&&(t.YNc(0,wo,2,3,"ng-template",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"vdr-facet-value-selector",4),t.NdJ("selectedValuesChange",function(a){return e.selectedValues=a}),t.qZA()()(),t.YNc(7,Mo,3,1,"table",5),t.YNc(8,Qo,2,0,"ng-template",null,6,t.W1O),t.YNc(10,qo,6,7,"ng-template",7)),2&n){const i=t.MAs(9);t.xp6(4),t.hij(" ",t.lcZ(5,3,"catalog.add-facet-value")," "),t.xp6(3),t.Q6J("ngIf","loading"!==e.state)("ngIfElse",i)}},dependencies:[f.vNO,_.sg,_.O5,Pe.$,ce.q,ft.n,ot.q,b.X$],styles:[".loading[_ngcontent-%COMP%]{min-height:25vh;display:flex;justify-content:center;align-items:center}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"],changeDetection:0});var U=m(536),ue=m(5038),$o=m(1196);function So(o,n){1&o&&t.GkF(0)}function Yo(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function Go(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function Eo(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}const Bo=function(o){return["/catalog/inventory",o]};function jo(o,n){if(1&o&&(t.TgZ(0,"a",8)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",9),t.qZA()),2&o){const e=n.item;t.Q6J("routerLink",t.VKq(2,Bo,e.productId)),t.xp6(2),t.Oqu(e.name)}}function Ro(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.sku," ")}}const Ho=function(o){return{$implicit:o}};class rt{constructor(n,e,i){this.route=n,this.router=e,this.dataService=i,this.previewUpdatedFilters=!1,this.filterTermControl=new d.p4(""),this.isLoading=!1,this.collectionIdChange$=new Q.X(""),this.parentIdChange$=new Q.X(""),this.filterChanges$=new Q.X([]),this.inheritFiltersChanges$=new Q.X(!0),this.refresh$=new Q.X(!0),this.destroy$=new Ut.x}ngOnInit(){this.contentsCurrentPage$=this.route.queryParamMap.pipe((0,h.U)(s=>s.get("contentsPage")),(0,h.U)(s=>s?+s:1),(0,K.O)(1),(0,U.x)()),this.contentsItemsPerPage$=this.route.queryParamMap.pipe((0,h.U)(s=>s.get("contentsPerPage")),(0,h.U)(s=>s?+s:10),(0,K.O)(10),(0,U.x)());const n=this.filterTermControl.valueChanges.pipe((0,Mt.b)(250),(0,B.b)(()=>this.setContentsPageNumber(1)),(0,K.O)("")),e=this.filterChanges$.asObservable().pipe((0,ue.h)(()=>this.previewUpdatedFilters),(0,B.b)(()=>this.setContentsPageNumber(1)),(0,K.O)([])),i=this.inheritFiltersChanges$.asObservable().pipe((0,ue.h)(()=>null!=this.inheritFilters),(0,U.x)(),(0,B.b)(()=>this.setContentsPageNumber(1)),(0,K.O)(!0)),r=(0,y.a)(this.collectionIdChange$,this.parentIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,n,e,i,this.refresh$).pipe((0,ae.R)(this.destroy$),(0,B.b)(()=>this.isLoading=!0),(0,Mt.b)(50),(0,C.w)(([s,l,u,g,v,T,P])=>{const I=g,q=(u-1)*g;if(T.length&&this.previewUpdatedFilters){const D=v?{name:{contains:v}}:void 0;return this.dataService.collection.previewCollectionVariants({parentId:l,filters:T,inheritFilters:P},{take:I,skip:q,filter:D}).mapSingle(pt=>pt.previewCollectionVariants).pipe((0,$o.K)(()=>(0,N.of)({items:[],totalItems:0})))}return s?this.dataService.collection.getCollectionContents(s,I,q,v).mapSingle(D=>D.collection?.productVariants):(0,N.of)(null)}),(0,B.b)(()=>this.isLoading=!1),(0,ye.x)(()=>this.isLoading=!1));this.contents$=r.pipe((0,h.U)(s=>s?s.items:[])),this.contentsTotalItems$=r.pipe((0,h.U)(s=>s?s.totalItems:0))}ngOnChanges(n){"collectionId"in n&&this.collectionIdChange$.next(n.collectionId.currentValue),"parentId"in n&&this.parentIdChange$.next(n.parentId.currentValue),"inheritFilters"in n&&this.inheritFiltersChanges$.next(n.inheritFilters.currentValue),"updatedFilters"in n&&this.updatedFilters&&this.filterChanges$.next(this.updatedFilters)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(n){this.setParam("contentsPage",n)}setContentsItemsPerPage(n){this.setParam("contentsPerPage",n)}refresh(){this.refresh$.next(!0)}setParam(n,e){this.router.navigate(["./"],{relativeTo:this.route,queryParams:{[n]:e},queryParamsHandling:"merge",replaceUrl:!0})}}rt.\u0275fac=function(n){return new(n||rt)(t.Y36(Z.gz),t.Y36(Z.F0),t.Y36(c.DoR))},rt.\u0275cmp=t.Xpm({type:rt,selectors:[["vdr-collection-contents"]],contentQueries:function(n,e,i){if(1&n&&t.Suo(i,t.Rgc,7),2&n){let a;t.iGM(a=t.CRH())&&(e.headerTemplate=a.first)}},inputs:{collectionId:"collectionId",parentId:"parentId",inheritFilters:"inheritFilters",updatedFilters:"updatedFilters",previewUpdatedFilters:"previewUpdatedFilters"},features:[t.TTD],decls:27,vars:46,consts:[[1,"table-wrapper"],[1,"progress","loop"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["id","collection-contents",3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault"],[3,"heading","optional"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0),t._UZ(1,"div",1),t.TgZ(2,"div",2),t.YNc(3,So,1,0,"ng-container",3),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"vdr-data-table-2",4),t.NdJ("pageChange",function(a){return e.setContentsPageNumber(a)})("itemsPerPageChange",function(a){return e.setContentsItemsPerPage(a)}),t.ALo(6,"async"),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"async"),t._UZ(10,"vdr-dt2-search",5),t.ALo(11,"translate"),t.TgZ(12,"vdr-dt2-column",6),t.ALo(13,"translate"),t.YNc(14,Yo,1,1,"ng-template"),t.qZA(),t.TgZ(15,"vdr-dt2-column",6),t.ALo(16,"translate"),t.YNc(17,Go,2,4,"ng-template"),t.qZA(),t.TgZ(18,"vdr-dt2-column",6),t.ALo(19,"translate"),t.YNc(20,Eo,2,4,"ng-template"),t.qZA(),t.TgZ(21,"vdr-dt2-column",7),t.ALo(22,"translate"),t.YNc(23,jo,4,4,"ng-template"),t.qZA(),t.TgZ(24,"vdr-dt2-column",7),t.ALo(25,"translate"),t.YNc(26,Ro,1,1,"ng-template"),t.qZA()()()),2&n&&(t.xp6(1),t.ekj("visible",e.isLoading),t.xp6(2),t.Q6J("ngTemplateOutlet",e.headerTemplate)("ngTemplateOutletContext",t.VKq(44,Ho,t.lcZ(4,22,e.contentsTotalItems$))),t.xp6(2),t.ekj("loading",e.isLoading),t.Q6J("items",t.lcZ(6,24,e.contents$))("itemsPerPage",t.lcZ(7,26,e.contentsItemsPerPage$))("totalItems",t.lcZ(8,28,e.contentsTotalItems$))("currentPage",t.lcZ(9,30,e.contentsCurrentPage$)),t.xp6(5),t.Q6J("searchTermControl",e.filterTermControl)("searchTermPlaceholder",t.lcZ(11,32,"catalog.filter-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(13,34,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(16,36,"common.created-at"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(19,38,"common.updated-at"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(22,40,"common.name"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(25,42,"catalog.sku"))("optional",!1))},dependencies:[f.qvL,_.tP,Z.rH,mt.e,H.U,it.J,_.Ov,b.X$,nt.H],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     table{margin-top:-1px}vdr-data-table[_ngcontent-%COMP%]{opacity:1;transition:opacity .3s}vdr-data-table.loading[_ngcontent-%COMP%]{opacity:.5}.table-wrapper[_ngcontent-%COMP%]{position:relative}.progress[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden;height:6px;opacity:0;transition:opacity .1s}.progress.visible[_ngcontent-%COMP%]{opacity:1}.sku[_ngcontent-%COMP%]{color:var(--color-text-200)}"],changeDetection:0});var Ko=m(4973),zo=m(6933),Wo=m(9911);const Xo=["collectionRow"];function ti(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"th",16)(1,"div",17),t._UZ(2,"div",18),t.TgZ(3,"input",19),t.NdJ("change",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onToggleAllClick())}),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("checked",null==e.selectionManager?null:e.selectionManager.areAllCurrentItemsSelected())}}function ei(o,n){1&o&&t._UZ(0,"clr-icon",28)}function ni(o,n){1&o&&t._UZ(0,"clr-icon",29)}function oi(o,n){1&o&&t._UZ(0,"clr-icon",30)}function ii(o,n){if(1&o&&(t.TgZ(0,"div",31),t._uU(1),t.qZA()),2&o){const e=t.oxw().ngIf;t.xp6(1),t.Oqu(e.sortOrder)}}function ai(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",22)(1,"button",23),t.NdJ("click",function(){const r=t.CHM(e).ngIf;return t.KtG(r.toggleSortOrder())}),t.YNc(2,ei,1,0,"clr-icon",24),t.YNc(3,ni,1,0,"clr-icon",25),t.YNc(4,oi,1,0,"clr-icon",26),t.qZA(),t.YNc(5,ii,2,1,"div",27),t.qZA()}if(2&o){const e=n.ngIf;t.xp6(1),t.ekj("active",e.sortOrder),t.xp6(1),t.Q6J("ngIf",!e.sortOrder),t.xp6(1),t.Q6J("ngIf","ASC"===e.sortOrder),t.xp6(1),t.Q6J("ngIf","DESC"===e.sortOrder),t.xp6(1),t.Q6J("ngIf",e.sortOrder)}}function ri(o,n){if(1&o&&(t.TgZ(0,"th")(1,"div",20)(2,"span"),t._uU(3),t.qZA(),t.YNc(4,ai,6,6,"div",21),t.qZA()()),2&o){const e=n.$implicit;t.ekj("expand",e.expand),t.xp6(1),t.Q6J("ngClass",e.align),t.xp6(2),t.Oqu(e.heading),t.xp6(1),t.Q6J("ngIf",e.sort)}}function ci(o,n){1&o&&t.GkF(0)}function si(o,n){1&o&&t.GkF(0)}function li(o,n){if(1&o&&t._UZ(0,"vdr-data-table-filters",40),2&o){const e=n.$implicit,i=t.oxw(3);t.Q6J("filterWithValue",e)("filters",i.filters)}}function di(o,n){if(1&o&&t._UZ(0,"vdr-data-table-filters",41),2&o){const e=t.oxw(3);t.Q6J("filters",e.filters)}}function pi(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",37),t.YNc(2,li,1,2,"vdr-data-table-filters",38),t.YNc(3,di,1,1,"vdr-data-table-filters",39),t.qZA(),t.BQk()),2&o){const e=t.oxw(2);t.xp6(2),t.Q6J("ngForOf",e.filters.activeFilters),t.xp6(1),t.Q6J("ngIf",e.filters.length)}}function ui(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr")(1,"th",32)(2,"button",33),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleSearchFilterRow())}),t.ALo(3,"translate"),t._UZ(4,"clr-icon",34),t.qZA(),t.TgZ(5,"div",35),t.YNc(6,ci,1,0,"ng-container",36),t.YNc(7,si,1,0,"ng-container",36),t.YNc(8,pi,4,2,"ng-container",8),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(1),t.ekj("active",e.showSearchFilterRow),t.uIk("colspan",e.visibleSortedColumns.length+(e.selectionManager?2:1)),t.xp6(1),t.ekj("active",e.showSearchFilterRow),t.Q6J("title",t.lcZ(3,11,"common.search-and-filter-list")),t.xp6(3),t.ekj("hidden",!e.showSearchFilterRow),t.xp6(1),t.Q6J("ngTemplateOutlet",null==e.searchComponent?null:e.searchComponent.template),t.xp6(1),t.Q6J("ngTemplateOutlet",e.customSearchTemplate),t.xp6(1),t.Q6J("ngIf",e.filters)}}const mi=function(o,n){return{item:o,i:n,depth:0}};function gi(o,n){if(1&o&&(t.ynx(0),t.GkF(1,42),t.BQk()),2&o){const e=n.$implicit,i=n.index;t.oxw();const a=t.MAs(23);t.xp6(1),t.Q6J("ngTemplateOutlet",a)("ngTemplateOutletContext",t.WLB(2,mi,e,i))}}function _i(o,n){if(1&o&&(t.TgZ(0,"tr")(1,"td"),t._UZ(2,"vdr-empty-placeholder",43),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.uIk("colspan",e.visibleSortedColumns.length+(e.selectionManager?2:1)),t.xp6(1),t.Q6J("emptyStateLabel",e.emptyStateLabel)}}function fi(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-items-per-page-controls",44),t.NdJ("itemsPerPageChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.itemsPerPageChange.emit(a))}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("itemsPerPage",e.itemsPerPage)}}const hi=function(o,n,e){return{currentStart:o,currentEnd:n,totalItems:e}};function vi(o,n){if(1&o&&(t.TgZ(0,"div",45),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,"common.total-items",t.kEZ(4,hi,e.currentStart,e.currentEnd,e.totalItems))," ")}}function Ci(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-pagination-controls",46),t.NdJ("pageChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.pageChange.emit(a))}),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("id",e.id)("currentPage",e.currentPage)("itemsPerPage",e.itemsPerPage)("totalItems",e.totalItems)}}function xi(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"td",16)(1,"div",17)(2,"div",52),t.ALo(3,"translate"),t._UZ(4,"clr-icon",53),t.qZA(),t.TgZ(5,"input",54),t.NdJ("click",function(a){t.CHM(e);const r=t.oxw().item,s=t.oxw();return t.KtG(s.onRowClick(r,a))}),t.qZA()()()}if(2&o){const e=t.oxw().item,i=t.oxw();t.ekj("active",i.activeIndex===i.absoluteIndex[e.id]),t.xp6(2),t.Q6J("title",t.lcZ(3,4,"catalog.reorder-collection")),t.xp6(3),t.Q6J("checked",null==i.selectionManager?null:i.selectionManager.isSelected(e))}}function bi(o,n){1&o&&t.GkF(0)}const Ve=function(o,n){return{item:o,depth:n}};function Ti(o,n){if(1&o&&(t.TgZ(0,"td")(1,"div",20),t.YNc(2,bi,1,0,"ng-container",55),t.qZA()()),2&o){const e=n.$implicit,i=t.oxw(),a=i.item,r=i.depth,s=t.oxw();t.ekj("active",s.activeIndex===s.absoluteIndex[a.id]),t.xp6(1),t.Q6J("ngClass",e.align),t.xp6(1),t.Q6J("ngTemplateOutlet",e.template)("ngTemplateOutletContext",t.WLB(5,Ve,a,r))}}function Zi(o,n){1&o&&t.GkF(0)}function Ai(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Zi,1,0,"ng-container",55),t.BQk()),2&o){const e=n.$implicit,i=t.oxw().depth;t.oxw();const a=t.MAs(23);t.xp6(1),t.Q6J("ngTemplateOutlet",a)("ngTemplateOutletContext",t.WLB(2,Ve,e,i+1))}}const Pi=function(o,n){return{depth:o,collection:n}};function yi(o,n){if(1&o&&(t.TgZ(0,"tr",47,48),t.YNc(2,xi,6,6,"td",49),t.YNc(3,Ti,3,8,"td",50),t._UZ(4,"td"),t.qZA(),t.YNc(5,Ai,2,5,"ng-container",51)),2&o){const e=n.item,i=n.depth,a=t.oxw();t.Q6J("cdkDragData",t.WLB(6,Pi,i,e)),t.xp6(2),t.Q6J("ngIf",a.selectionManager),t.xp6(1),t.Q6J("ngForOf",a.visibleSortedColumns),t.xp6(1),t.ekj("active",a.activeIndex===a.absoluteIndex[e.id]),t.xp6(1),t.Q6J("ngForOf",a.getSubcollections(e))}}const Fi=[[["vdr-bulk-action-menu"]]],Li=function(o,n,e,i){return{itemsPerPage:o,currentPage:n,totalItems:e,id:i}};class ct extends c.eJ5{constructor(n,e,i,a){super(n,e,i),this.changeDetectorRef=n,this.localStorageService=e,this.dataService=i,this.dragDrop=a,this.changeOrder=new t.vpe,this.dragRefs=[],this.absoluteIndex={},this.sortPredicate=(r,s)=>this.dropList.getSortedItems()[r]?.data.collection.parentId===s.data.collection.parentId}ngOnChanges(n){if(super.ngOnChanges(n),n.subCollections||n.items){const e=[];for(const i of this.items??[]){e.push(i);const a=this.getSubcollections(i);e.push(...a.flat())}e.forEach((i,a)=>this.absoluteIndex[i.id]=a)}}ngAfterViewInit(){this.collectionRowList.changes.subscribe(n=>{this.dropList.getSortedItems().forEach(e=>this.dropList.removeItem(e));for(const e of n.toArray())e.dropContainer=this.dropList,e._dragRef._withDropContainer(this.dropList._dropListRef),this.dropList.addItem(e)})}getSubcollections(n){return this.subCollections?.filter(e=>e.parentId===n.id)??[]}onDrop(n){const e=2===n.item.data.collection.breadcrumbs.length,i=e?(this.currentPage-1)*this.itemsPerPage:0,a=n.item.data.collection.parentId,r=this.items.findIndex(l=>l.id===a),s=i+n.currentIndex-r-1;if(this.changeOrder.emit({collectionId:n.item.data.collection.id,index:s,parentId:n.item.data.collection.parentId}),e)this.items=[...this.items],this.items.splice(n.previousIndex,1),this.items.splice(n.currentIndex,0,n.item.data.collection);else{const l=this.items.find(u=>u.id===a);if(l){const u=this.getSubcollections(l),g=i+n.previousIndex-r-1;u.splice(g,1),u.splice(n.currentIndex,0,n.item.data.collection)}}this.changeDetectorRef.markForCheck()}}ct.\u0275fac=function(n){return new(n||ct)(t.Y36(t.sBO),t.Y36(c.n2A),t.Y36(c.DoR),t.Y36(k.v0))},ct.\u0275cmp=t.Xpm({type:ct,selectors:[["vdr-collection-data-table"]],viewQuery:function(n,e){if(1&n&&(t.Gf(k.Wj,7),t.Gf(Xo,5,k.Zt)),2&n){let i;t.iGM(i=t.CRH())&&(e.dropList=i.first),t.iGM(i=t.CRH())&&(e.collectionRowList=i)}},inputs:{subCollections:"subCollections"},outputs:{changeOrder:"changeOrder"},features:[t.qOj,t.TTD],ngContentSelectors:["vdr-bulk-action-menu"],decls:24,vars:28,consts:[[1,"bulk-actions"],[1,"table-wrapper"],[1,""],[1,"heading-row"],["class","selection-col",4,"ngIf"],[3,"expand",4,"ngFor","ngForOf"],[1,"column-picker"],[3,"uiLanguage","columns","reorder","resetColumns"],[4,"ngIf"],["cdkDropList","","cdkDropListLockAxis","y",3,"cdkDropListSortPredicate","cdkDropListDropped"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-footer"],[3,"itemsPerPage","itemsPerPageChange",4,"ngIf"],["class","p5 total-items-count",4,"ngIf"],[3,"id","currentPage","itemsPerPage","totalItems","pageChange",4,"ngIf"],["collectionRowTmp",""],[1,"selection-col"],[1,"flex"],[1,"drag-handle-spacer"],["type","checkbox","clrCheckbox","",3,"checked","change"],[1,"cell-content",3,"ngClass"],["class","sort-toggle",4,"ngIf"],[1,"sort-toggle"],[3,"click"],["shape","two-way-arrows left",4,"ngIf"],["shape","arrow up",4,"ngIf"],["shape","arrow down",4,"ngIf"],["class","sort-label",4,"ngIf"],["shape","two-way-arrows left"],["shape","arrow up"],["shape","arrow down"],[1,"sort-label"],[1,"filter-row"],[1,"button-ghost","toggle-search-filter-row",3,"title","click"],["shape","search"],[1,"filter-row-wrapper"],[4,"ngTemplateOutlet"],[1,"filters"],["class","mt-1",3,"filterWithValue","filters",4,"ngFor","ngForOf"],["class","mt-1",3,"filters",4,"ngIf"],[1,"mt-1",3,"filterWithValue","filters"],[1,"mt-1",3,"filters"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"emptyStateLabel"],[3,"itemsPerPage","itemsPerPageChange"],[1,"p5","total-items-count"],[3,"id","currentPage","itemsPerPage","totalItems","pageChange"],["cdkDrag","","cdkDragBoundary","tbody",3,"cdkDragData"],["collectionRow",""],["class","selection-col",3,"active",4,"ngIf"],[3,"active",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["cdkDragHandle","",1,"drag-handle",3,"title"],["shape","drag-handle"],["type","checkbox","clrCheckbox","",3,"checked","click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,e){1&n&&(t.F$t(Fi),t.TgZ(0,"div",0),t.Hsn(1),t.qZA(),t.TgZ(2,"div",1)(3,"table",2)(4,"thead")(5,"tr",3),t.YNc(6,ti,4,1,"th",4),t.YNc(7,ri,5,5,"th",5),t.TgZ(8,"th")(9,"div",6)(10,"vdr-data-table-colum-picker",7),t.NdJ("reorder",function(a){return e.onColumnReorder(a)})("resetColumns",function(){return e.onColumnsReset()}),t.ALo(11,"async"),t.qZA()()()(),t.YNc(12,ui,9,13,"tr",8),t.qZA(),t.TgZ(13,"tbody",9),t.NdJ("cdkDropListDropped",function(a){return e.onDrop(a)}),t.YNc(14,gi,2,5,"ng-container",10),t.ALo(15,"paginate"),t.ynx(16),t.YNc(17,_i,3,2,"tr",8),t.BQk(),t.qZA()()(),t.TgZ(18,"div",11),t.YNc(19,fi,1,1,"vdr-items-per-page-controls",12),t.YNc(20,vi,3,8,"div",13),t.YNc(21,Ci,1,4,"vdr-pagination-controls",14),t.qZA(),t.YNc(22,yi,6,9,"ng-template",null,15,t.W1O)),2&n&&(t.xp6(3),t.Udp("table-layout",null!=e.items&&e.items.length?"inherit":"fixed"),t.ekj("no-select",e.disableSelect),t.xp6(1),t.ekj("items-selected",null==e.selectionManager?null:e.selectionManager.selection.length),t.xp6(2),t.Q6J("ngIf",e.selectionManager),t.xp6(1),t.Q6J("ngForOf",e.visibleSortedColumns),t.xp6(3),t.Q6J("uiLanguage",t.lcZ(11,18,e.uiLanguage$))("columns",e.sortedColumns),t.xp6(2),t.Q6J("ngIf",e.searchComponent||e.customSearchTemplate||(null==e.filters?null:e.filters.length)),t.xp6(1),t.Q6J("cdkDropListSortPredicate",e.sortPredicate),t.xp6(1),t.Q6J("ngForOf",t.xi3(15,20,e.items,t.l5B(23,Li,e.itemsPerPage,e.currentPage,e.totalItems,e.id)))("ngForTrackBy",e.trackByFn),t.xp6(3),t.Q6J("ngIf",!(null!=e.items&&e.items.length)),t.xp6(2),t.Q6J("ngIf",e.totalItems),t.xp6(1),t.Q6J("ngIf",e.totalItems),t.xp6(1),t.Q6J("ngIf",e.totalItems))},dependencies:[f.q0d,f.qvL,f.KKC,_.mk,_.sg,_.O5,_.tP,k.Wj,k.Zt,k.Bh,Fe.w,Le.L,F.y,Ko.j,zo.I,Wo.L,_.Ov,de._s,b.X$],styles:["[_nghost-%COMP%]{display:block;max-width:100%;position:relative;margin-bottom:calc(var(--space-unit) * 4);container-type:inline-size}th[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-weight-200);font-size:var(--font-size-xs);font-weight:600;text-transform:uppercase;position:relative;white-space:nowrap}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 1.5) calc(var(--space-unit) * 1)}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{text-align:center}@media screen and (min-width: 992px){tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{padding-left:var(--surface-margin-left);text-align:left}}th[_ngcontent-%COMP%]:last-of-type, td[_ngcontent-%COMP%]:last-of-type{border-right:1px solid var(--color-weight-200)}tr[_ngcontent-%COMP%]:first-of-type   th[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(0deg,var(--color-weight-200),transparent) 1}tr[_ngcontent-%COMP%]:last-of-type   td[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(180deg,var(--color-weight-200),transparent) 1}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-row-separator)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--color-table-row-hover-bg)}.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 5);background-color:var(--color-surface-bg);z-index:10;display:flex;position:absolute;top:5px;height:40px}@media screen and (min-width: 992px){.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 8.5)}}@media screen and (min-width: 1280px){.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 10.5)}}.table-wrapper[_ngcontent-%COMP%]{display:block;overflow-y:hidden;overflow-x:auto;width:100%;max-width:var(--surface-width)}table[_ngcontent-%COMP%]{width:100%}table.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.column-picker[_ngcontent-%COMP%]{width:24px}.sort-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:calc(var(--space-unit) * .5)}.sort-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:0;border-radius:var(--border-radius-lg);color:var(--color-weight-500);padding:0 2px;cursor:pointer;background-color:transparent}.sort-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--color-primary-700)}.sort-toggle[_ngcontent-%COMP%]   .sort-label[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * .5);font-size:10px;color:var(--color-primary-600);font-weight:400}.toggle-search-filter-row[_ngcontent-%COMP%]{position:absolute;top:-12px;left:4px}@media screen and (min-width: 1280px){.toggle-search-filter-row[_ngcontent-%COMP%]{left:8px}}.toggle-search-filter-row.active[_ngcontent-%COMP%]{background-color:var(--color-primary-700);color:var(--color-primary-100);border-color:var(--color-primary-700)}th.filter-row[_ngcontent-%COMP%]{position:relative;font-size:var(--font-size-base);font-weight:400;background-color:var(--color-weight-100);box-shadow:var(--data-table-filter-box-shadow);border-left-width:0;border-right-width:0;text-align:initial;padding:0}th.filter-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}th.filter-row.active[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-weight-200)}th.filter-row[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 1);display:flex;flex-wrap:wrap;gap:calc(var(--space-unit) * .5)}.filter-row-wrapper[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 4);padding-left:0;max-height:150px;transition:max-height .2s,padding .2s,opacity .2s}.filter-row-wrapper.hidden[_ngcontent-%COMP%]{max-height:0px;padding-top:0;padding-bottom:0;overflow:hidden;opacity:0}.cell-link[_ngcontent-%COMP%]{display:block;width:100%;height:100%}td.active[_ngcontent-%COMP%]{background-color:var(--color-table-row-active-bg)}.cell-content[_ngcontent-%COMP%]{display:flex;align-items:center;line-height:var(--font-size-sm);color:var(--color-weight-700)}.cell-content.left[_ngcontent-%COMP%]{justify-content:flex-start}.cell-content.center[_ngcontent-%COMP%]{justify-content:center}.cell-content.right[_ngcontent-%COMP%]{justify-content:flex-end}.selection-col[_ngcontent-%COMP%]{width:calc(var(--space-unit) * 8)}vdr-empty-placeholder[_ngcontent-%COMP%]{width:100%}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:var(--space-unit);margin-left:var(--surface-margin-left);margin-right:var(--space-unit)}.total-items-count[_ngcontent-%COMP%]{font-size:var(--font-size-xs)}@container (max-width: 500px){.total-items-count[_ngcontent-%COMP%]{display:none}}",".bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 6);background-color:var(--color-surface-bg)}@media screen and (min-width: 992px){.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 9.5)}}@media screen and (min-width: 1280px){.bulk-actions[_ngcontent-%COMP%]{margin-left:calc(var(--space-unit) * 11.5)}}.drag-handle[_ngcontent-%COMP%]{cursor:grab}.drag-handle-spacer[_ngcontent-%COMP%]{width:16px}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .3s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{opacity:0}.cdk-drag-placeholder[_ngcontent-%COMP%]{background-color:var(--color-primary-100)!important}"],changeDetection:0});var ki=m(7826),Oi=m(7747),me=m(3677),se=m(1567),Kt=m(9617),zt=m(3332),Wt=m(3661);const Ji=["collectionContents"];function Di(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",31),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.create())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.create")," ")}}function wi(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",31),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("disabled",(e.detailForm.invalid||e.detailForm.pristine)&&!e.assetsChanged()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function Ni(o,n){if(1&o&&t.YNc(0,wi,3,4,"button",32),2&o){const e=t.oxw();t.Q6J("vdrIfPermissions",e.updatePermission)}}function Vi(o,n){1&o&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"catalog.public")))}function Ui(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.Oqu(t.lcZ(1,1,"catalog.private"))}function Mi(o,n){if(1&o&&(t.TgZ(0,"vdr-card"),t._UZ(1,"vdr-page-entity-info",33),t.qZA()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("entity",e)}}const Qi=function(){return["/catalog/collections"]};function qi(o,n){1&o&&(t.TgZ(0,"a",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,Qi)),t.xp6(1),t.Oqu(t.lcZ(2,2,"catalog.root-collection")))}const $i=function(o){return["/catalog/collections",o]};function Si(o,n){if(1&o&&(t.TgZ(0,"a",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o){const e=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(4,$i,e.id)),t.xp6(1),t.Oqu(t.lcZ(2,2,e.name))}}function Yi(o,n){if(1&o&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,e.name))}}function Gi(o,n){if(1&o&&(t.TgZ(0,"li"),t.YNc(1,qi,3,5,"a",37),t.YNc(2,Si,3,6,"a",37),t.YNc(3,Yi,3,3,"ng-container",10),t.qZA()),2&o){const e=n.first,i=n.last;t.xp6(1),t.Q6J("ngIf",e),t.xp6(1),t.Q6J("ngIf",!e&&!i),t.xp6(1),t.Q6J("ngIf",i)}}function Ei(o,n){if(1&o&&(t.TgZ(0,"vdr-page-block")(1,"nav",34)(2,"ul",35),t.YNc(3,Gi,4,3,"li",36),t.qZA()()()),2&o){const e=n.ngIf;t.xp6(3),t.Q6J("ngForOf",e.breadcrumbs)}}function Bi(o,n){if(1&o&&(t.TgZ(0,"vdr-card",39),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",40),t.ALo(3,"hasPermission"),t.qZA()),2&o){const e=t.oxw();t.Q6J("title",t.lcZ(1,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get("customFields"))("readonly",!t.lcZ(3,6,e.updatePermission))}}function ji(o,n){1&o&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"catalog.inherit-filters-from-parent")))}function Ri(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.Oqu(t.lcZ(1,1,"catalog.do-not-inherit-filters"))}function Hi(o,n){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"vdr-configurable-input",41),t.NdJ("remove",function(){const r=t.CHM(e).index,s=t.oxw();return t.KtG(s.removeFilter(r))}),t.ALo(2,"hasPermission"),t.qZA(),t.BQk()}if(2&o){const e=n.$implicit,i=n.index,a=t.oxw();t.xp6(1),t.Q6J("position",i)("operation",e)("operationDefinition",a.getFilterDefinition(e))("formControlName",i)("readonly",!t.lcZ(2,5,a.updatePermission))}}function Ki(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",47),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.addFilter(r))}),t._uU(1),t.qZA()}if(2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",e.description," ")}}function zi(o,n){if(1&o&&(t.TgZ(0,"div")(1,"vdr-dropdown")(2,"button",42),t._UZ(3,"clr-icon",43),t.TgZ(4,"span"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t._UZ(7,"clr-icon",44),t.qZA(),t.TgZ(8,"vdr-dropdown-menu",45),t.YNc(9,Ki,2,1,"button",46),t.qZA()()()),2&o){const e=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,2,"marketing.add-condition")),t.xp6(4),t.Q6J("ngForOf",e.allFilters)}}const Wi=function(o){return{count:o}},Xi=function(){return{standalone:!0}};function ta(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",48)(1,"div",49),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"clr-checkbox-wrapper")(6,"input",50),t.NdJ("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleLivePreview())}),t.qZA(),t.TgZ(7,"label"),t._uU(8),t.ALo(9,"translate"),t.qZA()()()}if(2&o){const e=n.$implicit,i=t.oxw();let a,r;t.xp6(2),t.AsE(" ",t.lcZ(3,8,"catalog.collection-contents")," (",t.xi3(4,10,"common.results-count",t.VKq(15,Wi,e)),") "),t.xp6(3),t.ekj("disabled",null==(a=i.detailForm.get("filters"))?null:a.pristine),t.xp6(1),t.Q6J("ngModelOptions",t.DdM(17,Xi))("disabled",null==(r=i.detailForm.get("filters"))?null:r.pristine)("ngModel",i.livePreview),t.xp6(2),t.Oqu(t.lcZ(9,13,"catalog.live-preview-contents"))}}const ea=function(o){return{pattern:o}},na=A.Ps`
    query CollectionDetailQuery($id: ID!) {
        collection(id: $id) {
            ...Collection
        }
    }
    ${c.vWg}
`;class At extends c.VE7{constructor(n,e,i,a,r,s){super(),this.changeDetector=n,this.dataService=e,this.formBuilder=i,this.notificationService=a,this.modalService=r,this.localStorageService=s,this.customFields=this.getCustomFieldConfig("Collection"),this.detailForm=this.formBuilder.group({name:["",d.kI.required],slug:["",(0,c.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",visible:!1,inheritFilters:!0,filters:this.formBuilder.array([]),customFields:this.formBuilder.group(this.customFields.reduce((l,u)=>({...l,[u.name]:""}),{}))}),this.assetChanges={},this.filters=[],this.allFilters=[],this.livePreview=!1,this.updatePermission=[c.y3$.UpdateCatalog,c.y3$.UpdateCollection],this.filterRemoved$=new Ut.x,this.livePreview=this.localStorageService.get("livePreviewCollectionContents")??!1}ngOnInit(){this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(i=>{this.allFilters=i.collectionFilters});const n=this.detailForm.get("filters"),e=this.detailForm.get("inheritFilters");this.inheritFilters$=e.valueChanges.pipe((0,U.x)()),this.updatedFilters$=(0,ki.T)(n.statusChanges,this.filterRemoved$).pipe((0,Mt.b)(200),(0,ue.h)(()=>n.touched),(0,h.U)(()=>this.mapOperationsToInputs(this.filters,n.value).filter(i=>{for(const a of i.arguments)if(""===a.value)return!1;return!0}))),this.parentId$=this.route.paramMap.pipe((0,h.U)(i=>i.get("parentId")||void 0),(0,C.w)(i=>i?(0,N.of)(i):this.entity$.pipe((0,h.U)(a=>a.parent?.id))))}ngOnDestroy(){this.destroy()}getFilterDefinition(n){return this.allFilters.find(e=>e.code===n.code)}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(n){const e=this.detailForm.get(["slug"]),i=this.entity?(0,c.ZIM)(this.entity,this.languageCode):void 0,a=!i||!i.slug;e&&e.pristine&&a&&e.setValue((0,j.U)(`${n}`,"-"))}addFilter(n){const e=this.detailForm.get("filters"),i=n.args.reduce((a,r)=>({...a,[r.name]:(0,c.sux)(r.value)}),{});e.push(this.formBuilder.control({code:n.code,args:i})),this.filters.push({code:n.code,args:n.args.map(a=>({name:a.name,value:(0,c.sux)(a.value)}))})}removeFilter(n){const e=this.detailForm.get("filters");-1!==n&&(e.removeAt(n),e.markAsDirty(),e.markAsTouched(),this.filters.splice(n,1),this.filterRemoved$.next())}create(){if(!this.detailForm.dirty)return;const n=this.getUpdatedCollection({id:"",createdAt:"",updatedAt:"",languageCode:this.languageCode,name:"",slug:"",isPrivate:!1,breadcrumbs:[],description:"",featuredAsset:null,assets:[],translations:[],inheritFilters:!0,filters:[],parent:{},children:null},this.detailForm,this.languageCode),e=this.route.snapshot.paramMap.get("parentId");e&&(n.parentId=e),this.dataService.collection.createCollection(n).subscribe(i=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"Collection"}),this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",i.createCollection.id],{relativeTo:this.route})},i=>{this.notificationService.error((0,p.J)("common.notify-create-error"),{entity:"Collection"})})}save(){(0,y.a)(this.entity$,this.languageCode$).pipe((0,$.q)(1),(0,w.z)(([n,e])=>{const i=this.getUpdatedCollection(n,this.detailForm,e);return this.dataService.collection.updateCollection(i)})).subscribe(()=>{this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"Collection"}),this.contentsComponent.refresh()},n=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"Collection"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}toggleLivePreview(){this.livePreview=!this.livePreview,this.localStorageService.set("livePreviewCollectionContents",this.livePreview)}trackByFn(n,e){return JSON.stringify(e)}setFormValues(n,e){const i=(0,c.ZIM)(n,e);this.detailForm.patchValue({name:i?i.name:"",slug:i?i.slug:"",description:i?i.description:"",visible:!n.isPrivate,inheritFilters:n.inheritFilters});const a=this.detailForm.get("filters");a.length!==n.filters.length&&(a.clear(),this.filters=[],n.filters.forEach(r=>this.addFilter(r))),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),n,i)}getUpdatedCollection(n,e,i){return{...(0,c.iSy)({translatable:n,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:i,defaultTranslation:{languageCode:i,name:n.name||"",slug:n.slug||"",description:n.description||""}}),assetIds:this.assetChanges.assets?.map(r=>r.id),featuredAssetId:this.assetChanges.featuredAsset?.id,isPrivate:!e.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)}}mapOperationsToInputs(n,e){return n.map((i,a)=>({code:i.code,arguments:Object.entries(e[a].args).map(([r,s],l)=>({name:r,value:(0,c.qrw)(s)}))}))}}At.\u0275fac=function(n){return new(n||At)(t.Y36(t.sBO),t.Y36(c.DoR),t.Y36(d.qu),t.Y36(c.gqp),t.Y36(c.Z7U),t.Y36(c.n2A))},At.\u0275cmp=t.Xpm({type:At,selectors:[["vdr-collection-detail"]],viewQuery:function(n,e){if(1&n&&t.Gf(Ji,5),2&n){let i;t.iGM(i=t.CRH())&&(e.contentsComponent=i.first)}},features:[t.qOj],decls:73,vars:89,consts:[[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["for","slug",1,"form-grid-span",3,"label"],["formControlName","description",3,"readonly"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","collection-detail",3,"entity$","detailForm"],[3,"title"],[3,"assets","featuredAsset","updatePermissions","change"],["for","inheritFilters",3,"label"],["type","checkbox","clrToggle","","formControlName","inheritFilters","id","inheritFilters",3,"vdrDisabled"],["noInherit",""],["formArrayName","filters"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"vdrIfPermissions"],[3,"title","paddingX"],[3,"collectionId","parentId","updatedFilters","inheritFilters","previewUpdatedFilters"],["collectionContents",""],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"entity"],["role","navigation"],[1,"collection-breadcrumbs"],[4,"ngFor","ngForOf"],[3,"routerLink",4,"ngIf"],[3,"routerLink"],["formGroupName","customFields",3,"title"],["entityName","Collection",3,"customFields","customFieldsFormGroup","readonly"],[3,"position","operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["shape","ellipsis-vertical"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"ml-3"],[1,"contents-title"],["type","checkbox","clrCheckbox","",3,"ngModelOptions","disabled","ngModel","ngModelChange"]],template:function(n,e){if(1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(4,"async"),t.ALo(5,"async"),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"vdr-ab-right"),t._UZ(8,"vdr-action-bar-items",1),t.YNc(9,Di,3,4,"button",2),t.ALo(10,"async"),t.YNc(11,Ni,1,1,"ng-template",null,3,t.W1O),t.qZA()()(),t.TgZ(13,"form",4)(14,"vdr-page-detail-layout")(15,"vdr-page-detail-sidebar")(16,"vdr-card")(17,"vdr-form-field",5),t.ALo(18,"translate"),t.TgZ(19,"clr-toggle-wrapper"),t._UZ(20,"input",6),t.ALo(21,"hasPermission"),t.TgZ(22,"label",7),t.YNc(23,Vi,3,3,"ng-container",8),t.YNc(24,Ui,2,3,"ng-template",null,9,t.W1O),t.qZA()()()(),t.YNc(26,Mi,2,1,"vdr-card",10),t.ALo(27,"async"),t.qZA(),t.YNc(28,Ei,4,1,"vdr-page-block",10),t.ALo(29,"async"),t.TgZ(30,"vdr-page-block")(31,"vdr-card")(32,"div",11)(33,"vdr-form-field",12),t.ALo(34,"translate"),t.TgZ(35,"input",13),t.NdJ("input",function(a){return e.updateSlug(a.target.value)}),t.ALo(36,"hasPermission"),t.qZA()(),t.TgZ(37,"vdr-form-field",14),t.ALo(38,"translate"),t.ALo(39,"translate"),t._UZ(40,"input",15),t.ALo(41,"hasPermission"),t.qZA(),t.TgZ(42,"vdr-form-field",16),t.ALo(43,"translate"),t._UZ(44,"vdr-rich-text-editor",17),t.ALo(45,"hasPermission"),t.qZA()()(),t.YNc(46,Bi,4,8,"vdr-card",18),t._UZ(47,"vdr-custom-detail-component-host",19),t.TgZ(48,"vdr-card",20),t.ALo(49,"translate"),t.TgZ(50,"vdr-assets",21),t.NdJ("change",function(a){return e.assetChanges=a}),t.qZA()(),t.TgZ(51,"vdr-card",20),t.ALo(52,"translate"),t.TgZ(53,"vdr-form-field",22),t.ALo(54,"translate"),t.TgZ(55,"clr-toggle-wrapper"),t._UZ(56,"input",23),t.ALo(57,"hasPermission"),t.TgZ(58,"label",7),t.YNc(59,ji,3,3,"ng-container",8),t.YNc(60,Ri,2,3,"ng-template",null,24,t.W1O),t.qZA()()(),t.TgZ(62,"div",25),t.YNc(63,Hi,3,7,"ng-container",26),t.qZA(),t.YNc(64,zi,10,4,"div",27),t.qZA(),t.TgZ(65,"vdr-card",28),t.ALo(66,"translate"),t.TgZ(67,"vdr-collection-contents",29,30),t.ALo(69,"async"),t.ALo(70,"async"),t.ALo(71,"async"),t.YNc(72,ta,10,18,"ng-template"),t.qZA()()()()()),2&n){const i=t.MAs(12),a=t.MAs(25),r=t.MAs(61);t.xp6(3),t.Q6J("disabled",t.lcZ(4,41,e.isNew$))("availableLanguageCodes",t.lcZ(5,43,e.availableLanguages$))("currentLanguageCode",t.lcZ(6,45,e.languageCode$)),t.xp6(6),t.Q6J("ngIf",t.lcZ(10,47,e.isNew$))("ngIfElse",i),t.xp6(4),t.Q6J("formGroup",e.detailForm),t.xp6(4),t.Q6J("label",t.lcZ(18,49,"catalog.visibility")),t.xp6(3),t.Q6J("vdrDisabled",!t.lcZ(21,51,e.updatePermission)),t.xp6(3),t.Q6J("ngIf",e.detailForm.value.visible)("ngIfElse",a),t.xp6(3),t.Q6J("ngIf",t.lcZ(27,53,e.entity$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(29,55,e.entity$)),t.xp6(5),t.Q6J("label",t.lcZ(34,57,"common.name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(36,59,e.updatePermission)),t.xp6(2),t.Q6J("label",t.lcZ(38,61,"catalog.slug"))("errors",t.VKq(87,ea,t.lcZ(39,63,"catalog.slug-pattern-error"))),t.xp6(3),t.Q6J("readonly",!t.lcZ(41,65,e.updatePermission)),t.xp6(2),t.Q6J("label",t.lcZ(43,67,"common.description")),t.xp6(2),t.Q6J("readonly",!t.lcZ(45,69,e.updatePermission)),t.xp6(2),t.Q6J("ngIf",e.customFields.length),t.xp6(1),t.Q6J("entity$",e.entity$)("detailForm",e.detailForm),t.xp6(1),t.Q6J("title",t.lcZ(49,71,"catalog.assets")),t.xp6(2),t.Q6J("assets",null==e.entity?null:e.entity.assets)("featuredAsset",null==e.entity?null:e.entity.featuredAsset)("updatePermissions",e.updatePermission),t.xp6(1),t.Q6J("title",t.lcZ(52,73,"catalog.filters")),t.xp6(2),t.Q6J("label",t.lcZ(54,75,"catalog.filter-inheritance")),t.xp6(3),t.Q6J("vdrDisabled",!t.lcZ(57,77,e.updatePermission)),t.xp6(3),t.Q6J("ngIf",e.detailForm.value.inheritFilters)("ngIfElse",r),t.xp6(4),t.Q6J("ngForOf",e.filters)("ngForTrackBy",e.trackByFn),t.xp6(1),t.Q6J("vdrIfPermissions",e.updatePermission),t.xp6(1),t.Q6J("title",t.lcZ(66,79,"common.contents"))("paddingX",!1),t.xp6(2),t.Q6J("collectionId",e.id)("parentId",t.lcZ(69,81,e.parentId$))("updatedFilters",t.lcZ(70,83,e.updatedFilters$))("inheritFilters",t.lcZ(71,85,e.inheritFilters$))("previewUpdatedFilters",e.livePreview)}},dependencies:[f.q0d,f.qvL,f.MgK,f.KKC,f.PEh,_.sg,_.O5,d._Y,d.Fj,d.Wl,d.JJ,d.JL,d.On,d.sg,d.u,d.x0,d.CE,Z.rH,x.Kk,x.BN,x.mz,Oi.q,M.h,F.y,R.S,me.Y,Qt.J,qt.N,$t.U,St.H,J.H,G.W,se.x,ut.y,Kt.C,O.z,Vt.D,zt.T,Wt.W,gt.A,X,rt,_.Ov,b.X$,Y.j],styles:['@charset "UTF-8";.visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}clr-checkbox-wrapper[_ngcontent-%COMP%]{transition:opacity .3s}clr-checkbox-wrapper.disabled[_ngcontent-%COMP%]{opacity:.5}.collection-breadcrumbs[_ngcontent-%COMP%]{list-style-type:none;background-color:var(--color-component-bg-200);padding:2px 6px;margin-bottom:6px;border-radius:var(--clr-global-borderradius)}.collection-breadcrumbs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:.65rem;display:inline-block;margin-right:10px}.collection-breadcrumbs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:not(:last-child):after{content:"\\203a";top:0;color:var(--color-grey-400);margin-left:10px}'],changeDetection:0});class st{transform(n){return n?.breadcrumbs.slice(1,-1)}}function oa(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.move-collections"),"\n")}function ia(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function aa(o,n){if(1&o&&t._UZ(0,"clr-icon",11),2&o){const e=t.oxw().depth;t.ekj("transparent",0===e)}}function ra(o,n){1&o&&t._UZ(0,"clr-icon",15)}function ca(o,n){1&o&&t._UZ(0,"clr-icon",16)}function sa(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().item,r=t.oxw();return t.KtG(r.toggleExpanded(a))}),t.YNc(1,ra,1,0,"clr-icon",13),t.YNc(2,ca,1,0,"clr-icon",14),t.qZA()}if(2&o){const e=t.oxw().item,i=t.oxw();t.xp6(1),t.Q6J("ngIf",!i.expandedIds.includes(e.id)),t.xp6(1),t.Q6J("ngIf",i.expandedIds.includes(e.id))}}function la(o,n){1&o&&(t.TgZ(0,"button",17),t._UZ(1,"clr-icon",18),t.qZA())}st.\u0275fac=function(n){return new(n||st)},st.\u0275pipe=t.Yjl({name:"collectionBreadcrumb",type:st,pure:!0});const da=function(o){return{name:o}};function pa(o,n){if(1&o){const e=t.EpF();t._UZ(0,"div",6),t.YNc(1,aa,1,2,"clr-icon",7),t.YNc(2,sa,3,2,"button",8),t.YNc(3,la,2,0,"button",9),t.TgZ(4,"button",10),t.NdJ("click",function(){const r=t.CHM(e).item,s=t.oxw();return t.KtG(s.resolveWith(r))}),t.TgZ(5,"span"),t._uU(6),t.ALo(7,"translate"),t.qZA()()}if(2&o){const e=n.item,i=n.depth;t.Q6J("ngClass","indent-"+i),t.xp6(1),t.Q6J("ngIf",!(null!=e.children&&e.children.length)&&"__"!==e.parentId),t.xp6(1),t.Q6J("ngIf",null==e.children?null:e.children.length),t.xp6(1),t.Q6J("ngIf","__"===e.parentId),t.xp6(3),t.Oqu(t.xi3(7,5,"catalog.move-collection-to",t.VKq(8,da,e.name)))}}function ua(o,n){if(1&o&&(t.TgZ(0,"div")(1,"span",23),t._uU(2,"/"),t.qZA(),t._uU(3),t.qZA()),2&o){const e=n.$implicit;t.xp6(3),t.hij("",e.name," ")}}function ma(o,n){if(1&o&&(t.ynx(0),t.YNc(1,ua,4,1,"div",22),t.BQk()),2&o){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngForOf",e)}}function ga(o,n){1&o&&(t.TgZ(0,"span",23),t._uU(1,"/"),t.qZA())}function _a(o,n){if(1&o&&(t.ynx(0),t.YNc(1,ma,2,1,"ng-container",20),t.YNc(2,ga,2,0,"span",21),t.BQk()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("ngIf",e.length),t.xp6(1),t.Q6J("ngIf",!e.length)}}function fa(o,n){if(1&o&&(t.TgZ(0,"div",19),t.YNc(1,_a,3,2,"ng-container",20),t.ALo(2,"collectionBreadcrumb"),t.qZA()),2&o){const e=n.item;t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,e))}}function ha(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.slug," ")}}class Pt{constructor(n,e){this.dataService=n,this.i18nService=e,this.searchTermControl=new d.NI(""),this.currentPage$=new Q.X(1),this.itemsPerPage$=new Q.X(10),this.expandedIds$=new Ut.x,this.expandedIds=[]}ngOnInit(){const n=this.dataService.collection.getCollections(),e=this.searchTermControl.valueChanges.pipe((0,Mt.b)(250),(0,U.x)(),(0,K.O)("")),i=this.currentPage$.pipe((0,U.x)()),a=this.itemsPerPage$.pipe((0,U.x)());(0,y.a)(e,i,a).subscribe(([s,l,u])=>{const g=""===s;n.ref.refetch({options:{skip:(l-1)*u,take:u,filter:{name:{contains:s}},topLevelOnly:g}})});const r=this.dataService.collection.getCollections({take:1,topLevelOnly:!0}).mapSingle(s=>s.collections.items[0].parentId);this.items$=(0,y.a)(n.mapStream(({collections:s})=>s),r).pipe((0,h.U)(([s,l])=>[...l?[{id:l,name:this.i18nService.translate("catalog.root-collection"),slug:"",parentId:"__",position:0,featuredAsset:null,children:[],breadcrumbs:[],isPrivate:!1,createdAt:"",updatedAt:""}]:[],...s.items])),this.totalItems$=n.mapStream(s=>s.collections.totalItems),this.subCollections$=this.expandedIds$.pipe((0,B.b)(s=>this.expandedIds=s),(0,C.w)(s=>s.length?this.dataService.collection.getCollections({take:999,filter:{parentId:{in:s}}}).mapStream(l=>l.collections.items):(0,N.of)([])))}toggleExpanded(n){let e=this.expandedIds;e.includes(n.id)?e=e.filter(i=>i!==n.id):e.push(n.id),this.expandedIds$.next(e)}}Pt.\u0275fac=function(n){return new(n||Pt)(t.Y36(c.DoR),t.Y36(c.Dp7))},Pt.\u0275cmp=t.Xpm({type:Pt,selectors:[["vdr-move-collections-dialog"]],decls:21,vars:33,consts:[["vdrDialogTitle",""],["id","move-collection-list",1,"mt-2",3,"items","subCollections","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault"],[3,"heading","optional"],[3,"heading"],[3,"ngClass"],["class","child-arrow","shape","child-arrow",3,"transparent",4,"ngIf"],["class","icon-button folder-button",3,"click",4,"ngIf"],["class","icon-button folder-button","disabled","",4,"ngIf"],[1,"button-ghost",3,"click"],["shape","child-arrow",1,"child-arrow"],[1,"icon-button","folder-button",3,"click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],["disabled","",1,"icon-button","folder-button"],["shape","folder",1,"is-solid"],[1,"breadcrumb"],[4,"ngIf"],["class","separator",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"separator"]],template:function(n,e){1&n&&(t.YNc(0,oa,2,3,"ng-template",0),t.TgZ(1,"vdr-collection-data-table",1),t.NdJ("pageChange",function(a){return e.currentPage$.next(a)})("itemsPerPageChange",function(a){return e.itemsPerPage$.next(a)}),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t.ALo(6,"async"),t._UZ(7,"vdr-dt2-search",2),t.ALo(8,"translate"),t.TgZ(9,"vdr-dt2-column",3),t.ALo(10,"translate"),t.YNc(11,ia,1,1,"ng-template"),t.qZA(),t.TgZ(12,"vdr-dt2-column",4),t.ALo(13,"translate"),t.YNc(14,pa,8,10,"ng-template"),t.qZA(),t.TgZ(15,"vdr-dt2-column",5),t.ALo(16,"translate"),t.YNc(17,fa,3,3,"ng-template"),t.qZA(),t.TgZ(18,"vdr-dt2-column",5),t.ALo(19,"translate"),t.YNc(20,ha,1,1,"ng-template"),t.qZA()()),2&n&&(t.xp6(1),t.Q6J("items",t.lcZ(2,13,e.items$))("subCollections",t.lcZ(3,15,e.subCollections$))("itemsPerPage",t.lcZ(4,17,e.itemsPerPage$))("totalItems",t.lcZ(5,19,e.totalItems$))("currentPage",t.lcZ(6,21,e.currentPage$)),t.xp6(6),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(8,23,"common.search-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(10,25,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(13,27,"common.name"))("optional",!1),t.xp6(3),t.Q6J("heading",t.lcZ(16,29,"common.breadcrumb")),t.xp6(3),t.Q6J("heading",t.lcZ(19,31,"common.slug")))},dependencies:[f.qvL,_.mk,_.sg,_.O5,ot.q,H.U,it.J,ct,_.Ov,b.X$,st],styles:["[_nghost-%COMP%]{--indent-spacing: 18px}.indent-1[_ngcontent-%COMP%]{padding-left:var(--indent-spacing)}.indent-2[_ngcontent-%COMP%]{padding-left:calc(var(--indent-spacing) * 2)}.indent-3[_ngcontent-%COMP%]{padding-left:calc(var(--indent-spacing) * 3)}.indent-4[_ngcontent-%COMP%], .indent-5[_ngcontent-%COMP%], .indent-6[_ngcontent-%COMP%], .indent-7[_ngcontent-%COMP%], .indent-8[_ngcontent-%COMP%], .indent-9[_ngcontent-%COMP%]{padding-left:calc(var(--indent-spacing) * 4)}.child-arrow[_ngcontent-%COMP%]{margin:1px 6px}.child-arrow.transparent[_ngcontent-%COMP%]{opacity:0}.breadcrumb[_ngcontent-%COMP%]{display:flex}.separator[_ngcontent-%COMP%]{color:var(--color-weight-500);margin:0 3px}"],changeDetection:0});const Ue=(0,c.wwB)({location:"collection-list",requiresPermission:o=>o.includes(c.y3$.DeleteCollection)||o.includes(c.y3$.DeleteCatalog),getItemName:o=>o.name,bulkDelete:(o,n)=>o.collection.deleteCollections(n).pipe((0,h.U)(e=>e.deleteCollections))}),Me={location:"collection-list",label:(0,p.J)("catalog.move-collections"),icon:"drag-handle",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateCollection),onClick:({injector:o,selection:n,hostComponent:e,clearSelection:i})=>{const a=o.get(c.Z7U),r=o.get(c.DoR),s=o.get(c.gqp);a.fromComponent(Pt,{size:"xl",closable:!0}).pipe((0,C.w)(l=>{if(l){const u=n.map(g=>({collectionId:g.id,parentId:l.id,index:0}));return r.collection.moveCollection(u)}return L.E})).subscribe(l=>{s.success((0,p.J)("catalog.move-collections-success"),{count:n.length}),i(),e.refresh()})}},Qe=(0,c.z1G)({location:"collection-list",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateCollection),getItemName:o=>o.name,bulkAssignToChannel:(o,n,e)=>o.collection.assignCollectionsToChannel({collectionIds:n,channelId:e}).pipe((0,h.U)(i=>i.assignCollectionsToChannel))}),qe=(0,c.RBx)({location:"collection-list",requiresPermission:o=>o.includes(c.y3$.DeleteCatalog)||o.includes(c.y3$.DeleteCollection),getItemName:o=>o.name,bulkRemoveFromChannel:(o,n,e)=>o.collection.removeCollectionsFromChannel({channelId:e,collectionIds:n}).pipe((0,h.U)(i=>i.removeCollectionsFromChannel))});var Xt=m(5757),te=m(9002),va=m(1021),$e=m(3288);const Ca=function(){return["./create"]};function xa(o,n){1&o&&(t.TgZ(0,"a",6),t._UZ(1,"clr-icon",7),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,Ca)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.create-new-collection")," "))}function ba(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function Ta(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function Za(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}function Aa(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.position," ")}}function Pa(o,n){if(1&o&&t._UZ(0,"clr-icon",23),2&o){const e=t.oxw().depth;t.ekj("transparent",0===e)}}function ya(o,n){1&o&&t._UZ(0,"clr-icon",27)}function Fa(o,n){1&o&&t._UZ(0,"clr-icon",28)}function La(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",24),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().item,r=t.oxw(2);return t.KtG(r.toggleExpanded(a))}),t.YNc(1,ya,1,0,"clr-icon",25),t.YNc(2,Fa,1,0,"clr-icon",26),t.qZA()}if(2&o){const e=t.oxw().item,i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!i.expandedIds.includes(e.id)),t.xp6(1),t.Q6J("ngIf",i.expandedIds.includes(e.id))}}const Se=function(o){return["./",o]};function Ia(o,n){if(1&o&&(t._UZ(0,"div",18),t.YNc(1,Pa,1,2,"clr-icon",19),t.YNc(2,La,3,2,"button",20),t.TgZ(3,"a",21)(4,"span"),t._uU(5),t.qZA(),t._UZ(6,"clr-icon",22),t.qZA()),2&o){const e=n.item,i=n.depth;t.Q6J("ngClass","indent-"+i),t.xp6(1),t.Q6J("ngIf",!(null!=e.children&&e.children.length)),t.xp6(1),t.Q6J("ngIf",null==e.children?null:e.children.length),t.xp6(1),t.Q6J("routerLink",t.VKq(5,Se,e.id)),t.xp6(2),t.Oqu(e.name)}}function ka(o,n){if(1&o&&(t.TgZ(0,"div")(1,"span",33),t._uU(2,"/"),t.qZA(),t._uU(3),t.qZA()),2&o){const e=n.$implicit;t.xp6(3),t.hij("",e.name," ")}}function Oa(o,n){if(1&o&&(t.ynx(0),t.YNc(1,ka,4,1,"div",32),t.BQk()),2&o){const e=t.oxw().ngIf;t.xp6(1),t.Q6J("ngForOf",e)}}function Ja(o,n){1&o&&(t.TgZ(0,"span",33),t._uU(1,"/"),t.qZA())}function Da(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Oa,2,1,"ng-container",30),t.YNc(2,Ja,2,0,"span",31),t.BQk()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("ngIf",e.length),t.xp6(1),t.Q6J("ngIf",!e.length)}}function wa(o,n){if(1&o&&(t.TgZ(0,"div",29),t.YNc(1,Da,3,2,"ng-container",30),t.ALo(2,"collectionBreadcrumb"),t.qZA()),2&o){const e=n.item;t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,e))}}function Na(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.slug," ")}}function Va(o,n){1&o&&(t.TgZ(0,"vdr-chip",36),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.private")))}function Ua(o,n){1&o&&(t.TgZ(0,"vdr-chip",37),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.public")))}function Ma(o,n){if(1&o&&(t.YNc(0,Va,3,3,"vdr-chip",34),t.YNc(1,Ua,3,3,"vdr-chip",35)),2&o){const e=n.item;t.Q6J("ngIf",e.isPrivate),t.xp6(1),t.Q6J("ngIf",!e.isPrivate)}}const Qa=function(o){return{contents:o}};function qa(o,n){if(1&o&&(t.TgZ(0,"a",38)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"clr-icon",39),t.qZA()),2&o){const e=n.item;t.Q6J("routerLink",t.VKq(6,Se,t.VKq(4,Qa,e.id))),t.xp6(2),t.Oqu(t.lcZ(3,2,"common.view-contents"))}}function $a(o,n){if(1&o&&t._UZ(0,"vdr-dt2-custom-field-column",40),2&o){const e=n.$implicit,i=t.oxw(2);t.Q6J("customField",e)("sorts",i.sorts)}}function Sa(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-collection-data-table",8),t.NdJ("pageChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.setPageNumber(a))})("itemsPerPageChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.setItemsPerPage(a))})("changeOrder",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.onRearrange(a))}),t.ALo(1,"async"),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t.ALo(6,"async"),t._UZ(7,"vdr-bulk-action-menu",9)(8,"vdr-dt2-search",10),t.ALo(9,"translate"),t.TgZ(10,"vdr-dt2-column",11),t.ALo(11,"translate"),t.YNc(12,ba,1,1,"ng-template"),t.qZA(),t.TgZ(13,"vdr-dt2-column",12),t.ALo(14,"translate"),t.YNc(15,Ta,2,4,"ng-template"),t.qZA(),t.TgZ(16,"vdr-dt2-column",12),t.ALo(17,"translate"),t.YNc(18,Za,2,4,"ng-template"),t.qZA(),t.TgZ(19,"vdr-dt2-column",12),t.ALo(20,"translate"),t.YNc(21,Aa,1,1,"ng-template"),t.qZA(),t.TgZ(22,"vdr-dt2-column",13),t.ALo(23,"translate"),t.YNc(24,Ia,7,7,"ng-template"),t.qZA(),t.TgZ(25,"vdr-dt2-column",14),t.ALo(26,"translate"),t.YNc(27,wa,3,3,"ng-template"),t.qZA(),t.TgZ(28,"vdr-dt2-column",15),t.ALo(29,"translate"),t.YNc(30,Na,1,1,"ng-template"),t.qZA(),t.TgZ(31,"vdr-dt2-column",14),t.ALo(32,"translate"),t.YNc(33,Ma,2,2,"ng-template"),t.qZA(),t.TgZ(34,"vdr-dt2-column",16),t.ALo(35,"translate"),t.YNc(36,qa,5,8,"ng-template"),t.qZA(),t.YNc(37,$a,1,2,"vdr-dt2-custom-field-column",17),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("items",t.lcZ(1,32,e.items$))("subCollections",t.lcZ(2,34,e.subCollections$))("itemsPerPage",t.lcZ(3,36,e.itemsPerPage$))("totalItems",t.lcZ(4,38,e.totalItems$))("currentPage",t.lcZ(5,40,e.currentPage$))("filters",e.filters)("activeIndex",t.lcZ(6,42,e.activeCollectionIndex$)),t.xp6(7),t.Q6J("hostComponent",e)("selectionManager",e.selectionManager),t.xp6(1),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(9,44,"common.search-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(11,46,"common.id"))("hiddenByDefault",!0),t.xp6(3),t.Q6J("heading",t.lcZ(14,48,"common.created-at"))("hiddenByDefault",!0)("sort",e.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(17,50,"common.updated-at"))("hiddenByDefault",!0)("sort",e.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(20,52,"common.position"))("hiddenByDefault",!0)("sort",e.sorts.get("position")),t.xp6(3),t.Q6J("heading",t.lcZ(23,54,"common.name"))("optional",!1)("sort",e.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(26,56,"common.breadcrumb")),t.xp6(3),t.Q6J("heading",t.lcZ(29,58,"common.slug"))("sort",e.sorts.get("slug")),t.xp6(3),t.Q6J("heading",t.lcZ(32,60,"common.visibility")),t.xp6(3),t.Q6J("heading",t.lcZ(35,62,"common.view-contents"))("optional",!1),t.xp6(3),t.Q6J("ngForOf",e.customFields)}}function Ya(o,n){if(1&o&&(t.ynx(0),t._UZ(1,"vdr-collection-contents",41),t.ALo(2,"async"),t.BQk()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("collectionId",t.lcZ(2,1,e.activeCollectionId$))}}function Ga(o,n){if(1&o&&(t.YNc(0,Ya,3,3,"ng-container",30),t.ALo(1,"async")),2&o){const e=t.oxw();t.Q6J("ngIf",t.lcZ(1,1,e.activeCollectionId$))}}const Ea=function(){return["CreateCatalog","CreateCollection"]};class yt extends c.$ms{constructor(n,e){super(),this.dataService=n,this.notificationService=e,this.expandedIds=[],this.customFields=this.getCustomFieldConfig("Collection"),this.filters=this.createFilterCollection().addDateFilters().addFilter({name:"slug",label:(0,p.J)("common.slug"),type:{kind:"text"},filterField:"slug"}).addFilter({name:"visibility",type:{kind:"boolean"},label:(0,p.J)("common.visibility"),toFilterInput:i=>({isPrivate:{eq:!i}})}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("position","ASC").addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"name"}).addSort({name:"slug"}).addSort({name:"position"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),super.configure({document:c.rcS,getItems:i=>i.collections,setVariables:(i,a)=>{const r=""===this.searchTermControl.value&&0===this.filters.activeFilters.length||void 0;return{options:{skip:i,take:a,filter:{name:{contains:this.searchTermControl.value},...this.filters.createFilterInput()},topLevelOnly:r,sort:this.sorts.createSortInput()}}},refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}ngOnInit(){super.ngOnInit(),this.activeCollectionId$=this.route.paramMap.pipe((0,h.U)(e=>e.get("contents")),(0,U.x)());const n=this.route.queryParamMap.pipe((0,h.U)(e=>e.get("expanded")),(0,U.x)(),(0,h.U)(e=>e?e.split(","):[]));n.pipe((0,ae.R)(this.destroy$)).subscribe(e=>{this.expandedIds=e}),this.subCollections$=(0,y.a)(n,this.refresh$).pipe((0,C.w)(([e])=>e.length?this.dataService.collection.getCollections({take:999,filter:{parentId:{in:e}}}).mapStream(i=>i.collections.items):(0,N.of)([]))),this.activeCollectionTitle$=(0,y.a)(this.activeCollectionId$,this.items$,this.subCollections$).pipe((0,h.U)(([e,i,a])=>{if(e){const r=[...i,...a].find(s=>s.id===e);return r?r.name:""}return""})),this.activeCollectionIndex$=(0,y.a)(this.activeCollectionId$,this.items$,this.subCollections$).pipe((0,h.U)(([e,i,a])=>{if(e){const r=[];for(const s of i){r.push(s);const l=a.filter(u=>u.parentId&&u.parentId===s.id);r.push(...l)}return r.findIndex(s=>s.id===e)}return-1}))}onRearrange(n){this.dataService.collection.moveCollection([n]).subscribe({next:()=>{this.notificationService.success((0,p.J)("common.notify-saved-changes")),this.refresh()},error:e=>{this.notificationService.error((0,p.J)("common.notify-save-changes-error"))}})}closeContents(){const n={...this.route.snapshot.params};delete n.contents,this.router.navigate(["./",n],{relativeTo:this.route,queryParamsHandling:"preserve"})}setLanguage(n){this.dataService.client.setContentLanguage(n).subscribe()}toggleExpanded(n){let e=this.expandedIds;e.includes(n.id)?e=e.filter(i=>i!==n.id):e.push(n.id),this.router.navigate(["./"],{queryParams:{expanded:e.filter(i=>!!i).join(",")},queryParamsHandling:"merge",relativeTo:this.route})}}yt.\u0275fac=function(n){return new(n||yt)(t.Y36(c.DoR),t.Y36(c.gqp))},yt.\u0275cmp=t.Xpm({type:yt,selectors:[["vdr-collection-list"]],features:[t.qOj],decls:14,vars:14,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"rightPanelOpen","closeClicked"],["vdrSplitViewLeft",""],["vdrSplitViewRight","",3,"splitViewTitle"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],["id","collection-list",1,"mt-2",3,"items","subCollections","itemsPerPage","totalItems","currentPage","filters","activeIndex","pageChange","itemsPerPageChange","changeOrder"],["locationId","collection-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault"],[3,"heading","hiddenByDefault","sort"],[3,"heading","optional","sort"],[3,"heading"],[3,"heading","sort"],[3,"heading","optional"],[3,"customField","sorts",4,"ngFor","ngForOf"],[3,"ngClass"],["class","child-arrow","shape","child-arrow",3,"transparent",4,"ngIf"],["class","icon-button folder-button",3,"click",4,"ngIf"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["shape","child-arrow",1,"child-arrow"],[1,"icon-button","folder-button",3,"click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"breadcrumb"],[4,"ngIf"],["class","separator",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"separator"],["colorType","warning",4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","warning"],["colorType","success"],["queryParamsHandling","preserve",1,"button-small","bg-weight-150",3,"routerLink"],["shape","file-group"],[3,"customField","sorts"],[3,"collectionId"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"vdr-ab-right"),t._UZ(7,"vdr-action-bar-items",1),t.YNc(8,xa,4,5,"a",2),t.qZA()()(),t.TgZ(9,"vdr-split-view",3),t.NdJ("closeClicked",function(){return e.closeContents()}),t.ALo(10,"async"),t.YNc(11,Sa,38,64,"ng-template",4),t.YNc(12,Ga,2,3,"ng-template",5),t.ALo(13,"async"),t.qZA()),2&n&&(t.xp6(3),t.Q6J("availableLanguageCodes",t.lcZ(4,5,e.availableLanguages$))("currentLanguageCode",t.lcZ(5,7,e.contentLanguage$)),t.xp6(5),t.Q6J("vdrIfPermissions",t.DdM(13,Ea)),t.xp6(1),t.Q6J("rightPanelOpen",t.lcZ(10,9,e.activeCollectionId$)),t.xp6(3),t.Q6J("splitViewTitle",t.lcZ(13,11,e.activeCollectionTitle$)))},dependencies:[f.qvL,_.mk,_.sg,_.O5,Z.rH,x.Kk,x.BN,x.mz,z.Y,R.S,J.H,G.W,Xt.c,H.U,it.J,te.j,va._,$e.L,$e.a,O.z,rt,ct,_.Ov,b.X$,nt.H,st],styles:["[_nghost-%COMP%]{--indent-spacing: 18px}.indent-1[_ngcontent-%COMP%]{padding-left:var(--indent-spacing)}.indent-2[_ngcontent-%COMP%]{padding-left:calc(var(--indent-spacing) * 2)}.indent-3[_ngcontent-%COMP%]{padding-left:calc(var(--indent-spacing) * 3)}.indent-4[_ngcontent-%COMP%], .indent-5[_ngcontent-%COMP%], .indent-6[_ngcontent-%COMP%], .indent-7[_ngcontent-%COMP%], .indent-8[_ngcontent-%COMP%], .indent-9[_ngcontent-%COMP%]{padding-left:calc(var(--indent-spacing) * 4)}.child-arrow[_ngcontent-%COMP%]{margin:1px 6px}.child-arrow.transparent[_ngcontent-%COMP%]{opacity:0}.breadcrumb[_ngcontent-%COMP%]{display:flex}.separator[_ngcontent-%COMP%]{color:var(--color-weight-500);margin:0 3px}"],changeDetection:0});class tt{constructor(){this.allMoveListItems=[],this._rearrange$=new Ut.x,this._delete$=new Ut.x,this.rearrange$=this._rearrange$.asObservable(),this.delete$=this._delete$.asObservable()}ngOnDestroy(){this._rearrange$.complete(),this._delete$.complete()}setCollectionTree(n){this.collectionTree=n}resetMoveList(){this.allMoveListItems=[]}getMoveListItems(n){return 0===this.allMoveListItems.length&&(this.allMoveListItems=this.calculateAllMoveListItems()),this.allMoveListItems.filter(e=>e.id!==n.id&&!e.ancestorIdPath.has(n.id)&&e.id!==n.parent?.id)}onDrop(n){const e=n.item.data,a=n.container.data.id;if(null==a)throw new Error("Could not determine the ID of the root Collection");this._rearrange$.next({collectionId:e.id,parentId:a,index:n.currentIndex})}onMove(n){this._rearrange$.next(n)}onDelete(n){this._delete$.next(n)}calculateAllMoveListItems(){const n=(e,i,a,r)=>{const s=i.concat(e.name);return r.push({path:s.slice(1).join(" / ")||"root",id:e.id,ancestorIdPath:a}),e.children.forEach(l=>n(l,s,new Set([...a,e.id]),r)),r};return n(this.collectionTree,[],new Set,[])}}function Ba(o,n){1&o&&t._UZ(0,"clr-icon",32)}function ja(o,n){1&o&&t._UZ(0,"clr-icon",33)}function Ra(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,r=t.oxw();return t.KtG(r.toggleExpanded(a))}),t.YNc(1,Ba,1,0,"clr-icon",30),t.YNc(2,ja,1,0,"clr-icon",31),t.qZA()}if(2&o){const e=t.oxw().$implicit,i=t.oxw();t.Q6J("disabled",i.expandAll),t.xp6(1),t.Q6J("ngIf",!e.expanded&&!i.expandAll),t.xp6(1),t.Q6J("ngIf",e.expanded||i.expandAll)}}function Ha(o,n){1&o&&t._UZ(0,"div",34)}function Ka(o,n){1&o&&(t.TgZ(0,"vdr-chip"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"catalog.private")))}function za(o,n){1&o&&(t.TgZ(0,"div",35),t._UZ(1,"clr-icon",36),t.qZA())}tt.\u0275fac=function(n){return new(n||tt)},tt.\u0275prov=t.Yz7({token:tt,factory:tt.\u0275fac});const Wa=function(o){return{parentId:o}},Xa=function(o){return["./","create",o]};function tr(o,n){if(1&o&&(t.TgZ(0,"a",37),t._UZ(1,"clr-icon",38),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o){const e=t.oxw().$implicit;t.Q6J("routerLink",t.VKq(6,Xa,t.VKq(4,Wa,e.id))),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.create-new-collection")," ")}}function er(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw().$implicit,l=t.oxw();return t.KtG(l.move(s,r.id))}),t.ALo(1,"async"),t.TgZ(2,"div",39)(3,"div",40),t._UZ(4,"clr-icon",41),t.qZA(),t.TgZ(5,"div",42),t._uU(6),t.qZA()()()}if(2&o){const e=n.$implicit,i=t.oxw(2);t.Q6J("disabled",!t.lcZ(1,2,i.hasUpdatePermission$)),t.xp6(6),t.hij(" ",e.path," ")}}function nr(o,n){if(1&o&&t._UZ(0,"vdr-collection-tree-node",43),2&o){const e=t.oxw().$implicit,i=t.oxw();t.Q6J("expandAll",i.expandAll)("collectionTree",e)("activeCollectionId",i.activeCollectionId)("selectionManager",i.selectionManager)}}const or=function(o){return{contents:o}},ir=function(o){return["./",o]},ar=function(o){return["/catalog/collections/",o]},rr=function(){return["UpdateCatalog","UpdateCollection"]},cr=function(){return["CreateCatalog","CreateCollection"]};function sr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",3)(1,"div",4)(2,"div")(3,"input",5),t.NdJ("click",function(a){const s=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.selectionManager.toggleSelection(s,a))}),t.qZA()(),t.TgZ(4,"div",6),t.YNc(5,Ra,3,3,"button",7),t.YNc(6,Ha,1,0,"ng-template",null,8,t.W1O),t._uU(8),t.qZA(),t._UZ(9,"div",9),t.YNc(10,Ka,3,3,"vdr-chip",10),t.TgZ(11,"a",11),t._UZ(12,"clr-icon",12),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"a",13),t._UZ(16,"clr-icon",14),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.YNc(19,za,2,0,"div",15),t.TgZ(20,"vdr-dropdown")(21,"button",16),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.getMoveListItems(r))}),t._UZ(22,"clr-icon",17),t.qZA(),t.TgZ(23,"vdr-dropdown-menu",18),t.YNc(24,tr,4,8,"a",19),t._UZ(25,"div",20),t.TgZ(26,"button",21),t.NdJ("click",function(){const a=t.CHM(e),r=a.$implicit,s=a.index,l=t.oxw();return t.KtG(l.moveUp(r,s))}),t.ALo(27,"async"),t._UZ(28,"clr-icon",22),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"button",21),t.NdJ("click",function(){const a=t.CHM(e),r=a.$implicit,s=a.index,l=t.oxw();return t.KtG(l.moveDown(r,s))}),t.ALo(32,"async"),t._UZ(33,"clr-icon",23),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.TgZ(36,"h4",24),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.YNc(39,er,7,4,"button",25),t._UZ(40,"div",20),t.TgZ(41,"button",26),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.delete(r.id))}),t.ALo(42,"async"),t._UZ(43,"clr-icon",27),t._uU(44),t.ALo(45,"translate"),t.qZA()()()(),t.YNc(46,nr,1,4,"vdr-collection-tree-node",28),t.qZA()}if(2&o){const e=n.$implicit,i=n.index,a=t.MAs(7),r=t.oxw();t.ekj("private",e.isPrivate),t.Q6J("cdkDragData",e),t.xp6(1),t.ekj("active",e.id===r.activeCollectionId),t.Q6J("ngClass","depth-"+r.depth),t.xp6(2),t.Q6J("checked",r.selectionManager.isSelected(e)),t.xp6(2),t.Q6J("ngIf",null==e.children?null:e.children.length)("ngIfElse",a),t.xp6(3),t.hij(" ",e.name," "),t.xp6(2),t.Q6J("ngIf",e.isPrivate),t.xp6(1),t.Q6J("routerLink",t.VKq(46,ir,t.VKq(44,or,e.id))),t.xp6(2),t.hij(" ",t.lcZ(14,26,"catalog.view-contents")," "),t.xp6(2),t.Q6J("routerLink",t.VKq(48,ar,e.id)),t.xp6(2),t.hij(" ",t.lcZ(18,28,"common.edit")," "),t.xp6(2),t.Q6J("vdrIfPermissions",t.DdM(50,rr)),t.xp6(5),t.Q6J("vdrIfPermissions",t.DdM(51,cr)),t.xp6(2),t.Q6J("disabled",0===i||!t.lcZ(27,30,r.hasUpdatePermission$)),t.xp6(3),t.hij(" ",t.lcZ(30,32,"catalog.move-up")," "),t.xp6(2),t.Q6J("disabled",i===r.collectionTree.children.length-1||!t.lcZ(32,34,r.hasUpdatePermission$)),t.xp6(3),t.hij(" ",t.lcZ(35,36,"catalog.move-down")," "),t.xp6(3),t.Oqu(t.lcZ(38,38,"catalog.move-to")),t.xp6(2),t.Q6J("ngForOf",r.moveListItems),t.xp6(2),t.Q6J("disabled",!t.lcZ(42,40,r.hasDeletePermission$)),t.xp6(3),t.hij(" ",t.lcZ(45,42,"common.delete")," "),t.xp6(2),t.Q6J("ngIf",e.expanded||r.expandAll)}}class et{constructor(n,e,i,a,r,s){this.parent=n,this.dataService=e,this.collectionTreeService=i,this.router=a,this.route=r,this.changeDetectorRef=s,this.depth=0,this.expandAll=!1,this.moveListItems=[],n&&(this.depth=n.depth+1)}ngOnInit(){this.parentName=this.collectionTree.name||"<root>";const n=this.dataService.client.userStatus().mapStream(e=>e.userStatus.permissions).pipe((0,Ht.d)(1));this.hasUpdatePermission$=n.pipe((0,h.U)(e=>e.includes(c.y3$.UpdateCatalog)||e.includes(c.y3$.UpdateCollection))),this.hasDeletePermission$=n.pipe((0,h.U)(e=>e.includes(c.y3$.DeleteCatalog)||e.includes(c.y3$.DeleteCollection))),this.subscription=this.selectionManager?.selectionChanges$.subscribe(()=>this.changeDetectorRef.markForCheck())}ngOnChanges(n){const e=n.expandAll;e&&!0===e.previousValue&&!1===e.currentValue&&this.collectionTree.children.forEach(i=>i.expanded=!1)}ngOnDestroy(){this.subscription?.unsubscribe()}trackByFn(n,e){return e.id}toggleExpanded(n){n.expanded=!n.expanded;let e=this.route.snapshot.queryParamMap.get("expanded")?.split(",")??[];n.expanded?e.push(n.id):e=e.filter(i=>i!==n.id),this.router.navigate(["./"],{queryParams:{expanded:e.filter(i=>!!i).join(",")},queryParamsHandling:"merge",relativeTo:this.route})}getMoveListItems(n){this.moveListItems=this.collectionTreeService.getMoveListItems(n)}move(n,e){this.collectionTreeService.onMove({index:0,parentId:e,collectionId:n.id})}moveUp(n,e){n.parent&&this.collectionTreeService.onMove({index:e-1,parentId:n.parent.id,collectionId:n.id})}moveDown(n,e){n.parent&&this.collectionTreeService.onMove({index:e+1,parentId:n.parent.id,collectionId:n.id})}drop(n){(0,k.bA)(this.collectionTree.children,n.previousIndex,n.currentIndex),this.collectionTreeService.onDrop(n)}delete(n){this.collectionTreeService.onDelete(n)}}function Ye(o,n,e=[]){const i=[],a={},r=function lr(o){const n=new Map;function e(i){n.set(i.id,i),i.children.forEach(e)}return o&&e(o),n}(n);for(const l of o)a[l.id]={...l,children:[]};for(const l of o.map(u=>u.id))if(a.hasOwnProperty(l)){const u=a[l];u.expanded=r.get(l)?.expanded??e.includes(l);const g=u.parent;if(!g)continue;a[g.id]?a[g.id]?a[g.id].children.push(u):a[g.id]={children:[u]}:i.push(u)}return{id:i.length?i[0].parent.id:void 0,children:i}}function dr(o,n){if(1&o&&t._UZ(0,"vdr-collection-tree-node",1),2&o){const e=t.oxw();t.Q6J("expandAll",e.expandAll)("collectionTree",e.collectionTree)("selectionManager",e.selectionManager)("activeCollectionId",e.activeCollectionId)}}et.\u0275fac=function(n){return new(n||et)(t.Y36(et,12),t.Y36(c.DoR),t.Y36(tt),t.Y36(Z.F0),t.Y36(Z.gz),t.Y36(t.sBO))},et.\u0275cmp=t.Xpm({type:et,selectors:[["vdr-collection-tree-node"]],inputs:{collectionTree:"collectionTree",activeCollectionId:"activeCollectionId",expandAll:"expandAll",selectionManager:"selectionManager"},features:[t.TTD],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],["type","checkbox","clrCheckbox","",3,"checked","click"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button",3,"click"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId","selectionManager",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],[1,"move-to-item"],[1,"move-icon"],["shape","child-arrow"],[1,"path"],[3,"expandAll","collectionTree","activeCollectionId","selectionManager"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0,1),t.NdJ("cdkDropListDropped",function(a){return e.drop(a)}),t.ALo(2,"async"),t.YNc(3,sr,47,52,"div",2),t.qZA()),2&n&&(t.Q6J("cdkDropListData",e.collectionTree)("cdkDropListDisabled",!t.lcZ(2,4,e.hasUpdatePermission$)),t.xp6(3),t.Q6J("ngForOf",e.collectionTree.children)("ngForTrackBy",e.trackByFn))},dependencies:[f.q0d,f.qvL,f.KKC,_.mk,_.sg,_.O5,Z.rH,k.Wj,k.Zt,k.Bh,z.Y,F.y,Qt.J,qt.N,$t.U,St.H,J.H,et,_.Ov,b.X$],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--clr-table-bgcolor);border-radius:var(--clr-global-borderradius);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background-color:var(--clr-table-bgcolor);border-radius:var(--clr-global-borderradius);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item[_ngcontent-%COMP%]{display:flex;white-space:normal;align-items:baseline}.move-to-item[_ngcontent-%COMP%]   .move-icon[_ngcontent-%COMP%]{flex:none;margin-right:3px}.move-to-item[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{line-height:18px}"],changeDetection:0});class Yt{constructor(n){this.collectionTreeService=n,this.expandAll=!1,this.expandedIds=[],this.rearrange=new t.vpe,this.deleteCollection=new t.vpe}ngOnChanges(n){"collections"in n&&this.collections&&(this.collectionTree=Ye(this.collections,this.collectionTree,this.expandedIds),this.collectionTreeService.setCollectionTree(this.collectionTree),this.collectionTreeService.resetMoveList())}ngOnInit(){this.collectionTreeService.rearrange$.subscribe(n=>this.rearrange.emit(n)),this.collectionTreeService.delete$.subscribe(n=>this.deleteCollection.emit(n))}}function pr(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.hij(" ",t.lcZ(1,1,"catalog.confirm-deletion-of-unused-variants-title"),"\n")}function ur(o,n){if(1&o&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.AsE("",e.name," (",e.sku,")")}}function mr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",4),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.confirm())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,2,"common.cancel")),t.xp6(3),t.hij(" ",t.lcZ(5,4,"common.confirm")," "))}Yt.\u0275fac=function(n){return new(n||Yt)(t.Y36(tt))},Yt.\u0275cmp=t.Xpm({type:Yt,selectors:[["vdr-collection-tree"]],inputs:{collections:"collections",activeCollectionId:"activeCollectionId",expandAll:"expandAll",expandedIds:"expandedIds",selectionManager:"selectionManager"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[t._Bn([tt]),t.TTD],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","selectionManager","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","selectionManager","activeCollectionId"]],template:function(n,e){1&n&&t.YNc(0,dr,1,4,"vdr-collection-tree-node",0),2&n&&t.Q6J("ngIf",e.collectionTree)},dependencies:[_.O5,k.Fd,et],changeDetection:0});class Gt{constructor(){this.variants=[]}confirm(){this.resolveWith(!0)}cancel(){this.resolveWith()}}Gt.\u0275fac=function(n){return new(n||Gt)},Gt.\u0275cmp=t.Xpm({type:Gt,selectors:[["vdr-confirm-variant-deletion-dialog"]],decls:6,vars:4,consts:[["vdrDialogTitle",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(n,e){1&n&&(t.YNc(0,pr,2,3,"ng-template",0),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ul"),t.YNc(4,ur,2,2,"li",1),t.qZA(),t.YNc(5,mr,6,6,"ng-template",2)),2&n&&(t.xp6(1),t.hij("\n",t.lcZ(2,2,"catalog.confirm-deletion-of-unused-variants-body"),"\n"),t.xp6(3),t.Q6J("ngForOf",e.variants))},dependencies:[_.sg,ft.n,ot.q,b.X$],changeDetection:0});var gr=m(2157);function _r(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.create())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.create")," ")}}function fr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function hr(o,n){if(1&o&&t.YNc(0,fr,3,4,"button",21),2&o){const e=t.oxw();t.Q6J("vdrIfPermissions",e.updatePermission)}}function vr(o,n){1&o&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"catalog.public")))}function Cr(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.Oqu(t.lcZ(1,1,"catalog.private"))}function xr(o,n){if(1&o&&t._UZ(0,"vdr-page-entity-info",22),2&o){const e=n.ngIf;t.Q6J("entity",e)}}function br(o,n){if(1&o&&(t.TgZ(0,"vdr-card",23),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",24),t.ALo(3,"hasPermission"),t.qZA()),2&o){const e=t.oxw();t.Q6J("title",t.lcZ(1,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get("facet.customFields"))("readonly",!t.lcZ(3,6,e.updatePermission))}}function Tr(o,n){1&o&&(t.ynx(0),t.TgZ(1,"th"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.BQk()),2&o&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"common.custom-fields")))}const Zr=function(o){return["values",o,"customFields"]};function Ar(o,n){if(1&o&&(t.TgZ(0,"td",41),t._UZ(1,"vdr-tabbed-custom-fields",42),t.ALo(2,"hasPermission"),t.qZA()),2&o){const e=t.oxw().index,i=t.oxw(3);t.xp6(1),t.Q6J("customFields",i.customValueFields)("compact",!0)("customFieldsFormGroup",i.detailForm.get(t.VKq(6,Zr,e)))("readonly",!t.lcZ(2,4,i.updatePermission))}}const Pr=function(o){return["values",o]};function yr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"tr",31)(1,"td",32),t._UZ(2,"vdr-entity-info",22),t.qZA(),t.TgZ(3,"td",32)(4,"input",33),t.NdJ("input",function(a){const s=t.CHM(e).index,l=t.oxw(3);return t.KtG(l.updateValueCode(null==l.entity||null==l.entity.values[s]?null:l.entity.values[s].code,a.target.value,s))}),t.ALo(5,"hasPermission"),t.qZA()(),t.TgZ(6,"td",32),t._UZ(7,"input",34),t.qZA(),t.YNc(8,Ar,3,8,"td",35),t.TgZ(9,"td",32)(10,"vdr-dropdown")(11,"button",36),t._uU(12),t.ALo(13,"translate"),t._UZ(14,"clr-icon",37),t.qZA(),t.TgZ(15,"vdr-dropdown-menu",38)(16,"button",39),t.NdJ("click",function(){const r=t.CHM(e).index,s=t.oxw(3);return t.KtG(s.deleteFacetValue(null==s.entity||null==s.entity.values[r]?null:s.entity.values[r].id,r))}),t.ALo(17,"hasPermission"),t._UZ(18,"clr-icon",40),t._uU(19),t.ALo(20,"translate"),t.qZA()()()()()}if(2&o){const e=n.$implicit,i=n.index,a=t.oxw(3);t.Q6J("formGroup",a.detailForm.get(t.VKq(15,Pr,i))),t.xp6(2),t.Q6J("entity",e),t.xp6(2),t.Q6J("readonly",!t.lcZ(5,7,a.updatePermission)),t.xp6(4),t.Q6J("ngIf",a.customValueFields.length),t.xp6(4),t.hij(" ",t.lcZ(13,9,"common.actions")," "),t.xp6(4),t.Q6J("disabled",!t.lcZ(17,11,a.updatePermission)),t.xp6(3),t.hij(" ",t.lcZ(20,13,"common.delete")," ")}}function Fr(o,n){if(1&o&&(t.TgZ(0,"table",28)(1,"thead")(2,"tr"),t._UZ(3,"th"),t.TgZ(4,"th"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"th"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.YNc(10,Tr,4,3,"ng-container",29),t._UZ(11,"th"),t.qZA()(),t.TgZ(12,"tbody"),t.YNc(13,yr,21,17,"tr",30),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(5),t.Oqu(t.lcZ(6,4,"common.name")),t.xp6(3),t.Oqu(t.lcZ(9,6,"common.code")),t.xp6(2),t.Q6J("ngIf",e.customValueFields.length),t.xp6(3),t.Q6J("ngForOf",e.values)}}function Lr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",43),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.addFacetValue())}),t._UZ(1,"clr-icon",44),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&o&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"catalog.add-facet-value")," "))}const Ir=function(){return["CreateCatalog","CreateFacet"]};function kr(o,n){if(1&o&&(t.TgZ(0,"vdr-card",25),t.ALo(1,"translate"),t.YNc(2,Fr,14,8,"table",26),t.TgZ(3,"div"),t.YNc(4,Lr,4,3,"button",27),t.qZA()()),2&o){const e=t.oxw();t.Q6J("title",t.lcZ(1,4,"catalog.facet-values"))("paddingX",!1),t.xp6(2),t.Q6J("ngIf",0<e.getValuesFormArray().length),t.xp6(2),t.Q6J("vdrIfPermissions",t.DdM(6,Ir))}}const Or=A.Ps`
    query GetFacetDetail($id: ID!) {
        facet(id: $id) {
            ...FacetWithValues
        }
    }
    ${c.nMi}
`;class Ft extends c.VE7{constructor(n,e,i,a,r){super(),this.changeDetector=n,this.dataService=e,this.formBuilder=i,this.notificationService=a,this.modalService=r,this.customFields=this.getCustomFieldConfig("Facet"),this.customValueFields=this.getCustomFieldConfig("FacetValue"),this.detailForm=this.formBuilder.group({facet:this.formBuilder.group({code:["",d.kI.required],name:"",visible:!0,customFields:this.formBuilder.group(this.customFields.reduce((s,l)=>({...s,[l.name]:""}),{}))}),values:this.formBuilder.array([])}),this.values=[],this.updatePermission=[c.y3$.UpdateCatalog,c.y3$.UpdateFacet]}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}updateCode(n,e){if(!n){const i=this.detailForm.get(["facet","code"]);i&&i.pristine&&i.setValue((0,j.U)(e,"-"))}}updateValueCode(n,e,i){if(!n){const a=this.detailForm.get(["values",i,"code"]);a&&a.pristine&&a.setValue((0,j.U)(e,"-"))}}customValueFieldIsSet(n,e){return!!this.detailForm.get(["values",n,"customFields",e])}getValuesFormArray(){return this.detailForm.get("values")}addFacetValue(){const n=this.detailForm.get("values");if(n){const e=this.formBuilder.group({id:"",name:["",d.kI.required],code:"",customFields:this.formBuilder.group({})}),i={name:"",code:""};if(this.customValueFields.length){const a=new d.nJ({});i.customFields={};for(const r of this.customValueFields){const s=r.name;a.addControl(s,new d.p4)}e.addControl("customFields",a)}n.insert(n.length,e),this.values.push(i)}}create(){const n=this.detailForm.get("facet");if(!n||!n.dirty)return;const e=this.getUpdatedFacet({id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:this.languageCode,name:"",code:"",translations:[],values:[]},n,this.languageCode);this.dataService.facet.createFacet(e).subscribe(i=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"Facet"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",i.createFacet.id],{relativeTo:this.route})},i=>{this.notificationService.error((0,p.J)("common.notify-create-error"),{entity:"Facet"})})}save(){const n=this.detailForm.get("values");(0,y.a)(this.entity$,this.languageCode$).pipe((0,$.q)(1),(0,w.z)(([e,i])=>{const a=this.detailForm.get("facet"),r=[];if(a&&a.dirty){const s=this.getUpdatedFacet(e,a,i);s&&r.push(this.dataService.facet.updateFacet(s))}if(n&&n.dirty){const s=this.getCreatedFacetValues(e,n,i);s.length&&r.push(this.dataService.facet.createFacetValues(s).pipe((0,C.w)(()=>this.dataService.query(c.m_w,{id:this.id}).single$)));const l=this.getUpdatedFacetValues(e,n,i);l.length&&r.push(this.dataService.facet.updateFacetValues(l))}return(0,Nt.D)(r)})).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"Facet"})},e=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"Facet"})})}deleteFacetValue(n,e){if(!n){const i=this.detailForm.get("values");return i&&i.removeAt(e),void this.values.splice(e,1)}this.showModalAndDelete(n).pipe((0,C.w)(i=>i.result===c.PcR.DELETED?[!0]:this.showModalAndDelete(n,i.message||"").pipe((0,h.U)(a=>a.result===c.PcR.DELETED))),(0,C.w)(i=>i?this.dataService.query(c.m_w,{id:this.id}).single$:[])).subscribe(()=>{const i=this.detailForm.get("values");i&&i.removeAt(e),this.notificationService.success((0,p.J)("common.notify-delete-success"),{entity:"FacetValue"})},i=>{this.notificationService.error((0,p.J)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(n,e){return this.modalService.dialog({title:(0,p.J)("catalog.confirm-delete-facet-value"),body:e,buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(i=>i?this.dataService.facet.deleteFacetValues([n],!!e):L.E),(0,h.U)(i=>i.deleteFacetValues[0]))}setFormValues(n,e){const i=(0,c.ZIM)(n,e);if(this.detailForm.patchValue({facet:{code:n.code,visible:!n.isPrivate,name:i?.name??""}}),this.customFields.length){this.detailForm.get(["facet","customFields"]);this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["facet","customFields"]),n,i)}const a=this.detailForm.get("values");this.values=[...n.values],n.values.forEach(r=>{const s=(0,c.ZIM)(r,e),l={id:r.id,code:r.code,name:s?s.name:""};let u=a.controls.find(g=>g.value.id===r.id);if(u?(u.get("id")?.setValue(l.id),u.get("code")?.setValue(l.code),u.get("name")?.setValue(l.name)):(u=this.formBuilder.group(l),a.push(u)),this.customValueFields.length){let g=u.get(["customFields"]);if(g||(g=new d.nJ({}),u.addControl("customFields",g)),g)for(const v of this.customValueFields){const T=v.name,P="localeString"===v.type?s?.customFields?.[T]:r.customFields[T],I=g.get(T);I?I.setValue(P):g.addControl(T,new d.p4(P))}}})}getUpdatedFacet(n,e,i){const a=(0,c.iSy)({translatable:n,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:i,defaultTranslation:{languageCode:i,name:n.name||""}});return a.isPrivate=!e.value.visible,a}getCreatedFacetValues(n,e,i){return e.controls.filter(a=>!a.value?.id).map(a=>a.value).map(a=>(0,c.iSy)({translatable:{...a,translations:[]},updatedFields:a??{},customFieldConfig:this.customValueFields,languageCode:i,defaultTranslation:{languageCode:i,name:""}})).map(a=>({facetId:n.id,code:a.code??"",...a}))}getUpdatedFacetValues(n,e,i){const a=n.values.filter((s,l)=>{const u=e.get(l.toString());return u&&u.dirty&&u.value.id}),r=e.controls.filter(s=>s.dirty&&s.value.id).map(s=>s.value);if(a.length!==r.length)throw new Error((0,p.J)("error.facet-value-form-values-do-not-match"));return a.map((s,l)=>(0,c.iSy)({translatable:s,updatedFields:r[l],customFieldConfig:this.customValueFields,languageCode:i,defaultTranslation:{languageCode:i,name:""}})).filter(ne.notNullOrUndefined)}}Ft.\u0275fac=function(n){return new(n||Ft)(t.Y36(t.sBO),t.Y36(c.DoR),t.Y36(d.qu),t.Y36(c.gqp),t.Y36(c.Z7U))},Ft.\u0275cmp=t.Xpm({type:Ft,selectors:[["vdr-facet-detail"]],features:[t.qOj],decls:44,vars:43,consts:[[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["formGroupName","facet"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],[3,"entity",4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label"],["id","code","type","text","formControlName","code",3,"readonly"],[3,"title",4,"ngIf"],["locationId","facet-detail",3,"entity$","detailForm"],[3,"title","paddingX",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"entity"],[3,"title"],["entityName","Facet",3,"customFields","customFieldsFormGroup","readonly"],[3,"title","paddingX"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","button m-3",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],[4,"ngIf"],["class","facet-value",3,"formGroup",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroup"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code"],["class","",4,"ngIf"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[1,""],["entityName","FacetValue",3,"customFields","compact","customFieldsFormGroup","readonly"],["type","button",1,"button","m-3",3,"click"],["shape","add"]],template:function(n,e){if(1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(4,"async"),t.ALo(5,"async"),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"vdr-ab-right"),t._UZ(8,"vdr-action-bar-items",1),t.YNc(9,_r,3,4,"button",2),t.ALo(10,"async"),t.YNc(11,hr,1,1,"ng-template",null,3,t.W1O),t.qZA()()(),t.TgZ(13,"form",4)(14,"vdr-page-detail-layout")(15,"vdr-page-detail-sidebar",5)(16,"vdr-card")(17,"vdr-form-field",6),t.ALo(18,"translate"),t.TgZ(19,"clr-toggle-wrapper"),t._UZ(20,"input",7),t.ALo(21,"hasPermission"),t.TgZ(22,"label",8),t.YNc(23,vr,3,3,"ng-container",9),t.YNc(24,Cr,2,3,"ng-template",null,10,t.W1O),t.qZA()()()(),t.TgZ(26,"vdr-card"),t.YNc(27,xr,1,1,"vdr-page-entity-info",11),t.ALo(28,"async"),t.qZA()(),t.TgZ(29,"vdr-page-block")(30,"vdr-card",5)(31,"div",12)(32,"vdr-form-field",13),t.ALo(33,"translate"),t.TgZ(34,"input",14),t.NdJ("input",function(a){return e.updateCode(null==e.entity?null:e.entity.code,a.target.value)}),t.ALo(35,"hasPermission"),t.qZA()(),t.TgZ(36,"vdr-form-field",15),t.ALo(37,"translate"),t._UZ(38,"input",16),t.ALo(39,"hasPermission"),t.qZA()()(),t.YNc(40,br,4,8,"vdr-card",17),t._UZ(41,"vdr-custom-detail-component-host",18),t.YNc(42,kr,5,7,"vdr-card",19),t.ALo(43,"async"),t.qZA()()()),2&n){const i=t.MAs(12),a=t.MAs(25);t.xp6(3),t.Q6J("disabled",t.lcZ(4,19,e.isNew$))("availableLanguageCodes",t.lcZ(5,21,e.availableLanguages$))("currentLanguageCode",t.lcZ(6,23,e.languageCode$)),t.xp6(6),t.Q6J("ngIf",t.lcZ(10,25,e.isNew$))("ngIfElse",i),t.xp6(4),t.Q6J("formGroup",e.detailForm),t.xp6(4),t.Q6J("label",t.lcZ(18,27,"catalog.visibility")),t.xp6(3),t.Q6J("vdrDisabled",!t.lcZ(21,29,e.updatePermission)),t.xp6(3),t.Q6J("ngIf",null==e.detailForm.value.facet?null:e.detailForm.value.facet.visible)("ngIfElse",a),t.xp6(4),t.Q6J("ngIf",t.lcZ(28,31,e.entity$)),t.xp6(5),t.Q6J("label",t.lcZ(33,33,"common.name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(35,35,e.updatePermission)),t.xp6(2),t.Q6J("label",t.lcZ(37,37,"common.code")),t.xp6(2),t.Q6J("readonly",!t.lcZ(39,39,e.updatePermission)),t.xp6(2),t.Q6J("ngIf",e.customFields.length),t.xp6(1),t.Q6J("entity$",e.entity$)("detailForm",e.detailForm),t.xp6(1),t.Q6J("ngIf",!t.lcZ(43,41,e.isNew$))}},dependencies:[f.qvL,f.MgK,f.KKC,f.PEh,_.sg,_.O5,d._Y,d.Fj,d.Wl,d.JJ,d.JL,d.sg,d.u,d.x0,d.CE,x.Kk,x.BN,x.mz,M.h,F.y,R.S,Qt.J,qt.N,$t.U,St.H,J.H,G.W,se.x,gr.V,ut.y,Kt.C,O.z,Vt.D,zt.T,Wt.W,gt.A,_.Ov,b.X$,Y.j],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0});const Ge=(0,c.wwB)({location:"facet-list",requiresPermission:o=>o.includes(c.y3$.DeleteFacet)||o.includes(c.y3$.DeleteCatalog),getItemName:o=>o.name,shouldRetryItem:(o,n)=>!!o.message,bulkDelete:(o,n,e)=>o.facet.deleteFacets(n,e).pipe((0,h.U)(i=>i.deleteFacets))}),Ee=(0,c.z1G)({location:"facet-list",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateFacet),getItemName:o=>o.name,bulkAssignToChannel:(o,n,e)=>o.facet.assignFacetsToChannel({facetIds:n,channelId:e}).pipe((0,h.U)(i=>i.assignFacetsToChannel))}),Be=(0,c.RBx)({location:"facet-list",requiresPermission:o=>o.includes(c.y3$.DeleteCatalog)||o.includes(c.y3$.DeleteFacet),getItemName:o=>o.name,bulkRemoveFromChannel:(o,n,e,i)=>o.facet.removeFacetsFromChannel({channelId:e,facetIds:n,force:i}).pipe((0,h.U)(a=>a.removeFacetsFromChannel)),isErrorResult:o=>"FacetInUseError"===o.__typename?o.message:void 0}),Jr={location:"facet-list",label:(0,p.J)("catalog.remove-from-channel"),getTranslationVars:({injector:o})=>(0,c.PDO)(o.get(c.DoR)),icon:"layers",iconClass:"is-warning",requiresPermission:o=>o.includes(c.y3$.UpdateFacet)||o.includes(c.y3$.UpdateCatalog),isVisible:({injector:o})=>(0,c._Nz)(o.get(c.DoR)),onClick:({injector:o,selection:n,hostComponent:e,clearSelection:i})=>{const a=o.get(c.Z7U),r=o.get(c.DoR),s=o.get(c.gqp),l=r.client.userStatus().mapSingle(({userStatus:g})=>g.activeChannelId);function u(g,v){return a.dialog({title:(0,p.J)("catalog.remove-from-channel"),translationVars:{count:n.length},size:v?"lg":"md",body:v,buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:v?(0,p.J)("common.force-remove"):(0,p.J)("common.remove"),returnValue:!0}]}).pipe((0,C.w)(T=>T?l.pipe((0,C.w)(P=>P?r.facet.removeFacetsFromChannel({channelId:P,facetIds:g,force:!!v}):L.E),(0,h.U)(P=>P.removeFacetsFromChannel)):L.E))}u((0,V.T)(n.map(g=>g.id))).pipe((0,C.w)(g=>{let v=n.length;const T=[],P=[];let I=0;for(const q of g)"FacetInUseError"===q.__typename&&(T.push(q.message),P.push(n[I]?.id),v--),I++;return 0<P.length?u(P,T.join("\n")).pipe((0,h.U)(q=>{const D=q.filter(pt=>"FacetInUseError"===pt.__typename).length;return n.length-D})):(0,N.of)(v)}),(0,C.w)(g=>g?(0,c.PDO)(r).then(({channelCode:v})=>({channelCode:v,removedCount:g})):L.E)).subscribe(({removedCount:g,channelCode:v})=>{g&&(e.refresh(),i(),s.success((0,p.J)("catalog.notify-remove-facets-from-channel-success"),{count:g,channelCode:v}))})}},Dr=function(){return["./create"]};function wr(o,n){1&o&&(t.TgZ(0,"a",10),t._UZ(1,"clr-icon",11),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,Dr)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.create-new-facet")," "))}function Nr(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function Vr(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function Ur(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}const Mr=function(o){return["./",o]};function Qr(o,n){if(1&o&&(t.TgZ(0,"a",12)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",13),t.qZA()),2&o){const e=n.item;t.Q6J("routerLink",t.VKq(2,Mr,e.id)),t.xp6(2),t.Oqu(e.name)}}function qr(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.code," ")}}function $r(o,n){1&o&&(t.TgZ(0,"vdr-chip",16),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.private")))}function Sr(o,n){1&o&&(t.TgZ(0,"vdr-chip",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.public")))}function Yr(o,n){if(1&o&&(t.YNc(0,$r,3,3,"vdr-chip",14),t.YNc(1,Sr,3,3,"vdr-chip",15)),2&o){const e=n.item;t.Q6J("ngIf",e.isPrivate),t.xp6(1),t.Q6J("ngIf",!e.isPrivate)}}function Gr(o,n){if(1&o&&t._UZ(0,"vdr-facet-value-chip",21),2&o){const e=n.$implicit;t.Q6J("facetValue",e)("removable",!1)("displayFacetName",!1)}}function Er(o,n){if(1&o&&(t.ynx(0),t._UZ(1,"clr-icon",11),t._uU(2),t.BQk()),2&o){const e=t.oxw(2).item,i=t.oxw();t.xp6(2),t.hij(" ",e.values.length-i.initialLimit," ")}}function Br(o,n){1&o&&t._UZ(0,"clr-icon",25)}function jr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().item,r=t.oxw();return t.KtG(r.toggleDisplayLimit(a))}),t.YNc(1,Er,3,1,"ng-container",23),t.YNc(2,Br,1,0,"ng-template",null,24,t.W1O),t.qZA()}if(2&o){const e=t.MAs(3),i=t.oxw().item,a=t.oxw();t.xp6(1),t.Q6J("ngIf",(a.displayLimit[i.id]||0)<i.values.length)("ngIfElse",e)}}function Rr(o,n){if(1&o&&(t.TgZ(0,"div",18),t.YNc(1,Gr,1,3,"vdr-facet-value-chip",19),t.ALo(2,"slice"),t.YNc(3,jr,4,2,"button",20),t.qZA()),2&o){const e=n.item,i=t.oxw();t.xp6(1),t.Q6J("ngForOf",t.Dn7(2,2,e.values,0,i.displayLimit[e.id]||3)),t.xp6(2),t.Q6J("ngIf",e.values.length>i.initialLimit)}}function Hr(o,n){if(1&o&&t._UZ(0,"vdr-dt2-custom-field-column",26),2&o){const e=n.$implicit,i=t.oxw();t.Q6J("customField",e)("sorts",i.sorts)}}const Kr=function(){return["CreateCatalog","CreateFacet"]},zr=A.Ps`
    query GetFacetList($options: FacetListOptions) {
        facets(options: $options) {
            items {
                ...FacetWithValues
            }
            totalItems
        }
    }
    ${c.nMi}
`;class Lt extends c.$ms{constructor(n){super(),this.dataService=n,this.initialLimit=3,this.displayLimit={},this.customFields=this.getCustomFieldConfig("Facet"),this.filters=this.createFilterCollection().addDateFilters().addFilter({name:"visibility",type:{kind:"boolean"},label:(0,p.J)("common.visibility"),toFilterInput:e=>({isPrivate:{eq:!e}})}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSort({name:"id"}).addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"name"}).addSort({name:"code"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),super.configure({document:c.JJ4,getItems:e=>e.facets,setVariables:(e,i)=>({options:{skip:e,take:i,filter:{name:{contains:this.searchTermControl.value},...this.filters.createFilterInput()},sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]})}toggleDisplayLimit(n){this.displayLimit[n.id]===n.values.length?this.displayLimit[n.id]=this.initialLimit:this.displayLimit[n.id]=n.values.length}setLanguage(n){this.dataService.client.setContentLanguage(n).subscribe()}}Lt.\u0275fac=function(n){return new(n||Lt)(t.Y36(c.DoR))},Lt.\u0275cmp=t.Xpm({type:Lt,selectors:[["vdr-facet-list"]],features:[t.qOj],decls:39,vars:57,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],["id","facet-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","facet-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault","sort"],[3,"heading","optional","sort"],[3,"heading"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["colorType","warning",4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","warning"],["colorType","success"],[1,"facet-values-list"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","button-small",3,"click",4,"ngIf"],[3,"facetValue","removable","displayFacetName"],[1,"button-small",3,"click"],[4,"ngIf","ngIfElse"],["collapse",""],["shape","minus"],[3,"customField","sorts"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"vdr-ab-right"),t._UZ(7,"vdr-action-bar-items",1),t.YNc(8,wr,4,5,"a",2),t.qZA()()(),t.TgZ(9,"vdr-data-table-2",3),t.NdJ("pageChange",function(a){return e.setPageNumber(a)})("itemsPerPageChange",function(a){return e.setItemsPerPage(a)}),t.ALo(10,"async"),t.ALo(11,"async"),t.ALo(12,"async"),t.ALo(13,"async"),t._UZ(14,"vdr-bulk-action-menu",4)(15,"vdr-dt2-search",5),t.ALo(16,"translate"),t.TgZ(17,"vdr-dt2-column",6),t.ALo(18,"translate"),t.YNc(19,Nr,1,1,"ng-template"),t.qZA(),t.TgZ(20,"vdr-dt2-column",6),t.ALo(21,"translate"),t.YNc(22,Vr,2,4,"ng-template"),t.qZA(),t.TgZ(23,"vdr-dt2-column",6),t.ALo(24,"translate"),t.YNc(25,Ur,2,4,"ng-template"),t.qZA(),t.TgZ(26,"vdr-dt2-column",7),t.ALo(27,"translate"),t.YNc(28,Qr,4,4,"ng-template"),t.qZA(),t.TgZ(29,"vdr-dt2-column",8),t.ALo(30,"translate"),t.YNc(31,qr,1,1,"ng-template"),t.qZA(),t.TgZ(32,"vdr-dt2-column",8),t.ALo(33,"translate"),t.YNc(34,Yr,2,2,"ng-template"),t.qZA(),t.TgZ(35,"vdr-dt2-column",8),t.ALo(36,"translate"),t.YNc(37,Rr,4,6,"ng-template"),t.qZA(),t.YNc(38,Hr,1,2,"vdr-dt2-custom-field-column",9),t.qZA()),2&n&&(t.xp6(3),t.Q6J("availableLanguageCodes",t.lcZ(4,28,e.availableLanguages$))("currentLanguageCode",t.lcZ(5,30,e.contentLanguage$)),t.xp6(5),t.Q6J("vdrIfPermissions",t.DdM(56,Kr)),t.xp6(1),t.Q6J("items",t.lcZ(10,32,e.items$))("itemsPerPage",t.lcZ(11,34,e.itemsPerPage$))("totalItems",t.lcZ(12,36,e.totalItems$))("currentPage",t.lcZ(13,38,e.currentPage$))("filters",e.filters),t.xp6(5),t.Q6J("hostComponent",e)("selectionManager",e.selectionManager),t.xp6(1),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(16,40,"catalog.filter-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(18,42,"common.id"))("hiddenByDefault",!0)("sort",e.sorts.get("id")),t.xp6(3),t.Q6J("heading",t.lcZ(21,44,"common.created-at"))("hiddenByDefault",!0)("sort",e.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(24,46,"common.updated-at"))("hiddenByDefault",!0)("sort",e.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(27,48,"common.name"))("optional",!1)("sort",e.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(30,50,"common.code")),t.xp6(3),t.Q6J("heading",t.lcZ(33,52,"common.visibility")),t.xp6(3),t.Q6J("heading",t.lcZ(36,54,"catalog.values")),t.xp6(3),t.Q6J("ngForOf",e.customFields))},dependencies:[f.qvL,_.sg,_.O5,Z.rH,x.Kk,x.BN,x.mz,z.Y,ce.q,R.S,J.H,G.W,Xt.c,mt.e,H.U,it.J,te.j,O.z,_.Ov,_.OU,b.X$,nt.H],styles:[".facet-values-list[_ngcontent-%COMP%]{max-width:500px;display:flex;flex-wrap:wrap;align-items:center;gap:4px}"]});var ge=m(7619);const Wr=["optionGroupName"];function Xr(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",4)(1,"div",5)(2,"label"),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"input",6,7),t.NdJ("ngModelChange",function(a){const s=t.CHM(e).$implicit;return t.KtG(s.name=a)})("keydown.enter",function(a){t.CHM(e);const r=t.MAs(12),s=t.oxw();return t.KtG(s.handleEnter(a,r))}),t.qZA()(),t.TgZ(7,"div",8)(8,"label"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"vdr-option-value-input",9,10),t.NdJ("ngModelChange",function(a){const s=t.CHM(e).$implicit;return t.KtG(s.values=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.generateVariants())})("edit",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.generateVariants())}),t.qZA()(),t.TgZ(13,"div",11)(14,"button",12),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.removeOption(r.name))}),t.ALo(15,"translate"),t._UZ(16,"clr-icon",13),t.qZA()()()}if(2&o){const e=n.$implicit;t.xp6(3),t.Oqu(t.lcZ(4,7,"catalog.option")),t.xp6(2),t.Q6J("ngModel",e.name),t.xp6(4),t.Oqu(t.lcZ(10,9,"catalog.option-values")),t.xp6(2),t.Q6J("ngModel",e.values)("groupName",e.name)("disabled",""===e.name),t.xp6(3),t.Q6J("title",t.lcZ(15,11,"catalog.remove-option"))}}function tc(o,n){1&o&&(t.TgZ(0,"clr-alert",18)(1,"clr-alert-item")(2,"span",19),t._uU(3),t.ALo(4,"translate"),t.qZA()()()),2&o&&(t.Q6J("clrAlertClosable",!1),t.xp6(3),t.hij(" ",t.lcZ(4,2,"catalog.no-stock-locations-available-on-current-channel")," "))}function ec(o,n){if(1&o&&(t.TgZ(0,"option",23),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function nc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-form-field",20),t.ALo(1,"translate"),t.TgZ(2,"select",21),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw(2);return t.KtG(r.selectedStockLocationId=a)}),t.YNc(3,ec,2,2,"option",22),t.qZA()()}if(2&o){const e=t.oxw().ngIf,i=t.oxw();t.Q6J("label",t.lcZ(1,3,"catalog.add-stock-to-location")),t.xp6(2),t.Q6J("ngModel",i.selectedStockLocationId),t.xp6(1),t.Q6J("ngForOf",e)}}function oc(o,n){1&o&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.create")))}function ic(o,n){1&o&&(t.TgZ(0,"th"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"catalog.variant")))}function ac(o,n){1&o&&(t.TgZ(0,"td"),t._UZ(1,"input",31),t.qZA())}function rc(o,n){if(1&o&&(t.TgZ(0,"td"),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.values.join(" ")," ")}}function cc(o,n){if(1&o&&(t.TgZ(0,"tr",27),t.YNc(1,ac,2,0,"td",3),t.YNc(2,rc,2,1,"td",3),t.TgZ(3,"td")(4,"vdr-form-field"),t._UZ(5,"input",28),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"td")(8,"vdr-form-field"),t._UZ(9,"vdr-currency-input",29),t.qZA()(),t.TgZ(10,"td")(11,"vdr-form-field"),t._UZ(12,"input",30),t.qZA()()()),2&o){const e=n.$implicit,i=t.oxw(3);t.ekj("disabled",!!i.variantFormValues[e.id].value.enabled),t.Q6J("formGroup",i.variantFormValues[e.id]),t.xp6(1),t.Q6J("ngIf",1<i.variants.length),t.xp6(1),t.Q6J("ngIf",1<i.variants.length),t.xp6(3),t.Q6J("placeholder",t.lcZ(6,7,"catalog.sku")),t.xp6(4),t.Q6J("currencyCode",i.currencyCode)}}function sc(o,n){if(1&o&&(t.TgZ(0,"div",24)(1,"table",25)(2,"thead")(3,"tr"),t.YNc(4,oc,3,3,"th",3),t.YNc(5,ic,3,3,"th",3),t.TgZ(6,"th"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"th"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"th"),t._uU(13),t.ALo(14,"translate"),t.qZA()()(),t.YNc(15,cc,13,9,"tr",26),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(4),t.Q6J("ngIf",1<e.variants.length),t.xp6(1),t.Q6J("ngIf",1<e.variants.length),t.xp6(2),t.Oqu(t.lcZ(8,7,"catalog.sku")),t.xp6(3),t.Oqu(t.lcZ(11,9,"catalog.price")),t.xp6(3),t.Oqu(t.lcZ(14,11,"catalog.stock-on-hand")),t.xp6(2),t.Q6J("ngForOf",e.variants)("ngForTrackBy",e.trackByFn)}}function lc(o,n){if(1&o&&(t.ynx(0),t.YNc(1,tc,5,4,"clr-alert",14),t.TgZ(2,"div",15),t.YNc(3,nc,4,5,"vdr-form-field",16),t.qZA(),t.YNc(4,sc,16,13,"div",17),t.BQk()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("ngIf",0===e.length),t.xp6(2),t.Q6J("ngIf",e.length),t.xp6(1),t.Q6J("ngIf",0<e.length)}}const _e="__DEFAULT_VARIANT__";class It{constructor(n,e){this.dataService=n,this.formBuilder=e,this.variantsChange=new t.vpe,this.optionGroups=[],this.variantFormValues={},this.selectedStockLocationId=null}ngOnInit(){this.dataService.settings.getActiveChannel().single$.subscribe(n=>{this.currencyCode=n.activeChannel.defaultCurrencyCode}),this.stockLocations$=this.dataService.query(c.uQH,{options:{take:999}}).refetchOnChannelChange().mapStream(({stockLocations:n})=>n.items).pipe((0,B.b)(n=>{n.length&&(this.selectedStockLocationId=n[0].id)})),this.generateVariants()}addOption(){this.optionGroups.push({name:"",values:[]});const n=this.optionGroups.length-1;setTimeout(()=>{this.groupNameInputs.get(n)?.nativeElement?.focus()})}removeOption(n){this.optionGroups=this.optionGroups.filter(e=>e.name!==n),this.generateVariants()}generateVariants(){const e=this.optionGroups.reduce((i,a)=>i+a.values.length,0)?this.optionGroups.map(i=>i.values.map(a=>a.name)):[[_e]];this.variants=(0,ne.generateAllCombinations)(e).map(i=>({id:i.join("|"),values:i})),this.variants.forEach((i,a)=>{if(!this.variantFormValues[i.id]){const r=this.formBuilder.nonNullable.group({optionValues:[i.values],enabled:!0,price:this.copyFromDefault(i.id,"price",0),sku:this.copyFromDefault(i.id,"sku",""),stock:this.copyFromDefault(i.id,"stock",0)});r.valueChanges.subscribe(()=>this.onFormChange()),0===a&&(r.get("price")?.valueChanges.subscribe(s=>{this.copyValuesToPristine("price",r.get("price"))}),r.get("sku")?.valueChanges.subscribe(s=>{this.copyValuesToPristine("sku",r.get("sku"))}),r.get("stock")?.valueChanges.subscribe(s=>{this.copyValuesToPristine("stock",r.get("stock"))})),this.variantFormValues[i.id]=r}})}trackByFn(n,e){return e.values.join("|")}handleEnter(n,e){n.preventDefault(),n.stopPropagation(),e.focus()}copyValuesToPristine(n,e){e&&Object.values(this.variantFormValues).forEach(i=>{const a=i.get(n);a&&a.pristine&&a.setValue(e.value,{emitEvent:!1})})}onFormChange(){const n=this.variants.map(e=>this.variantFormValues[e.id].value).filter(e=>e.enabled);this.variantsChange.emit({groups:this.optionGroups.map(e=>({name:e.name,values:e.values.map(i=>i.name)})),variants:n,stockLocationId:this.selectedStockLocationId})}copyFromDefault(n,e,i){return n!==_e?this.variantFormValues[_e].get(e)?.value:i}}It.\u0275fac=function(n){return new(n||It)(t.Y36(c.DoR),t.Y36(d.qu))},It.\u0275cmp=t.Xpm({type:It,selectors:[["vdr-generate-product-variants"]],viewQuery:function(n,e){if(1&n&&t.Gf(Wr,5,t.SBq),2&n){let i;t.iGM(i=t.CRH())&&(e.groupNameInputs=i)}},outputs:{variantsChange:"variantsChange"},decls:7,vars:7,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"button","mb-2",3,"click"],["shape","plus"],[4,"ngIf"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],["optionGroupName",""],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange","edit"],["optionValueInputComponent",""],[1,"remove-group"],[1,"button-small","mt-2",3,"title","click"],["shape","trash"],["clrAlertType","warning","class","",3,"clrAlertClosable",4,"ngIf"],[1,"form-grid","mb-2"],[3,"label",4,"ngIf"],["class","variants-preview",4,"ngIf"],["clrAlertType","warning",1,"",3,"clrAlertClosable"],[1,"alert-text"],[3,"label"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"variants-preview"],[1,"table"],[3,"disabled","formGroup",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formGroup"],["type","text","formControlName","sku",3,"placeholder"],["formControlName","price",3,"currencyCode"],["type","number","formControlName","stock","min","0","step","1"],["type","checkbox","formControlName","enabled","clrCheckbox",""]],template:function(n,e){1&n&&(t.YNc(0,Xr,17,13,"div",0),t.TgZ(1,"button",1),t.NdJ("click",function(){return e.addOption()}),t._UZ(2,"clr-icon",2),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.YNc(5,lc,5,3,"ng-container",3),t.ALo(6,"async")),2&n&&(t.Q6J("ngForOf",e.optionGroups),t.xp6(3),t.hij(" ",t.lcZ(4,3,"catalog.add-option"),"\n"),t.xp6(2),t.Q6J("ngIf",t.lcZ(6,5,e.stockLocations$)))},dependencies:[f.TIm,f.CyW,f.I9z,f.q0d,f.qvL,f.MgK,f.KKC,f.xRP,_.sg,_.O5,d.YN,d.Kr,d.Fj,d.wV,d.Wl,d.EJ,d.JJ,d.JL,d.Q7,d.qQ,d.On,d.sg,d.u,ge.K,M.h,F.y,W,_.Ov,b.X$],styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});var dc=m(6884),je=m(196),Re=m(1125),pc=m(1122);function He(o,n){return(0,pc.m)(n)?(0,C.w)(()=>o,n):(0,C.w)(()=>o)}var Ke=m(2810),uc=m(4942),mc=m(9176),gc=m(9333);function _c(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-page-block")(1,"vdr-language-selector",10),t.NdJ("languageCodeChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.setLanguage(a))}),t.ALo(2,"async"),t.ALo(3,"async"),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("availableLanguageCodes",t.lcZ(2,2,e.availableLanguages$))("currentLanguageCode",t.lcZ(3,4,e.contentLanguage$))}}function fc(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function hc(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function vc(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}function Cc(o,n){if(1&o&&(t._UZ(0,"img",14),t.ALo(1,"assetPreview")),2&o){const e=n.ngIf;t.Q6J("src",t.xi3(1,1,e,"tiny"),t.LSH)}}function xc(o,n){1&o&&(t.TgZ(0,"div",15),t._UZ(1,"clr-icon",16),t.qZA())}function bc(o,n){if(1&o&&(t.TgZ(0,"div",11),t.YNc(1,Cc,2,4,"img",12),t.YNc(2,xc,2,0,"ng-template",null,13,t.W1O),t.qZA()),2&o){const e=n.item,i=t.MAs(3);t.xp6(1),t.Q6J("ngIf",e.featuredAsset)("ngIfElse",i)}}const Tc=function(o,n){return["/catalog/inventory",o,"variants",n]};function Zc(o,n){if(1&o&&(t.TgZ(0,"a",17)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",18),t.qZA()),2&o){const e=n.item;t.Q6J("routerLink",t.WLB(2,Tc,e.productId,e.id)),t.xp6(2),t.Oqu(e.name)}}function Ac(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.sku," ")}}function Pc(o,n){1&o&&(t.TgZ(0,"vdr-chip",21),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.enabled")))}function yc(o,n){1&o&&(t.TgZ(0,"vdr-chip",22),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.disabled")))}function Fc(o,n){if(1&o&&(t.YNc(0,Pc,3,3,"vdr-chip",19),t.YNc(1,yc,3,3,"vdr-chip",20)),2&o){const e=n.item;t.Q6J("ngIf",e.enabled),t.xp6(1),t.Q6J("ngIf",!e.enabled)}}function Lc(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeCurrency")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.price,e.currencyCode)," ")}}function Ic(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeCurrency")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.priceWithTax,e.currencyCode)," ")}}function kc(o,n){if(1&o&&(t.TgZ(0,"span",27),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.xp6(1),t.hij("(",e.stockAllocated," allocated)")}}function Oc(o,n){if(1&o&&(t.TgZ(0,"vdr-chip",24)(1,"div",25)(2,"div"),t._uU(3),t.YNc(4,kc,2,1,"span",26),t.qZA()()()),2&o){const e=n.$implicit;t.Q6J("title",null==e.stockLocation?null:e.stockLocation.name),t.xp6(3),t.hij(" ",e.stockOnHand,""),t.xp6(1),t.Q6J("ngIf",e.stockAllocated)}}function Jc(o,n){if(1&o&&t.YNc(0,Oc,5,3,"vdr-chip",23),2&o){const e=n.item;t.Q6J("ngForOf",e.stockLevels)}}function Dc(o,n){if(1&o&&t._UZ(0,"vdr-dt2-custom-field-column",28),2&o){const e=n.$implicit,i=t.oxw();t.Q6J("customField",e)("sorts",i.sorts)}}class lt extends c.$ms{constructor(){super(),this.hideLanguageSelect=!1,this.customFields=this.getCustomFieldConfig("ProductVariant"),this.filters=this.createFilterCollection().addDateFilters().addFilters([{name:"id",type:{kind:"text"},label:(0,p.J)("common.id"),filterField:"id"},{name:"enabled",type:{kind:"boolean"},label:(0,p.J)("common.enabled"),filterField:"enabled"},{name:"sku",type:{kind:"text"},label:(0,p.J)("catalog.sku"),filterField:"sku"},{name:"price",type:{kind:"number",inputType:"currency"},label:(0,p.J)("common.price"),filterField:"price"},{name:"priceWithTax",type:{kind:"number",inputType:"currency"},label:(0,p.J)("common.price-with-tax"),filterField:"priceWithTax"}]).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().addSorts([{name:"id"},{name:"createdAt"},{name:"updatedAt"},{name:"name"},{name:"sku"},{name:"price"},{name:"priceWithTax"}]).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.configure({document:c.NKc,getItems:n=>n.productVariants,setVariables:(n,e)=>({options:{skip:n,take:e,filter:{sku:{contains:this.searchTermControl.value},...this.filters.createFilterInput(),...this.productId?{productId:{eq:this.productId}}:{}},sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.sorts.valueChanges,this.filters.valueChanges]})}}lt.\u0275fac=function(n){return new(n||lt)},lt.\u0275cmp=t.Xpm({type:lt,selectors:[["vdr-product-variant-list"]],inputs:{productId:"productId",hideLanguageSelect:"hideLanguageSelect"},features:[t.qOj],decls:40,vars:64,consts:[[4,"ngIf"],["id","product-variant-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","product-variant-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault","sort"],[3,"heading"],[3,"heading","optional","sort"],[3,"heading","sort"],[3,"heading","hiddenByDefault"],[3,"customField","sorts",4,"ngFor","ngForOf"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["colorType","success",4,"ngIf"],["colorType","warning",4,"ngIf"],["colorType","success"],["colorType","warning"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"flex","center"],["class","ml-1",4,"ngIf"],[1,"ml-1"],[3,"customField","sorts"]],template:function(n,e){1&n&&(t.YNc(0,_c,4,6,"vdr-page-block",0),t.TgZ(1,"vdr-data-table-2",1),t.NdJ("pageChange",function(a){return e.setPageNumber(a)})("itemsPerPageChange",function(a){return e.setItemsPerPage(a)}),t.ALo(2,"async"),t.ALo(3,"async"),t.ALo(4,"async"),t.ALo(5,"async"),t._UZ(6,"vdr-bulk-action-menu",2)(7,"vdr-dt2-search",3),t.ALo(8,"translate"),t.TgZ(9,"vdr-dt2-column",4),t.ALo(10,"translate"),t.YNc(11,fc,1,1,"ng-template"),t.qZA(),t.TgZ(12,"vdr-dt2-column",4),t.ALo(13,"translate"),t.YNc(14,hc,2,4,"ng-template"),t.qZA(),t.TgZ(15,"vdr-dt2-column",4),t.ALo(16,"translate"),t.YNc(17,vc,2,4,"ng-template"),t.qZA(),t.TgZ(18,"vdr-dt2-column",5),t.ALo(19,"translate"),t.YNc(20,bc,4,2,"ng-template"),t.qZA(),t.TgZ(21,"vdr-dt2-column",6),t.ALo(22,"translate"),t.YNc(23,Zc,4,5,"ng-template"),t.qZA(),t.TgZ(24,"vdr-dt2-column",7),t.ALo(25,"translate"),t.YNc(26,Ac,1,1,"ng-template"),t.qZA(),t.TgZ(27,"vdr-dt2-column",5),t.ALo(28,"translate"),t.YNc(29,Fc,2,2,"ng-template"),t.qZA(),t.TgZ(30,"vdr-dt2-column",4),t.ALo(31,"translate"),t.YNc(32,Lc,2,4,"ng-template"),t.qZA(),t.TgZ(33,"vdr-dt2-column",7),t.ALo(34,"translate"),t.YNc(35,Ic,2,4,"ng-template"),t.qZA(),t.TgZ(36,"vdr-dt2-column",8),t.ALo(37,"translate"),t.YNc(38,Jc,1,1,"ng-template"),t.qZA(),t.YNc(39,Dc,1,2,"vdr-dt2-custom-field-column",9),t.qZA()),2&n&&(t.Q6J("ngIf",!e.hideLanguageSelect),t.xp6(1),t.Q6J("items",t.lcZ(2,34,e.items$))("itemsPerPage",t.lcZ(3,36,e.itemsPerPage$))("totalItems",t.lcZ(4,38,e.totalItems$))("currentPage",t.lcZ(5,40,e.currentPage$))("filters",e.filters),t.xp6(5),t.Q6J("hostComponent",e)("selectionManager",e.selectionManager),t.xp6(1),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(8,42,"catalog.filter-by-sku")),t.xp6(2),t.Q6J("heading",t.lcZ(10,44,"common.id"))("hiddenByDefault",!0)("sort",e.sorts.get("id")),t.xp6(3),t.Q6J("heading",t.lcZ(13,46,"common.created-at"))("hiddenByDefault",!0)("sort",e.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(16,48,"common.updated-at"))("hiddenByDefault",!0)("sort",e.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(19,50,"common.image")),t.xp6(3),t.Q6J("heading",t.lcZ(22,52,"catalog.name"))("optional",!1)("sort",e.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(25,54,"catalog.sku"))("sort",e.sorts.get("sku")),t.xp6(3),t.Q6J("heading",t.lcZ(28,56,"common.enabled")),t.xp6(3),t.Q6J("heading",t.lcZ(31,58,"common.price"))("hiddenByDefault",!0)("sort",e.sorts.get("price")),t.xp6(3),t.Q6J("heading",t.lcZ(34,60,"common.price-with-tax"))("sort",e.sorts.get("priceWithTax")),t.xp6(3),t.Q6J("heading",t.lcZ(37,62,"catalog.stock-on-hand"))("hiddenByDefault",!1),t.xp6(3),t.Q6J("ngForOf",e.customFields))},dependencies:[f.qvL,_.sg,_.O5,Z.rH,z.Y,R.S,Xt.c,mt.e,H.U,it.J,te.j,O.z,_.Ov,b.X$,re.M,nt.H,ie.k],styles:[".image-col[_ngcontent-%COMP%]{width:70px}.image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;margin-top:calc(var(--space-unit) * -1);margin-bottom:calc(var(--space-unit) * -1);background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}vdr-product-search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width: 768px){vdr-product-search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.search-index-button[_ngcontent-%COMP%]{position:relative}.search-index-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{right:0;top:0}.run-updates-button[_ngcontent-%COMP%]{position:relative}.run-updates-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{left:10px;top:10px}.edit-button[_ngcontent-%COMP%]{margin-right:24px}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"]});var fe=m(7611);function wc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.create())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.create")," ")}}function Nc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("disabled",(e.detailForm.invalid||e.detailForm.pristine)&&!e.assetsChanged()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function Vc(o,n){if(1&o&&t.YNc(0,Nc,3,4,"button",29),2&o){const e=t.oxw();t.Q6J("vdrIfPermissions",e.updatePermissions)}}const Uc=function(){return["enabled"]};function Mc(o,n){if(1&o&&(t.TgZ(0,"clr-toggle-wrapper"),t._UZ(1,"input",30),t.TgZ(2,"label"),t._uU(3),t.ALo(4,"translate"),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("formControl",e.detailForm.get(t.DdM(4,Uc))),t.xp6(2),t.Oqu(t.lcZ(4,2,"common.enabled"))}}function Qc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-chip",39),t.NdJ("iconClick",function(){t.CHM(e);const a=t.oxw().$implicit,r=t.oxw(4);return t.KtG(r.removeFromChannel(a.id))}),t._UZ(1,"vdr-channel-badge",40),t._uU(2),t.ALo(3,"channelCodeToLabel"),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("channelCode",e.code),t.xp6(1),t.hij(" ",t.lcZ(3,2,e.code)," ")}}function qc(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Qc,4,4,"vdr-chip",38),t.BQk()),2&o){const e=n.$implicit,i=t.oxw(4);t.xp6(1),t.Q6J("ngIf",!i.isDefaultChannel(e.code))}}function $c(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-form-item")(1,"div",33)(2,"div",34),t.YNc(3,qc,2,1,"ng-container",35),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"button",36),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(3);return t.KtG(a.assignToChannel())}),t._UZ(6,"clr-icon",37),t._uU(7),t.ALo(8,"translate"),t.qZA()()()}if(2&o){const e=t.oxw(3);t.xp6(3),t.Q6J("ngForOf",t.lcZ(4,2,e.productChannels$)),t.xp6(4),t.hij(" ",t.lcZ(8,4,"catalog.assign-to-channel")," ")}}function Sc(o,n){1&o&&(t.TgZ(0,"vdr-card",10),t.ALo(1,"translate"),t.YNc(2,$c,9,6,"vdr-form-item",32),t.qZA()),2&o&&t.Q6J("title",t.lcZ(1,1,"common.channels"))}function Yc(o,n){1&o&&(t.ynx(0),t.YNc(1,Sc,3,3,"vdr-card",31),t.BQk())}function Gc(o,n){if(1&o&&(t.TgZ(0,"vdr-chip",44),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("colorFrom",e.code)("invert",!0),t.xp6(1),t.hij(" ",e.name," ")}}const Ec=function(){return["options"]};function Bc(o,n){1&o&&(t.TgZ(0,"a",45),t._UZ(1,"clr-icon",46),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,Ec)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.edit-options")," "))}function jc(o,n){if(1&o&&(t.TgZ(0,"vdr-card",10),t.ALo(1,"translate"),t.TgZ(2,"div",41),t.YNc(3,Gc,2,3,"vdr-chip",42),t.ALo(4,"sort"),t.qZA(),t.TgZ(5,"div"),t.YNc(6,Bc,4,5,"a",43),t.qZA()()),2&o){const e=t.oxw();t.Q6J("title",t.lcZ(1,3,"catalog.product-options")),t.xp6(3),t.Q6J("ngForOf",t.xi3(4,5,null==e.entity?null:e.entity.optionGroups,"id")),t.xp6(3),t.Q6J("vdrIfPermissions",e.updatePermissions)}}function Rc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-facet-value-chip",47),t.NdJ("remove",function(){const r=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.removeProductFacetValue(r.id))}),t.ALo(1,"hasPermission"),t.qZA()}if(2&o){const e=n.$implicit,i=t.oxw();t.Q6J("facetValue",e)("removable",t.lcZ(1,2,i.updatePermissions))}}function Hc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",48),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectProductFacetValue())}),t._UZ(1,"clr-icon",49),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&o&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"catalog.add-facets")," "))}function Kc(o,n){if(1&o&&(t.TgZ(0,"vdr-card"),t._UZ(1,"vdr-page-entity-info",50),t.qZA()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("entity",e)}}function zc(o,n){1&o&&(t.TgZ(0,"div")(1,"clr-checkbox-wrapper"),t._UZ(2,"input",51),t.TgZ(3,"label"),t._uU(4),t.ALo(5,"translate"),t.qZA()()()),2&o&&(t.xp6(4),t.Oqu(t.lcZ(5,1,"catalog.auto-update-product-variant-name")))}function Wc(o,n){if(1&o&&(t.TgZ(0,"vdr-card",10),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",52),t.ALo(3,"hasPermission"),t.qZA()),2&o){const e=t.oxw();t.Q6J("title",t.lcZ(1,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get("customFields"))("readonly",!t.lcZ(3,6,e.updatePermissions))}}function Xc(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"vdr-generate-product-variants",53),t.NdJ("variantsChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.createVariantsConfig=a)}),t.qZA()()}}function ts(o,n){if(1&o&&t._UZ(0,"vdr-product-variant-list",54),2&o){const e=t.oxw();t.Q6J("productId",e.id)("hideLanguageSelect",!0)}}const es=function(){return["manage-variants"]};function ns(o,n){1&o&&(t.TgZ(0,"div",55)(1,"a",56),t._UZ(2,"clr-icon",57),t._uU(3),t.ALo(4,"translate"),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("routerLink",t.DdM(4,es)),t.xp6(2),t.hij(" ",t.lcZ(4,2,"catalog.manage-variants"),""))}const os=function(){return["name"]},ze=function(o){return{pattern:o}},is=A.Ps`
    query GetProductDetail($id: ID!) {
        product(id: $id) {
            ...ProductDetail
        }
    }
    ${c.c4F}
`;class dt extends c.VE7{constructor(n,e,i,a,r,s,l,u,g){super(),this.productDetailService=a,this.formBuilder=r,this.modalService=s,this.notificationService=l,this.dataService=u,this.changeDetector=g,this.customFields=this.getCustomFieldConfig("Product"),this.detailForm=this.formBuilder.group({enabled:!0,name:["",d.kI.required],autoUpdateVariantNames:!0,slug:["",(0,c.Foo)(/^[\p{Letter}0-9_-]+$/)],description:"",facetValueIds:[[]],customFields:this.formBuilder.group(this.customFields.reduce((v,T)=>({...v,[T.name]:""}),{}))}),this.assetChanges={},this.createVariantsConfig={groups:[],variants:[],stockLocationId:""},this.updatePermissions=[c.y3$.UpdateCatalog,c.y3$.UpdateProduct]}ngOnInit(){this.init();const n=this.entity$.pipe((0,h.U)(a=>a.facetValues)),i=this.detailForm.get("facetValueIds").valueChanges.pipe((0,Re.T)(1),(0,U.x)(),(0,C.w)(a=>this.dataService.facet.getFacetValues({filter:{id:{in:a}}}).mapSingle(({facetValues:r})=>r.items)),(0,Ht.d)(1));this.facetValues$=(0,je.z)(n.pipe((0,$.q)(1)),n.pipe(He(i))),this.productChannels$=this.entity$.pipe((0,h.U)(a=>a.channels))}ngOnDestroy(){this.destroy()}isDefaultChannel(n){return n===dc.z$}assignToChannel(){this.productChannels$.pipe((0,$.q)(1),(0,C.w)(n=>this.modalService.fromComponent(E,{size:"lg",locals:{productIds:[this.id],currentChannelIds:n.map(e=>e.id)}}))).subscribe()}removeFromChannel(n){(0,pe.D)((0,c.PDO)(this.dataService,n)).pipe((0,C.w)(({channelCode:e})=>this.modalService.dialog({title:(0,p.J)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("catalog.remove-from-channel"),translationVars:{channelCode:e},returnValue:!0}]})),(0,C.w)(e=>e?this.dataService.product.removeProductsFromChannel({channelId:n,productIds:[this.id]}):L.E)).subscribe(()=>{this.notificationService.success((0,p.J)("catalog.notify-remove-product-from-channel-success"))},e=>{this.notificationService.error((0,p.J)("catalog.notify-remove-product-from-channel-error"))})}assignVariantToChannel(n){return this.modalService.fromComponent(E,{size:"lg",locals:{productIds:[this.id],productVariantIds:[n.id],currentChannelIds:n.channels.map(e=>e.id)}}).subscribe()}removeVariantFromChannel({channelId:n,variant:e}){(0,pe.D)((0,c.PDO)(this.dataService,n)).pipe((0,C.w)(({channelCode:i})=>this.modalService.dialog({title:(0,p.J)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("catalog.remove-from-channel"),translationVars:{channelCode:i},returnValue:!0}]})),(0,C.w)(i=>i?this.dataService.product.removeVariantsFromChannel({channelId:n,productVariantIds:[e.id]}):L.E)).subscribe(()=>{this.notificationService.success((0,p.J)("catalog.notify-remove-variant-from-channel-success"))},i=>{this.notificationService.error((0,p.J)("catalog.notify-remove-variant-from-channel-error"))})}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(n){const e=this.detailForm.get("slug"),i=this.entity?(0,c.ZIM)(this.entity,this.languageCode):void 0,a=!i||!i.slug;e&&e.pristine&&a&&e.setValue((0,j.U)(`${n}`,"-"))}selectProductFacetValue(){this.displayFacetValueModal().subscribe(n=>{if(n){const e=this.detailForm,i=e.value.facetValueIds??[];e.patchValue({facetValueIds:(0,V.T)([...i,...n])}),e.markAsDirty()}})}updateProductOption(n){(0,y.a)(this.entity$,this.languageCode$).pipe((0,$.q)(1),(0,w.z)(([e,i])=>this.productDetailService.updateProductOption(n,e,i))).subscribe(()=>{this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"ProductOption"})},e=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"ProductOption"})})}removeProductFacetValue(n){const e=this.detailForm,i=e.value.facetValueIds??[];e.patchValue({facetValueIds:i.filter(a=>a!==n)}),e.markAsDirty()}displayFacetValueModal(){return this.modalService.fromComponent(at,{size:"md",closable:!0}).pipe((0,h.U)(n=>n&&n.map(e=>e.id)))}create(){const n=this.detailForm;if(!n.dirty)return;const e=this.getUpdatedProduct({id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:this.languageCode,name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],channels:[]},n,this.languageCode);this.productDetailService.createProductWithVariants(e,this.createVariantsConfig,this.languageCode).subscribe(({createProductVariants:i,productId:a})=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"Product"}),this.assetChanges={},this.detailForm.markAsPristine(),this.router.navigate(["../",a],{relativeTo:this.route})},i=>{console.error(i),this.notificationService.error((0,p.J)("common.notify-create-error"),{entity:"Product"})})}save(){(0,y.a)(this.entity$,this.languageCode$).pipe((0,$.q)(1),(0,w.z)(([n,e])=>{const i=this.detailForm;let a;return(i.dirty||this.assetsChanged())&&(a=this.getUpdatedProduct(n,i,e)),this.productDetailService.updateProduct({product:n,languageCode:e,autoUpdate:this.detailForm.get(["product","autoUpdateVariantNames"])?.value??!1,productInput:a,variantsInput:undefined})})).subscribe(n=>{this.updateSlugAfterSave(n),this.detailForm.markAsPristine(),this.assetChanges={},this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"Product"}),this.changeDetector.markForCheck()},n=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"Product"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(n,e){const i=(0,c.ZIM)(n,e);this.detailForm.patchValue({enabled:n.enabled,name:i?i.name:"",slug:i?i.slug:"",description:i?i.description:"",facetValueIds:n.facetValues.map(a=>a.id)}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),n,i)}getUpdatedProduct(n,e,i){return{...(0,c.iSy)({translatable:n,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:i,defaultTranslation:{languageCode:i,name:n.name||"",slug:n.slug||"",description:n.description||""}}),assetIds:this.assetChanges.assets?.map(r=>r.id),featuredAssetId:this.assetChanges.featuredAsset?.id,facetValueIds:e.value.facetValueIds}}updateSlugAfterSave(n){const e=n[0],i=this.detailForm.get(["product","slug"]);i&&function a(r){return r.hasOwnProperty("updateProduct")}(e)&&i.setValue(e.updateProduct.slug,{emitEvent:!1})}}dt.\u0275fac=function(n){return new(n||dt)(t.Y36(Z.gz),t.Y36(Z.F0),t.Y36(c.iHG),t.Y36(S),t.Y36(d.qu),t.Y36(c.Z7U),t.Y36(c.gqp),t.Y36(c.DoR),t.Y36(t.sBO))},dt.\u0275cmp=t.Xpm({type:dt,selectors:[["vdr-product-detail2"]],features:[t.qOj],decls:68,vars:86,consts:[[1,"flex","clr-flex-row"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],["for","visibility",3,"label"],[4,"vdrIfPermissions"],[4,"ngIf"],[3,"title",4,"ngIf"],[3,"title"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","button-small mt-2",3,"click",4,"vdrIfPermissions"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug",3,"readonly"],["for","slug",1,"form-grid-span",3,"label","errors"],["formControlName","description",3,"readonly"],["locationId","product-detail",3,"entity$","detailForm"],[3,"assets","featuredAsset","updatePermissions","change"],[3,"title","paddingX"],[4,"ngIf","ngIfElse"],["variantList",""],["class","mx-3",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[3,"title",4,"vdrIfMultichannel"],[4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[1,"mb-2"],[4,"ngFor","ngForOf"],[1,"button-small",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],[1,"options"],[3,"colorFrom","invert",4,"ngFor","ngForOf"],["class","button-small mt-2",3,"routerLink",4,"vdrIfPermissions"],[3,"colorFrom","invert"],[1,"button-small","mt-2",3,"routerLink"],["shape","pencil"],[3,"facetValue","removable","remove"],[1,"button-small","mt-2",3,"click"],["shape","plus"],[3,"entity"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["entityName","Product",3,"customFields","customFieldsFormGroup","readonly"],[3,"variantsChange"],[3,"productId","hideLanguageSelect"],[1,"mx-3"],[1,"button",3,"routerLink"],["shape","add-text"]],template:function(n,e){if(1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left"),t._UZ(3,"div",0),t.TgZ(4,"vdr-language-selector",1),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(5,"async"),t.ALo(6,"async"),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"vdr-ab-right"),t._UZ(9,"vdr-action-bar-items",2),t.YNc(10,wc,3,4,"button",3),t.ALo(11,"async"),t.YNc(12,Vc,1,1,"ng-template",null,4,t.W1O),t.qZA()()(),t.TgZ(14,"form",5)(15,"vdr-page-detail-layout")(16,"vdr-page-detail-sidebar")(17,"vdr-card")(18,"vdr-form-field",6),t.ALo(19,"translate"),t.YNc(20,Mc,5,5,"clr-toggle-wrapper",7),t.qZA()(),t.YNc(21,Yc,2,0,"ng-container",8),t.ALo(22,"async"),t.YNc(23,jc,7,8,"vdr-card",9),t.TgZ(24,"vdr-card",10),t.ALo(25,"translate"),t.TgZ(26,"div",11),t.YNc(27,Rc,2,4,"vdr-facet-value-chip",12),t.ALo(28,"async"),t.qZA(),t.TgZ(29,"div"),t.YNc(30,Hc,4,3,"button",13),t.qZA()(),t.YNc(31,Kc,2,1,"vdr-card",8),t.ALo(32,"async"),t.qZA(),t.TgZ(33,"vdr-page-block"),t._UZ(34,"button",14),t.TgZ(35,"vdr-card")(36,"div",15)(37,"div")(38,"vdr-form-field",16),t.ALo(39,"translate"),t.TgZ(40,"input",17),t.NdJ("input",function(a){return e.updateSlug(a.target.value)}),t.ALo(41,"hasPermission"),t.qZA()(),t.YNc(42,zc,6,3,"div",8),t.ALo(43,"async"),t.qZA(),t.TgZ(44,"vdr-form-field",18),t.ALo(45,"translate"),t.ALo(46,"translate"),t._UZ(47,"input",19),t.ALo(48,"hasPermission"),t.qZA(),t.TgZ(49,"vdr-form-field",20),t.ALo(50,"translate"),t.ALo(51,"translate"),t._UZ(52,"vdr-rich-text-editor",21),t.ALo(53,"hasPermission"),t.qZA()()(),t.YNc(54,Wc,4,8,"vdr-card",9),t._UZ(55,"vdr-custom-detail-component-host",22),t.TgZ(56,"vdr-card",10),t.ALo(57,"translate"),t.TgZ(58,"vdr-assets",23),t.NdJ("change",function(a){return e.assetChanges=a}),t.qZA()(),t.TgZ(59,"vdr-card",24),t.ALo(60,"translate"),t.ALo(61,"async"),t.YNc(62,Xc,2,0,"div",25),t.ALo(63,"async"),t.YNc(64,ts,1,2,"ng-template",null,26,t.W1O),t.YNc(66,ns,5,5,"div",27),t.ALo(67,"async"),t.qZA()()()()),2&n){const i=t.MAs(13),a=t.MAs(65);let r;t.xp6(4),t.Q6J("disabled",t.lcZ(5,35,e.isNew$))("availableLanguageCodes",t.lcZ(6,37,e.availableLanguages$))("currentLanguageCode",t.lcZ(7,39,e.languageCode$)),t.xp6(6),t.Q6J("ngIf",t.lcZ(11,41,e.isNew$))("ngIfElse",i),t.xp6(4),t.Q6J("formGroup",e.detailForm),t.xp6(4),t.Q6J("label",t.lcZ(19,43,"catalog.visibility")),t.xp6(2),t.Q6J("vdrIfPermissions",e.updatePermissions),t.xp6(1),t.Q6J("ngIf",!t.lcZ(22,45,e.isNew$)),t.xp6(2),t.Q6J("ngIf",null==e.entity?null:e.entity.optionGroups.length),t.xp6(1),t.Q6J("title",t.lcZ(25,47,"catalog.facets")),t.xp6(3),t.Q6J("ngForOf",t.lcZ(28,49,e.facetValues$)),t.xp6(3),t.Q6J("vdrIfPermissions",e.updatePermissions),t.xp6(1),t.Q6J("ngIf",t.lcZ(32,51,e.entity$)),t.xp6(7),t.Q6J("label",t.lcZ(39,53,"catalog.product-name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(41,55,e.updatePermissions)),t.xp6(2),t.Q6J("ngIf",!1===t.lcZ(43,57,e.isNew$)&&(null==(r=e.detailForm.get(t.DdM(81,os)))?null:r.dirty)),t.xp6(2),t.Q6J("label",t.lcZ(45,59,"catalog.slug"))("errors",t.VKq(82,ze,t.lcZ(46,61,"catalog.slug-pattern-error"))),t.xp6(3),t.Q6J("readonly",!t.lcZ(48,63,e.updatePermissions)),t.xp6(2),t.Q6J("label",t.lcZ(50,65,"common.description"))("errors",t.VKq(84,ze,t.lcZ(51,67,"catalog.slug-pattern-error"))),t.xp6(3),t.Q6J("readonly",!t.lcZ(53,69,e.updatePermissions)),t.xp6(2),t.Q6J("ngIf",e.customFields.length),t.xp6(1),t.Q6J("entity$",e.entity$)("detailForm",e.detailForm),t.xp6(1),t.Q6J("title",t.lcZ(57,71,"catalog.assets")),t.xp6(2),t.Q6J("assets",e.assetChanges.assets||(null==e.entity?null:e.entity.assets))("featuredAsset",e.assetChanges.featuredAsset||(null==e.entity?null:e.entity.featuredAsset))("updatePermissions",e.updatePermissions),t.xp6(1),t.Q6J("title",t.lcZ(60,73,"catalog.product-variants"))("paddingX",t.lcZ(61,75,e.isNew$)),t.xp6(3),t.Q6J("ngIf",t.lcZ(63,77,e.isNew$))("ngIfElse",a),t.xp6(4),t.Q6J("ngIf",!1===t.lcZ(67,79,e.isNew$))}},dependencies:[f.qvL,f.MgK,f.KKC,f.PEh,_.sg,_.O5,d._Y,d.Fj,d.Wl,d.JJ,d.JL,d.oH,d.sg,d.u,Z.rH,x.Kk,x.BN,x.mz,z.Y,ce.q,M.h,F.y,Ke.J,R.S,me.Y,J.H,uc.u,G.W,mc.n,gc.M,ut.y,Kt.C,O.z,Vt.D,zt.T,Wt.W,gt.A,It,X,lt,_.Ov,b.X$,fe.U,Y.j,ke.E],styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}.facets[_ngcontent-%COMP%], .options[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:3px}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:initial;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}@media screen and (min-width: 768px){.view-mode[_ngcontent-%COMP%]{flex-direction:row}}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap;max-height:144px}.pagination-row[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between}"],changeDetection:0});const We={location:"product-list",label:(0,p.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:o=>o.includes(c.y3$.DeleteProduct)||o.includes(c.y3$.DeleteCatalog),onClick:({injector:o,selection:n,hostComponent:e,clearSelection:i})=>{const a=o.get(c.Z7U),r=o.get(c.DoR),s=o.get(c.gqp);a.dialog({title:(0,p.J)("catalog.confirm-bulk-delete-products"),translationVars:{count:n.length},buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(l=>l?r.product.deleteProducts((0,V.T)(n.map(u=>u.id))):L.E)).subscribe(l=>{let u=0;const g=[];for(const v of l.deleteProducts)v.result===c.PcR.DELETED?u++:v.message&&g.push(v.message);0<u&&s.success((0,p.J)("catalog.notify-bulk-delete-products-success"),{count:u}),0<g.length&&s.error(g.join("\n")),e.refresh(),i()})}},Xe={location:"product-list",label:(0,p.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateProduct),isVisible:({injector:o})=>(0,c.SDV)(o.get(c.DoR)),onClick:({injector:o,selection:n,clearSelection:e})=>{o.get(c.Z7U).fromComponent(E,{size:"lg",locals:{productIds:(0,V.T)(n.map(a=>a.id)),currentChannelIds:[]}}).subscribe(a=>{a&&e()})}},tn=(0,c.RBx)({location:"product-list",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateProduct),getItemName:o=>o.name,bulkRemoveFromChannel:(o,n,e)=>o.product.removeProductsFromChannel({channelId:e,productIds:n}).pipe((0,h.U)(i=>i.removeProductsFromChannel))}),en={location:"product-list",label:(0,p.J)("catalog.edit-facet-values"),icon:"tag",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateProduct),onClick:({injector:o,selection:n,hostComponent:e,clearSelection:i})=>{const a=o.get(c.Z7U),s=(o.get(c.DoR),o.get(c.gqp)),l="product",u=(0,V.T)(n.map(g=>g.id));return a.fromComponent(Zt,{size:"xl",locals:{mode:l,ids:u}}).subscribe(g=>{g&&(s.success((0,p.J)("common.notify-bulk-update-success"),{count:n.length,entity:"Products"}),i())})}};var as=m(904);const rs=function(){return["./create"]};function cs(o,n){1&o&&(t.TgZ(0,"a",16),t._UZ(1,"clr-icon",17),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,rs)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.create-new-product")," "))}function ss(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function ls(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function ds(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}function ps(o,n){if(1&o&&(t._UZ(0,"img",21),t.ALo(1,"assetPreview")),2&o){const e=n.ngIf;t.Q6J("src",t.xi3(1,1,e,"tiny"),t.LSH)}}function us(o,n){1&o&&(t.TgZ(0,"div",22),t._UZ(1,"clr-icon",23),t.qZA())}function ms(o,n){if(1&o&&(t.TgZ(0,"div",18),t.YNc(1,ps,2,4,"img",19),t.YNc(2,us,2,0,"ng-template",null,20,t.W1O),t.qZA()),2&o){const e=n.item,i=t.MAs(3);t.xp6(1),t.Q6J("ngIf",e.featuredAsset)("ngIfElse",i)}}const gs=function(o){return["./",o]};function _s(o,n){if(1&o&&(t.TgZ(0,"a",24)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",25),t.qZA()),2&o){const e=n.item;t.Q6J("routerLink",t.VKq(2,gs,e.id)),t.xp6(2),t.Oqu(e.name)}}function fs(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.slug," ")}}function hs(o,n){1&o&&(t.TgZ(0,"vdr-chip",28),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.enabled")))}function vs(o,n){1&o&&(t.TgZ(0,"vdr-chip",29),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"common.disabled")))}function Cs(o,n){if(1&o&&(t.YNc(0,hs,3,3,"vdr-chip",26),t.YNc(1,vs,3,3,"vdr-chip",27)),2&o){const e=n.item;t.Q6J("ngIf",e.enabled),t.xp6(1),t.Q6J("ngIf",!e.enabled)}}const xs=function(o){return{count:o}};function bs(o,n){if(1&o&&(t._uU(0),t.ALo(1,"translate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,"catalog.variant-count",t.VKq(4,xs,null==e.variantList?null:e.variantList.totalItems))," ")}}function Ts(o,n){if(1&o&&t._UZ(0,"vdr-dt2-custom-field-column",30),2&o){const e=n.$implicit,i=t.oxw();t.Q6J("customField",e)("sorts",i.sorts)}}const Zs=function(){return["CreateCatalog","CreateProduct"]};class kt extends c.$ms{constructor(n,e,i,a){super(),this.dataService=n,this.modalService=e,this.notificationService=i,this.jobQueueService=a,this.pendingSearchIndexUpdates=0,this.customFields=this.getCustomFieldConfig("Product"),this.filters=this.createFilterCollection().addDateFilters().addFilters([{name:"id",type:{kind:"text"},label:(0,p.J)("common.id"),filterField:"id"},{name:"enabled",type:{kind:"boolean"},label:(0,p.J)("common.enabled"),filterField:"enabled"},{name:"slug",type:{kind:"text"},label:(0,p.J)("common.slug"),filterField:"slug"}]).addFilter({name:"facetValues",type:{kind:"custom",component:c.qPP,serializeValue:r=>r.map(s=>s.id).join(","),deserializeValue:r=>r.split(",").map(s=>({id:s})),getLabel:r=>0===r.length?"":r[0].name?r.map(s=>s.name).join(", "):(0,Ie.n)(this.dataService.facet.getFacetValues({filter:{id:{in:r.map(s=>s.id)}}}).mapSingle(({facetValues:s})=>s.items.map(l=>l.name).join(", ")))},label:(0,p.J)("catalog.facet-values"),toFilterInput:r=>({facetValueId:{in:r.map(s=>s.id)}})}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("createdAt","DESC").addSorts([{name:"id"},{name:"createdAt"},{name:"updatedAt"},{name:"name"},{name:"slug"}]).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.configure({document:c.Qek,getItems:r=>r.products,setVariables:(r,s)=>({options:{skip:r,take:s,filter:{name:{contains:this.searchTermControl.value},...this.filters.createFilterInput()},sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.sorts.valueChanges,this.filters.valueChanges]})}rebuildSearchIndex(){this.dataService.product.reindex().subscribe(({reindex:n})=>{this.notificationService.info((0,p.J)("catalog.reindexing")),this.jobQueueService.addJob(n.id,e=>{if(e.state===c.Zyh.COMPLETED){const i=(new Intl.NumberFormat).format(e.duration||0);this.notificationService.success((0,p.J)("catalog.reindex-successful"),{count:e.result.indexedItemCount,time:i}),this.refresh()}else this.notificationService.error((0,p.J)("catalog.reindex-error"))})})}deleteProduct(n){this.modalService.dialog({title:(0,p.J)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(e=>e?this.dataService.product.deleteProduct(n):L.E),(0,as.g)(500)).subscribe(()=>{this.notificationService.success((0,p.J)("common.notify-delete-success"),{entity:"Product"}),this.refresh()},e=>{this.notificationService.error((0,p.J)("common.notify-delete-error"),{entity:"Product"})})}}kt.\u0275fac=function(n){return new(n||kt)(t.Y36(c.DoR),t.Y36(c.Z7U),t.Y36(c.gqp),t.Y36(c.u8d))},kt.\u0275cmp=t.Xpm({type:kt,selectors:[["vdr-products-list"]],features:[t.qOj],decls:50,vars:64,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-list"],["class","button primary mr-1",3,"routerLink",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["shape","refresh",1,""],["id","product-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","product-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault","sort"],[3,"heading"],[3,"heading","optional","sort"],[3,"heading","sort"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"button","primary","mr-1",3,"routerLink"],["shape","plus"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],["colorType","success",4,"ngIf"],["colorType","warning",4,"ngIf"],["colorType","success"],["colorType","warning"],[3,"customField","sorts"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left")(3,"vdr-language-selector",0),t.NdJ("languageCodeChange",function(a){return e.setLanguage(a)}),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"vdr-ab-right"),t._UZ(7,"vdr-action-bar-items",1),t.YNc(8,cs,4,5,"a",2),t.TgZ(9,"vdr-dropdown")(10,"button",3),t._UZ(11,"clr-icon",4),t.qZA(),t.TgZ(12,"vdr-dropdown-menu",5)(13,"button",6),t.NdJ("click",function(){return e.rebuildSearchIndex()}),t._UZ(14,"clr-icon",7),t._uU(15),t.ALo(16,"translate"),t.qZA()()()()()(),t.TgZ(17,"vdr-data-table-2",8),t.NdJ("pageChange",function(a){return e.setPageNumber(a)})("itemsPerPageChange",function(a){return e.setItemsPerPage(a)}),t.ALo(18,"async"),t.ALo(19,"async"),t.ALo(20,"async"),t.ALo(21,"async"),t._UZ(22,"vdr-bulk-action-menu",9)(23,"vdr-dt2-search",10),t.ALo(24,"translate"),t.TgZ(25,"vdr-dt2-column",11),t.ALo(26,"translate"),t.YNc(27,ss,1,1,"ng-template"),t.qZA(),t.TgZ(28,"vdr-dt2-column",11),t.ALo(29,"translate"),t.YNc(30,ls,2,4,"ng-template"),t.qZA(),t.TgZ(31,"vdr-dt2-column",11),t.ALo(32,"translate"),t.YNc(33,ds,2,4,"ng-template"),t.qZA(),t.TgZ(34,"vdr-dt2-column",12),t.ALo(35,"translate"),t.YNc(36,ms,4,2,"ng-template"),t.qZA(),t.TgZ(37,"vdr-dt2-column",13),t.ALo(38,"translate"),t.YNc(39,_s,4,4,"ng-template"),t.qZA(),t.TgZ(40,"vdr-dt2-column",14),t.ALo(41,"translate"),t.YNc(42,fs,1,1,"ng-template"),t.qZA(),t.TgZ(43,"vdr-dt2-column",12),t.ALo(44,"translate"),t.YNc(45,Cs,2,2,"ng-template"),t.qZA(),t.TgZ(46,"vdr-dt2-column",12),t.ALo(47,"translate"),t.YNc(48,bs,2,6,"ng-template"),t.qZA(),t.YNc(49,Ts,1,2,"vdr-dt2-custom-field-column",15),t.qZA()),2&n&&(t.xp6(3),t.Q6J("availableLanguageCodes",t.lcZ(4,31,e.availableLanguages$))("currentLanguageCode",t.lcZ(5,33,e.contentLanguage$)),t.xp6(5),t.Q6J("vdrIfPermissions",t.DdM(63,Zs)),t.xp6(7),t.hij(" ",t.lcZ(16,35,"catalog.rebuild-search-index")," "),t.xp6(2),t.Q6J("items",t.lcZ(18,37,e.items$))("itemsPerPage",t.lcZ(19,39,e.itemsPerPage$))("totalItems",t.lcZ(20,41,e.totalItems$))("currentPage",t.lcZ(21,43,e.currentPage$))("filters",e.filters),t.xp6(5),t.Q6J("hostComponent",e)("selectionManager",e.selectionManager),t.xp6(1),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(24,45,"catalog.filter-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(26,47,"common.id"))("hiddenByDefault",!0)("sort",e.sorts.get("id")),t.xp6(3),t.Q6J("heading",t.lcZ(29,49,"common.created-at"))("hiddenByDefault",!0)("sort",e.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(32,51,"common.updated-at"))("hiddenByDefault",!0)("sort",e.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(35,53,"common.image")),t.xp6(3),t.Q6J("heading",t.lcZ(38,55,"catalog.name"))("optional",!1)("sort",e.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(41,57,"common.slug"))("sort",e.sorts.get("slug")),t.xp6(3),t.Q6J("heading",t.lcZ(44,59,"common.enabled")),t.xp6(3),t.Q6J("heading",t.lcZ(47,61,"catalog.number-of-variants")),t.xp6(3),t.Q6J("ngForOf",e.customFields))},dependencies:[f.qvL,_.sg,_.O5,Z.rH,x.Kk,x.BN,x.mz,z.Y,R.S,Qt.J,qt.N,$t.U,St.H,J.H,G.W,Xt.c,mt.e,H.U,it.J,te.j,O.z,_.Ov,b.X$,re.M,nt.H],styles:[".image-col[_ngcontent-%COMP%]{width:70px}.image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;margin-top:calc(var(--space-unit) * -1);margin-bottom:calc(var(--space-unit) * -1);background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}vdr-product-search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width: 768px){vdr-product-search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.search-index-button[_ngcontent-%COMP%]{position:relative}.search-index-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{right:0;top:0}.run-updates-button[_ngcontent-%COMP%]{position:relative}.run-updates-button[_ngcontent-%COMP%]   vdr-status-badge[_ngcontent-%COMP%]{left:10px;top:10px}.edit-button[_ngcontent-%COMP%]{margin-right:24px}.sku[_ngcontent-%COMP%]{color:var(--color-text-300)}"]});var As=m(3312);const Ps=function(o){return{rate:o}};function ys(o,n){if(1&o&&(t.TgZ(0,"div",2),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"async"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,"catalog.price-includes-tax-at",t.VKq(6,Ps,t.lcZ(3,4,e.taxRate$))),"\n")}}const Fs=function(o,n){return{price:o,rate:n}};function Ls(o,n){if(1&o&&(t.TgZ(0,"div",2),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"localeCurrency"),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,"catalog.price-with-tax-in-default-zone",t.WLB(11,Fs,t.xi3(3,4,t.lcZ(4,7,e.grossPrice$),e.currencyCode),t.lcZ(5,9,e.taxRate$))),"\n")}}class Ot{constructor(n){this.dataService=n,this.priceChange$=new Q.X(0),this.taxCategoryIdChange$=new Q.X("")}ngOnInit(){const n=this.dataService.settings.getTaxRatesSimple(999,0,"cache-first").mapStream(i=>i.taxRates.items),e=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(i=>i.activeChannel);this.taxRate$=(0,y.a)(e,n,this.taxCategoryIdChange$).pipe((0,h.U)(([i,a,r])=>{const s=i.defaultTaxZone;if(!s)return 0;const l=a.find(u=>u.zone.id===s.id&&u.category.id===r);return l?l.value:0})),this.grossPrice$=(0,y.a)(this.taxRate$,this.priceChange$).pipe((0,h.U)(([i,a])=>Math.round(a*((100+i)/100))))}ngOnChanges(n){"price"in n&&this.priceChange$.next(n.price.currentValue),"taxCategoryId"in n&&this.taxCategoryIdChange$.next(n.taxCategoryId.currentValue)}}function Is(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.AsE(" ",e.name," (",e.sku,") ")}}function ks(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"ng-select",1),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.selectedVariantId=a)})("change",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.onSelect(a))}),t.ALo(1,"async"),t.ALo(2,"translate"),t.YNc(3,Is,1,2,"ng-template",2),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("items",t.lcZ(1,5,e.variants$))("ngModel",e.selectedVariantId)("searchFn",e.searchFn)("clearable",!1)("placeholder",t.lcZ(2,7,"catalog.quick-jump-placeholder"))}}Ot.\u0275fac=function(n){return new(n||Ot)(t.Y36(c.DoR))},Ot.\u0275cmp=t.Xpm({type:Ot,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[t.TTD],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(n,e){1&n&&(t.TgZ(0,"label",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.YNc(3,ys,4,8,"div",1),t.YNc(4,Ls,6,14,"div",1)),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,3,"catalog.taxes")),t.xp6(2),t.Q6J("ngIf",e.priceIncludesTax),t.xp6(1),t.Q6J("ngIf",!e.priceIncludesTax))},dependencies:[f.MgK,_.O5,_.Ov,b.X$,ie.k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0});A.Ps`
    query GetProductVariantsQuickJump($id: ID!) {
        product(id: $id) {
            id
            variants {
                id
                name
                sku
            }
        }
    }
`;class Jt{constructor(n,e){this.dataService=n,this.router=e,this.searchFn=(i,a)=>a.name.toLowerCase().includes(i.toLowerCase())||a.sku.toLowerCase().includes(i.toLowerCase())}ngOnInit(){this.variants$=this.dataService.query(c.aAr,{id:this.productId}).mapSingle(n=>n.product?.variants??[])}onSelect(n){n&&this.router.navigate(["catalog","inventory",this.productId,"variants",n.id]).then(()=>this.selectedVariantId=void 0)}}Jt.\u0275fac=function(n){return new(n||Jt)(t.Y36(c.DoR),t.Y36(Z.F0))},Jt.\u0275cmp=t.Xpm({type:Jt,selectors:[["vdr-product-variant-quick-jump"]],inputs:{productId:"productId"},decls:2,vars:3,consts:[["appendTo","body","bindValue","id",3,"items","ngModel","searchFn","clearable","placeholder","ngModelChange","change",4,"ngIf"],["appendTo","body","bindValue","id",3,"items","ngModel","searchFn","clearable","placeholder","ngModelChange","change"],["ng-option-tmp",""]],template:function(n,e){if(1&n&&(t.YNc(0,ks,4,9,"ng-select",0),t.ALo(1,"async")),2&n){let i;t.Q6J("ngIf",(null==(i=t.lcZ(1,1,e.variants$))?null:i.length)>1)}},dependencies:[_.O5,d.JJ,d.On,oe.w9,oe.ir,_.Ov,b.X$],changeDetection:0});var Os=m(2799);function Js(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-language-selector",8),t.NdJ("languageCodeChange",function(a){t.CHM(e);const r=t.oxw(2);return t.KtG(r.setLanguage(a))}),t.ALo(1,"async"),t.ALo(2,"async"),t.qZA()}if(2&o){const e=t.oxw().ngIf,i=t.oxw();t.Q6J("disabled",t.lcZ(1,3,i.isNew$))("availableLanguageCodes",e)("currentLanguageCode",t.lcZ(2,5,i.languageCode$))}}function Ds(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Js,3,7,"vdr-language-selector",7),t.BQk()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("ngIf",e.length>1)}}function ws(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",(e.detailForm.invalid||e.stockLevelsForm.invalid||e.pricesForm.invalid||e.detailForm.pristine&&e.stockLevelsForm.pristine&&e.pricesForm.pristine)&&!e.assetsChanged()),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}const Ns=function(){return["enabled"]};function Vs(o,n){if(1&o&&(t.TgZ(0,"clr-toggle-wrapper"),t._UZ(1,"input",38),t.TgZ(2,"label"),t._uU(3),t.ALo(4,"translate"),t.qZA()()),2&o){const e=t.oxw(2);t.xp6(1),t.Q6J("formControl",e.detailForm.get(t.DdM(4,Ns))),t.xp6(2),t.Oqu(t.lcZ(4,2,"common.enabled"))}}function Us(o,n){if(1&o&&(t.TgZ(0,"vdr-chip",42)(1,"span"),t._uU(2),t.qZA(),t._uU(3),t.qZA()),2&o){const e=n.$implicit,i=t.oxw(3);t.Q6J("colorFrom",i.optionGroupCode(e.groupId))("invert",!0),t.xp6(2),t.hij("",i.optionGroupCode(e.groupId),":"),t.xp6(1),t.hij(" ",i.optionName(e)," ")}}const Ms=function(){return["../../","options"]};function Qs(o,n){1&o&&(t.TgZ(0,"a",43),t._UZ(1,"clr-icon",44),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,Ms)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.edit-options")," "))}function qs(o,n){if(1&o&&(t.TgZ(0,"vdr-card",14),t.ALo(1,"translate"),t.TgZ(2,"div",39),t.YNc(3,Us,4,4,"vdr-chip",40),t.ALo(4,"sort"),t.qZA(),t.TgZ(5,"div"),t.YNc(6,Qs,4,5,"a",41),t.qZA()()),2&o){const e=t.oxw().ngIf,i=t.oxw();t.Q6J("title",t.lcZ(1,3,"catalog.product-options")),t.xp6(3),t.Q6J("ngForOf",t.xi3(4,5,e.options,"groupId")),t.xp6(3),t.Q6J("vdrIfPermissions",i.updatePermissions)}}function $s(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"vdr-facet-value-chip",45),t.NdJ("remove",function(){const r=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.removeFacetValue(r.id))}),t.ALo(1,"hasPermission"),t.qZA()}if(2&o){const e=n.$implicit,i=t.oxw(2);t.Q6J("facetValue",e)("removable",t.lcZ(1,2,i.updatePermissions))}}function Ss(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",46),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectFacetValue())}),t._UZ(1,"clr-icon",47),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&o&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"catalog.add-facets")," "))}function Ys(o,n){if(1&o&&t._UZ(0,"vdr-page-entity-info",48),2&o){const e=n.ngIf;t.Q6J("entity",e)}}function Gs(o,n){if(1&o&&(t.TgZ(0,"vdr-card",14),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",49),t.ALo(3,"hasPermission"),t.qZA()),2&o){const e=t.oxw(2);t.Q6J("title",t.lcZ(1,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get("customFields"))("readonly",!t.lcZ(3,6,e.updatePermissions))}}function Es(o,n){if(1&o&&(t.TgZ(0,"option",33),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}function Bs(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"button",55),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,r=t.oxw(2);return t.KtG(r.toggleDeletePrice(a.get("delete")))}),t._UZ(2,"clr-icon",56),t.qZA()()}if(2&o){const e=t.oxw().$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("disabled",e.value.currencyCode===i.channelDefaultCurrencyCode)}}function js(o,n){if(1&o&&(t.TgZ(0,"div",50)(1,"vdr-form-field",51),t.ALo(2,"translate"),t.ALo(3,"translate"),t.TgZ(4,"div",52),t._UZ(5,"vdr-currency-input",53),t.ALo(6,"hasPermission"),t.YNc(7,Bs,3,1,"div",2),t.qZA()(),t._UZ(8,"vdr-variant-price-detail",54),t.ALo(9,"async"),t.qZA()),2&o){const e=n.$implicit,i=t.oxw(2);t.Q6J("formGroup",e),t.xp6(1),t.Q6J("label",t.lcZ(2,12,"catalog.price")+(1<i.pricesForm.length?" ("+e.value.currencyCode+")":""))("tooltip",1<i.pricesForm.length&&e.value.currencyCode===i.channelDefaultCurrencyCode?t.lcZ(3,14,"catalog.default-currency"):void 0),t.xp6(3),t.ekj("pending-deletion",!0===e.value.delete),t.xp6(1),t.Q6J("currencyCode",e.value.currencyCode)("readonly",!t.lcZ(6,16,i.updatePermissions)||!0===e.value.delete),t.xp6(2),t.Q6J("ngIf",1<i.pricesForm.controls.length),t.xp6(1),t.Q6J("price",e.value.price)("currencyCode",e.value.currencyCode)("priceIncludesTax",t.lcZ(9,18,i.channelPriceIncludesTax$))("taxCategoryId",i.detailForm.get("taxCategoryId").value)}}function Rs(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw(4);return t.KtG(s.addPriceInCurrency(r))}),t._uU(1),t.ALo(2,"localeCurrencyName"),t.qZA()}if(2&o){const e=n.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e)," ")}}function Hs(o,n){if(1&o&&(t.TgZ(0,"div")(1,"vdr-dropdown")(2,"button",57),t._UZ(3,"clr-icon",47),t._uU(4),t.ALo(5,"translate"),t._UZ(6,"clr-icon",58),t.qZA(),t.TgZ(7,"vdr-dropdown-menu"),t.YNc(8,Rs,3,3,"button",59),t.qZA()()()),2&o){const e=t.oxw().ngIf;t.xp6(4),t.hij(" ",t.lcZ(5,2,"catalog.add-price-in-another-currency")," "),t.xp6(4),t.Q6J("ngForOf",e)}}function Ks(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Hs,9,4,"div",2),t.BQk()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("ngIf",e.length)}}function zs(o,n){if(1&o&&(t.TgZ(0,"div",61)(1,"vdr-form-field",62),t.ALo(2,"translate"),t._UZ(3,"input",63),t.ALo(4,"hasPermission"),t.qZA(),t.TgZ(5,"vdr-form-item",64),t.ALo(6,"translate"),t._uU(7),t.qZA()()),2&o){const e=n.$implicit,i=t.oxw(2);let a,r,s,l,u;t.Q6J("formGroup",e),t.xp6(1),t.Q6J("label",(null==(a=e.get("stockLocationName"))?null:a.value)+": "+t.lcZ(2,7,"catalog.stock-on-hand"))("for","stockOnHand_"+(null==(r=e.get("stockLocationId"))?null:r.value)),t.xp6(2),t.Q6J("id","stockOnHand_"+(null==(s=e.get("stockLocationId"))?null:s.value))("readonly",!t.lcZ(4,9,i.updatePermissions)),t.xp6(2),t.Q6J("label",(null==(l=e.get("stockLocationName"))?null:l.value)+": "+t.lcZ(6,11,"catalog.stock-allocated")),t.xp6(2),t.hij(" ",null==(u=e.get("stockAllocated"))?null:u.value," ")}}function Ws(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){const r=t.CHM(e).$implicit,s=t.oxw(4);return t.KtG(s.addStockLocation(r))}),t._UZ(1,"clr-icon",65),t._uU(2),t.qZA()}if(2&o){const e=n.$implicit;t.xp6(2),t.hij(" ",e.name," ")}}function Xs(o,n){if(1&o&&(t.TgZ(0,"div")(1,"vdr-dropdown")(2,"button",57),t._UZ(3,"clr-icon",47),t._uU(4),t.ALo(5,"translate"),t._UZ(6,"clr-icon",58),t.qZA(),t.TgZ(7,"vdr-dropdown-menu"),t.YNc(8,Ws,3,1,"button",59),t.qZA()()()),2&o){const e=t.oxw().ngIf;t.xp6(4),t.hij(" ",t.lcZ(5,2,"catalog.add-stock-location")," "),t.xp6(4),t.Q6J("ngForOf",e)}}function tl(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Xs,9,4,"div",2),t.BQk()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("ngIf",e.length)}}const he=function(){return["UpdateCatalog","UpdateProduct"]};function el(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"form",10)(1,"vdr-page-detail-layout")(2,"vdr-page-detail-sidebar")(3,"vdr-card")(4,"vdr-form-field",11),t.ALo(5,"translate"),t.YNc(6,Vs,5,5,"clr-toggle-wrapper",12),t.qZA()(),t.YNc(7,qs,7,8,"vdr-card",13),t.TgZ(8,"vdr-card",14),t.ALo(9,"translate"),t.TgZ(10,"div",15),t.YNc(11,$s,2,4,"vdr-facet-value-chip",16),t.ALo(12,"async"),t.qZA(),t.TgZ(13,"div"),t.YNc(14,Ss,4,3,"button",17),t.qZA()(),t.TgZ(15,"vdr-card"),t.YNc(16,Ys,1,1,"vdr-page-entity-info",18),t.ALo(17,"async"),t.qZA()(),t.TgZ(18,"vdr-page-block"),t._UZ(19,"button",19),t.TgZ(20,"vdr-card")(21,"div",20)(22,"vdr-form-field",21),t.ALo(23,"translate"),t._UZ(24,"input",22),t.ALo(25,"hasPermission"),t.qZA(),t.TgZ(26,"vdr-form-field",23),t.ALo(27,"translate"),t._UZ(28,"input",24),t.ALo(29,"hasPermission"),t.qZA()()(),t.YNc(30,Gs,4,8,"vdr-card",13),t._UZ(31,"vdr-custom-detail-component-host",25),t.TgZ(32,"vdr-card",14),t.ALo(33,"translate"),t.TgZ(34,"vdr-assets",26),t.NdJ("change",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.assetChanges=a)}),t.qZA()(),t.TgZ(35,"vdr-card",14),t.ALo(36,"translate"),t.TgZ(37,"div",20)(38,"vdr-form-field",27),t.ALo(39,"translate"),t.TgZ(40,"select",28),t.YNc(41,Es,2,2,"option",29),t.ALo(42,"async"),t.qZA()()(),t.YNc(43,js,10,20,"div",30),t.YNc(44,Ks,2,1,"ng-container",2),t.ALo(45,"async"),t.qZA(),t.TgZ(46,"vdr-card",14),t.ALo(47,"translate"),t.TgZ(48,"div",20)(49,"vdr-form-field",31),t.ALo(50,"translate"),t.ALo(51,"translate"),t.TgZ(52,"select",32),t.ALo(53,"hasPermission"),t.TgZ(54,"option",33),t._uU(55),t.ALo(56,"translate"),t.qZA(),t.TgZ(57,"option",33),t._uU(58),t.ALo(59,"translate"),t.qZA(),t.TgZ(60,"option",33),t._uU(61),t.ALo(62,"translate"),t.qZA()()(),t.TgZ(63,"vdr-form-item",34),t.ALo(64,"translate"),t.ALo(65,"translate"),t._UZ(66,"input",35),t.ALo(67,"hasPermission"),t.TgZ(68,"clr-toggle-wrapper"),t._UZ(69,"input",36),t.ALo(70,"hasPermission"),t.TgZ(71,"label"),t._uU(72),t.ALo(73,"translate"),t.qZA()()()(),t.YNc(74,zs,8,13,"div",37),t.YNc(75,tl,2,1,"ng-container",2),t.ALo(76,"async"),t.qZA()()()()}if(2&o){const e=n.ngIf,i=t.oxw();let a;t.Q6J("formGroup",i.detailForm),t.xp6(4),t.Q6J("label",t.lcZ(5,43,"catalog.visibility")),t.xp6(2),t.Q6J("vdrIfPermissions",t.DdM(95,he)),t.xp6(1),t.Q6J("ngIf",e.options.length),t.xp6(1),t.Q6J("title",t.lcZ(9,45,"catalog.facets")),t.xp6(3),t.Q6J("ngForOf",t.lcZ(12,47,i.facetValues$)),t.xp6(3),t.Q6J("vdrIfPermissions",i.updatePermissions),t.xp6(2),t.Q6J("ngIf",t.lcZ(17,49,i.entity$)),t.xp6(6),t.Q6J("label",t.lcZ(23,51,"common.name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(25,53,t.DdM(96,he))),t.xp6(2),t.Q6J("label",t.lcZ(27,55,"catalog.sku")),t.xp6(2),t.Q6J("readonly",!t.lcZ(29,57,i.updatePermissions)),t.xp6(2),t.Q6J("ngIf",i.customFields.length),t.xp6(1),t.Q6J("entity$",i.entity$)("detailForm",i.detailForm),t.xp6(1),t.Q6J("title",t.lcZ(33,59,"catalog.assets")),t.xp6(2),t.Q6J("assets",i.assetChanges.assets||e.assets)("featuredAsset",i.assetChanges.featuredAsset||e.featuredAsset)("updatePermissions",i.updatePermissions),t.xp6(1),t.Q6J("title",t.lcZ(36,61,"catalog.price-and-tax")),t.xp6(3),t.Q6J("label",t.lcZ(39,63,"catalog.tax-category")),t.xp6(3),t.Q6J("ngForOf",t.lcZ(42,65,i.taxCategories$)),t.xp6(2),t.Q6J("ngForOf",i.pricesForm.controls),t.xp6(1),t.Q6J("ngIf",t.lcZ(45,67,i.unusedCurrencyCodes$)),t.xp6(2),t.Q6J("title",t.lcZ(47,69,"catalog.stock-levels")),t.xp6(3),t.Q6J("label",t.lcZ(50,71,"catalog.track-inventory"))("tooltip",t.lcZ(51,73,"catalog.track-inventory-tooltip")),t.xp6(3),t.Q6J("disabled",!t.lcZ(53,75,i.updatePermissions)),t.xp6(2),t.Q6J("value",i.GlobalFlag.TRUE),t.xp6(1),t.hij(" ",t.lcZ(56,77,"catalog.track-inventory-true")," "),t.xp6(2),t.Q6J("value",i.GlobalFlag.FALSE),t.xp6(1),t.hij(" ",t.lcZ(59,79,"catalog.track-inventory-false")," "),t.xp6(2),t.Q6J("value",i.GlobalFlag.INHERIT),t.xp6(1),t.hij(" ",t.lcZ(62,81,"catalog.track-inventory-inherit")," "),t.xp6(2),t.Q6J("label",t.lcZ(64,83,"catalog.out-of-stock-threshold"))("tooltip",t.lcZ(65,85,"catalog.out-of-stock-threshold-tooltip")),t.xp6(3),t.Q6J("readonly",!t.lcZ(67,87,i.updatePermissions))("vdrDisabled",!1!==(null==(a=i.detailForm.get("useGlobalOutOfStockThreshold"))?null:a.value)||i.inventoryIsNotTracked(i.detailForm)),t.xp6(3),t.Q6J("vdrDisabled",!t.lcZ(70,89,i.updatePermissions)||i.inventoryIsNotTracked(i.detailForm)),t.xp6(3),t.AsE("",t.lcZ(73,91,"catalog.use-global-value")," (",i.globalOutOfStockThreshold,")"),t.xp6(2),t.Q6J("ngForOf",i.stockLevelsForm.controls),t.xp6(1),t.Q6J("ngIf",t.lcZ(76,93,i.unusedStockLocation$))}}class Dt extends c.VE7{constructor(n,e,i,a,r,s){super(),this.productDetailService=n,this.formBuilder=e,this.modalService=i,this.notificationService=a,this.dataService=r,this.changeDetector=s,this.updatePermissions=[c.y3$.UpdateCatalog,c.y3$.UpdateProduct],this.customFields=this.getCustomFieldConfig("ProductVariant"),this.customOptionFields=this.getCustomFieldConfig("ProductOption"),this.detailForm=this.formBuilder.group({id:"",enabled:!1,sku:"",name:"",taxCategoryId:"",stockOnHand:0,useGlobalOutOfStockThreshold:!0,outOfStockThreshold:0,trackInventory:c.TvZ.TRUE,facetValueIds:[],customFields:this.formBuilder.group(this.customFields.reduce((l,u)=>({...l,[u.name]:""}),{}))}),this.stockLevelsForm=this.formBuilder.array([]),this.pricesForm=this.formBuilder.array([]),this.assetChanges={},this.GlobalFlag=c.TvZ}ngOnInit(){this.init(),this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(({globalSettings:r})=>{this.globalTrackInventory=r.trackInventory,this.globalOutOfStockThreshold=r.outOfStockThreshold,this.changeDetector.markForCheck()}),this.taxCategories$=this.result$.pipe((0,h.U)(r=>r.taxCategories.items));const n=this.result$.pipe((0,B.b)(r=>this.channelDefaultCurrencyCode=r.activeChannel.defaultCurrencyCode),(0,h.U)(r=>r.activeChannel.availableCurrencyCodes));this.unusedCurrencyCodes$=(0,y.a)(this.pricesForm.valueChanges,n).pipe((0,h.U)(([r,s])=>s.filter(l=>!r.map(u=>u.currencyCode).includes(l))));const e=this.result$.pipe((0,h.U)(r=>r.stockLocations.items));this.unusedStockLocation$=(0,y.a)(this.entity$,e).pipe((0,h.U)(([r,s])=>{const l=r.stockLevels.map(u=>u.stockLocation.id);return s.filter(u=>!l.includes(u.id))})),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(r=>r.activeChannel.pricesIncludeTax).pipe((0,Ht.d)(1)),this.stockLevels$=this.entity$.pipe((0,h.U)(r=>r?.stockLevels??[]));const i=this.entity$.pipe((0,h.U)(r=>r.facetValues??[])),a=this.detailForm.get("facetValueIds").valueChanges.pipe((0,Re.T)(1),(0,U.x)(),(0,C.w)(r=>this.dataService.facet.getFacetValues({filter:{id:{in:r}}}).mapSingle(({facetValues:s})=>s.items)),(0,Ht.d)(1));this.facetValues$=(0,je.z)(i.pipe((0,$.q)(1)),i.pipe(He(a)))}ngOnDestroy(){this.destroy()}addPriceInCurrency(n){this.pricesForm.push(this.formBuilder.group({currencyCode:n,price:0,delete:!1}))}toggleDeletePrice(n){n.setValue(!n.value),n.markAsDirty()}addStockLocation(n){this.stockLevelsForm.push(this.formBuilder.group({stockLocationId:n.id,stockLocationName:n.name,stockOnHand:0,stockAllocated:0}))}save(){(0,y.a)(this.entity$,this.languageCode$).pipe((0,$.q)(1),(0,w.z)(([n,e])=>{this.detailForm.value;const a=(0,As.e)(this.getUpdatedVariant(n,this.detailForm,e),["id","enabled","translations","sku","taxCategoryId","facetValueIds","featuredAssetId","assetIds","trackInventory","outOfStockThreshold","useGlobalOutOfStockThreshold","customFields"]);return this.stockLevelsForm.dirty&&(a.stockLevels=this.stockLevelsForm.controls.filter(r=>r.dirty).map(r=>({stockLocationId:r.value.stockLocationId,stockOnHand:r.value.stockOnHand}))),this.pricesForm.dirty&&(a.prices=this.pricesForm.controls.filter(r=>r.dirty).map(r=>({price:r.value.price,currencyCode:r.value.currencyCode,delete:!0===r.value.delete}))),this.dataService.mutate(c.YZY,{input:[a]})})).subscribe(n=>{this.detailForm.markAsPristine(),this.stockLevelsForm.markAsPristine(),this.pricesForm.markAsPristine(),this.assetChanges={},this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"ProductVariant"}),this.changeDetector.markForCheck()},n=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"ProductVariant"})})}assetsChanged(){return!!Object.values(this.assetChanges).length}inventoryIsNotTracked(n){const e=n.get("trackInventory")?.value;return e===c.TvZ.FALSE||e===c.TvZ.INHERIT&&!1===this.globalTrackInventory}optionGroupCode(n){return this.entity?.product.optionGroups.find(i=>i.id===n)?.code}optionName(n){return(n.translations.find(i=>i.languageCode===this.languageCode)??n.translations[0]).name}removeFacetValue(n){const e=this.detailForm,i=e.value.facetValueIds??[];e.patchValue({facetValueIds:i.filter(a=>a!==n)}),e.markAsDirty()}selectFacetValue(){this.displayFacetValueModal().subscribe(n=>{if(n){const e=this.detailForm.value.facetValueIds??[];this.detailForm.patchValue({facetValueIds:(0,V.T)([...e,...n])}),this.detailForm.markAsDirty()}})}displayFacetValueModal(){return this.modalService.fromComponent(at,{size:"md",closable:!0}).pipe((0,h.U)(n=>n&&n.map(e=>e.id)))}setFormValues(n,e){const i=(0,c.ZIM)(n,e),a=n.facetValues.map(r=>r.id);this.detailForm.patchValue({id:n.id,enabled:n.enabled,sku:n.sku,name:i?i.name:"",taxCategoryId:n.taxCategory.id,stockOnHand:n.stockLevels[0]?.stockOnHand??0,useGlobalOutOfStockThreshold:n.useGlobalOutOfStockThreshold,outOfStockThreshold:n.outOfStockThreshold,trackInventory:n.trackInventory,facetValueIds:a}),this.stockLevelsForm.clear();for(const r of n.stockLevels)this.stockLevelsForm.push(this.formBuilder.group({stockLocationId:r.stockLocation.id,stockLocationName:r.stockLocation.name,stockOnHand:r.stockOnHand,stockAllocated:r.stockAllocated}));this.pricesForm.clear();for(const r of n.prices)this.pricesForm.push(this.formBuilder.group({price:r.price,currencyCode:r.currencyCode,delete:!1}));this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),n,i)}getUpdatedVariant(n,e,i){return{...(0,c.iSy)({translatable:n,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:i,defaultTranslation:{languageCode:i,name:n.name||""}}),assetIds:this.assetChanges.assets?.map(r=>r.id),featuredAssetId:this.assetChanges.featuredAsset?.id,facetValueIds:e.value.facetValueIds}}}Dt.\u0275fac=function(n){return new(n||Dt)(t.Y36(S),t.Y36(d.qu),t.Y36(c.Z7U),t.Y36(c.gqp),t.Y36(c.DoR),t.Y36(t.sBO))},Dt.\u0275cmp=t.Xpm({type:Dt,selectors:[["vdr-product-variant-detail"]],features:[t.qOj],decls:12,vars:10,consts:[[3,"grow"],[1,"flex","center"],[4,"ngIf"],[3,"productId"],["locationId","product-variant-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],["class","form",3,"formGroup",4,"ngIf"],["class","mr-2",3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange",4,"ngIf"],[1,"mr-2",3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"btn","btn-primary",3,"disabled","click"],[1,"form",3,"formGroup"],["for","visibility",3,"label"],[4,"vdrIfPermissions"],[3,"title",4,"ngIf"],[3,"title"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","button-small mt-2",3,"click",4,"vdrIfPermissions"],[3,"entity",4,"ngIf"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku",3,"readonly"],["locationId","product-variant-detail",3,"entity$","detailForm"],[3,"assets","featuredAsset","updatePermissions","change"],["for","taxCategory",3,"label"],["name","taxCategory","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],["class","form-grid prices",3,"formGroup",4,"ngFor","ngForOf"],["for","track-inventory",3,"label","tooltip"],["name","track-inventory","formControlName","trackInventory",3,"disabled"],[3,"value"],[3,"label","tooltip"],["type","number","formControlName","outOfStockThreshold",3,"readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],["class","form-grid stock-levels",3,"formGroup",4,"ngFor","ngForOf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"options"],[3,"colorFrom","invert",4,"ngFor","ngForOf"],["class","button-small mt-2",3,"routerLink",4,"vdrIfPermissions"],[3,"colorFrom","invert"],[1,"button-small","mt-2",3,"routerLink"],["shape","pencil"],[3,"facetValue","removable","remove"],[1,"button-small","mt-2",3,"click"],["shape","plus"],[3,"entity"],["entityName","ProductVariant",3,"customFields","customFieldsFormGroup","readonly"],[1,"form-grid","prices",3,"formGroup"],["for","price",3,"label","tooltip"],[1,"price-wrapper"],["name","price","formControlName","price",3,"currencyCode","readonly"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[1,"button-small","delete-button",3,"disabled","click"],["shape","trash"],["vdrDropdownTrigger","",1,"button","mt-2"],["shape","ellipsis-vertical"],["vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["vdrDropdownItem","",3,"click"],[1,"form-grid","stock-levels",3,"formGroup"],[3,"label","for"],["type","number","formControlName","stockOnHand",3,"id","readonly"],[3,"label"],["shape","map-marker"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-left",0)(3,"div",1),t.YNc(4,Ds,2,1,"ng-container",2),t.ALo(5,"async"),t._UZ(6,"vdr-product-variant-quick-jump",3),t.qZA()(),t.TgZ(7,"vdr-ab-right"),t._UZ(8,"vdr-action-bar-items",4),t.YNc(9,ws,3,4,"button",5),t.qZA()()(),t.YNc(10,el,77,97,"form",6),t.ALo(11,"async")),2&n&&(t.xp6(2),t.Q6J("grow",!0),t.xp6(2),t.Q6J("ngIf",t.lcZ(5,5,e.availableLanguages$)),t.xp6(2),t.Q6J("productId",null==e.entity?null:e.entity.product.id),t.xp6(3),t.Q6J("vdrIfPermissions",t.DdM(9,he)),t.xp6(1),t.Q6J("ngIf",t.lcZ(11,7,e.entity$)))},dependencies:[f.qvL,f.MgK,f.KKC,f.PEh,_.sg,_.O5,d._Y,d.YN,d.Kr,d.Fj,d.wV,d.Wl,d.EJ,d.JJ,d.JL,d.oH,d.sg,d.u,Z.rH,x.Kk,x.BN,x.mz,z.Y,ge.K,ce.q,M.h,F.y,Ke.J,R.S,Qt.J,qt.N,$t.U,St.H,J.H,G.W,se.x,ut.y,Kt.C,O.z,Vt.D,zt.T,Wt.W,gt.A,X,Ot,Jt,_.Ov,b.X$,Os.u,fe.U,Y.j],styles:[".facets[_ngcontent-%COMP%], .options[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:3px}vdr-product-variant-quick-jump[_ngcontent-%COMP%]{flex:1;margin-right:calc(var(--space-unit) * 2)}.stock-levels[_ngcontent-%COMP%], .prices[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 2);padding-top:calc(var(--space-unit) * 2);border-top:1px solid var(--color-weight-150)}.price-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-unit);width:100%}.price-wrapper.pending-deletion[_ngcontent-%COMP%]   vdr-currency-input[_ngcontent-%COMP%]{opacity:.7}.price-wrapper.pending-deletion[_ngcontent-%COMP%]   .delete-button[_ngcontent-%COMP%]{background-color:var(--color-error-700);color:var(--color-error-100)}"],changeDetection:0});const nn={location:"product-variant-list",label:(0,p.J)("catalog.assign-to-channel"),icon:"layers",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateProduct),isVisible:({injector:o})=>(0,c.SDV)(o.get(c.DoR)),onClick:({injector:o,selection:n,clearSelection:e})=>{o.get(c.Z7U).fromComponent(E,{size:"lg",locals:{productVariantIds:(0,V.T)(n.map(a=>a.id)),currentChannelIds:[]}}).subscribe(a=>{a&&e()})}},on=(0,c.RBx)({location:"product-variant-list",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateProduct),getItemName:o=>o.name,bulkRemoveFromChannel:(o,n,e)=>o.product.removeVariantsFromChannel({channelId:e,productVariantIds:n}).pipe((0,h.U)(i=>i.removeProductVariantsFromChannel))}),an={location:"product-variant-list",label:(0,p.J)("common.delete"),icon:"trash",iconClass:"is-danger",requiresPermission:o=>o.includes(c.y3$.DeleteProduct)||o.includes(c.y3$.DeleteCatalog),onClick:({injector:o,selection:n,hostComponent:e,clearSelection:i})=>{const a=o.get(c.Z7U),r=o.get(c.DoR),s=o.get(c.gqp);a.dialog({title:(0,p.J)("common.confirm-bulk-delete"),translationVars:{count:n.length},buttons:[{type:"secondary",label:(0,p.J)("common.cancel")},{type:"danger",label:(0,p.J)("common.delete"),returnValue:!0}]}).pipe((0,C.w)(l=>l?r.product.deleteProductVariants((0,V.T)(n.map(u=>u.id))):L.E)).subscribe(l=>{let u=0;const g=[];for(const v of l.deleteProductVariants)v.result===c.PcR.DELETED?u++:v.message&&g.push(v.message);0<u&&s.success((0,p.J)("catalog.notify-bulk-delete-products-success"),{count:u}),0<g.length&&s.error(g.join("\n")),e.refresh(),i()})}};var nl=m(4285);function ol(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"th"),t._uU(2),t.qZA(),t.BQk()),2&o){const e=n.$implicit;t.xp6(2),t.Oqu(e.name)}}function il(o,n){if(1&o&&(t._UZ(0,"img",18),t.ALo(1,"assetPreview")),2&o){const e=n.ngIf;t.Q6J("src",t.xi3(1,1,e,"tiny"),t.LSH)}}function al(o,n){1&o&&(t.TgZ(0,"div",19),t._UZ(1,"clr-icon",20),t.qZA())}function rl(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"td",5),t.ALo(2,"stringToColor"),t._uU(3),t.qZA(),t.BQk()),2&o){const e=n.$implicit,i=t.oxw().ngIf,a=t.oxw(2);t.xp6(1),t.Udp("color",t.lcZ(2,5,a.optionGroupName(e.groupId))),t.ekj("disabled",!i.get("enabled").value),t.xp6(2),t.hij(" ",e.name," ")}}function cl(o,n){if(1&o&&(t._UZ(0,"vdr-currency-input",21),t.ALo(1,"hasPermission")),2&o){const e=t.oxw(2).$implicit,i=t.oxw();t.Q6J("currencyCode",e.currencyCode)("readonly",!t.lcZ(1,2,i.updatePermission))}}function sl(o,n){if(1&o&&(t._UZ(0,"vdr-currency-input",22),t.ALo(1,"hasPermission")),2&o){const e=t.oxw(2).$implicit,i=t.oxw();t.Q6J("currencyCode",e.currencyCode)("readonly",!t.lcZ(1,2,i.updatePermission))}}function ll(o,n){if(1&o&&(t.ynx(0,4),t.TgZ(1,"td",5)(2,"div",6)(3,"div",7),t.YNc(4,il,2,4,"img",8),t.YNc(5,al,2,0,"ng-template",null,9,t.W1O),t.qZA()()(),t.TgZ(7,"td",5)(8,"clr-input-container"),t._UZ(9,"input",10),t.ALo(10,"hasPermission"),t.ALo(11,"translate"),t.qZA()(),t.TgZ(12,"td",5)(13,"clr-input-container"),t._UZ(14,"input",11),t.ALo(15,"hasPermission"),t.ALo(16,"translate"),t.qZA()(),t.YNc(17,rl,4,7,"ng-container",1),t.ALo(18,"sort"),t.TgZ(19,"td",12)(20,"clr-input-container"),t.YNc(21,cl,2,4,"vdr-currency-input",13),t.YNc(22,sl,2,4,"vdr-currency-input",14),t.qZA()(),t.TgZ(23,"td",15)(24,"clr-input-container"),t._UZ(25,"input",16),t.ALo(26,"hasPermission"),t.qZA()(),t.TgZ(27,"td",15)(28,"clr-toggle-wrapper"),t._UZ(29,"input",17),t.ALo(30,"hasPermission"),t.qZA()(),t.BQk()),2&o){const e=n.ngIf,i=t.MAs(6),a=t.oxw().$implicit,r=t.oxw();t.Q6J("formGroup",e),t.xp6(1),t.ekj("disabled",!e.get("enabled").value),t.xp6(3),t.Q6J("ngIf",r.getFeaturedAsset(a))("ngIfElse",i),t.xp6(3),t.ekj("disabled",!e.get("enabled").value),t.xp6(2),t.Q6J("readonly",!t.lcZ(10,24,r.updatePermission))("placeholder",t.lcZ(11,26,"common.name")),t.xp6(3),t.ekj("disabled",!e.get("enabled").value),t.xp6(2),t.Q6J("readonly",!t.lcZ(15,28,r.updatePermission))("placeholder",t.lcZ(16,30,"catalog.sku")),t.xp6(3),t.Q6J("ngForOf",t.xi3(18,32,a.options,"groupId")),t.xp6(2),t.ekj("disabled",!e.get("enabled").value),t.xp6(2),t.Q6J("ngIf",!r.channelPriceIncludesTax),t.xp6(1),t.Q6J("ngIf",r.channelPriceIncludesTax),t.xp6(1),t.ekj("disabled",!e.get("enabled").value),t.xp6(2),t.Q6J("readonly",!t.lcZ(26,35,r.updatePermission)),t.xp6(2),t.ekj("disabled",!e.get("enabled").value),t.xp6(2),t.Q6J("vdrDisabled",!t.lcZ(30,37,r.updatePermission))}}function dl(o,n){if(1&o&&(t.TgZ(0,"tr"),t.YNc(1,ll,31,39,"ng-container",3),t.qZA()),2&o){const e=n.$implicit,i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.formGroupMap.get(e.id))}}class Et{constructor(n){this.changeDetector=n,this.formGroupMap=new Map,this.updatePermission=[c.y3$.UpdateCatalog,c.y3$.UpdateProduct]}ngOnInit(){this.subscription=this.formArray.valueChanges.pipe((0,h.U)(n=>n.length),(0,Mt.b)(1),(0,U.x)()).subscribe(()=>{this.buildFormGroupMap()}),this.buildFormGroupMap()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(n,e){return null!=e.id?e.id:n}getFeaturedAsset(n){return this.pendingAssetChanges[n.id]?.featuredAsset||n.featuredAsset}optionGroupName(n){const e=this.optionGroups.find(i=>i.id===n);return e&&e.name}buildFormGroupMap(){this.formGroupMap.clear();for(const n of this.formArray.controls)this.formGroupMap.set(n.value.id,n);this.changeDetector.markForCheck()}}function pl(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.create())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.create")," ")}}function ul(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.save())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("disabled",e.detailForm.invalid||e.detailForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(2,2,"common.update")," ")}}function ml(o,n){1&o&&t.YNc(0,ul,3,4,"button",13),2&o&&t.Q6J("vdrIfPermissions","UpdateStockLocation")}function gl(o,n){if(1&o&&(t.TgZ(0,"vdr-card"),t._UZ(1,"vdr-page-entity-info",14),t.qZA()),2&o){const e=n.ngIf;t.xp6(1),t.Q6J("entity",e)}}function _l(o,n){if(1&o&&(t.TgZ(0,"vdr-card",15),t.ALo(1,"translate"),t._UZ(2,"vdr-tabbed-custom-fields",16),t.qZA()),2&o){const e=t.oxw();t.Q6J("title",t.lcZ(1,3,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.detailForm.get("customFields"))}}Et.\u0275fac=function(n){return new(n||Et)(t.Y36(t.sBO))},Et.\u0275cmp=t.Xpm({type:Et,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",paginationConfig:"paginationConfig",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:24,vars:24,consts:[[1,"table"],[4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(n,e){1&n&&(t.TgZ(0,"table",0)(1,"thead")(2,"tr"),t._UZ(3,"th"),t.TgZ(4,"th"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"th"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.YNc(10,ol,3,1,"ng-container",1),t.ALo(11,"sort"),t.TgZ(12,"th"),t._uU(13),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"th"),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"th"),t._uU(19),t.ALo(20,"translate"),t.qZA()()(),t.TgZ(21,"tbody"),t.YNc(22,dl,2,1,"tr",2),t.ALo(23,"paginate"),t.qZA()()),2&n&&(t.xp6(5),t.Oqu(t.lcZ(6,8,"common.name")),t.xp6(3),t.Oqu(t.lcZ(9,10,"catalog.sku")),t.xp6(2),t.Q6J("ngForOf",t.xi3(11,12,e.optionGroups,"id")),t.xp6(3),t.Oqu(t.lcZ(14,15,"catalog.price")),t.xp6(3),t.Oqu(t.lcZ(17,17,"catalog.stock-on-hand")),t.xp6(3),t.Oqu(t.lcZ(20,19,"common.enabled")),t.xp6(3),t.Q6J("ngForOf",t.xi3(23,21,e.variants,e.paginationConfig))("ngForTrackBy",e.trackByFn))},dependencies:[f.q0d,f.qvL,f.KKC,f.PEh,f.xRP,f.G55,_.sg,_.O5,d.Fj,d.wV,d.Wl,d.JJ,d.JL,d.qQ,d.sg,d.u,ge.K,F.y,se.x,de._s,b.X$,fe.U,nl.s,Y.j,re.M],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});const fl=function(o){return{pattern:o}},ve=A.Ps`
    fragment StockLocationDetail on StockLocation {
        id
        createdAt
        updatedAt
        name
        description
    }
`,hl=A.Ps`
    query GetStockLocationDetail($id: ID!) {
        stockLocation(id: $id) {
            ...StockLocationDetail
        }
    }
    ${ve}
`,vl=A.Ps`
    mutation CreateStockLocation($input: CreateStockLocationInput!) {
        createStockLocation(input: $input) {
            ...StockLocationDetail
        }
    }
    ${ve}
`,Cl=A.Ps`
    mutation UpdateStockLocation($input: UpdateStockLocationInput!) {
        updateStockLocation(input: $input) {
            ...StockLocationDetail
        }
    }
    ${ve}
`;class Bt extends c.VE7{constructor(n,e,i,a){super(),this.changeDetector=n,this.dataService=e,this.formBuilder=i,this.notificationService=a,this.customFields=this.getCustomFieldConfig("StockLocation"),this.detailForm=this.formBuilder.group({name:["",d.kI.required],description:[""],customFields:this.formBuilder.group(this.customFields.reduce((r,s)=>({...r,[s.name]:""}),{}))})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}create(){if(!this.detailForm.dirty)return;const{name:n,description:e,customFields:i}=this.detailForm.value;if(!n)return;const a={name:n,description:e,customFields:i};this.dataService.mutate(c.yNU,{input:a}).subscribe(r=>{this.notificationService.success((0,p.J)("common.notify-create-success"),{entity:"StockLocation"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",r.createStockLocation.id],{relativeTo:this.route})},r=>{this.notificationService.error((0,p.J)("common.notify-create-error"),{entity:"StockLocation"})})}save(){if(!this.detailForm.dirty)return;const n=this.detailForm.value;this.entity$.pipe((0,$.q)(1),(0,w.z)(e=>{const i={id:e.id,name:n.name,description:n.description,customFields:n.customFields};return this.dataService.mutate(c.Xwk,{input:i})})).subscribe(e=>{this.notificationService.success((0,p.J)("common.notify-update-success"),{entity:"StockLocation"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck()},e=>{this.notificationService.error((0,p.J)("common.notify-update-error"),{entity:"StockLocation"})})}setFormValues(n){this.detailForm.patchValue({name:n.name,description:n.description}),this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get("customFields"),n)}}Bt.\u0275fac=function(n){return new(n||Bt)(t.Y36(t.sBO),t.Y36(c.DoR),t.Y36(d.qu),t.Y36(c.gqp))},Bt.\u0275cmp=t.Xpm({type:Bt,selectors:[["vdr-stock-location-detail"]],features:[t.qOj],decls:28,vars:28,consts:[["locationId","stock-location-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],[1,"form",3,"formGroup"],[4,"ngIf"],[1,"form-grid"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly"],["for","slug",1,"form-grid-span",3,"label","errors"],["formControlName","description",3,"readonly"],["formGroupName","customFields",3,"title",4,"ngIf"],["locationId","stock-location-detail",3,"entity$","detailForm"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"entity"],["formGroupName","customFields",3,"title"],["entityName","StockLocation",3,"customFields","customFieldsFormGroup"]],template:function(n,e){if(1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),t._UZ(2,"vdr-ab-left"),t.TgZ(3,"vdr-ab-right"),t._UZ(4,"vdr-action-bar-items",0),t.YNc(5,pl,3,4,"button",1),t.ALo(6,"async"),t.YNc(7,ml,1,1,"ng-template",null,2,t.W1O),t.qZA()()(),t.TgZ(9,"form",3)(10,"vdr-page-detail-layout")(11,"vdr-page-detail-sidebar"),t.YNc(12,gl,2,1,"vdr-card",4),t.ALo(13,"async"),t.qZA(),t.TgZ(14,"vdr-page-block")(15,"vdr-card")(16,"div",5)(17,"vdr-form-field",6),t.ALo(18,"translate"),t._UZ(19,"input",7),t.ALo(20,"hasPermission"),t.qZA(),t.TgZ(21,"vdr-form-field",8),t.ALo(22,"translate"),t.ALo(23,"translate"),t._UZ(24,"vdr-rich-text-editor",9),t.ALo(25,"hasPermission"),t.qZA()()(),t.YNc(26,_l,3,5,"vdr-card",10),t._UZ(27,"vdr-custom-detail-component-host",11),t.qZA()()()),2&n){const i=t.MAs(8);t.xp6(5),t.Q6J("ngIf",t.lcZ(6,12,e.isNew$))("ngIfElse",i),t.xp6(4),t.Q6J("formGroup",e.detailForm),t.xp6(3),t.Q6J("ngIf",t.lcZ(13,14,e.entity$)),t.xp6(5),t.Q6J("label",t.lcZ(18,16,"common.name")),t.xp6(2),t.Q6J("readonly",!t.lcZ(20,18,"UpdateStockLocation")),t.xp6(2),t.Q6J("label",t.lcZ(22,20,"common.description"))("errors",t.VKq(26,fl,t.lcZ(23,22,"catalog.slug-pattern-error"))),t.xp6(3),t.Q6J("readonly",!t.lcZ(25,24,"UpdateStockLocation")),t.xp6(2),t.Q6J("ngIf",e.customFields.length),t.xp6(1),t.Q6J("entity$",e.entity$)("detailForm",e.detailForm)}},dependencies:[_.O5,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,d.x0,x.Kk,x.BN,x.mz,M.h,F.y,me.Y,J.H,G.W,ut.y,Kt.C,O.z,Vt.D,zt.T,Wt.W,gt.A,_.Ov,b.X$,Y.j],changeDetection:0});A.Ps`
    mutation DeleteStockLocations($input: [DeleteStockLocationInput!]!) {
        deleteStockLocations(input: $input) {
            result
            message
        }
    }
`,A.Ps`
    mutation AssignStockLocationsToChannel($input: AssignStockLocationsToChannelInput!) {
        assignStockLocationsToChannel(input: $input) {
            id
            name
        }
    }
`,A.Ps`
    mutation RemoveStockLocationsFromChannel($input: RemoveStockLocationsFromChannelInput!) {
        removeStockLocationsFromChannel(input: $input) {
            id
            name
        }
    }
`;const rn=(0,c.wwB)({location:"stock-location-list",requiresPermission:o=>o.includes(c.y3$.DeleteStockLocation)||o.includes(c.y3$.DeleteCatalog),getItemName:o=>o.name,bulkDelete:(o,n)=>o.mutate(c.jBp,{input:n.map(e=>({id:e}))}).pipe((0,h.U)(e=>e.deleteStockLocations)),shouldRetryItem:o=>o.result===c.PcR.NOT_DELETED}),cn=(0,c.z1G)({location:"stock-location-list",requiresPermission:o=>o.includes(c.y3$.UpdateCatalog)||o.includes(c.y3$.UpdateStockLocation),getItemName:o=>o.name,bulkAssignToChannel:(o,n,e)=>o.mutate(c.bYS,{input:{channelId:e,stockLocationIds:n}}).pipe((0,h.U)(i=>i.assignStockLocationsToChannel))}),sn=(0,c.RBx)({location:"stock-location-list",requiresPermission:o=>o.includes(c.y3$.DeleteCatalog)||o.includes(c.y3$.DeleteStockLocation),getItemName:o=>o.name,bulkRemoveFromChannel:(o,n,e)=>o.mutate(c.nwT,{input:{channelId:e,stockLocationIds:n}}).pipe((0,h.U)(i=>i.removeStockLocationsFromChannel))}),xl=function(){return["./","create"]};function bl(o,n){1&o&&(t.TgZ(0,"a",9),t._UZ(1,"clr-icon",10),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.Q6J("routerLink",t.DdM(4,xl)),t.xp6(2),t.hij(" ",t.lcZ(3,2,"catalog.create-new-stock-location")," "))}function Tl(o,n){if(1&o&&t._uU(0),2&o){const e=n.item;t.hij(" ",e.id," ")}}function Zl(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.createdAt,"short")," ")}}function Al(o,n){if(1&o&&(t._uU(0),t.ALo(1,"localeDate")),2&o){const e=n.item;t.hij(" ",t.xi3(1,1,e.updatedAt,"short")," ")}}const Pl=function(o){return["./",o]};function yl(o,n){if(1&o&&(t.TgZ(0,"a",11)(1,"span"),t._uU(2),t.qZA(),t._UZ(3,"clr-icon",12),t.qZA()),2&o){const e=n.item;t.Q6J("routerLink",t.VKq(2,Pl,e.id)),t.xp6(2),t.Oqu(e.name)}}function Fl(o,n){if(1&o&&t._UZ(0,"div",13),2&o){const e=n.item;t.Q6J("innerHTML",e.description,t.oJD)}}function Ll(o,n){if(1&o&&t._UZ(0,"vdr-dt2-custom-field-column",14),2&o){const e=n.$implicit,i=t.oxw();t.Q6J("customField",e)("sorts",i.sorts)}}const Il=function(){return["CreateStockLocation"]},kl=A.Ps`
    query GetStockLocationList($options: StockLocationListOptions) {
        stockLocations(options: $options) {
            items {
                ...StockLocationListItem
            }
            totalItems
        }
    }
    fragment StockLocationListItem on StockLocation {
        id
        createdAt
        updatedAt
        name
        description
    }
`;class wt extends c.$ms{constructor(){super(),this.customFields=this.getCustomFieldConfig("StockLocation"),this.filters=this.createFilterCollection().addDateFilters().addFilters([{name:"id",type:{kind:"text"},label:(0,p.J)("common.id"),filterField:"id"},{name:"enabled",type:{kind:"text"},label:(0,p.J)("common.enabled"),filterField:"name"},{name:"sku",type:{kind:"text"},label:(0,p.J)("catalog.sku"),filterField:"description"}]).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().addSorts([{name:"id"},{name:"createdAt"},{name:"updatedAt"},{name:"name"},{name:"description"}]).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.configure({document:c.uQH,getItems:n=>n.stockLocations,setVariables:(n,e)=>({options:{skip:n,take:e,filter:{name:{contains:this.searchTermControl.value},...this.filters.createFilterInput()},sort:this.sorts.createSortInput()}}),refreshListOnChanges:[this.sorts.valueChanges,this.filters.valueChanges]})}}function Ol(o,n){1&o&&(t._uU(0),t.ALo(1,"translate")),2&o&&t.Oqu(t.lcZ(1,1,"catalog.update-product-option"))}wt.\u0275fac=function(n){return new(n||wt)},wt.\u0275cmp=t.Xpm({type:wt,selectors:[["vdr-stock-location-list"]],features:[t.qOj],decls:30,vars:46,consts:[["locationId","stock-location-list"],["class","button primary",3,"routerLink",4,"vdrIfPermissions"],["id","stock-location-list",1,"mt-2",3,"items","itemsPerPage","totalItems","currentPage","filters","pageChange","itemsPerPageChange"],["locationId","stock-location-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],[3,"heading","hiddenByDefault","sort"],[3,"heading","optional","sort"],[3,"heading","sort"],[3,"customField","sorts",4,"ngFor","ngForOf"],[1,"button","primary",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[1,"description",3,"innerHTML"],[3,"customField","sorts"]],template:function(n,e){1&n&&(t.TgZ(0,"vdr-page-block")(1,"vdr-action-bar"),t._UZ(2,"vdr-ab-left"),t.TgZ(3,"vdr-ab-right"),t._UZ(4,"vdr-action-bar-items",0),t.YNc(5,bl,4,5,"a",1),t.qZA()()(),t.TgZ(6,"vdr-data-table-2",2),t.NdJ("pageChange",function(a){return e.setPageNumber(a)})("itemsPerPageChange",function(a){return e.setItemsPerPage(a)}),t.ALo(7,"async"),t.ALo(8,"async"),t.ALo(9,"async"),t.ALo(10,"async"),t._UZ(11,"vdr-bulk-action-menu",3)(12,"vdr-dt2-search",4),t.ALo(13,"translate"),t.TgZ(14,"vdr-dt2-column",5),t.ALo(15,"translate"),t.YNc(16,Tl,1,1,"ng-template"),t.qZA(),t.TgZ(17,"vdr-dt2-column",5),t.ALo(18,"translate"),t.YNc(19,Zl,2,4,"ng-template"),t.qZA(),t.TgZ(20,"vdr-dt2-column",5),t.ALo(21,"translate"),t.YNc(22,Al,2,4,"ng-template"),t.qZA(),t.TgZ(23,"vdr-dt2-column",6),t.ALo(24,"translate"),t.YNc(25,yl,4,4,"ng-template"),t.qZA(),t.TgZ(26,"vdr-dt2-column",7),t.ALo(27,"translate"),t.YNc(28,Fl,1,1,"ng-template"),t.qZA(),t.YNc(29,Ll,1,2,"vdr-dt2-custom-field-column",8),t.qZA()),2&n&&(t.xp6(5),t.Q6J("vdrIfPermissions",t.DdM(45,Il)),t.xp6(1),t.Q6J("items",t.lcZ(7,25,e.items$))("itemsPerPage",t.lcZ(8,27,e.itemsPerPage$))("totalItems",t.lcZ(9,29,e.totalItems$))("currentPage",t.lcZ(10,31,e.currentPage$))("filters",e.filters),t.xp6(5),t.Q6J("hostComponent",e)("selectionManager",e.selectionManager),t.xp6(1),t.Q6J("searchTermControl",e.searchTermControl)("searchTermPlaceholder",t.lcZ(13,33,"catalog.filter-by-name")),t.xp6(2),t.Q6J("heading",t.lcZ(15,35,"common.id"))("hiddenByDefault",!0)("sort",e.sorts.get("id")),t.xp6(3),t.Q6J("heading",t.lcZ(18,37,"common.created-at"))("hiddenByDefault",!0)("sort",e.sorts.get("createdAt")),t.xp6(3),t.Q6J("heading",t.lcZ(21,39,"common.updated-at"))("hiddenByDefault",!0)("sort",e.sorts.get("updatedAt")),t.xp6(3),t.Q6J("heading",t.lcZ(24,41,"common.name"))("optional",!1)("sort",e.sorts.get("name")),t.xp6(3),t.Q6J("heading",t.lcZ(27,43,"common.description"))("sort",e.sorts.get("description")),t.xp6(3),t.Q6J("ngForOf",e.customFields))},dependencies:[f.qvL,_.sg,Z.rH,x.Kk,x.BN,x.mz,J.H,G.W,Xt.c,mt.e,H.U,it.J,te.j,O.z,_.Ov,b.X$,nt.H],styles:[".description>p{margin-top:0!important}"],changeDetection:0});const Jl=function(){return["UpdateCatalog","UpdateProduct"]};function Dl(o,n){if(1&o&&(t.TgZ(0,"section")(1,"label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"vdr-tabbed-custom-fields",10),t.ALo(5,"hasPermission"),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"common.custom-fields")),t.xp6(2),t.Q6J("customFields",e.customFields)("customFieldsFormGroup",e.customFieldsForm)("readonly",!t.lcZ(5,6,t.DdM(8,Jl)))}}function wl(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"button",12),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.update())}),t._uU(4),t.ALo(5,"translate"),t.qZA()}if(2&o){const e=t.oxw(),i=t.MAs(4),a=t.MAs(8);t.xp6(1),t.Oqu(t.lcZ(2,3,"common.cancel")),t.xp6(2),t.Q6J("disabled",i.invalid||a.invalid||i.pristine&&a.pristine&&e.customFieldsForm.pristine),t.xp6(1),t.hij(" ",t.lcZ(5,5,"catalog.update-product-option")," ")}}class jt{constructor(){this.updateVariantName=!0,this.codeInputTouched=!1}ngOnInit(){const n=this.productOption.translations.find(e=>e.languageCode===this.activeLanguage);if(this.name=n?.name??"",this.code=this.productOption.code,this.customFieldsForm=new d.nJ({}),this.customFields){const e=n&&n.customFields||{};for(const i of this.customFields){const a=i.name,r="localeString"===i.type?e[a]:this.productOption.customFields[a];this.customFieldsForm.addControl(i.name,new d.p4(r))}}}update(){const n=(0,c.iSy)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith({...n,autoUpdate:this.updateVariantName})}cancel(){this.resolveWith()}updateCode(n){!this.codeInputTouched&&!this.productOption.code&&(this.code=(0,j.U)(n,"-"))}}jt.\u0275fac=function(n){return new(n||jt)},jt.\u0275cmp=t.Xpm({type:jt,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],["entityName","ProductOption",3,"customFields","customFieldsFormGroup","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(n,e){1&n&&(t.YNc(0,Ol,2,3,"ng-template",0),t.TgZ(1,"vdr-form-field",1),t.ALo(2,"translate"),t.TgZ(3,"input",2,3),t.NdJ("ngModelChange",function(a){return e.name=a})("input",function(a){return e.updateCode(a.target.value)}),t.qZA()(),t.TgZ(5,"vdr-form-field",4),t.ALo(6,"translate"),t.TgZ(7,"input",5,6),t.NdJ("ngModelChange",function(a){return e.code=a}),t.qZA()(),t.TgZ(9,"clr-checkbox-wrapper")(10,"input",7),t.NdJ("ngModelChange",function(a){return e.updateVariantName=a}),t.qZA(),t.TgZ(11,"label"),t._uU(12),t.ALo(13,"translate"),t.qZA()(),t.YNc(14,Dl,6,9,"section",8),t.YNc(15,wl,6,7,"ng-template",9)),2&n&&(t.xp6(1),t.Q6J("label",t.lcZ(2,7,"catalog.option-name")),t.xp6(2),t.Q6J("ngModel",e.name),t.xp6(2),t.Q6J("label",t.lcZ(6,9,"common.code")),t.xp6(2),t.Q6J("ngModel",e.code),t.xp6(3),t.Q6J("ngModel",e.updateVariantName),t.xp6(2),t.Oqu(t.lcZ(13,11,"catalog.auto-update-option-variant-name")),t.xp6(2),t.Q6J("ngIf",e.customFields.length))},dependencies:[f.MgK,f.KKC,f.PEh,_.O5,d.Fj,d.Wl,d.JJ,d.Q7,d.c5,d.On,M.h,F.y,ft.n,ot.q,ut.y,b.X$,Y.j],changeDetection:0});class Rt{constructor(n,e){this.bulkActionRegistryService=n,this.pageService=e,n.registerBulkAction(en),n.registerBulkAction(Xe),n.registerBulkAction(nn),n.registerBulkAction(tn),n.registerBulkAction(on),n.registerBulkAction(We),n.registerBulkAction(an),n.registerBulkAction(Ee),n.registerBulkAction(Be),n.registerBulkAction(Ge),n.registerBulkAction(Me),n.registerBulkAction(Qe),n.registerBulkAction(qe),n.registerBulkAction(Ue),n.registerBulkAction(cn),n.registerBulkAction(sn),n.registerBulkAction(rn),e.registerPageTab({priority:0,location:"product-list",tab:(0,p.J)("catalog.products"),route:"",component:kt}),e.registerPageTab({priority:0,location:"product-detail",tab:(0,p.J)("catalog.product"),route:"",component:(0,c.IX9)({component:dt,query:c.R2H,entityKey:"product",getBreadcrumbs:i=>[{label:i?i.name:(0,p.J)("catalog.create-new-product"),link:[i?.id]}]})}),e.registerPageTab({priority:0,location:"product-list",tab:(0,p.J)("catalog.product-variants"),route:"variants",component:lt}),e.registerPageTab({priority:0,location:"stock-location-detail",tab:(0,p.J)("catalog.stock-location"),route:"",component:(0,c.IX9)({component:Bt,query:c.D4,entityKey:"stockLocation",getBreadcrumbs:i=>[{label:i?i.name:(0,p.J)("catalog.create-new-stock-location"),link:[i?.id]}]})}),e.registerPageTab({priority:0,location:"product-list",tab:(0,p.J)("catalog.stock-locations"),route:"stock-locations",component:wt}),e.registerPageTab({priority:0,location:"product-variant-detail",tab:(0,p.J)("catalog.product-variants"),route:"",component:(0,c.IX9)({component:Dt,query:c.EB8,entityKey:"productVariant",getBreadcrumbs:i=>[{label:`${i?.product.name}`,link:["/catalog","inventory",i?.product.id]},{label:`${i?.name} (${i?.sku})`,link:["variants",i?.id]}]})}),e.registerPageTab({priority:0,location:"facet-list",tab:(0,p.J)("catalog.facets"),route:"",component:Lt}),e.registerPageTab({priority:0,location:"facet-detail",tab:(0,p.J)("catalog.facet"),route:"",component:(0,c.IX9)({component:Ft,query:c.m_w,entityKey:"facet",getBreadcrumbs:i=>[{label:i?i.name:(0,p.J)("catalog.create-new-facet"),link:[i?.id]}]})}),e.registerPageTab({priority:0,location:"collection-list",tab:(0,p.J)("catalog.collections"),route:"",component:yt}),e.registerPageTab({priority:0,location:"collection-detail",tab:(0,p.J)("catalog.collection"),route:"",component:(0,c.IX9)({component:At,query:c.B3M,entityKey:"collection",getBreadcrumbs:i=>[{label:i?i.name:(0,p.J)("catalog.create-new-collection"),link:[i?.id]}]})}),e.registerPageTab({priority:0,location:"asset-list",tab:(0,p.J)("catalog.assets"),route:"",component:Tt}),e.registerPageTab({priority:0,location:"asset-detail",tab:(0,p.J)("catalog.asset"),route:"",component:(0,c.IX9)({component:bt,query:c.SS8,entityKey:"asset",getBreadcrumbs:i=>[{label:`${i?.name}`,link:[i?.id]}]})})}}Rt.\u0275fac=function(n){return new(n||Rt)(t.LFG(c._4w),t.LFG(c.PhL))},Rt.\u0275mod=t.oAB({type:Rt}),Rt.\u0275inj=t.cJS({providers:[{provide:Z.Z6,useFactory:o=>Ze(o),multi:!0,deps:[c.PhL]}],imports:[c.m81,Z.Bz.forChild([])]});const Nl=A.Ps`
    fragment ProductListQueryProductFragment on Product {
        id
        createdAt
        updatedAt
        enabled
        languageCode
        name
        slug
        featuredAsset {
            id
            createdAt
            updatedAt
            preview
            focalPoint {
                x
                y
            }
        }
        variantList {
            totalItems
        }
    }
`,Vl=A.Ps`
    query ProductListQuery($options: ProductListOptions) {
        products(options: $options) {
            items {
                ...ProductListQueryProductFragment
            }
            totalItems
        }
    }
    ${Nl}
`,Ce=A.Ps`
    fragment ProductVariantDetailQueryProductVariantFragment on ProductVariant {
        id
        createdAt
        updatedAt
        enabled
        languageCode
        name
        price
        currencyCode
        prices {
            price
            currencyCode
        }
        priceWithTax
        stockOnHand
        stockAllocated
        trackInventory
        outOfStockThreshold
        useGlobalOutOfStockThreshold
        taxRateApplied {
            id
            name
            value
        }
        taxCategory {
            id
            name
        }
        sku
        options {
            ...ProductOption
        }
        stockLevels {
            id
            createdAt
            updatedAt
            stockOnHand
            stockAllocated
            stockLocationId
            stockLocation {
                id
                createdAt
                updatedAt
                name
            }
        }
        facetValues {
            id
            code
            name
            facet {
                id
                name
            }
        }
        featuredAsset {
            ...Asset
        }
        assets {
            ...Asset
        }
        translations {
            id
            languageCode
            name
        }
        channels {
            id
            code
        }
        product {
            id
            name
            optionGroups {
                id
                name
                code
                translations {
                    id
                    languageCode
                    name
                }
            }
        }
    }
`,Ul=A.Ps`
    query GetProductVariantDetail($id: ID!) {
        productVariant(id: $id) {
            ...ProductVariantDetailQueryProductVariantFragment
        }
        stockLocations(options: { take: 100 }) {
            items {
                id
                createdAt
                updatedAt
                name
                description
            }
        }
        taxCategories(options: { take: 100 }) {
            items {
                id
                createdAt
                updatedAt
                name
                isDefault
            }
            totalItems
        }
        activeChannel {
            id
            availableCurrencyCodes
            defaultCurrencyCode
        }
    }
    ${Ce}
`,Ml=A.Ps`
    mutation ProductVariantUpdateMutation($input: [UpdateProductVariantInput!]!) {
        updateProductVariants(input: $input) {
            ...ProductVariantDetailQueryProductVariantFragment
        }
    }
    ${Ce}
`,Ql=A.Ps`
    fragment ProductVariantListQueryProductVariantFragment on ProductVariant {
        id
        createdAt
        updatedAt
        productId
        enabled
        languageCode
        name
        price
        currencyCode
        priceWithTax
        trackInventory
        outOfStockThreshold
        stockLevels {
            id
            createdAt
            updatedAt
            stockLocationId
            stockOnHand
            stockAllocated
            stockLocation {
                id
                createdAt
                updatedAt
                name
            }
        }
        useGlobalOutOfStockThreshold
        sku
        featuredAsset {
            ...Asset
        }
    }

    ${c.fed}
`,ql=A.Ps`
    query ProductVariantListQuery($options: ProductVariantListOptions!) {
        productVariants(options: $options) {
            items {
                ...ProductVariantListQueryProductVariantFragment
            }
            totalItems
        }
    }
    ${Ql}
`}}]);
//# sourceMappingURL=938.eb1c99978ac4f07a.js.map